/*
 (C) Andrea Giammarchi - @WebReflection - Mit Style License */
(function(e,t){function Ht(){var e=wt.splice(0,wt.length);Et=0;while(e.length)e.shift().call(null,e.shift())}function Bt(e,t){for(var n=0,r=e.length;n<r;n++)Jt(e[n],t)}function jt(e){for(var t=0,n=e.length,r;t<n;t++)r=e[t],Pt(r,A[It(r)])}function Ft(e){return function(t){ut(t)&&(Jt(t,e),O.length&&Bt(t.querySelectorAll(O),e))}}function It(e){var t=ht.call(e,"is"),n=e.nodeName.toUpperCase(),r=_.call(L,t?N+t.toUpperCase():T+n);return t&&-1<r&&!qt(n,t)?-1:r}function qt(e,t){return-1<O.indexOf(e+'[is\x3d"'+
t+'"]')}function Rt(e){var t=e.currentTarget,n=e.attrChange,r=e.attrName,i=e.target,s=e[y]||2,o=e[w]||3;kt&&(!i||i===t)&&t[h]&&r!=="style"&&(e.prevValue!==e.newValue||e.newValue===""&&(n===s||n===o))&&t[h](r,n===s?null:e.prevValue,n===o?null:e.newValue)}function Ut(e){var t=Ft(e);return function(e){wt.push(t,e.target),Et&&clearTimeout(Et),Et=setTimeout(Ht,1)}}function zt(e){Ct&&(Ct=!1,e.currentTarget.removeEventListener(S,zt)),O.length&&Bt((e.target||n).querySelectorAll(O),e.detail===l?l:a),st&&Vt()}
function Wt(e,t){var n=this;vt.call(n,e,t),Lt.call(n,{target:n})}function Xt(e,t){nt(e,t),Mt?Mt.observe(e,yt):(Nt&&(e.setAttribute=Wt,e[o]=Ot(e),e[u](x,Lt)),e[u](E,Rt)),e[m]&&kt&&(e.created=!0,e[m](),e.created=!1)}function Vt(){for(var e,t=0,n=at.length;t<n;t++)e=at[t],M.contains(e)||(n--,at.splice(t--,1),Jt(e,l))}function $t(e){throw new Error("A "+e+" type is already registered");}function Jt(e,t){var n,r=It(e);-1<r&&(Dt(e,A[r]),r=0,t===a&&!e[a]?(e[l]=!1,e[a]=!0,r=1,st&&_.call(at,e)<0&&at.push(e)):
t===l&&!e[l]&&(e[a]=!1,e[l]=!0,r=1),r&&(n=e[t+f])&&n.call(e))}function Kt(){}function Qt(e,t,r){var i=r&&r[c]||"",o=t.prototype,u=tt(o),a=t.observedAttributes||j,f={prototype:u};ot(u,m,{value:function(){if(Q)Q=!1;else if(!this[W]){this[W]=!0,new t(this),o[m]&&o[m].call(this);var e=G[Z.get(t)];(!V||e.create.length>1)&&Zt(this)}}}),ot(u,h,{value:function(e){-1<_.call(a,e)&&o[h].apply(this,arguments)}}),o[d]&&ot(u,p,{value:o[d]}),o[v]&&ot(u,g,{value:o[v]}),i&&(f[c]=i),e=e.toUpperCase(),G[e]={constructor:t,
create:i?[i,et(e)]:[e]},Z.set(t,e),n[s](e.toLowerCase(),f),en(e),Y[e].r()}function Gt(e){var t=G[e.toUpperCase()];return t&&t.constructor}function Yt(e){return typeof e=="string"?e:e&&e.is||""}function Zt(e){var t=e[h],n=t?e.attributes:j,r=n.length,i;while(r--)i=n[r],t.call(e,i.name||i.nodeName,null,i.value||i.nodeValue)}function en(e){return e=e.toUpperCase(),e in Y||(Y[e]={},Y[e].p=new K(function(t){Y[e].r=t})),Y[e].p}function tn(){X&&delete e.customElements,B(e,"customElements",{configurable:!0,
value:new Kt}),B(e,"CustomElementRegistry",{configurable:!0,value:Kt});for(var t=function(t){var r=e[t];if(r){e[t]=function(t){var i,s;return t||(t=this),t[W]||(Q=!0,i=G[Z.get(t.constructor)],s=V&&i.create.length===1,t=s?Reflect.construct(r,j,i.constructor):n.createElement.apply(n,i.create),t[W]=!0,Q=!1,s||Zt(t)),t},e[t].prototype=r.prototype;try{r.prototype.constructor=e[t]}catch(i){z=!0,B(r,W,{value:e[t]})}}},r=i.get(/^HTML[A-Z]*[a-z]/),o=r.length;o--;t(r[o]));n.createElement=function(e,t){var n=
Yt(t);return n?gt.call(this,e,et(n)):gt.call(this,e)},St||(Tt=!0,n[s](""))}var n=e.document,r=e.Object,i=function(e){var t=/^[A-Z]+[a-z]/,n=function(e){var t=[],n;for(n in s)e.test(n)&&t.push(n);return t},i=function(e,t){t=t.toLowerCase(),t in s||(s[e]=(s[e]||[]).concat(t),s[t]=s[t.toUpperCase()]=e)},s=(r.create||r)(null),o={},u,a,f,l;for(a in e)for(l in e[a]){f=e[a][l],s[l]=f;for(u=0;u<f.length;u++)s[f[u].toLowerCase()]=s[f[u].toUpperCase()]=l}return o.get=function(r){return typeof r=="string"?s[r]||
(t.test(r)?[]:""):n(r)},o.set=function(n,r){return t.test(n)?i(n,r):i(r,n),o},o}({collections:{HTMLAllCollection:["all"],HTMLCollection:["forms"],HTMLFormControlsCollection:["elements"],HTMLOptionsCollection:["options"]},elements:{Element:["element"],HTMLAnchorElement:["a"],HTMLAppletElement:["applet"],HTMLAreaElement:["area"],HTMLAttachmentElement:["attachment"],HTMLAudioElement:["audio"],HTMLBRElement:["br"],HTMLBaseElement:["base"],HTMLBodyElement:["body"],HTMLButtonElement:["button"],HTMLCanvasElement:["canvas"],
HTMLContentElement:["content"],HTMLDListElement:["dl"],HTMLDataElement:["data"],HTMLDataListElement:["datalist"],HTMLDetailsElement:["details"],HTMLDialogElement:["dialog"],HTMLDirectoryElement:["dir"],HTMLDivElement:["div"],HTMLDocument:["document"],HTMLElement:["element","abbr","address","article","aside","b","bdi","bdo","cite","code","command","dd","dfn","dt","em","figcaption","figure","footer","header","i","kbd","mark","nav","noscript","rp","rt","ruby","s","samp","section","small","strong","sub",
"summary","sup","u","var","wbr"],HTMLEmbedElement:["embed"],HTMLFieldSetElement:["fieldset"],HTMLFontElement:["font"],HTMLFormElement:["form"],HTMLFrameElement:["frame"],HTMLFrameSetElement:["frameset"],HTMLHRElement:["hr"],HTMLHeadElement:["head"],HTMLHeadingElement:["h1","h2","h3","h4","h5","h6"],HTMLHtmlElement:["html"],HTMLIFrameElement:["iframe"],HTMLImageElement:["img"],HTMLInputElement:["input"],HTMLKeygenElement:["keygen"],HTMLLIElement:["li"],HTMLLabelElement:["label"],HTMLLegendElement:["legend"],
HTMLLinkElement:["link"],HTMLMapElement:["map"],HTMLMarqueeElement:["marquee"],HTMLMediaElement:["media"],HTMLMenuElement:["menu"],HTMLMenuItemElement:["menuitem"],HTMLMetaElement:["meta"],HTMLMeterElement:["meter"],HTMLModElement:["del","ins"],HTMLOListElement:["ol"],HTMLObjectElement:["object"],HTMLOptGroupElement:["optgroup"],HTMLOptionElement:["option"],HTMLOutputElement:["output"],HTMLParagraphElement:["p"],HTMLParamElement:["param"],HTMLPictureElement:["picture"],HTMLPreElement:["pre"],HTMLProgressElement:["progress"],
HTMLQuoteElement:["blockquote","q","quote"],HTMLScriptElement:["script"],HTMLSelectElement:["select"],HTMLShadowElement:["shadow"],HTMLSlotElement:["slot"],HTMLSourceElement:["source"],HTMLSpanElement:["span"],HTMLStyleElement:["style"],HTMLTableCaptionElement:["caption"],HTMLTableCellElement:["td","th"],HTMLTableColElement:["col","colgroup"],HTMLTableElement:["table"],HTMLTableRowElement:["tr"],HTMLTableSectionElement:["thead","tbody","tfoot"],HTMLTemplateElement:["template"],HTMLTextAreaElement:["textarea"],
HTMLTimeElement:["time"],HTMLTitleElement:["title"],HTMLTrackElement:["track"],HTMLUListElement:["ul"],HTMLUnknownElement:["unknown","vhgroupv","vkeygen"],HTMLVideoElement:["video"]},nodes:{Attr:["node"],Audio:["audio"],CDATASection:["node"],CharacterData:["node"],Comment:["#comment"],Document:["#document"],DocumentFragment:["#document-fragment"],DocumentType:["node"],HTMLDocument:["#document"],Image:["img"],Option:["option"],ProcessingInstruction:["node"],ShadowRoot:["#shadow-root"],Text:["#text"],
XMLDocument:["xml"]}});t||(t="auto");var s="registerElement",o="__"+s+(e.Math.random()*1E5>>0),u="addEventListener",a="attached",f="Callback",l="detached",c="extends",h="attributeChanged"+f,p=a+f,d="connected"+f,v="disconnected"+f,m="created"+f,g=l+f,y="ADDITION",b="MODIFICATION",w="REMOVAL",E="DOMAttrModified",S="DOMContentLoaded",x="DOMSubtreeModified",T="\x3c",N="\x3d",C=/^[A-Z][A-Z0-9]*(?:-[A-Z0-9]+)+$/,k=["ANNOTATION-XML","COLOR-PROFILE","FONT-FACE","FONT-FACE-SRC","FONT-FACE-URI","FONT-FACE-FORMAT",
"FONT-FACE-NAME","MISSING-GLYPH"],L=[],A=[],O="",M=n.documentElement,_=L.indexOf||function(e){for(var t=this.length;t--&&this[t]!==e;);return t},D=r.prototype,P=D.hasOwnProperty,H=D.isPrototypeOf,B=r.defineProperty,j=[],F=r.getOwnPropertyDescriptor,I=r.getOwnPropertyNames,q=r.getPrototypeOf,R=r.setPrototypeOf,U=!!r.__proto__,z=!1,W="__dreCEv1",X=e.customElements,V=t!=="force"&&!!(X&&X.define&&X.get&&X.whenDefined),$=r.create||r,J=e.Map||function(){var t=[],n=[],r;return{get:function(e){return n[_.call(t,
e)]},set:function(e,i){r=_.call(t,e),r<0?n[t.push(e)-1]=i:n[r]=i}}},K=e.Promise||function(e){function i(e){n=!0;while(t.length)t.shift()(e)}var t=[],n=!1,r={"catch":function(){return r},then:function(e){return t.push(e),n&&setTimeout(i,1),r}};return e(i),r},Q=!1,G=$(null),Y=$(null),Z=new J,et=function(e){return e.toLowerCase()},tt=r.create||function sn(e){return e?(sn.prototype=e,new sn):this},nt=R||(U?function(e,t){return e.__proto__=t,e}:I&&F?function(){function e(e,t){for(var n,r=I(t),i=0,s=r.length;i<
s;i++)n=r[i],P.call(e,n)||B(e,n,F(t,n))}return function(t,n){do e(t,n);while((n=q(n))&&!H.call(n,t));return t}}():function(e,t){for(var n in t)e[n]=t[n];return e}),rt=e.MutationObserver||e.WebKitMutationObserver,it=(e.HTMLElement||e.Element||e.Node).prototype,st=!H.call(it,M),ot=st?function(e,t,n){return e[t]=n.value,e}:B,ut=st?function(e){return e.nodeType===1}:function(e){return H.call(it,e)},at=st&&[],ft=it.attachShadow,lt=it.cloneNode,ct=it.dispatchEvent,ht=it.getAttribute,pt=it.hasAttribute,
dt=it.removeAttribute,vt=it.setAttribute,mt=n.createElement,gt=mt,yt=rt&&{attributes:!0,characterData:!0,attributeOldValue:!0},bt=rt||function(e){Nt=!1,M.removeEventListener(E,bt)},wt,Et=0,St=s in n,xt=!0,Tt=!1,Nt=!0,Ct=!0,kt=!0,Lt,At,Ot,Mt,_t,Dt,Pt;St||(R||U?(Dt=function(e,t){H.call(t,e)||Xt(e,t)},Pt=Xt):(Dt=function(e,t){e[o]||(e[o]=r(!0),Xt(e,t))},Pt=Dt),st?(Nt=!1,function(){var e=F(it,u),t=e.value,n=function(e){var t=new CustomEvent(E,{bubbles:!0});t.attrName=e,t.prevValue=ht.call(this,e),t.newValue=
null,t[w]=t.attrChange=2,dt.call(this,e),ct.call(this,t)},r=function(e,t){var n=pt.call(this,e),r=n&&ht.call(this,e),i=new CustomEvent(E,{bubbles:!0});vt.call(this,e,t),i.attrName=e,i.prevValue=n?r:null,i.newValue=t,n?i[b]=i.attrChange=1:i[y]=i.attrChange=0,ct.call(this,i)},i=function(e){var t=e.currentTarget,n=t[o],r=e.propertyName,i;n.hasOwnProperty(r)&&(n=n[r],i=new CustomEvent(E,{bubbles:!0}),i.attrName=n.name,i.prevValue=n.value||null,i.newValue=n.value=t[r]||null,i.prevValue==null?i[y]=i.attrChange=
0:i[b]=i.attrChange=1,ct.call(t,i))};e.value=function(e,s,u){e===E&&this[h]&&this.setAttribute!==r&&(this[o]={className:{name:"class",value:this.className}},this.setAttribute=r,this.removeAttribute=n,t.call(this,"propertychange",i)),t.call(this,e,s,u)},B(it,u,e)}()):rt||(M[u](E,bt),M.setAttribute(o,1),M.removeAttribute(o),Nt&&(Lt=function(e){var t=this,n,r,i;if(t===e.target){n=t[o],t[o]=r=Ot(t);for(i in r){if(!(i in n))return At(0,t,i,n[i],r[i],y);if(r[i]!==n[i])return At(1,t,i,n[i],r[i],b)}for(i in n)if(!(i in
r))return At(2,t,i,n[i],r[i],w)}},At=function(e,t,n,r,i,s){var o={attrChange:e,currentTarget:t,attrName:n,prevValue:r,newValue:i};o[s]=e,Rt(o)},Ot=function(e){for(var t,n,r={},i=e.attributes,s=0,o=i.length;s<o;s++)t=i[s],n=t.name,n!=="setAttribute"&&(r[n]=t.value);return r})),n[s]=function(t,r){p=t.toUpperCase(),xt&&(xt=!1,rt?(Mt=function(e,t){function n(e,t){for(var n=0,r=e.length;n<r;t(e[n++]));}return new rt(function(r){for(var i,s,o,u=0,a=r.length;u<a;u++)i=r[u],i.type==="childList"?(n(i.addedNodes,
e),n(i.removedNodes,t)):(s=i.target,kt&&s[h]&&i.attributeName!=="style"&&(o=ht.call(s,i.attributeName),o!==i.oldValue&&s[h](i.attributeName,i.oldValue,o)))})}(Ft(a),Ft(l)),_t=function(e){return Mt.observe(e,{childList:!0,subtree:!0}),e},_t(n),ft&&(it.attachShadow=function(){return _t(ft.apply(this,arguments))})):(wt=[],n[u]("DOMNodeInserted",Ut(a)),n[u]("DOMNodeRemoved",Ut(l))),n[u](S,zt),n[u]("readystatechange",zt),it.cloneNode=function(e){var t=lt.call(this,!!e),n=It(t);return-1<n&&Pt(t,A[n]),e&&
O.length&&jt(t.querySelectorAll(O)),t});if(Tt)return Tt=!1;-2<_.call(L,N+p)+_.call(L,T+p)&&$t(t);if(!C.test(p)||-1<_.call(k,p))throw new Error("The type "+t+" is invalid");var i=function(){return o?n.createElement(f,p):n.createElement(f)},s=r||D,o=P.call(s,c),f=o?r[c].toUpperCase():p,p,d;return o&&-1<_.call(L,T+f)&&$t(f),d=L.push((o?N:T)+p)-1,O=O.concat(O.length?",":"",o?f+'[is\x3d"'+t.toLowerCase()+'"]':f),i.prototype=A[d]=P.call(s,"prototype")?s.prototype:tt(it),O.length&&Bt(n.querySelectorAll(O),
a),i},n.createElement=gt=function(e,t){var r=Yt(t),i=r?mt.call(n,e,et(r)):mt.call(n,e),s=""+e,o=_.call(L,(r?N:T)+(r||s).toUpperCase()),u=-1<o;return r&&(i.setAttribute("is",r=r.toLowerCase()),u&&(u=qt(s.toUpperCase(),r))),kt=!n.createElement.innerHTMLHelper,u&&Pt(i,A[o]),i}),Kt.prototype={constructor:Kt,define:V?function(e,t,n){if(n)Qt(e,t,n);else{var r=e.toUpperCase();G[r]={constructor:t,create:[r]},Z.set(t,r),X.define(e,t)}}:Qt,get:V?function(e){return X.get(e)||Gt(e)}:Gt,whenDefined:V?function(e){return K.race([X.whenDefined(e),
en(e)])}:en};if(!X||t==="force")tn();else try{(function(t,r,i){r[c]="a",t.prototype=tt(HTMLAnchorElement.prototype),t.prototype.constructor=t,e.customElements.define(i,t,r);if(ht.call(n.createElement("a",{is:i}),"is")!==i||V&&ht.call(new t,"is")!==i)throw r;})(function on(){return Reflect.construct(HTMLAnchorElement,[],on)},{},"document-register-element-a")}catch(nn){tn()}try{mt.call(n,"a","a")}catch(rn){et=function(e){return{is:e.toLowerCase()}}}})(window);
void function(){var smoke={};smoke.ok="Ok";smoke.ok_reference=undefined;smoke.cancel="Cancel";smoke.cancel_reference=undefined;smoke.point_event="click";smoke.parent=document.body;smoke.zindex=1E4;smoke.reverse_buttons=false;smoke.autofocus=true;smoke.autoexit=true;smoke.autoclose=true;smoke.custom_css={};smoke.css_prefix="smoke";smoke.value=undefined;smoke.callback=undefined;smoke.observe_mutation=true;smoke.window_opened=undefined;smoke.window_closed=undefined;smoke.use_wrapper=true;smoke.title=
{};smoke.title.text=undefined;smoke.title.close=undefined;smoke.title.close_reference=undefined;smoke.extension=[];smoke.build=function(text,params){if(typeof smoke.parent=="undefined"||smoke.parent==null)smoke.parent=document.body;var ok=typeof params.ok!="undefined"?params.ok:smoke.ok;var ok_reference=typeof params.ok_reference!="undefined"?params.ok_reference:smoke.ok_reference;var cancel=typeof params.cancel!="undefined"?params.cancel:smoke.cancel;var cancel_reference=typeof params.cancel_reference!=
"undefined"?params.cancel_reference:smoke.cancel_reference;var point_event=typeof params.point_event!="undefined"?params.point_event:smoke.point_event;var parent=typeof params.parent!="undefined"?params.parent:smoke.parent;var zindex=typeof params.zindex!="undefined"?params.zindex:smoke.zindex;var reverse_buttons=typeof params.reverse_buttons!="undefined"?params.reverse_buttons:smoke.reverse_buttons;var autoexit=typeof params.autoexit!="undefined"?params.autoexit:smoke.autoexit;var autofocus=typeof params.autofocus!=
"undefined"?params.autofocus:smoke.autofocus;var autoclose=typeof params.autoclose!="undefined"?params.autoclose:smoke.autoclose;var custom_css=typeof params.custom_css!="undefined"?params.custom_css:smoke.custom_css;var css_prefix=typeof params.css_prefix!="undefined"?params.css_prefix:smoke.css_prefix;var input_default_value=typeof params.value!="undefined"?params.value:smoke.value;var callback=typeof params.callback!="undefined"?params.callback:smoke.callback;var observe_mutation=typeof params.observe_mutation!=
"undefined"?params.observe_mutation:smoke.observe_mutation;var title=typeof params.title!="undefined"?merge_objects(smoke.title,params.title):smoke.title;var window_opened=typeof params.window_opened!="undefined"?params.window_opened:smoke.window_opened;var window_closed=typeof params.window_closed!="undefined"?params.window_closed:smoke.window_closed;var use_wrapper=typeof params.use_wrapper!="undefined"?params.use_wrapper:smoke.use_wrapper;var window_closed_ran=false;params.point_event=point_event;
params.callback=callback;params.autoclose=autoclose;var modal=document.createElement("div");modal.className=css_prefix+"-base";modal.style.zIndex=zindex;modal.savedScrollTop=parent.scrollTop;parent.appendChild(modal);if(use_wrapper){var dialog_wrapper=modal.dialog_wrapper=document.createElement("div");dialog_wrapper.className=css_prefix+"-dialog_wrapper";modal.appendChild(dialog_wrapper)}else var dialog_wrapper=modal;if(autoexit)setTimeout(function(){dialog_wrapper.addEventListener(point_event,function(evt){if(evt.currentTarget!=
evt.target)return;evt.stopPropagation();evt.preventDefault();modal.dialog.close(false);if(!window_closed_ran&&smoke.window_closed){smoke.window_closed(modal,text,params);window_closed_ran=true}})},0);var dialog=modal.dialog=document.createElement("div");dialog.className=css_prefix+"-dialog";dialog_wrapper.appendChild(dialog);var buttons=dialog.buttons=document.createElement("div");buttons.className=css_prefix+"-dialog-buttons";if(typeof title.text!="undefined"||typeof title.close!="undefined"||typeof title.close_reference!=
"undefined"){var title_element=dialog.title_element=document.createElement("div");title_element.className=css_prefix+"-dialog-title";if(typeof title.text!="undefined"){var title_text=title_element.text=document.createElement("div");title_text.className=css_prefix+"-dialog-title-text";title_element.appendChild(title_text);title_text.innerHTML=title.text}if(typeof title.close!="undefined"||typeof title.close_reference!="undefined"){if(typeof title.close_reference!="undefined")var title_close=title.close_reference.cloneNode(true);
else{var close_text=title.close;var title_close=document.createElement("button");title_close.innerHTML=close_text}title_close.classList.add(css_prefix+"-dialog-title-close");title_element.title_close=title_close;title_element.appendChild(title_close)}dialog.appendChild(title_element)}var text_div=dialog.text=document.createElement("div");text_div.className=css_prefix+"-dialog-text";text_div.innerHTML=text;dialog.appendChild(text_div);if(params.type=="prompt"){var prompt=modal.dialog.prompt=document.createElement("div");
prompt.className=css_prefix+"-prompt";prompt.input=document.createElement("input");prompt.input.type="text";prompt.input.className=css_prefix+"-prompt-input";if(typeof input_default_value!="undefined")prompt.input.value=input_default_value;prompt.appendChild(prompt.input);dialog.appendChild(prompt)}if(typeof ok_reference!="undefined")buttons.ok=ok_reference.cloneNode(true);else{buttons.ok=document.createElement("button");buttons.ok.classList.add(css_prefix+"-dialog-buttons-ok");buttons.ok.innerHTML=
ok}if(params.type=="prompt"||params.type=="confirm")if(typeof cancel_reference!="undefined")buttons.cancel=cancel_reference.cloneNode(true);else{buttons.cancel=document.createElement("button");buttons.cancel.classList.add(css_prefix+"-dialog-buttons-cancel");buttons.cancel.innerHTML=cancel}switch(params.type){case "alert":buttons.appendChild(buttons.ok);break;case "prompt":case "confirm":if(params.reverse_buttons){buttons.appendChild(buttons.cancel);buttons.appendChild(buttons.ok)}else{buttons.appendChild(buttons.ok);
buttons.appendChild(buttons.cancel)}break}dialog.appendChild(buttons);for(var current_structure_name in custom_css){var property_array=current_structure_name.split(".");var current_element=modal;property_array.forEach(function(current_property){current_element=current_element[current_property]});var current_class_list=custom_css[current_structure_name];if(typeof current_class_list=="string")current_class_list=[current_class_list];current_class_list.forEach(function(current_classname){current_element.classList.add(current_classname)})}if(typeof params.callback!=
"function")params.callback=function(){};modal.dialog.params=params;smoke["finishbuilding_"+params.type](modal,params);if(dialog.title_element&&dialog.title_element.title_close){dialog.title_element.title_close.addEventListener(dialog.params.point_event,dialog.cancel?dialog.cancel:dialog.ok);dialog.title_element.title_close.smoke_pure_modal=modal}if(typeof modal.dialog.prompt!="undefined"&&autofocus!=false)modal.dialog.prompt.input.focus();modal.style.top=modal.savedScrollTop+"px";parent.scrollTop=
modal.savedScrollTop;if(observe_mutation){var MutationObserver=window.MutationObserver||window.WebkitMutationObserver;if(typeof MutationObserver!="undefined"){var observer=dialog.removal_observer=new MutationObserver(function(mutation_list){for(var i=0,curlen_i=mutation_list.length;i<curlen_i;i++){var mutation_item=mutation_list[i];if(mutation_item.type!="childList")return;for(var j=0,curlen_j=mutation_item.removedNodes.length;j<curlen_j;j++){if(mutation_item.removedNodes[j]!=modal)continue;dialog.destroy(observer);
if(!window_closed_ran&&smoke.window_closed){smoke.window_closed(modal,text,params);window_closed_ran=true}return}}});observer.observe(parent,{attributes:false,childList:true,subtree:false})}}dialog.destroy=function(observer){if(modal.parentNode)modal.parentNode.removeChild(modal);if(observer)observer.disconnect();dialog.listener_list.forEach(function(listener){document.removeEventListener(listener.event,listener.callback);dialog.listener_list=[]})};dialog.close=function(truthy){dialog.destroy(dialog.removal_observer);
dialog.params.callback(truthy)};if(smoke.window_opened)smoke.window_opened(modal,text,params);for(var value in params)if(smoke.extension[value])smoke.extension[value](params[value],modal,text,callback,params);return modal};smoke.extend=function(value,func){smoke.extension[value]=func};smoke.finishbuilding_alert=function(modal){var dialog=modal.dialog;dialog.callback_ok=function(){dialog.params.callback()};var ok_function_wrapper=dialog.ok=function(evt){ok_function(evt,modal)};smoke.add_global_listener(dialog,
"keyup",ok_function_wrapper);dialog.buttons.ok.addEventListener(dialog.params.point_event,ok_function_wrapper);dialog.buttons.ok.smoke_pure_modal=modal};smoke.finishbuilding_confirm=function(modal){var dialog=modal.dialog;dialog.callback_ok=function(){dialog.params.callback(true)};dialog.callback_cancel=function(){dialog.params.callback(false)};var ok_function_wrapper=dialog.ok=function(evt){ok_function(evt,modal)};var cancel_function_wrapper=dialog.cancel=function(evt){cancel_function(evt,modal)};
smoke.add_global_listener(dialog,"keyup",ok_function_wrapper);smoke.add_global_listener(dialog,"keyup",cancel_function_wrapper);dialog.buttons.ok.addEventListener(dialog.params.point_event,ok_function_wrapper);dialog.buttons.cancel.addEventListener(dialog.params.point_event,cancel_function_wrapper);dialog.buttons.ok.smoke_pure_modal=modal;dialog.buttons.cancel.smoke_pure_modal=modal};smoke.finishbuilding_prompt=function(modal){var dialog=modal.dialog;dialog.callback_ok=function(){dialog.params.callback(dialog.prompt.input.value)};
dialog.callback_cancel=function(){dialog.params.callback(false)};var ok_function_wrapper=dialog.ok=function(evt){ok_function(evt,modal)};var cancel_function_wrapper=dialog.cancel=function(evt){cancel_function(evt,modal)};smoke.add_global_listener(dialog,"keyup",ok_function_wrapper);smoke.add_global_listener(dialog,"keyup",cancel_function_wrapper);dialog.buttons.ok.addEventListener(dialog.params.point_event,ok_function_wrapper);dialog.buttons.cancel.addEventListener(dialog.params.point_event,cancel_function_wrapper);
dialog.buttons.ok.smoke_pure_modal=modal;dialog.buttons.cancel.smoke_pure_modal=modal};smoke.add_global_listener=function(dialog,event,callback){document.addEventListener(event,callback);if(typeof dialog.listener_list=="undefined")dialog.listener_list=[];dialog.listener_list.push({"event":event,"callback":callback})};function ok_function(evt,modal){if(evt&&(evt.type=="keyup"&&typeof evt.keyCode!="undefined"&&(evt.keyCode==0||evt.keyCode!=13)))return;if(modal.dialog.params.autoclose)modal.dialog.destroy(modal.dialog.removal_observer);
modal.dialog.callback_ok()}function cancel_function(evt,modal){if(evt&&(evt.type=="keyup"&&typeof evt.keyCode!="undefined"&&(evt.keyCode==0||evt.keyCode!=27)))return;if(modal.dialog.params.autoclose)modal.dialog.destroy(modal.dialog.removal_observer);modal.dialog.callback_cancel()}smoke.action_list=[{name:"alert"},{name:"confirm"},{name:"prompt"}];smoke.action_list.forEach(function(current_action_entry){var current_action=current_action_entry.name;smoke[current_action]=function(text,callback,params){return smoke.build(text,
merge_objects({callback:callback,type:current_action},params))}});function merge_objects(secondary,primary){if(typeof secondary=="undefined")var primary=primary.primary,secondary=primary.secondary;var new_object={};for(var property in secondary)new_object[property]=secondary[property];for(var property in primary)new_object[property]=primary[property];return new_object}if(typeof module!="undefined"&&module.exports)module.exports=smoke;else if(typeof define==="function"&&define.amd)define("smoke",[],
function(){return smoke});else this.smoke=smoke}();
function ListMenu(settings){var listmenu={};if(typeof settings=="undefined")settings={};listmenu.container_tag=typeof settings.container_tag!="undefined"?settings.container_tag.toLowerCase():"ul";listmenu.list_item_tag=typeof settings.list_item_tag!="undefined"?settings.list_item_tag.toLowerCase():"li";listmenu.css_lit_class="highlighted";listmenu.show_delay=typeof settings.show_delay!="undefined"?settings.show_delay:500;listmenu.hide_delay=typeof settings.hide_delay!="undefined"?settings.hide_delay:
250;listmenu.hide_stick_delay=typeof settings.hide_stick_delay!="undefined"?settings.hide_stick_delay:150;listmenu.show_stick_delay=typeof settings.show_stick_delay!="undefined"?settings.show_stick_delay:0;listmenu.touch_events="touch_events"in settings?settings.touch_events:false;listmenu.hide_on_touch_elsewhere="hide_on_touch_elsewhere"in settings?settings.hide_on_touch_elsewhere:true;listmenu.show_on_click="show_on_click"in settings?settings.show_on_click:false;listmenu.hide_on_click="hide_on_click"in
settings?settings.hide_on_click:false;listmenu.hide_on_left_click="hide_on_left_click"in settings?settings.hide_on_left_click:true;listmenu.show_on_mouseover="show_on_mouseover"in settings?settings.show_on_mouseover:true;listmenu.hide_on_mouseover="hide_on_mouseover"in settings?settings.hide_on_mouseover:true;listmenu.animate="animate"in settings?settings.animate:undefined;listmenu.show_process_timeout_time=typeof settings.show_process_timeout_time!="undefined"?settings.show_process_timeout_time:
25;listmenu.hide_process_timeout_time=typeof settings.hide_process_timeout_time!="undefined"?settings.hide_process_timeout_time:25;var highlight=listmenu.highlight=function(obj){if(typeof obj.listmenu_settings=="undefined")obj.listmenu_settings={};if(typeof obj.listmenu_settings.selected!="undefined"&&obj.listmenu_settings.selected==false)return;obj.classList.add(listmenu.css_lit_class)};var unhighlight=listmenu.unhighlight=function(obj){if(typeof obj.listmenu_settings=="undefined")obj.listmenu_settings=
{};if(typeof obj.listmenu_settings.selected!="undefined"&&obj.listmenu_settings.selected==true)return;obj.classList.remove(listmenu.css_lit_class)};var set_selected=listmenu.set_selected=function(obj){if(typeof obj.listmenu_settings=="undefined")obj.listmenu_settings={};if(obj.listmenu_settings.unselectable)return;obj.listmenu_settings.selected=true;highlight(obj)};var clear_selected=listmenu.clear_selected=function(obj){if(typeof obj.listmenu_settings=="undefined")obj.listmenu_settings={};obj.listmenu_settings.selected=
false;unhighlight(obj)};var toggle_selected=listmenu.toggle_selected=function(obj){if(typeof obj.listmenu_settings=="undefined")obj.listmenu_settings={};obj.listmenu_settings.selected=!obj.listmenu_settings.selected;if(obj.listmenu_settings.selected==true)highlight(obj);else unhighlight(obj)};var queued_events=[];listmenu.create_menu=function(obj,settings){if(typeof settings=="undefined")settings={};var settings_touch_events="touch_events"in settings?settings.touch_events:listmenu.touch_events;var settings_hide_on_touch_elsewhere=
"hide_on_touch_elsewhere"in settings?settings.hide_on_touch_elsewhere:listmenu.hide_on_touchdown;var settings_show_on_click="show_on_click"in settings?settings.show_on_click:listmenu.show_on_click;var settings_hide_on_click="hide_on_click"in settings?settings.hide_on_click:listmenu.hide_on_click;var settings_hide_on_left_click="hide_on_left_click"in settings?settings.hide_on_left_click:listmenu.hide_on_left_click;var settings_show_on_mouseover="show_on_mouseover"in settings?settings.show_on_mouseover:
listmenu.show_on_mouseover;var settings_hide_on_mouseover="hide_on_mouseover"in settings?settings.hide_on_mouseover:listmenu.hide_on_mouseover;obj.is_open=false;recurse_gen(obj);if(settings_touch_events&&settings_hide_on_touch_elsewhere){document.addEventListener("mousedown",body_touchstart_listener);function body_touchstart_listener(evt){if(obj instanceof HTMLElement==false||is_attached(obj)==false)document.body.removeEventListener("mousedown",body_touchstart_listener);if(obj==evt.target||obj.contains(evt.target))return;
evt.stopPropagation();if(obj.listmenu_settings.is_open==false)return;listmenu.unhighlight(obj);listmenu.close(obj)}}function recurse_gen(obj){if(obj.tagName.toLowerCase()==listmenu.container_tag)var container=obj;else var container=obj.querySelector(listmenu.container_tag);if(typeof container.listmenu_settings=="undefined")container.listmenu_settings={};var is_root=typeof container.listmenu_settings.parent=="undefined";var list_items=container.listmenu_settings.children=get_elements_until(container,
listmenu.list_item_tag,listmenu.container_tag);if(!is_root)container.style.display="none";list_items.forEach(function(list_item){if(typeof list_item.listmenu_settings=="undefined")list_item.listmenu_settings={};if(typeof list_item.listmenu_settings.is_open=="undefined")list_item.listmenu_settings.is_open=false;if(typeof list_item.listmenu_settings.hide_on_left_click=="undefined")list_item.listmenu_settings.hide_on_left_click=settings_hide_on_left_click;list_item.listmenu_settings.parent=container;
var child_child=list_item.querySelector(listmenu.container_tag);if(child_child!=null){list_item.listmenu_settings.children=[child_child];if(typeof child_child.listmenu_settings=="undefined")child_child.listmenu_settings={};child_child.listmenu_settings.parent=list_item;recurse_gen(child_child)}else list_item.listmenu_settings.children=[];if(settings_touch_events==true)list_item.addEventListener("touchstart",show_event);else{if(settings_hide_on_click==true&&settings_hide_on_click==true)list_item.addEventListener("mouseup",
show_or_hide_event);else{if(settings_hide_on_click==true)list_item.addEventListener("mouseup",function(evt){hide_event(evt,true,true)});if(settings_show_on_click==true)list_item.addEventListener("mouseup",function(evt){show_event(evt,true,true)})}if(settings_hide_on_mouseover==true)list_item.addEventListener("mouseout",hide_event);if(settings_show_on_mouseover==true)list_item.addEventListener("mouseover",show_event)}list_item.addEventListener(settings_touch_events==true?"touchstart":"mouseup",click_event)})}
};function clear_queued_events(){queued_events.forEach(function(queued_event){clearTimeout(queued_event)});queued_events=[]}function show_or_hide_event(evt){if(hide_event(evt,true,true)==false)show_event(evt,true,true)}function hide_event(evt,hide_on_click,is_immediate){var list_item=evt.currentTarget;if(typeof hide_on_click!="undefined"&&hide_on_click==true){if(list_item.listmenu_settings.hide_on_left_click==false&&("which"in evt&&evt.which==3||"button"in evt&&evt.button==3))return false;if(list_item.listmenu_settings.is_open==
false)return false;var container_list=list_item.listmenu_settings.children}else{var container_list=[list_item.listmenu_settings.parent];if(container_list[0].contains(evt.relatedTarget))return false}clear_queued_events();if(listmenu.hide_stick_delay==0||is_immediate==true)return hide_event_cont();else queued_events.push(setTimeout(hide_event_cont,listmenu.hide_stick_delay));function hide_event_cont(){container_list.forEach(function(container){var hide_list=container.listmenu_settings.parent?hide_children(container.listmenu_settings.parent):
hide_grandchildren(container,0);begin_process(hide_list,"hide")});return true}}function show_event(evt,show_on_click,is_immediate){evt.stopPropagation();var list_item=evt.currentTarget;if(show_on_click&&("which"in evt&&evt.which==3||"button"in evt&&evt.button==3))return false;if(show_on_click&&list_item.listmenu_settings.is_open==true)return false;clear_queued_events();if(listmenu.show_stick_delay==0||is_immediate==true)return show_event_cont();else queued_events.push(setTimeout(show_event_cont,listmenu.show_stick_delay));
function show_event_cont(){if(show_on_click&&list_item.listmenu_settings.is_open==true)return false;var show_list=show_children(list_item);var hide_list=[];list_item.listmenu_settings.parent.listmenu_settings.children.forEach(function(sibling){if(sibling!=list_item)hide_list=hide_list.concat(hide_children(sibling))});begin_process(show_list,"show");begin_process(hide_list,"hide");return true}}function show_children(list_item,record){var display_type=typeof list_item.listmenu_settings.parent!="undefined"?
"block":"inline-block";var children=list_item.listmenu_settings.children;return children}function hide_children(list_item,level){var children=list_item.listmenu_settings.children;var descendant_list=children;children.forEach(function(container){if(typeof container.listmenu_settings.children!="undefined")descendant_list=descendant_list.concat(hide_grandchildren(container,level))});return descendant_list}function hide_grandchildren(container,level){var new_level=typeof level!="undefined"?level+1:undefined;
var children=container.listmenu_settings.children;var descendant_list=[];children.forEach(function(list_item){if(typeof level=="undefined"||level>0)listmenu.unhighlight(list_item);descendant_list=descendant_list.concat(hide_children(list_item,new_level))});return descendant_list}function begin_process(showhide_list,showhide,options){showhide_list.forEach(function(entry){if(typeof entry.listmenu_settings.parent=="undefined")return;entry.listmenu_settings.parent.listmenu_settings.is_open=showhide==
"show"?true:false});if(typeof listmenu.animate=="undefined")return;if(typeof options=="undefined")options={};var showhide_delay="instant"in options&&options.instant==true?0:listmenu[showhide+"_delay"];var showhide_list_new=[];var j=0;showhide_list.forEach(function(obj){var obj=showhide_list[i];if(typeof obj.listmenu_settings=="undefined")obj.listmenu_settings={};if(typeof obj.listmenu_settings.showhide_list!="undefined"){var showhide_list_temp=obj.listmenu_settings.showhide_list;showhide_list_temp[obj.listmenu_settings.showhide_list_index]=
undefined}if(showhide=="hide"&&obj.style.display=="none")return;obj.listmenu_settings.showhide_list=showhide_list_new;obj.listmenu_settings.showhide_list_index=j;j+=1;showhide_list_new.push(obj)});showhide_list=showhide_list_new;var max_steps=listmenu[showhide+"_process_timeout_time"]==0?1:showhide_delay/listmenu[showhide+"_process_timeout_time"]+1;var current_step=0;showhide_process_internal();function showhide_process_internal(){if(current_step>max_steps)return;var current_counter=current_step/
max_steps;if(showhide=="hide")current_counter=1-current_counter;listmenu.animate(showhide_list,current_counter,showhide);current_step+=1;setTimeout(showhide_process_internal,settings[showhide+"_process_timeout_time"])}}function click_event(evt){evt.stopPropagation();if("which"in evt&&evt.which==3||"button"in evt&&evt.button==3)return;var list_item=evt.currentTarget;if(list_item.listmenu_settings.children.length!=0)return;list_item.listmenu_settings.parent.listmenu_settings.children.forEach(function(sibling){if(sibling!=
list_item)clear_selected(sibling)});set_selected(list_item);var hide_list=hide_ancestors_and_self(list_item.listmenu_settings.parent,[]);begin_process(hide_list,"hide")}function hide_ancestors_and_self(container,hide_list){if(typeof container.listmenu_settings.parent=="undefined")return hide_list;hide_list.push(container);return hide_ancestors_and_self(container.listmenu_settings.parent.listmenu_settings.parent,hide_list)}listmenu.close=function(container,options){begin_process(hide_grandchildren(container,
0),"hide",options)};listmenu.open=function(container,options){begin_process(hide_grandchildren(container),"show",options)};function get_elements_until(parent,tagname_to_search_for,tagname_to_stop_at){var element_list=[];check_children(parent);function check_children(parent){var children=parent.childNodes;parent.childNodes.forEach(function(child){var tagname=child.tagName;if(typeof tagname=="undefined")return;tagname=tagname.toLowerCase();if(tagname==tagname_to_search_for)element_list.push(child);
if(tagname!=tagname_to_stop_at)check_children(child)})}return element_list}return listmenu;function is_attached(obj){while(true){obj=obj.parentNode;if(obj==document.documentElement)return true;if(obj==null)return false}}}
ListMenu.anim_fade=function(obj_list,counter,showhide){obj_list.forEach(function(obj){if(typeof obj=="undefined")return;if(showhide!="show"){if(counter==0)obj.style.display="none";return}if(counter==0&&obj.style.display=="none"){obj.style.opacity=0;obj.style.display="block"}if(obj.style.opacity<=counter)obj.style.opacity=counter})};var pollfishExtras={};
var pollfishConfig={api_key:"c3d39c28-ad03-49e7-8f1e-791291339386",debug:false,survey_format:"playful",indicator_position:"BOTTOM_RIGHT",survey_format:0,closeCallback:function(result){if(pollfishExtras.closeCallback)return pollfishExtras.closeCallback(result)},userNotEligibleCallback:function(result){if(pollfishExtras.userNotEligibleCallback)return pollfishExtras.userNotEligibleCallback(result)},closeAndNoShowCallback:function(result){if(pollfishExtras.closeAndNoShowCallback)return pollfishExtras.closeAndNoShowCallback(result)},
surveyCompletedCallback:function(result){if(pollfishExtras.surveyCompletedCallback)return pollfishExtras.surveyCompletedCallback(result)},surveyAvailable:function(result){pollfishExtras.noSurveys=false;if(pollfishExtras.surveyAvailable)return pollfishExtras.surveyAvailable(result)},surveyNotAvailable:function(result){pollfishExtras.noSurveys=true;if(pollfishExtras.surveyNotAvailable)return pollfishExtras.surveyNotAvailable(result)},ready:function(){Pollfish.hide()}};
https:(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory(global):typeof define==="function"&&define.amd?define(factory):factory(global)})(typeof self!=="undefined"?self:typeof window!=="undefined"?window:typeof global!=="undefined"?global:this,function(global){var _Base64=global.Base64;var version="2.4.8";var buffer;if(typeof module!=="undefined"&&module.exports)try{buffer=eval("require('buffer').Buffer")}catch(err){buffer=undefined}var b64chars=
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var b64tab=function(bin){var t={};for(var i=0,l=bin.length;i<l;i++)t[bin.charAt(i)]=i;return t}(b64chars);var fromCharCode=String.fromCharCode;var cb_utob=function(c){if(c.length<2){var cc=c.charCodeAt(0);return cc<128?c:cc<2048?fromCharCode(192|cc>>>6)+fromCharCode(128|cc&63):fromCharCode(224|cc>>>12&15)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|cc&63)}else{var cc=65536+(c.charCodeAt(0)-55296)*1024+(c.charCodeAt(1)-56320);return fromCharCode(240|
cc>>>18&7)+fromCharCode(128|cc>>>12&63)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|cc&63)}};var re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g;var utob=function(u){return u.replace(re_utob,cb_utob)};var cb_encode=function(ccc){var padlen=[0,2,1][ccc.length%3],ord=ccc.charCodeAt(0)<<16|(ccc.length>1?ccc.charCodeAt(1):0)<<8|(ccc.length>2?ccc.charCodeAt(2):0),chars=[b64chars.charAt(ord>>>18),b64chars.charAt(ord>>>12&63),padlen>=2?"\x3d":b64chars.charAt(ord>>>6&63),padlen>=1?"\x3d":b64chars.charAt(ord&
63)];return chars.join("")};var btoa=global.btoa?function(b){return global.btoa(b)}:function(b){return b.replace(/[\s\S]{1,3}/g,cb_encode)};var _encode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(u){return(u.constructor===buffer.constructor?u:buffer.from(u)).toString("base64")}:function(u){return(u.constructor===buffer.constructor?u:new buffer(u)).toString("base64")}:function(u){return btoa(utob(u))};var encode=function(u,urisafe){return!urisafe?_encode(String(u)):_encode(String(u)).replace(/[+\/]/g,
function(m0){return m0=="+"?"-":"_"}).replace(/=/g,"")};var encodeURI=function(u){return encode(u,true)};var re_btou=new RegExp(["[\ufffd-\ufffd][?-\ufffd]","[\ufffd-\ufffd][?-\ufffd]{2}","[\ufffd-\ufffd][?-\ufffd]{3}"].join("|"),"g");var cb_btou=function(cccc){switch(cccc.length){case 4:var cp=(7&cccc.charCodeAt(0))<<18|(63&cccc.charCodeAt(1))<<12|(63&cccc.charCodeAt(2))<<6|63&cccc.charCodeAt(3),offset=cp-65536;return fromCharCode((offset>>>10)+55296)+fromCharCode((offset&1023)+56320);case 3:return fromCharCode((15&
cccc.charCodeAt(0))<<12|(63&cccc.charCodeAt(1))<<6|63&cccc.charCodeAt(2));default:return fromCharCode((31&cccc.charCodeAt(0))<<6|63&cccc.charCodeAt(1))}};var btou=function(b){return b.replace(re_btou,cb_btou)};var cb_decode=function(cccc){var len=cccc.length,padlen=len%4,n=(len>0?b64tab[cccc.charAt(0)]<<18:0)|(len>1?b64tab[cccc.charAt(1)]<<12:0)|(len>2?b64tab[cccc.charAt(2)]<<6:0)|(len>3?b64tab[cccc.charAt(3)]:0),chars=[fromCharCode(n>>>16),fromCharCode(n>>>8&255),fromCharCode(n&255)];chars.length-=
[0,0,2,1][padlen];return chars.join("")};var atob=global.atob?function(a){return global.atob(a)}:function(a){return a.replace(/[\s\S]{1,4}/g,cb_decode)};var _decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(a){return(a.constructor===buffer.constructor?a:buffer.from(a,"base64")).toString()}:function(a){return(a.constructor===buffer.constructor?a:new buffer(a,"base64")).toString()}:function(a){return btou(atob(a))};var decode=function(a){return _decode(String(a).replace(/[-_]/g,
function(m0){return m0=="-"?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};var noConflict=function(){var Base64=global.Base64;global.Base64=_Base64;return Base64};global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict,__buffer__:buffer};if(typeof Object.defineProperty==="function"){var noEnum=function(v){return{value:v,enumerable:false,writable:true,configurable:true}};global.Base64.extendString=
function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)}));Object.defineProperty(String.prototype,"toBase64",noEnum(function(urisafe){return encode(this,urisafe)}));Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,true)}))}}if(global["Meteor"])Base64=global.Base64;if(typeof module!=="undefined"&&module.exports)module.exports.Base64=global.Base64;else if(typeof define==="function"&&define.amd)define([],function(){return global.Base64});
return{Base64:global.Base64}});
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.moment=t()}(this,function(){var e,i;function c(){return e.apply(null,arguments)}function o(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function u(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function l(e){return void 0===e}function d(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}
function h(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function f(e,t){var n,s=[];for(n=0;n<e.length;++n)s.push(t(e[n],n));return s}function m(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function _(e,t){for(var n in t)m(t,n)&&(e[n]=t[n]);return m(t,"toString")&&(e.toString=t.toString),m(t,"valueOf")&&(e.valueOf=t.valueOf),e}function y(e,t,n,s){return Ot(e,t,n,s,!0).utc()}function g(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],
overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function p(e){if(null==e._isValid){var t=g(e),n=i.call(t.parsedDateParts,function(e){return null!=e}),s=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n);if(e._strict&&(s=s&&0===t.charsLeftOver&&
0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return s;e._isValid=s}return e._isValid}function v(e){var t=y(NaN);return null!=e?_(g(t),e):g(t).userInvalidated=!0,t}i=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),n=t.length>>>0,s=0;s<n;s++)if(s in t&&e.call(this,t[s],s,t))return!0;return!1};var r=c.momentProperties=[];function w(e,t){var n,s,i;if(l(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),l(t._i)||(e._i=t._i),
l(t._f)||(e._f=t._f),l(t._l)||(e._l=t._l),l(t._strict)||(e._strict=t._strict),l(t._tzm)||(e._tzm=t._tzm),l(t._isUTC)||(e._isUTC=t._isUTC),l(t._offset)||(e._offset=t._offset),l(t._pf)||(e._pf=g(t)),l(t._locale)||(e._locale=t._locale),0<r.length)for(n=0;n<r.length;n++)l(i=t[s=r[n]])||(e[s]=i);return e}var t=!1;function M(e){w(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===t&&(t=!0,c.updateOffset(this),t=!1)}function S(e){return e instanceof M||null!=
e&&null!=e._isAMomentObject}function D(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function k(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=D(t)),n}function a(e,t,n){var s,i=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),a=0;for(s=0;s<i;s++)(n&&e[s]!==t[s]||!n&&k(e[s])!==k(t[s]))&&a++;return a+r}function Y(e){!1===c.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function n(i,r){var a=!0;return _(function(){if(null!=c.deprecationHandler&&
c.deprecationHandler(null,i),a){for(var e,t=[],n=0;n<arguments.length;n++){if(e="","object"==typeof arguments[n]){for(var s in e+="\n["+n+"] ",arguments[0])e+=s+": "+arguments[0][s]+", ";e=e.slice(0,-2)}else e=arguments[n];t.push(e)}Y(i+"\nArguments: "+Array.prototype.slice.call(t).join("")+"\n"+(new Error).stack),a=!1}return r.apply(this,arguments)},r)}var s,O={};function T(e,t){null!=c.deprecationHandler&&c.deprecationHandler(e,t),O[e]||(Y(t),O[e]=!0)}function x(e){return e instanceof Function||
"[object Function]"===Object.prototype.toString.call(e)}function b(e,t){var n,s=_({},e);for(n in t)m(t,n)&&(u(e[n])&&u(t[n])?(s[n]={},_(s[n],e[n]),_(s[n],t[n])):null!=t[n]?s[n]=t[n]:delete s[n]);for(n in e)m(e,n)&&!m(t,n)&&u(e[n])&&(s[n]=_({},s[n]));return s}function P(e){null!=e&&this.set(e)}c.suppressDeprecationWarnings=!1,c.deprecationHandler=null,s=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)m(e,t)&&n.push(t);return n};var W={};function H(e,t){var n=e.toLowerCase();W[n]=W[n+"s"]=
W[t]=e}function R(e){return"string"==typeof e?W[e]||W[e.toLowerCase()]:void 0}function C(e){var t,n,s={};for(n in e)m(e,n)&&(t=R(n))&&(s[t]=e[n]);return s}var F={};function L(e,t){F[e]=t}function U(e,t,n){var s=""+Math.abs(e),i=t-s.length;return(0<=e?n?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+s}var N=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,
G=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,V={},E={};function I(e,t,n,s){var i=s;"string"==typeof s&&(i=function(){return this[s]()}),e&&(E[e]=i),t&&(E[t[0]]=function(){return U(i.apply(this,arguments),t[1],t[2])}),n&&(E[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function A(e,t){return e.isValid()?(t=j(t,e.localeData()),V[t]=V[t]||function(s){var e,i,t,r=s.match(N);for(e=0,i=r.length;e<i;e++)E[r[e]]?r[e]=E[r[e]]:r[e]=(t=r[e]).match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,
""):t.replace(/\\/g,"");return function(e){var t,n="";for(t=0;t<i;t++)n+=x(r[t])?r[t].call(e,s):r[t];return n}}(t),V[t](e)):e.localeData().invalidDate()}function j(e,t){var n=5;function s(e){return t.longDateFormat(e)||e}for(G.lastIndex=0;0<=n&&G.test(e);)e=e.replace(G,s),G.lastIndex=0,n-=1;return e}var Z=/\d/,z=/\d\d/,$=/\d{3}/,q=/\d{4}/,J=/[+-]?\d{6}/,B=/\d\d?/,Q=/\d\d\d\d?/,X=/\d\d\d\d\d\d?/,K=/\d{1,3}/,ee=/\d{1,4}/,te=/[+-]?\d{1,6}/,ne=/\d+/,se=/[+-]?\d+/,ie=/Z|[+-]\d\d:?\d\d/gi,re=/Z|[+-]\d\d(?::?\d\d)?/gi,
ae=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,oe={};function ue(e,n,s){oe[e]=x(n)?n:function(e,t){return e&&s?s:n}}function le(e,t){return m(oe,e)?oe[e](t._strict,t._locale):new RegExp(de(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,s,i){return t||n||s||i})))}function de(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$\x26")}var he={};function ce(e,n){var t,
s=n;for("string"==typeof e&&(e=[e]),d(n)&&(s=function(e,t){t[n]=k(e)}),t=0;t<e.length;t++)he[e[t]]=s}function fe(e,i){ce(e,function(e,t,n,s){n._w=n._w||{},i(e,n._w,n,s)})}var me=0,_e=1,ye=2,ge=3,pe=4,ve=5,we=6,Me=7,Se=8;function De(e){return ke(e)?366:365}function ke(e){return e%4==0&&e%100!=0||e%400==0}I("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),I(0,["YY",2],0,function(){return this.year()%100}),I(0,["YYYY",4],0,"year"),I(0,["YYYYY",5],0,"year"),I(0,["YYYYYY",6,!0],0,"year"),
H("year","y"),L("year",1),ue("Y",se),ue("YY",B,z),ue("YYYY",ee,q),ue("YYYYY",te,J),ue("YYYYYY",te,J),ce(["YYYYY","YYYYYY"],me),ce("YYYY",function(e,t){t[me]=2===e.length?c.parseTwoDigitYear(e):k(e)}),ce("YY",function(e,t){t[me]=c.parseTwoDigitYear(e)}),ce("Y",function(e,t){t[me]=parseInt(e,10)}),c.parseTwoDigitYear=function(e){return k(e)+(68<k(e)?1900:2E3)};var Ye,Oe=Te("FullYear",!0);function Te(t,n){return function(e){return null!=e?(be(this,t,e),c.updateOffset(this,n),this):xe(this,t)}}function xe(e,
t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function be(e,t,n){e.isValid()&&!isNaN(n)&&("FullYear"===t&&ke(e.year())&&1===e.month()&&29===e.date()?e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),Pe(n,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](n))}function Pe(e,t){if(isNaN(e)||isNaN(t))return NaN;var n,s=(t%(n=12)+n)%n;return e+=(t-s)/12,1===s?ke(e)?29:28:31-s%7%2}Ye=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;
return-1},I("M",["MM",2],"Mo",function(){return this.month()+1}),I("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),I("MMMM",0,0,function(e){return this.localeData().months(this,e)}),H("month","M"),L("month",8),ue("M",B),ue("MM",B,z),ue("MMM",function(e,t){return t.monthsShortRegex(e)}),ue("MMMM",function(e,t){return t.monthsRegex(e)}),ce(["M","MM"],function(e,t){t[_e]=k(e)-1}),ce(["MMM","MMMM"],function(e,t,n,s){var i=n._locale.monthsParse(e,s,n._strict);null!=i?t[_e]=i:g(n).invalidMonth=
e});var We=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,He="January_February_March_April_May_June_July_August_September_October_November_December".split("_");var Re="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function Ce(e,t){var n;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=k(t);else if(!d(t=e.localeData().monthsParse(t)))return e;return n=Math.min(e.date(),Pe(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e}function Fe(e){return null!=e?(Ce(this,e),c.updateOffset(this,
!0),this):xe(this,"Month")}var Le=ae;var Ue=ae;function Ne(){function e(e,t){return t.length-e.length}var t,n,s=[],i=[],r=[];for(t=0;t<12;t++)n=y([2E3,t]),s.push(this.monthsShort(n,"")),i.push(this.months(n,"")),r.push(this.months(n,"")),r.push(this.monthsShort(n,""));for(s.sort(e),i.sort(e),r.sort(e),t=0;t<12;t++)s[t]=de(s[t]),i[t]=de(i[t]);for(t=0;t<24;t++)r[t]=de(r[t]);this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+
i.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+s.join("|")+")","i")}function Ge(e){var t=new Date(Date.UTC.apply(null,arguments));return e<100&&0<=e&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function Ve(e,t,n){var s=7+t-n;return-((7+Ge(e,0,s).getUTCDay()-t)%7)+s-1}function Ee(e,t,n,s,i){var r,a,o=1+7*(t-1)+(7+n-s)%7+Ve(e,s,i);return o<=0?a=De(r=e-1)+o:o>De(e)?(r=e+1,a=o-De(e)):(r=e,a=o),{year:r,dayOfYear:a}}function Ie(e,t,n){var s,i,r=Ve(e.year(),t,n),a=Math.floor((e.dayOfYear()-
r-1)/7)+1;return a<1?s=a+Ae(i=e.year()-1,t,n):a>Ae(e.year(),t,n)?(s=a-Ae(e.year(),t,n),i=e.year()+1):(i=e.year(),s=a),{week:s,year:i}}function Ae(e,t,n){var s=Ve(e,t,n),i=Ve(e+1,t,n);return(De(e)-s+i)/7}I("w",["ww",2],"wo","week"),I("W",["WW",2],"Wo","isoWeek"),H("week","w"),H("isoWeek","W"),L("week",5),L("isoWeek",5),ue("w",B),ue("ww",B,z),ue("W",B),ue("WW",B,z),fe(["w","ww","W","WW"],function(e,t,n,s){t[s.substr(0,1)]=k(e)});I("d",0,"do","day"),I("dd",0,0,function(e){return this.localeData().weekdaysMin(this,
e)}),I("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),I("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),I("e",0,0,"weekday"),I("E",0,0,"isoWeekday"),H("day","d"),H("weekday","e"),H("isoWeekday","E"),L("day",11),L("weekday",11),L("isoWeekday",11),ue("d",B),ue("e",B),ue("E",B),ue("dd",function(e,t){return t.weekdaysMinRegex(e)}),ue("ddd",function(e,t){return t.weekdaysShortRegex(e)}),ue("dddd",function(e,t){return t.weekdaysRegex(e)}),fe(["dd","ddd","dddd"],
function(e,t,n,s){var i=n._locale.weekdaysParse(e,s,n._strict);null!=i?t.d=i:g(n).invalidWeekday=e}),fe(["d","e","E"],function(e,t,n,s){t[s]=k(e)});var je="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");var Ze="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");var ze="Su_Mo_Tu_We_Th_Fr_Sa".split("_");var $e=ae;var qe=ae;var Je=ae;function Be(){function e(e,t){return t.length-e.length}var t,n,s,i,r,a=[],o=[],u=[],l=[];for(t=0;t<7;t++)n=y([2E3,1]).day(t),s=this.weekdaysMin(n,""),i=this.weekdaysShort(n,
""),r=this.weekdays(n,""),a.push(s),o.push(i),u.push(r),l.push(s),l.push(i),l.push(r);for(a.sort(e),o.sort(e),u.sort(e),l.sort(e),t=0;t<7;t++)o[t]=de(o[t]),u[t]=de(u[t]),l[t]=de(l[t]);this._weekdaysRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+
a.join("|")+")","i")}function Qe(){return this.hours()%12||12}function Xe(e,t){I(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function Ke(e,t){return t._meridiemParse}I("H",["HH",2],0,"hour"),I("h",["hh",2],0,Qe),I("k",["kk",2],0,function(){return this.hours()||24}),I("hmm",0,0,function(){return""+Qe.apply(this)+U(this.minutes(),2)}),I("hmmss",0,0,function(){return""+Qe.apply(this)+U(this.minutes(),2)+U(this.seconds(),2)}),I("Hmm",0,0,function(){return""+this.hours()+
U(this.minutes(),2)}),I("Hmmss",0,0,function(){return""+this.hours()+U(this.minutes(),2)+U(this.seconds(),2)}),Xe("a",!0),Xe("A",!1),H("hour","h"),L("hour",13),ue("a",Ke),ue("A",Ke),ue("H",B),ue("h",B),ue("k",B),ue("HH",B,z),ue("hh",B,z),ue("kk",B,z),ue("hmm",Q),ue("hmmss",X),ue("Hmm",Q),ue("Hmmss",X),ce(["H","HH"],ge),ce(["k","kk"],function(e,t,n){var s=k(e);t[ge]=24===s?0:s}),ce(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),ce(["h","hh"],function(e,t,n){t[ge]=k(e),g(n).bigHour=
!0}),ce("hmm",function(e,t,n){var s=e.length-2;t[ge]=k(e.substr(0,s)),t[pe]=k(e.substr(s)),g(n).bigHour=!0}),ce("hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[ge]=k(e.substr(0,s)),t[pe]=k(e.substr(s,2)),t[ve]=k(e.substr(i)),g(n).bigHour=!0}),ce("Hmm",function(e,t,n){var s=e.length-2;t[ge]=k(e.substr(0,s)),t[pe]=k(e.substr(s))}),ce("Hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[ge]=k(e.substr(0,s)),t[pe]=k(e.substr(s,2)),t[ve]=k(e.substr(i))});var et,tt=Te("Hours",!0),nt={calendar:{sameDay:"[Today at] LT",
nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",
MM:"%d months",y:"a year",yy:"%d years"},months:He,monthsShort:Re,week:{dow:0,doy:6},weekdays:je,weekdaysMin:ze,weekdaysShort:Ze,meridiemParse:/[ap]\.?m?\.?/i},st={},it={};function rt(e){return e?e.toLowerCase().replace("_","-"):e}function at(e){var t=null;if(!st[e]&&"undefined"!=typeof module&&module&&module.exports)try{t=et._abbr,require("./locale/"+e),ot(t)}catch(e){}return st[e]}function ot(e,t){var n;return e&&((n=l(t)?lt(e):ut(e,t))?et=n:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+
e+" not found. Did you forget to load it?")),et._abbr}function ut(e,t){if(null!==t){var n,s=nt;if(t.abbr=e,null!=st[e])T("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),s=st[e]._config;else if(null!=t.parentLocale)if(null!=st[t.parentLocale])s=st[t.parentLocale]._config;else{if(null==(n=at(t.parentLocale)))return it[t.parentLocale]||
(it[t.parentLocale]=[]),it[t.parentLocale].push({name:e,config:t}),null;s=n._config}return st[e]=new P(b(s,t)),it[e]&&it[e].forEach(function(e){ut(e.name,e.config)}),ot(e),st[e]}return delete st[e],null}function lt(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return et;if(!o(e)){if(t=at(e))return t;e=[e]}return function(e){for(var t,n,s,i,r=0;r<e.length;){for(t=(i=rt(e[r]).split("-")).length,n=(n=rt(e[r+1]))?n.split("-"):null;0<t;){if(s=at(i.slice(0,t).join("-")))return s;if(n&&
n.length>=t&&a(i,n,!0)>=t-1)break;t--}r++}return et}(e)}function dt(e){var t,n=e._a;return n&&-2===g(e).overflow&&(t=n[_e]<0||11<n[_e]?_e:n[ye]<1||n[ye]>Pe(n[me],n[_e])?ye:n[ge]<0||24<n[ge]||24===n[ge]&&(0!==n[pe]||0!==n[ve]||0!==n[we])?ge:n[pe]<0||59<n[pe]?pe:n[ve]<0||59<n[ve]?ve:n[we]<0||999<n[we]?we:-1,g(e)._overflowDayOfYear&&(t<me||ye<t)&&(t=ye),g(e)._overflowWeeks&&-1===t&&(t=Me),g(e)._overflowWeekday&&-1===t&&(t=Se),g(e).overflow=t),e}function ht(e,t,n){return null!=e?e:null!=t?t:n}function ct(e){var t,
n,s,i,r,a=[];if(!e._d){var o,u;for(o=e,u=new Date(c.now()),s=o._useUTC?[u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()]:[u.getFullYear(),u.getMonth(),u.getDate()],e._w&&null==e._a[ye]&&null==e._a[_e]&&function(e){var t,n,s,i,r,a,o,u;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)r=1,a=4,n=ht(t.GG,e._a[me],Ie(Tt(),1,4).year),s=ht(t.W,1),((i=ht(t.E,1))<1||7<i)&&(u=!0);else{r=e._locale._week.dow,a=e._locale._week.doy;var l=Ie(Tt(),r,a);n=ht(t.gg,e._a[me],l.year),s=ht(t.w,l.week),null!=t.d?((i=t.d)<0||
6<i)&&(u=!0):null!=t.e?(i=t.e+r,(t.e<0||6<t.e)&&(u=!0)):i=r}s<1||s>Ae(n,r,a)?g(e)._overflowWeeks=!0:null!=u?g(e)._overflowWeekday=!0:(o=Ee(n,s,i,r,a),e._a[me]=o.year,e._dayOfYear=o.dayOfYear)}(e),null!=e._dayOfYear&&(r=ht(e._a[me],s[me]),(e._dayOfYear>De(r)||0===e._dayOfYear)&&(g(e)._overflowDayOfYear=!0),n=Ge(r,0,e._dayOfYear),e._a[_e]=n.getUTCMonth(),e._a[ye]=n.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=a[t]=s[t];for(;t<7;t++)e._a[t]=a[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[ge]&&0===
e._a[pe]&&0===e._a[ve]&&0===e._a[we]&&(e._nextDay=!0,e._a[ge]=0),e._d=(e._useUTC?Ge:function(e,t,n,s,i,r,a){var o=new Date(e,t,n,s,i,r,a);return e<100&&0<=e&&isFinite(o.getFullYear())&&o.setFullYear(e),o}).apply(null,a),i=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[ge]=24),e._w&&void 0!==e._w.d&&e._w.d!==i&&(g(e).weekdayMismatch=!0)}}var ft=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,
mt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,_t=/Z|[+-]\d\d(?::?\d\d)?/,yt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],gt=
[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],pt=/^\/?Date\((\-?\d+)/i;function vt(e){var t,n,s,i,r,a,o=e._i,u=ft.exec(o)||mt.exec(o);if(u){for(g(e).iso=!0,t=0,n=yt.length;t<n;t++)if(yt[t][1].exec(u[1])){i=yt[t][0],s=!1!==yt[t][2];break}if(null==i)return void(e._isValid=!1);if(u[3]){for(t=
0,n=gt.length;t<n;t++)if(gt[t][1].exec(u[3])){r=(u[2]||" ")+gt[t][0];break}if(null==r)return void(e._isValid=!1)}if(!s&&null!=r)return void(e._isValid=!1);if(u[4]){if(!_t.exec(u[4]))return void(e._isValid=!1);a="Z"}e._f=i+(r||"")+(a||""),kt(e)}else e._isValid=!1}var wt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function Mt(e,t,n,s,i,r){var a=[function(e){var t=
parseInt(e,10);{if(t<=49)return 2E3+t;if(t<=999)return 1900+t}return t}(e),Re.indexOf(t),parseInt(n,10),parseInt(s,10),parseInt(i,10)];return r&&a.push(parseInt(r,10)),a}var St={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Dt(e){var t,n,s,i=wt.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(i){var r=Mt(i[4],i[3],i[2],i[5],i[6],i[7]);if(t=i[1],n=r,s=e,t&&Ze.indexOf(t)!==(new Date(n[0],n[1],
n[2])).getDay()&&(g(s).weekdayMismatch=!0,!(s._isValid=!1)))return;e._a=r,e._tzm=function(e,t,n){if(e)return St[e];if(t)return 0;var s=parseInt(n,10),i=s%100;return(s-i)/100*60+i}(i[8],i[9],i[10]),e._d=Ge.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),g(e).rfc2822=!0}else e._isValid=!1}function kt(e){if(e._f!==c.ISO_8601)if(e._f!==c.RFC_2822){e._a=[],g(e).empty=!0;var t,n,s,i,r,a,o,u,l=""+e._i,d=l.length,h=0;for(s=j(e._f,e._locale).match(N)||[],t=0;t<s.length;t++)i=s[t],(n=(l.match(le(i,
e))||[])[0])&&(0<(r=l.substr(0,l.indexOf(n))).length&&g(e).unusedInput.push(r),l=l.slice(l.indexOf(n)+n.length),h+=n.length),E[i]?(n?g(e).empty=!1:g(e).unusedTokens.push(i),a=i,u=e,null!=(o=n)&&m(he,a)&&he[a](o,u._a,u,a)):e._strict&&!n&&g(e).unusedTokens.push(i);g(e).charsLeftOver=d-h,0<l.length&&g(e).unusedInput.push(l),e._a[ge]<=12&&!0===g(e).bigHour&&0<e._a[ge]&&(g(e).bigHour=void 0),g(e).parsedDateParts=e._a.slice(0),g(e).meridiem=e._meridiem,e._a[ge]=function(e,t,n){var s;if(null==n)return t;
return null!=e.meridiemHour?e.meridiemHour(t,n):(null!=e.isPM&&((s=e.isPM(n))&&t<12&&(t+=12),s||12!==t||(t=0)),t)}(e._locale,e._a[ge],e._meridiem),ct(e),dt(e)}else Dt(e);else vt(e)}function Yt(e){var t,n,s,i,r=e._i,a=e._f;return e._locale=e._locale||lt(e._l),null===r||void 0===a&&""===r?v({nullInput:!0}):("string"==typeof r&&(e._i=r=e._locale.preparse(r)),S(r)?new M(dt(r)):(h(r)?e._d=r:o(a)?function(e){var t,n,s,i,r;if(0===e._f.length)return g(e).invalidFormat=!0,e._d=new Date(NaN);for(i=0;i<e._f.length;i++)r=
0,t=w({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],kt(t),p(t)&&(r+=g(t).charsLeftOver,r+=10*g(t).unusedTokens.length,g(t).score=r,(null==s||r<s)&&(s=r,n=t));_(e,n||t)}(e):a?kt(e):l(n=(t=e)._i)?t._d=new Date(c.now()):h(n)?t._d=new Date(n.valueOf()):"string"==typeof n?(s=t,null===(i=pt.exec(s._i))?(vt(s),!1===s._isValid&&(delete s._isValid,Dt(s),!1===s._isValid&&(delete s._isValid,c.createFromInputFallback(s)))):s._d=new Date(+i[1])):o(n)?(t._a=f(n.slice(0),function(e){return parseInt(e,
10)}),ct(t)):u(n)?function(e){if(!e._d){var t=C(e._i);e._a=f([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),ct(e)}}(t):d(n)?t._d=new Date(n):c.createFromInputFallback(t),p(e)||(e._d=null),e))}function Ot(e,t,n,s,i){var r,a={};return!0!==n&&!1!==n||(s=n,n=void 0),(u(e)&&function(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}(e)||o(e)&&0===e.length)&&
(e=void 0),a._isAMomentObject=!0,a._useUTC=a._isUTC=i,a._l=n,a._i=e,a._f=t,a._strict=s,(r=new M(dt(Yt(a))))._nextDay&&(r.add(1,"d"),r._nextDay=void 0),r}function Tt(e,t,n,s){return Ot(e,t,n,s,!1)}c.createFromInputFallback=n("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",
function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),c.ISO_8601=function(){},c.RFC_2822=function(){};var xt=n("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Tt.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:v()}),bt=n("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Tt.apply(null,arguments);return this.isValid()&&e.isValid()?this<e?
this:e:v()});function Pt(e,t){var n,s;if(1===t.length&&o(t[0])&&(t=t[0]),!t.length)return Tt();for(n=t[0],s=1;s<t.length;++s)t[s].isValid()&&!t[s][e](n)||(n=t[s]);return n}var Wt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ht(e){var t=C(e),n=t.year||0,s=t.quarter||0,i=t.month||0,r=t.week||0,a=t.day||0,o=t.hour||0,u=t.minute||0,l=t.second||0,d=t.millisecond||0;this._isValid=function(e){for(var t in e)if(-1===Ye.call(Wt,t)||null!=e[t]&&isNaN(e[t]))return!1;
for(var n=!1,s=0;s<Wt.length;++s)if(e[Wt[s]]){if(n)return!1;parseFloat(e[Wt[s]])!==k(e[Wt[s]])&&(n=!0)}return!0}(t),this._milliseconds=+d+1E3*l+6E4*u+1E3*o*60*60,this._days=+a+7*r,this._months=+i+3*s+12*n,this._data={},this._locale=lt(),this._bubble()}function Rt(e){return e instanceof Ht}function Ct(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function Ft(e,n){I(e,0,0,function(){var e=this.utcOffset(),t="+";return e<0&&(e=-e,t="-"),t+U(~~(e/60),2)+n+U(~~e%60,2)})}Ft("Z",":"),Ft("ZZ",""),ue("Z",
re),ue("ZZ",re),ce(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Ut(re,e)});var Lt=/([\+\-]|\d\d)/gi;function Ut(e,t){var n=(t||"").match(e);if(null===n)return null;var s=((n[n.length-1]||[])+"").match(Lt)||["-",0,0],i=60*s[1]+k(s[2]);return 0===i?0:"+"===s[0]?i:-i}function Nt(e,t){var n,s;return t._isUTC?(n=t.clone(),s=(S(e)||h(e)?e.valueOf():Tt(e).valueOf())-n.valueOf(),n._d.setTime(n._d.valueOf()+s),c.updateOffset(n,!1),n):Tt(e).local()}function Gt(e){return 15*-Math.round(e._d.getTimezoneOffset()/
15)}function Vt(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}c.updateOffset=function(){};var Et=/^(\-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,It=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function At(e,t){var n,s,i,r=e,a=null;return Rt(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:d(e)?(r={},t?r[t]=e:r.milliseconds=e):(a=Et.exec(e))?(n="-"===a[1]?-1:
1,r={y:0,d:k(a[ye])*n,h:k(a[ge])*n,m:k(a[pe])*n,s:k(a[ve])*n,ms:k(Ct(1E3*a[we]))*n}):(a=It.exec(e))?(n="-"===a[1]?-1:(a[1],1),r={y:jt(a[2],n),M:jt(a[3],n),w:jt(a[4],n),d:jt(a[5],n),h:jt(a[6],n),m:jt(a[7],n),s:jt(a[8],n)}):null==r?r={}:"object"==typeof r&&("from"in r||"to"in r)&&(i=function(e,t){var n;if(!e.isValid()||!t.isValid())return{milliseconds:0,months:0};t=Nt(t,e),e.isBefore(t)?n=Zt(e,t):((n=Zt(t,e)).milliseconds=-n.milliseconds,n.months=-n.months);return n}(Tt(r.from),Tt(r.to)),(r={}).ms=
i.milliseconds,r.M=i.months),s=new Ht(r),Rt(e)&&m(e,"_locale")&&(s._locale=e._locale),s}function jt(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function Zt(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function zt(s,i){return function(e,t){var n;return null===t||isNaN(+t)||(T(i,"moment()."+i+"(period, number) is deprecated. Please use moment()."+
i+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=e,e=t,t=n),$t(this,At(e="string"==typeof e?+e:e,t),s),this}}function $t(e,t,n,s){var i=t._milliseconds,r=Ct(t._days),a=Ct(t._months);e.isValid()&&(s=null==s||s,a&&Ce(e,xe(e,"Month")+a*n),r&&be(e,"Date",xe(e,"Date")+r*n),i&&e._d.setTime(e._d.valueOf()+i*n),s&&c.updateOffset(e,r||a))}At.fn=Ht.prototype,At.invalid=function(){return At(NaN)};var qt=zt(1,"add"),Jt=zt(-1,"subtract");function Bt(e,t){var n=
12*(t.year()-e.year())+(t.month()-e.month()),s=e.clone().add(n,"months");return-(n+(t-s<0?(t-s)/(s-e.clone().add(n-1,"months")):(t-s)/(e.clone().add(n+1,"months")-s)))||0}function Qt(e){var t;return void 0===e?this._locale._abbr:(null!=(t=lt(e))&&(this._locale=t),this)}c.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",c.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Xt=n("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",
function(e){return void 0===e?this.localeData():this.locale(e)});function Kt(){return this._locale}function en(e,t){I(0,[e,e.length],0,t)}function tn(e,t,n,s,i){var r;return null==e?Ie(this,s,i).year:((r=Ae(e,s,i))<t&&(t=r),function(e,t,n,s,i){var r=Ee(e,t,n,s,i),a=Ge(r.year,0,r.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}.call(this,e,t,n,s,i))}I(0,["gg",2],0,function(){return this.weekYear()%100}),I(0,["GG",2],0,function(){return this.isoWeekYear()%
100}),en("gggg","weekYear"),en("ggggg","weekYear"),en("GGGG","isoWeekYear"),en("GGGGG","isoWeekYear"),H("weekYear","gg"),H("isoWeekYear","GG"),L("weekYear",1),L("isoWeekYear",1),ue("G",se),ue("g",se),ue("GG",B,z),ue("gg",B,z),ue("GGGG",ee,q),ue("gggg",ee,q),ue("GGGGG",te,J),ue("ggggg",te,J),fe(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,s){t[s.substr(0,2)]=k(e)}),fe(["gg","GG"],function(e,t,n,s){t[s]=c.parseTwoDigitYear(e)}),I("Q",0,"Qo","quarter"),H("quarter","Q"),L("quarter",7),ue("Q",Z),ce("Q",
function(e,t){t[_e]=3*(k(e)-1)}),I("D",["DD",2],"Do","date"),H("date","D"),L("date",9),ue("D",B),ue("DD",B,z),ue("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),ce(["D","DD"],ye),ce("Do",function(e,t){t[ye]=k(e.match(B)[0])});var nn=Te("Date",!0);I("DDD",["DDDD",3],"DDDo","dayOfYear"),H("dayOfYear","DDD"),L("dayOfYear",4),ue("DDD",K),ue("DDDD",$),ce(["DDD","DDDD"],function(e,t,n){n._dayOfYear=k(e)}),I("m",["mm",2],0,"minute"),H("minute","m"),
L("minute",14),ue("m",B),ue("mm",B,z),ce(["m","mm"],pe);var sn=Te("Minutes",!1);I("s",["ss",2],0,"second"),H("second","s"),L("second",15),ue("s",B),ue("ss",B,z),ce(["s","ss"],ve);var rn,an=Te("Seconds",!1);for(I("S",0,0,function(){return~~(this.millisecond()/100)}),I(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),I(0,["SSS",3],0,"millisecond"),I(0,["SSSS",4],0,function(){return 10*this.millisecond()}),I(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),I(0,["SSSSSS",6],0,function(){return 1E3*
this.millisecond()}),I(0,["SSSSSSS",7],0,function(){return 1E4*this.millisecond()}),I(0,["SSSSSSSS",8],0,function(){return 1E5*this.millisecond()}),I(0,["SSSSSSSSS",9],0,function(){return 1E6*this.millisecond()}),H("millisecond","ms"),L("millisecond",16),ue("S",K,Z),ue("SS",K,z),ue("SSS",K,$),rn="SSSS";rn.length<=9;rn+="S")ue(rn,ne);function on(e,t){t[we]=k(1E3*("0."+e))}for(rn="S";rn.length<=9;rn+="S")ce(rn,on);var un=Te("Milliseconds",!1);I("z",0,0,"zoneAbbr"),I("zz",0,0,"zoneName");var ln=M.prototype;
function dn(e){return e}ln.add=qt,ln.calendar=function(e,t){var n=e||Tt(),s=Nt(n,this).startOf("day"),i=c.calendarFormat(this,s)||"sameElse",r=t&&(x(t[i])?t[i].call(this,n):t[i]);return this.format(r||this.localeData().calendar(i,this,Tt(n)))},ln.clone=function(){return new M(this)},ln.diff=function(e,t,n){var s,i,r;if(!this.isValid())return NaN;if(!(s=Nt(e,this)).isValid())return NaN;switch(i=6E4*(s.utcOffset()-this.utcOffset()),t=R(t)){case "year":r=Bt(this,s)/12;break;case "month":r=Bt(this,s);
break;case "quarter":r=Bt(this,s)/3;break;case "second":r=(this-s)/1E3;break;case "minute":r=(this-s)/6E4;break;case "hour":r=(this-s)/36E5;break;case "day":r=(this-s-i)/864E5;break;case "week":r=(this-s-i)/6048E5;break;default:r=this-s}return n?r:D(r)},ln.endOf=function(e){return void 0===(e=R(e))||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))},ln.format=function(e){e||(e=this.isUtc()?c.defaultFormatUtc:c.defaultFormat);var t=A(this,
e);return this.localeData().postformat(t)},ln.from=function(e,t){return this.isValid()&&(S(e)&&e.isValid()||Tt(e).isValid())?At({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},ln.fromNow=function(e){return this.from(Tt(),e)},ln.to=function(e,t){return this.isValid()&&(S(e)&&e.isValid()||Tt(e).isValid())?At({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},ln.toNow=function(e){return this.to(Tt(),e)},ln.get=function(e){return x(this[e=
R(e)])?this[e]():this},ln.invalidAt=function(){return g(this).overflow},ln.isAfter=function(e,t){var n=S(e)?e:Tt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=R(l(t)?"millisecond":t))?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())},ln.isBefore=function(e,t){var n=S(e)?e:Tt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=R(l(t)?"millisecond":t))?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())},ln.isBetween=function(e,
t,n,s){return("("===(s=s||"()")[0]?this.isAfter(e,n):!this.isBefore(e,n))&&(")"===s[1]?this.isBefore(t,n):!this.isAfter(t,n))},ln.isSame=function(e,t){var n,s=S(e)?e:Tt(e);return!(!this.isValid()||!s.isValid())&&("millisecond"===(t=R(t||"millisecond"))?this.valueOf()===s.valueOf():(n=s.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))},ln.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},ln.isSameOrBefore=function(e,t){return this.isSame(e,
t)||this.isBefore(e,t)},ln.isValid=function(){return p(this)},ln.lang=Xt,ln.locale=Qt,ln.localeData=Kt,ln.max=bt,ln.min=xt,ln.parsingFlags=function(){return _({},g(this))},ln.set=function(e,t){if("object"==typeof e)for(var n=function(e){var t=[];for(var n in e)t.push({unit:n,priority:F[n]});return t.sort(function(e,t){return e.priority-t.priority}),t}(e=C(e)),s=0;s<n.length;s++)this[n[s].unit](e[n[s].unit]);else if(x(this[e=R(e)]))return this[e](t);return this},ln.startOf=function(e){switch(e=R(e)){case "year":this.month(0);
case "quarter":case "month":this.date(1);case "week":case "isoWeek":case "day":case "date":this.hours(0);case "hour":this.minutes(0);case "minute":this.seconds(0);case "second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},ln.subtract=Jt,ln.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},ln.toObject=function(){var e=this;return{years:e.year(),
months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},ln.toDate=function(){return new Date(this.valueOf())},ln.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,n=t?this.clone().utc():this;return n.year()<0||9999<n.year()?A(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):x(Date.prototype.toISOString)?t?this.toDate().toISOString():(new Date(this.valueOf()+60*this.utcOffset()*1E3)).toISOString().replace("Z",
A(n,"Z")):A(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},ln.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var n="["+e+'("]',s=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",i=t+'[")]';return this.format(n+s+"-MM-DD[T]HH:mm:ss.SSS"+i)},ln.toJSON=function(){return this.isValid()?this.toISOString():null},ln.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},
ln.unix=function(){return Math.floor(this.valueOf()/1E3)},ln.valueOf=function(){return this._d.valueOf()-6E4*(this._offset||0)},ln.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},ln.year=Oe,ln.isLeapYear=function(){return ke(this.year())},ln.weekYear=function(e){return tn.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},ln.isoWeekYear=function(e){return tn.call(this,e,this.isoWeek(),
this.isoWeekday(),1,4)},ln.quarter=ln.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},ln.month=Fe,ln.daysInMonth=function(){return Pe(this.year(),this.month())},ln.week=ln.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},ln.isoWeek=ln.isoWeeks=function(e){var t=Ie(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},ln.weeksInYear=function(){var e=this.localeData()._week;return Ae(this.year(),e.dow,
e.doy)},ln.isoWeeksInYear=function(){return Ae(this.year(),1,4)},ln.date=nn,ln.day=ln.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,n,s=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,n=this.localeData(),e="string"!=typeof t?t:isNaN(t)?"number"==typeof(t=n.weekdaysParse(t))?t:null:parseInt(t,10),this.add(e-s,"d")):s},ln.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-
t,"d")},ln.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=(n=e,s=this.localeData(),"string"==typeof n?s.weekdaysParse(n)%7||7:isNaN(n)?null:n);return this.day(this.day()%7?t:t-7)}return this.day()||7;var n,s},ln.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864E5)+1;return null==e?t:this.add(e-t,"d")},ln.hour=ln.hours=tt,ln.minute=ln.minutes=sn,ln.second=ln.seconds=an,ln.millisecond=ln.milliseconds=un,ln.utcOffset=
function(e,t,n){var s,i=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=Ut(re,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return!this._isUTC&&t&&(s=Gt(this)),this._offset=e,this._isUTC=!0,null!=s&&this.add(s,"m"),i!==e&&(!t||this._changeInProgress?$t(this,At(e-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,c.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?i:Gt(this)},ln.utc=function(e){return this.utcOffset(0,
e)},ln.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Gt(this),"m")),this},ln.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=Ut(ie,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},ln.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?Tt(e).utcOffset():0,(this.utcOffset()-e)%60==0)},ln.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||
this.utcOffset()>this.clone().month(5).utcOffset()},ln.isLocal=function(){return!!this.isValid()&&!this._isUTC},ln.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},ln.isUtc=Vt,ln.isUTC=Vt,ln.zoneAbbr=function(){return this._isUTC?"UTC":""},ln.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},ln.dates=n("dates accessor is deprecated. Use date instead.",nn),ln.months=n("months accessor is deprecated. Use month instead",Fe),ln.years=n("years accessor is deprecated. Use year instead",
Oe),ln.zone=n("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),ln.isDSTShifted=n("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!l(this._isDSTShifted))return this._isDSTShifted;var e={};if(w(e,this),(e=Yt(e))._a){var t=e._isUTC?y(e._a):Tt(e._a);this._isDSTShifted=this.isValid()&&
0<a(e._a,t.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var hn=P.prototype;function cn(e,t,n,s){var i=lt(),r=y().set(s,t);return i[n](r,e)}function fn(e,t,n){if(d(e)&&(t=e,e=void 0),e=e||"",null!=t)return cn(e,t,n,"month");var s,i=[];for(s=0;s<12;s++)i[s]=cn(e,s,n,"month");return i}function mn(e,t,n,s){"boolean"==typeof e?d(t)&&(n=t,t=void 0):(t=e,e=!1,d(n=t)&&(n=t,t=void 0)),t=t||"";var i,r=lt(),a=e?r._week.dow:0;if(null!=n)return cn(t,(n+a)%7,s,"day");var o=[];for(i=0;i<7;i++)o[i]=
cn(t,(i+a)%7,s,"day");return o}hn.calendar=function(e,t,n){var s=this._calendar[e]||this._calendar.sameElse;return x(s)?s.call(t,n):s},hn.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},hn.invalidDate=function(){return this._invalidDate},hn.ordinal=function(e){return this._ordinal.replace("%d",e)},hn.preparse=dn,hn.postformat=
dn,hn.relativeTime=function(e,t,n,s){var i=this._relativeTime[n];return x(i)?i(e,t,n,s):i.replace(/%d/i,e)},hn.pastFuture=function(e,t){var n=this._relativeTime[0<e?"future":"past"];return x(n)?n(t):n.replace(/%s/i,t)},hn.set=function(e){var t,n;for(n in e)x(t=e[n])?this[n]=t:this["_"+n]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},hn.months=function(e,t){return e?o(this._months)?this._months[e.month()]:
this._months[(this._months.isFormat||We).test(t)?"format":"standalone"][e.month()]:o(this._months)?this._months:this._months.standalone},hn.monthsShort=function(e,t){return e?o(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[We.test(t)?"format":"standalone"][e.month()]:o(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},hn.monthsParse=function(e,t,n){var s,i,r;if(this._monthsParseExact)return function(e,t,n){var s,i,r,a=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=
[],this._longMonthsParse=[],this._shortMonthsParse=[],s=0;s<12;++s)r=y([2E3,s]),this._shortMonthsParse[s]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[s]=this.months(r,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(i=Ye.call(this._shortMonthsParse,a))?i:null:-1!==(i=Ye.call(this._longMonthsParse,a))?i:null:"MMM"===t?-1!==(i=Ye.call(this._shortMonthsParse,a))?i:-1!==(i=Ye.call(this._longMonthsParse,a))?i:null:-1!==(i=Ye.call(this._longMonthsParse,a))?i:-1!==(i=Ye.call(this._shortMonthsParse,
a))?i:null}.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),s=0;s<12;s++){if(i=y([2E3,s]),n&&!this._longMonthsParse[s]&&(this._longMonthsParse[s]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[s]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[s]||(r="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[s]=new RegExp(r.replace(".",""),"i")),n&&"MMMM"===
t&&this._longMonthsParse[s].test(e))return s;if(n&&"MMM"===t&&this._shortMonthsParse[s].test(e))return s;if(!n&&this._monthsParse[s].test(e))return s}},hn.monthsRegex=function(e){return this._monthsParseExact?(m(this,"_monthsRegex")||Ne.call(this),e?this._monthsStrictRegex:this._monthsRegex):(m(this,"_monthsRegex")||(this._monthsRegex=Ue),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},hn.monthsShortRegex=function(e){return this._monthsParseExact?(m(this,"_monthsRegex")||Ne.call(this),
e?this._monthsShortStrictRegex:this._monthsShortRegex):(m(this,"_monthsShortRegex")||(this._monthsShortRegex=Le),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},hn.week=function(e){return Ie(e,this._week.dow,this._week.doy).week},hn.firstDayOfYear=function(){return this._week.doy},hn.firstDayOfWeek=function(){return this._week.dow},hn.weekdays=function(e,t){return e?o(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":
"standalone"][e.day()]:o(this._weekdays)?this._weekdays:this._weekdays.standalone},hn.weekdaysMin=function(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin},hn.weekdaysShort=function(e){return e?this._weekdaysShort[e.day()]:this._weekdaysShort},hn.weekdaysParse=function(e,t,n){var s,i,r;if(this._weekdaysParseExact)return function(e,t,n){var s,i,r,a=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],s=0;s<7;++s)r=y([2E3,
1]).day(s),this._minWeekdaysParse[s]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[s]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[s]=this.weekdays(r,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(i=Ye.call(this._weekdaysParse,a))?i:null:"ddd"===t?-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:null:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:"dddd"===t?-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:-1!==(i=
Ye.call(this._minWeekdaysParse,a))?i:null:"ddd"===t?-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:null}.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),s=0;s<7;s++){if(i=y([2E3,
1]).day(s),n&&!this._fullWeekdaysParse[s]&&(this._fullWeekdaysParse[s]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[s]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[s]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[s]||(r="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[s]=new RegExp(r.replace(".",""),"i")),n&&"dddd"===
t&&this._fullWeekdaysParse[s].test(e))return s;if(n&&"ddd"===t&&this._shortWeekdaysParse[s].test(e))return s;if(n&&"dd"===t&&this._minWeekdaysParse[s].test(e))return s;if(!n&&this._weekdaysParse[s].test(e))return s}},hn.weekdaysRegex=function(e){return this._weekdaysParseExact?(m(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(m(this,"_weekdaysRegex")||(this._weekdaysRegex=$e),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},hn.weekdaysShortRegex=
function(e){return this._weekdaysParseExact?(m(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(m(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=qe),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},hn.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(m(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(m(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=
Je),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},hn.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},hn.meridiem=function(e,t,n){return 11<e?n?"pm":"PM":n?"am":"AM"},ot("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===k(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),c.lang=n("moment.lang is deprecated. Use moment.locale instead.",ot),c.langData=n("moment.langData is deprecated. Use moment.localeData instead.",
lt);var _n=Math.abs;function yn(e,t,n,s){var i=At(t,n);return e._milliseconds+=s*i._milliseconds,e._days+=s*i._days,e._months+=s*i._months,e._bubble()}function gn(e){return e<0?Math.floor(e):Math.ceil(e)}function pn(e){return 4800*e/146097}function vn(e){return 146097*e/4800}function wn(e){return function(){return this.as(e)}}var Mn=wn("ms"),Sn=wn("s"),Dn=wn("m"),kn=wn("h"),Yn=wn("d"),On=wn("w"),Tn=wn("M"),xn=wn("y");function bn(e){return function(){return this.isValid()?this._data[e]:NaN}}var Pn=
bn("milliseconds"),Wn=bn("seconds"),Hn=bn("minutes"),Rn=bn("hours"),Cn=bn("days"),Fn=bn("months"),Ln=bn("years");var Un=Math.round,Nn={ss:44,s:45,m:45,h:22,d:26,M:11};var Gn=Math.abs;function Vn(e){return(0<e)-(e<0)||+e}function En(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n=Gn(this._milliseconds)/1E3,s=Gn(this._days),i=Gn(this._months);t=D((e=D(n/60))/60),n%=60,e%=60;var r=D(i/12),a=i%=12,o=s,u=t,l=e,d=n?n.toFixed(3).replace(/\.?0+$/,""):"",h=this.asSeconds();if(!h)return"P0D";
var c=h<0?"-":"",f=Vn(this._months)!==Vn(h)?"-":"",m=Vn(this._days)!==Vn(h)?"-":"",_=Vn(this._milliseconds)!==Vn(h)?"-":"";return c+"P"+(r?f+r+"Y":"")+(a?f+a+"M":"")+(o?m+o+"D":"")+(u||l||d?"T":"")+(u?_+u+"H":"")+(l?_+l+"M":"")+(d?_+d+"S":"")}var In=Ht.prototype;return In.isValid=function(){return this._isValid},In.abs=function(){var e=this._data;return this._milliseconds=_n(this._milliseconds),this._days=_n(this._days),this._months=_n(this._months),e.milliseconds=_n(e.milliseconds),e.seconds=_n(e.seconds),
e.minutes=_n(e.minutes),e.hours=_n(e.hours),e.months=_n(e.months),e.years=_n(e.years),this},In.add=function(e,t){return yn(this,e,t,1)},In.subtract=function(e,t){return yn(this,e,t,-1)},In.as=function(e){if(!this.isValid())return NaN;var t,n,s=this._milliseconds;if("month"===(e=R(e))||"year"===e)return t=this._days+s/864E5,n=this._months+pn(t),"month"===e?n:n/12;switch(t=this._days+Math.round(vn(this._months)),e){case "week":return t/7+s/6048E5;case "day":return t+s/864E5;case "hour":return 24*t+
s/36E5;case "minute":return 1440*t+s/6E4;case "second":return 86400*t+s/1E3;case "millisecond":return Math.floor(864E5*t)+s;default:throw new Error("Unknown unit "+e);}},In.asMilliseconds=Mn,In.asSeconds=Sn,In.asMinutes=Dn,In.asHours=kn,In.asDays=Yn,In.asWeeks=On,In.asMonths=Tn,In.asYears=xn,In.valueOf=function(){return this.isValid()?this._milliseconds+864E5*this._days+this._months%12*2592E6+31536E6*k(this._months/12):NaN},In._bubble=function(){var e,t,n,s,i,r=this._milliseconds,a=this._days,o=this._months,
u=this._data;return 0<=r&&0<=a&&0<=o||r<=0&&a<=0&&o<=0||(r+=864E5*gn(vn(o)+a),o=a=0),u.milliseconds=r%1E3,e=D(r/1E3),u.seconds=e%60,t=D(e/60),u.minutes=t%60,n=D(t/60),u.hours=n%24,o+=i=D(pn(a+=D(n/24))),a-=gn(vn(i)),s=D(o/12),o%=12,u.days=a,u.months=o,u.years=s,this},In.clone=function(){return At(this)},In.get=function(e){return e=R(e),this.isValid()?this[e+"s"]():NaN},In.milliseconds=Pn,In.seconds=Wn,In.minutes=Hn,In.hours=Rn,In.days=Cn,In.weeks=function(){return D(this.days()/7)},In.months=Fn,In.years=
Ln,In.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t,n,s,i,r,a,o,u,l,d,h,c=this.localeData(),f=(n=!e,s=c,i=At(t=this).abs(),r=Un(i.as("s")),a=Un(i.as("m")),o=Un(i.as("h")),u=Un(i.as("d")),l=Un(i.as("M")),d=Un(i.as("y")),(h=r<=Nn.ss&&["s",r]||r<Nn.s&&["ss",r]||a<=1&&["m"]||a<Nn.m&&["mm",a]||o<=1&&["h"]||o<Nn.h&&["hh",o]||u<=1&&["d"]||u<Nn.d&&["dd",u]||l<=1&&["M"]||l<Nn.M&&["MM",l]||d<=1&&["y"]||["yy",d])[2]=n,h[3]=0<+t,h[4]=s,function(e,t,n,s,i){return i.relativeTime(t||
1,!!n,e,s)}.apply(null,h));return e&&(f=c.pastFuture(+this,f)),c.postformat(f)},In.toISOString=En,In.toString=En,In.toJSON=En,In.locale=Qt,In.localeData=Kt,In.toIsoString=n("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",En),In.lang=Xt,I("X",0,0,"unix"),I("x",0,0,"valueOf"),ue("x",se),ue("X",/[+-]?\d+(\.\d{1,3})?/),ce("X",function(e,t,n){n._d=new Date(1E3*parseFloat(e,10))}),ce("x",function(e,t,n){n._d=new Date(k(e))}),c.version="2.22.2",e=Tt,c.fn=ln,c.min=function(){return Pt("isBefore",
[].slice.call(arguments,0))},c.max=function(){return Pt("isAfter",[].slice.call(arguments,0))},c.now=function(){return Date.now?Date.now():+new Date},c.utc=y,c.unix=function(e){return Tt(1E3*e)},c.months=function(e,t){return fn(e,t,"months")},c.isDate=h,c.locale=ot,c.invalid=v,c.duration=At,c.isMoment=S,c.weekdays=function(e,t,n){return mn(e,t,n,"weekdays")},c.parseZone=function(){return Tt.apply(null,arguments).parseZone()},c.localeData=lt,c.isDuration=Rt,c.monthsShort=function(e,t){return fn(e,
t,"monthsShort")},c.weekdaysMin=function(e,t,n){return mn(e,t,n,"weekdaysMin")},c.defineLocale=ut,c.updateLocale=function(e,t){if(null!=t){var n,s,i=nt;null!=(s=at(e))&&(i=s._config),(n=new P(t=b(i,t))).parentLocale=st[e],st[e]=n,ot(e)}else null!=st[e]&&(null!=st[e].parentLocale?st[e]=st[e].parentLocale:null!=st[e]&&delete st[e]);return st[e]},c.locales=function(){return s(st)},c.weekdaysShort=function(e,t,n){return mn(e,t,n,"weekdaysShort")},c.normalizeUnits=R,c.relativeTimeRounding=function(e){return void 0===
e?Un:"function"==typeof e&&(Un=e,!0)},c.relativeTimeThreshold=function(e,t){return void 0!==Nn[e]&&(void 0===t?Nn[e]:(Nn[e]=t,"s"===e&&(Nn.ss=t-1),!0))},c.calendarFormat=function(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"},c.prototype=ln,c.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",
TIME_MS:"HH:mm:ss.SSS",WEEK:"YYYY-[W]WW",MONTH:"YYYY-MM"},c});
(function(root,factory){if(typeof define==="function"&&define.amd)define("wavesurfer",[],function(){return root["WaveSurfer"]=factory()});else if(typeof exports==="object")module.exports=factory();else root["WaveSurfer"]=factory()})(this,function(){var WaveSurfer={defaultParams:{audioContext:null,audioRate:1,autoCenter:true,autoVisualRange:undefined,backend:"WebAudio",barHeight:1,classList:{},styleList:{wave:{},progressWave:{},cursor:{}},closeAudioContext:false,container:null,cursorAlignment:"middle",
cursorColor:undefined,cursorWidth:1,dragToSeek:true,forceDecode:false,height:128,hideScrollbar:false,initialSeekPosition:0,interact:true,invertTransparency:false,loopSelection:true,mediaContainer:null,mediaControls:false,mediaType:"audio",minPxPerSec:20,partialRender:false,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,progressColor:"#555",normalize:false,renderer:"MultiCanvas",scrollParent:false,skipLength:2,splitChannels:false,waveColor:"#999",savePlayStateOnDrag:true},
init:function(params){var my=this;var temp=Object.assign({},my.defaultParams);var updateCursorPosition=function(n){if(my.drawer)my.drawer.updateCursorPosition()};var drawBuffer=function(){if(my.drawer)my.drawBuffer()};my.aliases={};my.aliases.cursorColor={target:{object:temp.styleList.cursor,property:"_backgroundColor"},sourceList:[{object:temp,property:"cursorColor"},{object:temp.styleList.cursor,property:"backgroundColor"}]};my.aliases.cursorWidth={target:{object:temp.styleList.cursor,property:"_width"},
sourceList:[{object:temp,property:"cursorWidth",get:function(n){return parseFloat(n)},set:function(n){return n+"px"},afterSet:updateCursorPosition},{object:temp.styleList.cursor,property:"width",afterSet:updateCursorPosition}]};my.aliases.cursorAlignment={target:{object:temp.styleList.cursor,property:"_cursorAlignment"},sourceList:[{object:temp,property:"cursorAlignment",afterSet:updateCursorPosition}]};Array("invertTransparency","backgroundColor","barWidth").forEach(function(prop){my.aliases[prop]=
{target:{object:temp,property:"_"+prop},sourceList:[{object:temp,property:prop,afterSet:drawBuffer}]}});Array("wave","progressWave").forEach(function(waveType){Array("color","backgroundColor").forEach(function(prop){var uniqueProp=waveType=="wave"?"wave":"progress";var propCaps=prop[0].toUpperCase()+prop.slice(1);my.aliases[waveType+propCaps]={target:{object:temp.styleList[waveType],property:"_"+prop},sourceList:[{object:temp,property:uniqueProp+propCaps,afterSet:drawBuffer},{object:temp.styleList[waveType],
property:prop,afterSet:drawBuffer}]}})});WaveSurfer.util.refreshAliases(my.aliases);var temp=Object.assign(temp,my.defaultParams);my.params=WaveSurfer.util.deepMerge(temp,params);my.container=typeof params.container=="string"?document.querySelector(my.params.container):my.params.container;if(!my.container)throw new Error("Container element not found.");if(my.params.mediaContainer==null)my.mediaContainer=my.container;else if(typeof my.params.mediaContainer=="string")my.mediaContainer=document.querySelector(my.params.mediaContainer);
else my.mediaContainer=my.params.mediaContainer;if(!my.mediaContainer)throw new Error("Media Container element not found.");my.savedVolume=0;my.isMuted=false;my.tmpEvents=[];my.currentAjax=null;my.createDrawer();my.createBackend();my.createPeakCache();my.initialSeekPosition=typeof my.params.initialSeekPosition=="number"?function(){return my.params.initialSeekPosition}:my.params.initialSeekPosition;my.isDestroyed=false;my.on("ready",function(){my.audioIsReady=true;if(typeof my.initialSeekPosition!=
"undefined")my.seekTo(my.initialSeekPosition())});my.on("scroll",function(evt,func){var drawer=my.drawer;if(!drawer||!drawer.params.autoVisualRange)return;if(drawer.lastScrollWasProgrammatic){drawer.lastScrollWasProgrammatic=false;return}drawer.scrollBarDragEventActive=true;drawer.setPositionLockFromCursorAndScrollPosition()})},createDrawer:function(){var my=this;my.drawer=Object.create(WaveSurfer.Drawer[my.params.renderer]);my.drawer.init(my.container,my.params,my.aliases,my);my.drawer.on("redraw",
function(){my.drawBuffer(function(){my.drawer.progress(my.backend.getPlayedPercents())})});if(!my.params.dragToSeek)my.drawer.on("click",function(evt,progress){my.seekTo(progress)});else{my.pointerUp=function(evt){if(!my.mousedownState)return;my.mousedownState=undefined;var progress=my.drawer.handleEvent(evt);var drawer=my.drawer;if(drawer.scrollBarDragEventActive){drawer.scrollBarDragEventActive=false;if(drawer.lastScrollWasProgrammatic==false){var oldProgress=my.getCurrentTime()/my.getDuration();
var progress=drawer.constrainProgressByVisualRange(oldProgress)}}my.seekTo(progress);if(my.isPlayingSaved&&my.savePlayStateOnDrag)my.play(my.getCurrentTime());else my.seekTo(my.getCurrentTime()/my.getDuration())};function pointerDown(){my.isPlayingSaved=my.isPlaying();if(my.isPlayingSaved)my.pause();my.mousedownState=true}my.drawer.on("pointerdown",pointerDown);document.body.addEventListener("mouseup",my.pointerUp);document.body.addEventListener("touchend",my.pointerUp);document.body.addEventListener("mouseleave",
my.pointerUp);function pointerMove(evt,progress){if(my.mousedownState)my.seekTo(progress)}my.drawer.on("pointermove",pointerMove)}my.drawer.on("scroll",function(evt){if(my.params.partialRender)my.drawBuffer(function(){my.fireEvent("scroll",evt)});else my.fireEvent("scroll",evt)})},createBackend:function(){var my=this;if(my.backend)my.backend.destroy();if(my.params.backend=="AudioElement")my.params.backend="MediaElement";if(my.params.backend=="WebAudio"&&!WaveSurfer.WebAudio.supportsWebAudio())my.params.backend=
"MediaElement";my.backend=Object.create(WaveSurfer[my.params.backend]);my.backend.init(my.params);my.backend.on("finish",function(){my.fireEvent("finish")});my.backend.on("play",function(){my.fireEvent("play")});my.backend.on("pause",function(){my.fireEvent("pause")});my.backend.on("audioprocess",function(time){my.drawer.progress(my.backend.getPlayedPercents());my.fireEvent("audioprocess",time)})},createPeakCache:function(){if(!this.params.partialRender)return;this.peakCache=Object.create(WaveSurfer.PeakCache);
this.peakCache.init()},getDuration:function(){if(this.audioIsReady||this.cachedData===undefined||this.cachedData.duration===undefined)return this.backend.getDuration();else return this.cachedData.duration},getCurrentTime:function(){if(this.audioIsReady||this.cachedData===undefined||this.cachedData.duration===undefined)return this.backend.getCurrentTime();else return this.initialSeekPosition()*this.cachedData.duration},play:function(start,end,callback){function action(){my.fireEvent("interaction",
my.play.bind(my,start,end,callback));my.backend.play(start,end,callback)}var my=this;if(my.audioIsReady==true)action();else my.tmpEvents.push(my.once("ready",action))},pause:function(callback){return this.backend.isPaused()||this.backend.pause(callback)},playPause:function(callback){return this.backend.isPaused()?this.play(callback):this.pause(callback)},isPlaying:function(){return!this.backend.isPaused()},skipBackward:function(seconds){this.skip(-seconds||-this.params.skipLength)},skipForward:function(seconds){this.skip(seconds||
this.params.skipLength)},skip:function(offset){var position=this.getCurrentTime()||0;var duration=this.getDuration()||1;position=Math.max(0,Math.min(duration,position+(offset||0)));this.seekAndCenter(position/duration)},seekAndCenter:function(progress){this.seekTo(progress);this.drawer.recenter(progress)},seekTo:function(progress){this.initialSeekPosition=function(){return progress};this.fireEvent("interaction",this.seekTo.bind(this,progress));var paused=this.backend.isPaused();var savedScrollParent=
this.params.scrollParent;this.params.scrollParent=false;this.backend.seekTo(progress*this.getDuration());this.drawer.progress(progress,true);this.params.scrollParent=savedScrollParent;this.fireEvent.apply(this,["seek"].concat(Array.prototype.slice.call(arguments)));if(!paused)this.backend.play()},stop:function(){this.pause();this.seekTo(0);this.drawer.progress(0)},setVolume:function(newVolume){this.backend.setVolume(newVolume)},getVolume:function(){return this.backend.getVolume()},setPlaybackRate:function(rate){this.backend.setPlaybackRate(rate)},
getPlaybackRate:function(){return this.backend.getPlaybackRate()},toggleMute:function(){this.setMute(!this.isMuted)},setMute:function(mute){if(mute===this.isMuted)return;if(mute){this.savedVolume=this.backend.getVolume();this.backend.setVolume(0);this.isMuted=true}else{this.backend.setVolume(this.savedVolume);this.isMuted=false}},getMute:function(){return this.isMuted},getFilters:function(){return this.backend.filters||[]},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent;
this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},getNumberOfChannels:function(){return this.backend.buffer?this.backend.buffer.numberOfChannels:this.cachedData&&this.cachedData.numberOfChannels!==undefined?this.cachedData.numberOfChannels:this.backend.peaks&&this.backend.peaks[0]instanceof Array?this.backend.peaks.length:2},getComputedWidthAndRange:function(){var nominalWidth=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio);var parentWidth=
this.drawer.getWidth();if(!this.params.scrollParent||nominalWidth<parentWidth){var width=parentWidth;var start=0;var end=width}else{var width=nominalWidth;var start=this.drawer.getScrollX();var end=Math.min(start+parentWidth,width)}return{width:width,start:start,end:end,nominalWidth:nominalWidth,parentWidth:parentWidth}},getPxPerSec:function(width){return(typeof width=="undefined"?this.getComputedWidthAndRange().width:width)/(this.getDuration()*this.params.pixelRatio)},drawBuffer:function(callback){var my=
this,wse=my.getComputedWidthAndRange();var width=wse.width,start=wse.start,end=wse.end;if("peaks"in my.backend&&my.backend.peaks!=null){var numberOfChannels=my.getNumberOfChannels();var subrangeLength=(my.backend.peaks[0]instanceof Array?my.backend.peaks[0].length:my.backend.peaks.length)/numberOfChannels}else var subrangeLength=width;if(my.params.partialRender){start=Math.round((start+1)/width*subrangeLength)-1;end=Math.round((end+1)/width*subrangeLength)-1;var newRanges=my.peakCache.addRangeToPeakCache(subrangeLength,
start,end);var peaks=function(inner){newRanges.forEach(function(newRange){var peaks=my.backend.getPeaks(subrangeLength,newRange[0],newRange[1]);inner(peaks,width,newRange[0],newRange[1])})}}else{start=0;end=subrangeLength-1;var peaks=my.backend.getPeaks(subrangeLength,start,end)}my.drawer.drawPeaks(peaks,width,start,end,!my.params.partialRender,function(){if(callback instanceof Function)callback();my.fireEvent("redraw",peaks,width)})},zoom:function(pxPerSec,callback){var my=this;if(my.params.partialRender&&
my.peakCache)my.peakCache.clearPeakCache();my.params.minPxPerSec=pxPerSec;my.params.scrollParent=true;my.drawBuffer(function(){my.drawer.updateProgress();my.drawer.lockOnPosition(my.drawer.getCurrentProgress()*my.drawer.getScrollWidth(),1,my.drawer.relativePositionLock);my.fireEvent("zoom",pxPerSec);if(callback)callback()})},loadArrayBuffer:function(arraybuffer){var my=this;my.decodeArrayBuffer(arraybuffer,function(data){if(!my.isDestroyed)my.loadDecodedBuffer(data)})},loadDecodedBuffer:function(buffer){var my=
this;my.backend.load(buffer);my.drawBuffer(function(){my.fireEvent("ready")})},loadBlob:function(blob){var reader=new FileReader;reader.addEventListener("progress",function(e){my.onProgress(e)});reader.addEventListener("load",function(e){my.loadArrayBuffer(e.target.result)});reader.addEventListener("error",function(){my.fireEvent("error","Error reading file.")});reader.readAsArrayBuffer(blob);this.empty()},load:function(url,peaks,preload,settings){var my=this;var settings=settings||{};var loadOnInteraction=
settings.loadOnInteraction;var createHTMLAudioElement=settings.createHTMLAudioElement;Array("loadOnInteraction","createHTMLAudioElement").forEach(function(prop){if(prop in settings)delete settings[prop]});my.cachedData=settings;my.empty({drawPeaks:peaks===undefined},function(){my.isMuted=false;switch(my.params.backend){case "WebAudio":my.loadBuffer(url,peaks,true,loadOnInteraction);case "MediaElement":if(createHTMLAudioElement)url=new Audio(url);my.loadMediaElement(url,peaks,preload)}})},loadBuffer:function(url,
peaks,preload,loadOnInteraction){var my=this;var load=function(action){if(action)my.tmpEvents.push(my.once("ready",action));my.getArrayBuffer(url,my.loadArrayBuffer.bind(my))};if(peaks){my.backend.setPeaks(peaks);my.drawBuffer(complete)}else complete();function complete(){if(loadOnInteraction)my.tmpEvents.push(my.once("interaction",function(result){load(result)}));else{my.drawer.updateProgress(0);load()}}},loadMediaElement:function(urlOrElement,peaks,preload){var my=this,url=urlOrElement;if(typeof urlOrElement===
"string")my.backend.load(url,my.mediaContainer,peaks,preload);else{var element=urlOrElement;my.backend.loadElement(element,peaks);url=element.src}var audioReady=new Promise(function(res){my.tmpEvents.push(my.backend.once("canplay",res))});var canvasReady=!peaks?Promise.resolve():new Promise(function(res){my.drawBuffer(function(){my.fireEvent("waveform-drawn");res()})});Promise.all([audioReady,canvasReady]).then(function(){my.fireEvent("ready")});my.tmpEvents.push(my.backend.once("error",function(err){my.fireEvent("error",
err)}));if(peaks)my.backend.setPeaks(peaks);if((!peaks||my.params.forceDecode)&&my.backend.supportsWebAudio())my.getArrayBuffer(url,function(arraybuffer){my.decodeArrayBuffer(arraybuffer,function(buffer){my.backend.buffer=buffer;my.backend.setPeaks(null);my.drawBuffer(function(){my.fireEvent("waveform-ready")})})})},decodeArrayBuffer:function(arraybuffer,callback){this.arraybuffer=arraybuffer;this.backend.decodeArrayBuffer(arraybuffer,function(data){if(!this.isDestroyed&&this.arraybuffer==arraybuffer){callback(data);
this.arraybuffer=null}}.bind(this),this.fireEvent.bind(this,"error","Error decoding audiobuffer"))},getArrayBuffer:function(url,callback){var my=this;var ajax=WaveSurfer.util.ajax({url:url,responseType:"arraybuffer"});this.currentAjax=ajax;this.tmpEvents.push(ajax.on("progress",function(e){my.onProgress(e)}),ajax.on("success",function(data,e){callback(data);my.currentAjax=null}),ajax.on("error",function(e){my.fireEvent("error","XHR error: "+e.target.statusText);my.currentAjax=null}));return ajax},
onProgress:function(e){if(e.lengthComputable)var percentComplete=e.loaded/e.total;else percentComplete=e.loaded/(e.loaded+1E6);this.fireEvent("loading",Math.round(percentComplete*100),e.target)},exportPCM:function(length,accuracy,noWindow,start){length=length||1024;accuracy=accuracy||1E4;noWindow=noWindow||false;var peaks=this.backend.getPeaks(length,start,length-1);var arr=[].map.call(peaks,function(val){return Math.round(val*accuracy)/accuracy});var json=JSON.stringify(arr);if(!noWindow)window.open("data:application/json;charset\x3dutf-8,"+
encodeURIComponent(json));return json},exportImage:function(format,quality){if(!format)format="image/png";if(!quality)quality=1;return this.drawer.getImage(format,quality)},cancelAjax:function(){if(this.currentAjax){this.currentAjax.xhr.abort();this.currentAjax=null}},clearTmpEvents:function(){this.tmpEvents.forEach(function(e){e.un()})},empty:function(init,callback){init=init||{};if(!this.backend.isPaused()){this.stop();this.backend.disconnectSource()}this.cancelAjax();this.clearTmpEvents();this.drawer.progress(0);
this.drawer.setWidth(0);if(!("drawPeaks"in init)||init.drawPeaks==true)this.drawer.drawPeaks({length:this.drawer.getWidth()},0,undefined,undefined,true,callback);else if(callback)callback()},destroy:function(){if(this.pointerUp){document.body.removeEventListener("mouseup",this.pointerUp);document.body.removeEventListener("touchend",this.pointerUp);document.body.removeEventListener("mouseleave",this.pointerUp)}this.fireEvent("destroy");this.cancelAjax();this.clearTmpEvents();this.unAll();this.backend.destroy();
this.drawer.destroy();this.isDestroyed=true}};WaveSurfer.create=function(params){var wavesurfer=Object.create(WaveSurfer);wavesurfer.init(params);return wavesurfer};WaveSurfer.util={requestAnimationFrame:(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){setTimeout(callback,1E3/60)}).bind(window),frame:function(func){return function(){var my=this,args=arguments;
WaveSurfer.util.requestAnimationFrame(function(){func.apply(my,args)})}},extend:function(dest){var sources=Array.prototype.slice.call(arguments,1);sources.forEach(function(source){Object.keys(source).forEach(function(key){dest[key]=source[key]})});return dest},deepMerge:function(target,obj,level){if(obj===null||typeof obj!="object"||"isActiveClone"in obj)return typeof target!="object"?obj:target;if(target===null||typeof target!="object")var target=obj instanceof Date?new obj.constructor:obj.constructor();
for(var key in obj){if(!Object.prototype.hasOwnProperty.call(obj,key))continue;obj.isActiveClone=null;if(obj[key]instanceof Element||level!==undefined&&level==0)target[key]=obj[key];else target[key]=this.deepMerge(target[key],obj[key],level===undefined?undefined:level-1);delete obj.isActiveClone}return target},setAliases:function(init){var targetObject=init.target.object,targetProperty=init.target.property;if(init.styleSource){var styleSource=init.styleSource;var styleAfterSet=styleSource.set?function(n){styleSourceObject[styleSourceProperty]=
styleSource.set(n)}:function(n){styleSourceObject[styleSourceProperty]=n};var styleSourceObject=styleSource.object,styleSourceProperty=styleSource.property;var styleSourcePropertyUnderscore=styleSourceProperty.replace(/([A-Z])/g,"-$1").toLowerCase();Object.defineProperty(styleSourceObject,styleSourceProperty,{configurable:true});Object.defineProperty(styleSourceObject,styleSourceProperty,{get:function(){return this.getPropertyValue(styleSourcePropertyUnderscore)},set:function(n){targetObject[targetProperty]=
n;this.setProperty(styleSourcePropertyUnderscore,n)}})}init.sourceList.forEach(function(source){if(source.get)var get=function(){return source.get(targetObject[targetProperty])};else var get=function(){return targetObject[targetProperty]};var afterSet=source.afterSet;if(styleAfterSet)var setExtra=afterSet?function(n){styleAfterSet(n);afterSet(n)}:styleAfterSet;else var setExtra=afterSet?afterSet:undefined;if(source.set)if(setExtra)var set=function(value){value=targetObject[targetProperty]=source.set(value);
setExtra(value)};else var set=function(value){targetObject[targetProperty]=source.set(value)};else if(setExtra)var set=function(value){value=targetObject[targetProperty]=value;setExtra(value)};else var set=function(value){targetObject[targetProperty]=value};Object.defineProperty(source.object,source.property,{configurable:true,get:get,set:set})})},refreshAliases:function(aliases,changes){for(var aliasName in aliases){var alias=aliases[aliasName];if(changes&&changes[aliasName])WaveSurfer.util.deepMerge(alias,
changes[aliasName],1);WaveSurfer.util.setAliases(alias)}},debounce:function(func,wait,immediate){var args,context,timeout;var later=function(){timeout=null;if(!immediate)func.apply(context,args)};return function(){context=this;args=arguments;var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(!timeout)timeout=setTimeout(later,wait);if(callNow)func.apply(context,args)}},min:function(values){var min=+Infinity;for(var i in values)if(values[i]<min)min=values[i];return min},
max:function(values){var max=-Infinity;for(var i in values)if(values[i]>max)max=values[i];return max},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},ajax:function(options){var ajax=Object.create(WaveSurfer.Observer);var xhr=new XMLHttpRequest;var fired100=false;xhr.open(options.method||"GET",options.url,true);xhr.responseType=options.responseType||"json";xhr.addEventListener("progress",function(e){ajax.fireEvent("progress",e);if(e.lengthComputable&&e.loaded==e.total)fired100=
true});xhr.addEventListener("load",function(e){if(!fired100)ajax.fireEvent("progress",e);ajax.fireEvent("load",e);if(200==xhr.status||206==xhr.status)ajax.fireEvent("success",xhr.response,e);else ajax.fireEvent("error",e)});xhr.addEventListener("error",function(e){ajax.fireEvent("error",e)});xhr.send();ajax.xhr=xhr;return ajax}};WaveSurfer.Observer={on:function(event,fn){if(!this.handlers)this.handlers={};var handlers=this.handlers[event];if(!handlers)handlers=this.handlers[event]=[];handlers.push(fn);
return{name:event,callback:fn,un:this.un.bind(this,event,fn)}},un:function(event,fn){if(!this.handlers)return;var handlers=this.handlers[event];if(!handlers)return;if(!fn){handlers.length=0;return}for(var i=handlers.length-1;i>=0;i--)if(handlers[i]==fn)handlers.splice(i,1)},unAll:function(){this.handlers=null},once:function(event,handler){var my=this,fn=function(){handler.apply(this,arguments);setTimeout(function(){my.un(event,fn)},0)};return this.on(event,fn)},fireEvent:function(event){if(!this.handlers)return;
var handlers=this.handlers[event];var args=Array.prototype.slice.call(arguments,1);handlers&&handlers.forEach(function(fn){fn.apply(null,args)})}};WaveSurfer.util.extend(WaveSurfer,WaveSurfer.Observer);WaveSurfer.WebAudio={scriptBufferSize:256,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return!!(window.AudioContext||window.webkitAudioContext)},getAudioContext:function(){if(!WaveSurfer.WebAudio.audioContext)WaveSurfer.WebAudio.audioContext=new (window.AudioContext||
window.webkitAudioContext);return WaveSurfer.WebAudio.audioContext},getOfflineAudioContext:function(sampleRate){if(!WaveSurfer.WebAudio.offlineAudioContext)WaveSurfer.WebAudio.offlineAudioContext=new (window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,sampleRate);return WaveSurfer.WebAudio.offlineAudioContext},init:function(params){this.params=params;this.ac=params.audioContext||this.getAudioContext();this.lastPlay=this.ac.currentTime;this.startPosition=0;this.scheduledPause=null;this.states=
[Object.create(WaveSurfer.WebAudio.state.playing),Object.create(WaveSurfer.WebAudio.state.paused),Object.create(WaveSurfer.WebAudio.state.finished)];this.createVolumeNode();this.createScriptNode();this.createAnalyserNode();this.setState(this.PAUSED_STATE);this.setPlaybackRate(this.params.audioRate);this.setLength(0)},disconnectFilters:function(){if(this.filters){this.filters.forEach(function(filter){filter&&filter.disconnect()});this.filters=null;this.analyser.connect(this.gainNode)}},setState:function(state){if(this.state!==
this.states[state]){this.state=this.states[state];this.state.init.call(this)}},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(filters){this.disconnectFilters();if(filters&&filters.length){this.filters=filters;this.analyser.disconnect();filters.reduce(function(prev,curr){prev.connect(curr);return curr},this.analyser).connect(this.gainNode)}},createScriptNode:function(){if(this.ac.createScriptProcessor)this.scriptNode=this.ac.createScriptProcessor(this.scriptBufferSize);
else this.scriptNode=this.ac.createJavaScriptNode(this.scriptBufferSize);this.scriptNode.connect(this.ac.destination)},addOnAudioProcess:function(){var my=this;this.scriptNode.onaudioprocess=function(){var time=my.getCurrentTime();if(time>=my.getDuration()){my.setState(my.FINISHED_STATE);my.fireEvent("pause")}else if(time>=my.scheduledPause)my.pause();else if(my.state===my.states[my.PLAYING_STATE])my.fireEvent("audioprocess",time)}},removeOnAudioProcess:function(){this.scriptNode.onaudioprocess=null},
createAnalyserNode:function(){this.analyser=this.ac.createAnalyser();this.analyser.connect(this.gainNode)},createVolumeNode:function(){if(this.ac.createGain)this.gainNode=this.ac.createGain();else this.gainNode=this.ac.createGainNode();this.gainNode.connect(this.ac.destination)},setVolume:function(newGain){this.gainNode.gain.value=newGain},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(arraybuffer,callback,errback){if(!this.offlineAc)this.offlineAc=this.getOfflineAudioContext(this.ac?
this.ac.sampleRate:44100);this.offlineAc.decodeAudioData(arraybuffer,function(data){callback(data)}.bind(this),errback)},setPeaks:function(peaks){this.peaks=peaks},setLength:function(length){if(this.mergedPeaks&&length==2*this.mergedPeaks.length-1+2)return;this.splitPeaks=[];this.mergedPeaks=[];var channels=this.buffer?this.buffer.numberOfChannels:1;for(var c=0;c<channels;c++){this.splitPeaks[c]=[];this.splitPeaks[c][2*(length-1)]=0;this.splitPeaks[c][2*(length-1)+1]=0}this.mergedPeaks[2*(length-
1)]=0;this.mergedPeaks[2*(length-1)+1]=0},getPeaks:function(length,first,last){first=first||0;last=last||length-1;if(this.peaks)return this.peaks;this.setLength(length);var sampleSize=this.buffer.length/length;var sampleStep=~~(sampleSize/10)||1;var channels=this.buffer.numberOfChannels;for(var c=0;c<channels;c++){var peaks=this.splitPeaks[c];var chan=this.buffer.getChannelData(c);for(var i=first;i<=last;i++){var start=~~(i*sampleSize);var end=~~(start+sampleSize);var min=0,max=0;for(var j=start;j<
end;j+=sampleStep){var value=chan[j];if(max<value)max=value;else if(min>value)min=value}peaks[2*i]=max;peaks[2*i+1]=min;if(c==0||max>this.mergedPeaks[2*i])this.mergedPeaks[2*i]=max;if(c==0||min<this.mergedPeaks[2*i+1])this.mergedPeaks[2*i+1]=min}}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){if(this.source)this.source.disconnect()},destroy:function(){if(!this.isPaused())this.pause();
this.unAll();this.buffer=null;this.disconnectFilters();this.disconnectSource();this.gainNode.disconnect();this.scriptNode.disconnect();this.analyser.disconnect();if(this.params.closeAudioContext){if(typeof this.ac.close==="function"&&this.ac.state!="closed")this.ac.close();this.ac=null;if(!this.params.audioContext)WaveSurfer.WebAudio.audioContext=null;else this.params.audioContext=null;WaveSurfer.WebAudio.offlineAudioContext=null}},load:function(buffer){this.startPosition=0;this.lastPlay=this.ac.currentTime;
this.buffer=buffer;this.createSource()},createSource:function(){this.disconnectSource();this.source=this.ac.createBufferSource();this.source.start=this.source.start||this.source.noteGrainOn;this.source.stop=this.source.stop||this.source.noteOff;this.source.playbackRate.value=this.playbackRate;this.source.buffer=this.buffer;this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){if(!this.buffer)return 0;return this.buffer.duration},
seekTo:function(start,end){if(!this.buffer)return;this.scheduledPause=null;if(start==null){start=this.getCurrentTime();if(start>=this.getDuration())start=0}if(end==null)end=this.getDuration();this.startPosition=start;this.lastPlay=this.ac.currentTime;if(this.state===this.states[this.FINISHED_STATE])this.setState(this.PAUSED_STATE);return{start:start,end:end}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(start,end){if(!this.buffer)return;this.initialSeekPosition=
undefined;this.createSource();var adjustedTime=this.seekTo(start,end);start=adjustedTime.start;end=adjustedTime.end;this.scheduledPause=end;this.source.start(0,start,end-start);if(this.ac.state=="suspended"&&this.ac.resume)this.ac.resume();this.setState(this.PLAYING_STATE);this.fireEvent("play")},pause:function(){this.scheduledPause=null;this.startPosition+=this.getPlayedTime();this.source&&this.source.stop(0);this.setState(this.PAUSED_STATE);this.fireEvent("pause")},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},
getPlaybackRate:function(){return this.playbackRate},setPlaybackRate:function(value){value=value||1;if(this.isPaused())this.playbackRate=value;else{this.pause();this.playbackRate=value;this.play()}}};WaveSurfer.WebAudio.state={};WaveSurfer.WebAudio.state.playing={init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var duration=this.getDuration();return this.getCurrentTime()/duration||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}};WaveSurfer.WebAudio.state.paused=
{init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var duration=this.getDuration();return this.getCurrentTime()/duration||0},getCurrentTime:function(){return this.startPosition}};WaveSurfer.WebAudio.state.finished={init:function(){this.removeOnAudioProcess();this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}};WaveSurfer.util.extend(WaveSurfer.WebAudio,WaveSurfer.Observer);WaveSurfer.MediaElement=Object.create(WaveSurfer.WebAudio);
WaveSurfer.util.extend(WaveSurfer.MediaElement,{init:function(params){this.params=params;this.media={currentTime:0,duration:0,paused:true,playbackRate:1,play:function(){},pause:function(){}};this.mediaType=params.mediaType.toLowerCase();this.elementPosition=params.elementPosition;this.setPlaybackRate(this.params.audioRate);this.createTimer()},createTimer:function(){var my=this;var playing=false;var onAudioProcess=function(){if(my.isPaused())return;my.fireEvent("audioprocess",my.getCurrentTime());
var requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame;requestAnimationFrame(onAudioProcess)};this.on("play",onAudioProcess)},load:function(url,container,peaks,preload){var media=document.createElement(this.mediaType);media.controls=this.params.mediaControls;media.autoplay=this.params.autoplay||false;media.preload=preload==null?"auto":preload;media.src=url;media.style.width="100%";var prevMedia=container.querySelector(this.mediaType);if(prevMedia)container.removeChild(prevMedia);
container.appendChild(media);this._load(media,peaks)},loadElement:function(element,peaks){element.controls=this.params.mediaControls;element.autoplay=this.params.autoplay||false;this._load(element,peaks)},_load:function(element,peaks){var my=this;if(typeof element.load=="function")element.load();element.addEventListener("error",function(){my.fireEvent("error","Error loading media element.")});element.addEventListener("canplay",function(){my.fireEvent("canplay")});element.addEventListener("ended",
function(){my._media.currentTime=my.media.currentTime;my.fireEvent("finish")});my.media=element;my._media={};my.peaks=peaks;my.onPlayEnd=null;my.buffer=null;my.setPlaybackRate(my.playbackRate)},isPaused:function(){return!this.media||this.media.paused},getDuration:function(){var duration=(this.buffer||this.media).duration;if(duration>=Infinity)duration=this.media.seekable.end(0);return duration},getCurrentTime:function(){return this.media&&this[this.media.paused?"_media":"media"].currentTime},getPlayedPercents:function(){return this.getCurrentTime()/
this.getDuration()||0},getPlaybackRate:function(){return this.playbackRate||this.media.playbackRate},setPlaybackRate:function(value){this.playbackRate=value||1;this.media.playbackRate=this.playbackRate},seekTo:function(start){if(start!=null)this._media.currentTime=start;this.clearPlayEnd()},play:function(start,end,callback){var my=this;if(typeof callback!="function")callback=function(){};my.seekTo(start);my.media.currentTime=my._media.currentTime;var playPromise=my.media.play();if(typeof playPromise==
"undefined"){finish();callback(true)}else playPromise.then(function(){finish();callback(true)}).catch(function(){callback(false)});function finish(){if(end)my.setPlayEnd(end);my.fireEvent("play")}},pause:function(){if(this.media){this.media.pause();this._media.currentTime=this.media.currentTime}this.clearPlayEnd();this.fireEvent("pause")},setPlayEnd:function(end){var my=this;my.onPlayEnd=function(time){if(time>=end){my.pause();my.seekTo(end)}};my.on("audioprocess",my.onPlayEnd)},clearPlayEnd:function(){if(this.onPlayEnd){this.un("audioprocess",
this.onPlayEnd);this.onPlayEnd=null}},getPeaks:function(length,start,end){if(this.buffer)return WaveSurfer.WebAudio.getPeaks.call(this,length,start,end);return this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(val){this.media.volume=val},destroy:function(){this.pause();this.unAll();this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media);this.media=null}});WaveSurfer.AudioElement=WaveSurfer.MediaElement;WaveSurfer.Drawer={init:function(container,
params,aliases,wavesurfer){this.wavesurfer=wavesurfer;this.container=container;this.params=params;this.aliases=aliases;this.width=0;this.height=params.height*this.params.pixelRatio;this.lastPos=0;this.relativePositionLock=.5;this.initDrawer(params);this.createWrapper();this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave"));this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+
"px"});this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"});if(this.params.styleList.wrapper)this.style(this.wrapper,this.params.styleList.wrapper);if(this.params.classList.wrapper)this.wrapper.classList.add(this.params.classList.wrapper);this.setupWrapperEvents()},handleEvent:function(e,doNotPreventDefault,clientXadj){if(!doNotPreventDefault)e.preventDefault();var clientX=(e.changedTouches?e.changedTouches[0].clientX:e.clientX)+(clientXadj===
undefined?0:clientXadj);var numerator=clientX-this.wrapper.getBoundingClientRect().left+this.wrapper.scrollLeft;if(numerator<0)numerator=0;var denominator=this.getScrollWidth()-1;var progress=numerator>denominator?1:numerator/denominator||0;return progress},setupWrapperEvents:function(){var my=this;function pointerDown(evt){var scrollbarHeight=my.wrapper.offsetHeight-my.wrapper.clientHeight;my.mousedownIsOnScroll=scrollbarHeight!=0&&evt.clientY>=my.wrapper.getBoundingClientRect().bottom-scrollbarHeight;
if(my.params.interact)my.fireEvent("pointerdown",evt,my.handleEvent(evt))}this.wrapper.addEventListener("mousedown",pointerDown);this.wrapper.addEventListener("touchstart",pointerDown);function pointerMove(evt){my.fireEvent("pointermove",evt,my.handleEvent(evt))}this.wrapper.addEventListener("mousemove",pointerMove);this.wrapper.addEventListener("touchmove",pointerMove);this.wrapper.addEventListener("click",function(evt){var scrollbarHeight=my.wrapper.offsetHeight-my.wrapper.clientHeight;if(scrollbarHeight!=
0){var bbox=my.wrapper.getBoundingClientRect();if(evt.clientY>=bbox.bottom-scrollbarHeight)return}if(my.params.interact)my.fireEvent("click",evt,my.handleEvent(evt))});this.wrapper.addEventListener("scroll",function(evt){my.fireEvent("scroll",evt)})},drawPeaks:WaveSurfer.util.frame(function(peaks,length,start,end,clearCanvas,callback){var my=this;my.setWidth(length);if(clearCanvas===undefined||clearCanvas===true)my.clearCanvas();if(peaks instanceof Function)peaks(inner);else inner(peaks,length,start,
end);if(callback)callback();function inner(peaks,length,start,end){if(!my.params.splitChannels)drawFunction(peaks,0);else{var channels=peaks;my.setHeight(channels.length*my.params.height*my.params.pixelRatio);channels.forEach(function(channelPeaks,channelIndex){drawFunction(peaks,channelIndex)})}function drawFunction(peaks,channelIndex){if(peaks[0]instanceof Array)peaks=peaks[0];my[my.params.barWidth?"drawBars":"drawWave"](peaks,channelIndex,start,end)}}}),style:function(el,styles){if(el==null)return el;
Object.keys(styles).forEach(function(prop){if(el.style[prop]!==styles[prop])el.style[prop]=styles[prop]});return el},resetScroll:function(){if(this.wrapper!==null){this.wrapper.scrollLeft=0;this.lastScrollWasProgrammatic=true}},recenter:function(progress){if(progress===undefined)progress=this.getCurrentProgress();this.recenterOnPosition(progress*this.getScrollWidth(),1)},recenterOnPosition:function(position,scrollSpeed){this.lockOnPosition(position,scrollSpeed,.5)},lockOnPosition:function(position,
scrollSpeed,relativePosition){var relativePosition=relativePosition===undefined?.5:relativePosition;var newScroll=position-relativePosition*this.getWidth()/this.params.pixelRatio;this.wrapper.scrollLeft=this.wrapper.scrollLeft*(1-scrollSpeed)+newScroll*scrollSpeed||0;this.lastScrollWasProgrammatic=true},setPositionLockFromCursorAndScrollPosition:function(pos){if(pos===undefined)pos=this.lastPos;this.constrainOffsetByVisualRange(pos);this.relativePositionLock=this.constrainOffsetByVisualRange(pos)},
constrainOffsetByVisualRange:function(pos){var fullWidth=this.getWidth()/this.params.pixelRatio,adj=undefined;var offset=(pos-this.wrapper.scrollLeft)/fullWidth;var adj=offset<=this.params.autoVisualRange[0]?0:offset>=this.params.autoVisualRange[1]?1:undefined;if(adj!==undefined)offset=this.params.autoVisualRange[adj];return offset},constrainProgressByVisualRange:function(progress){var minPxDelta=1/this.params.pixelRatio;var pos=Math.round(progress*this.width)*minPxDelta;var newOffset=this.constrainOffsetByVisualRange(pos);
var fullWidth=this.getWidth()/this.params.pixelRatio;return(newOffset*fullWidth+this.wrapper.scrollLeft)/(minPxDelta*this.width)},getScrollX:function(){return Math.round(this.wrapper.scrollLeft*this.params.pixelRatio)},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)},getScrollWidth:function(){return this.wrapper.scrollWidth},setWidth:function(width){if(this.width==width)return;this.width=width;this.style(this.wrapper,{width:""});this.updateSize()},setHeight:function(height){if(height==
this.height)return;this.height=height;this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"});this.updateSize()},progress:function(progress,fromSeekTo){var minPxDelta=1/this.params.pixelRatio;var pos=Math.round(progress*this.width)*minPxDelta;if(this.params.autoVisualRange&&fromSeekTo===true)this.setPositionLockFromCursorAndScrollPosition(pos);if(progress!=this.lastProgress){this.lastProgress=progress;var t=this.wavesurfer.getComputedWidthAndRange();if(t.nominalWidth!=t.parentWidth&&
(this.params.autoCenter||this.params.autoVisualRange)){pos=Math.round(this.getScrollWidth()*progress);this.lockOnPosition(pos,1,this.relativePositionLock)}}this.updateProgress(pos)},destroy:function(){this.unAll();if(this.wrapper){if(this.wrapper.parentNode==this.container)this.container.removeChild(this.wrapper);this.wrapper=null}},initDrawer:function(){},createElements:function(){},updateSize:function(){},drawWave:function(peaks,max){},clearCanvas:function(){},updateProgress:function(position){},
updateCursorPosition:function(position){},getCurrentPosition:function(){},getCurrentProgress:function(){}};WaveSurfer.util.extend(WaveSurfer.Drawer,WaveSurfer.Observer);WaveSurfer.Drawer.Canvas=Object.create(WaveSurfer.Drawer);WaveSurfer.util.extend(WaveSurfer.Drawer.Canvas,{initDrawer:function(params){this.maxCanvasWidth=params.maxCanvasWidth!=null?params.maxCanvasWidth:4E3;this.maxCanvasElementWidth=Math.round(this.maxCanvasWidth/this.params.pixelRatio);if(this.maxCanvasWidth<=1)throw"maxCanvasWidth must be greater than 1.";
if(this.maxCanvasWidth%2==1)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor;this.halfPixel=.5/this.params.pixelRatio;this.canvases=[]},createElements:function(){var params=this.params;Array("progressWave","wave").forEach(function(waveType){this[waveType]=this.wrapper.appendChild(this.style(document.createElement("wave"),Object.assign({},params.styleList[waveType],{overflow:"hidden",position:"absolute",zIndex:2,left:0,top:0,height:"100%",
width:waveType=="progressWave"?"0":"100%",boxSizing:"border-box",pointerEvents:"none"})));if(params.classList[waveType])this[waveType].classList.add(params.classList[waveType]);if(waveType=="progressWave")this[waveType].style.display="none"},this);this.cursorWrapper=this.wrapper.appendChild(this.style(document.createElement("div"),{overflow:"hidden",position:"absolute",zIndex:2,height:"100%",left:0,display:"block",pointerEvents:"none"}));this.cursor=this.cursorWrapper.appendChild(this.style(document.createElement("div"),
Object.assign({},params.styleList.cursor,{backgroundColor:params.cursorColor,position:"absolute",width:params.cursorWidth+"px",height:"100%",left:0,display:"none"})));WaveSurfer.util.refreshAliases(this.aliases,{cursorColor:{styleSource:{object:this.cursor.style,property:"backgroundColor"}},cursorWidth:{styleSource:{object:this.cursor.style,property:"width"},get:function(n){return parseFloat(n)},set:function(n){return n+"px"}}});if(params.classList.cursor)this.cursor.classList.add(params.classList.cursor);
this.addCanvas()},updateSize:function(){var totalWidth=Math.round(this.width/this.params.pixelRatio);var requiredCanvases=Math.ceil(totalWidth/this.maxCanvasElementWidth);var pos=this.getCurrentPosition();this.style(this.cursorWrapper,{width:totalWidth+"px"});this.style(this.wave,{width:totalWidth-pos+"px"});while(this.canvases.length<requiredCanvases)this.addCanvas();while(this.canvases.length>requiredCanvases)this.removeCanvas();this.canvases.forEach(function(canvas,canvasIndex){if(canvasIndex!=
this.canvases.length-1)var canvasWidth=this.maxCanvasWidth+(this.params.invertTransparency?0:2*Math.ceil(this.params.pixelRatio/2));else var canvasWidth=this.width-this.maxCanvasWidth*(this.canvases.length-1);this.updateDimensions(canvas,canvasIndex,canvasWidth,this.height);this.clearWaveType(canvas)},this);this.wavesurfer.fireEvent("drawer-update-size")},addCanvas:function(){var entry={};var leftOffset=this.maxCanvasElementWidth*this.canvases.length;Array("progressWave","wave").forEach(function(waveType){entry[waveType]=
this[waveType].appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:leftOffset+"px",top:!this.invertTransparency?0:-(this.halfPixel/2)+"px",height:!this.invertTransparency?"100%":"calc(100% + "+this.halfPixel+"px)"}));entry[waveType+"Ctx"]=entry[waveType].getContext("2d")},this);this.canvases.push(entry)},removeCanvas:function(){var lastCanvas=this.canvases.pop();lastCanvas.wave.parentElement.removeChild(lastCanvas.wave);if(lastCanvas.progressWave)lastCanvas.progressWave.parentElement.removeChild(lastCanvas.progressWave)},
updateDimensions:function(canvas,canvasIndex,width,height){var elementWidth=Math.round(width/this.params.pixelRatio);var totalWidth=Math.round(this.width/this.params.pixelRatio);canvas.start=this.maxCanvasElementWidth*canvasIndex/totalWidth;canvas.end=canvas.start+elementWidth/totalWidth;canvas.waveCtx.canvas.width=width;canvas.waveCtx.canvas.height=height;this.style(this.wave,{height:height/this.params.pixelRatio+"px"});this.style(canvas.waveCtx.canvas,{width:elementWidth+"px"});this.style(this.cursor,
{display:"block"});if(!canvas.progressWaveCtx)return;this.style(this.progressWave,{height:height/this.params.pixelRatio+"px"});canvas.progressWaveCtx.canvas.width=width;canvas.progressWaveCtx.canvas.height=height;this.style(canvas.progressWaveCtx.canvas,{width:elementWidth+"px"});this.style(this.progressWave,{display:"block"})},clearCanvas:function(){this.canvases.forEach(function(canvas){this.clearWaveType(canvas)},this)},clearWaveType:function(canvas){canvas.waveCtx.clearRect(0,0,canvas.waveCtx.canvas.width,
canvas.waveCtx.canvas.height);if(!canvas.progressWaveCtx)return;canvas.progressWaveCtx.clearRect(0,0,canvas.progressWaveCtx.canvas.width,canvas.progressWaveCtx.canvas.height)},drawBars:function(peaks,channelIndex,start,end){var hasMinVals=[].some.call(peaks,function(val){return val<0});var peakIndexScale=hasMinVals?2:1;var height=this.params.height*this.params.pixelRatio;var offsetY=height*channelIndex||0;var halfH=height/2;var length=peaks.length/peakIndexScale;var bar=this.params.barWidth*this.params.pixelRatio;
var gap=Math.max(this.params.pixelRatio,~~(bar/2));var step=bar+gap;if(!this.params.normalize)var absmax=1/this.params.barHeight;else{var max=WaveSurfer.util.max(peaks);var min=WaveSurfer.util.min(peaks);var absmax=-min>max?-min:max}var scale=length/this.width;this.fillRect(0,0,this.width,height,"background");for(var i=start/scale;i<end/scale;i+=step){var peak=peaks[Math.floor(i*scale*peakIndexScale)]||0;var h=Math.round(peak/absmax*halfH);this.fillRect(i+this.halfPixel,halfH-h+offsetY,bar+this.halfPixel,
h*2)}if(this.params.invertTransparency)this.invertTransparency()},drawWave:function(peaks,channelIndex,start,end){var hasMinValues=[].some.call(peaks,function(val){return val<0});if(!hasMinValues){var reflectedPeaks=[];for(var i=0,len=peaks.length;i<len;i++){reflectedPeaks[2*i]=peaks[i];reflectedPeaks[2*i+1]=-peaks[i]}peaks=reflectedPeaks}var height=this.params.height*this.params.pixelRatio;var offsetY=height*channelIndex||0;var halfH=height/2;if(!this.params.normalize)var absmax=1/this.params.barHeight;
else{var max=WaveSurfer.util.max(peaks);var min=WaveSurfer.util.min(peaks);var absmax=-min>max?-min:max}this.fillRect(0,0,this.width,height,"background");this.drawLine(peaks,absmax,halfH,offsetY,start,end);this.fillRect(0,halfH+offsetY-this.halfPixel,this.width,this.halfPixel);if(this.params.invertTransparency)this.invertTransparency()},invertTransparency:function(){this.canvases.forEach(function(canvasGroup){["wave"].concat(canvasGroup.progressWaveCtx?["progressWave"]:[]).forEach(function(waveType){var canvas=
canvasGroup[waveType];var temp=document.createElement("canvas");temp.width=canvas.width;temp.height=canvas.height;temp.getContext("2d").drawImage(canvas,0,0);var ctx=canvas.getContext("2d");ctx.fillStyle=waveType=="wave"||this.params.progressColor===undefined?this.params.waveColor:this.params.progressColor;ctx.globalCompositeOperation="copy";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.globalCompositeOperation="destination-out";ctx.drawImage(temp,0,0);ctx.globalCompositeOperation="source-over"},
this)},this)},drawLine:function(peaks,absmax,halfH,offsetY,start,end){this.canvases.forEach(function(canvas){this.setFillStyles(canvas);this.drawLineToContext(canvas,canvas.waveCtx,peaks,absmax,halfH,offsetY,start,end);this.drawLineToContext(canvas,canvas.progressWaveCtx,peaks,absmax,halfH,offsetY,start,end)},this)},drawLineToContext:function(canvas,ctx,peaks,absmax,halfH,offsetY,start,end){if(!ctx)return;var length=peaks.length/2;var scale=this.width!=length?this.width/length:1;var first=Math.round(length*
canvas.start);var last=Math.round(length*canvas.end)+1;if(first>end||last<start)return;var canvasStart=Math.max(first,start);var canvasEnd=Math.min(last,end);ctx.beginPath();ctx.moveTo((canvasStart-first)*scale+this.halfPixel,halfH+offsetY);for(var i=canvasStart;i<canvasEnd;i++){var peak=peaks[2*i]||0;var h=Math.round(peak/absmax*halfH);ctx.lineTo((i-first)*scale+this.halfPixel,halfH-h+offsetY)}for(var i=canvasEnd-1;i>=canvasStart;i--){var peak=peaks[2*i+1]||0;var h=Math.round(peak/absmax*halfH);
ctx.lineTo((i-first)*scale+this.halfPixel,halfH-h+offsetY)}ctx.closePath();ctx.fill()},fillRect:function(x,y,width,height,fillLayer){var fillLayer=fillLayer===undefined?"foreground":fillLayer;var startCanvas=Math.floor(x/this.maxCanvasWidth);var endCanvas=Math.min(Math.ceil((x+width)/this.maxCanvasWidth)+1,this.canvases.length);for(var i=startCanvas;i<endCanvas;i++){var canvas=this.canvases[i];var leftOffset=i*this.maxCanvasWidth;var intersection={x1:Math.max(x,i*this.maxCanvasWidth),y1:y,x2:Math.min(x+
width,i*this.maxCanvasWidth+canvas.waveCtx.canvas.width),y2:y+height};if(intersection.x1<intersection.x2)["wave"].concat(canvas.progressWaveCtx?["progressWave"]:[]).forEach(function(waveType){var uniqueProp=waveType=="wave"?"wave":"progress";if(fillLayer=="background"&&this.params[uniqueProp+"BackgroundColor"]===undefined&&this.params.backgroundColor===undefined)return;this.setFillStyles(canvas,waveType,fillLayer);this.fillRectToContext(canvas[waveType+"Ctx"],intersection.x1-leftOffset,intersection.y1,
intersection.x2-intersection.x1,intersection.y2-intersection.y1)},this)}},fillRectToContext:function(ctx,x,y,width,height){if(ctx)ctx.fillRect(x,y,width,height)},setFillStyles:function(canvas,waveType,fillLayer){var fillLayer=fillLayer===undefined?"foreground":fillLayer;var params=this.params;if(fillLayer=="foreground"){if(params.invertTransparency)var cutColor=params.invertTransparency==="object"&&"cutColor"in params.invertTransparency?params.invertTransparency.cutColor:"#fefefe";if(waveType===undefined||
waveType=="wave")canvas.waveCtx.fillStyle=params.invertTransparency?cutColor:params.waveColor;if((waveType===undefined||waveType=="progressWave")&&canvas.progressWaveCtx)canvas.progressWaveCtx.fillStyle=params.invertTransparency?cutColor:params.progressColor}else{if(waveType===undefined||waveType=="wave")canvas.waveCtx.fillStyle=params.waveBackgroundColor!==undefined?params.waveBackgroundColor:params.backgroundColor;if((waveType===undefined||waveType=="progressWave")&&canvas.progressWaveCtx)canvas.progressWaveCtx.fillStyle=
params.progressBackgroundColor!==undefined?params.progressBackgroundColor:params.backgroundColor}},updateProgress:function(pos){if(pos===undefined)pos=this.getCurrentPosition();var totalWidth=this.width/this.params.pixelRatio;this.style(this.wave,{left:pos+"px",width:totalWidth-pos+"px"});this.canvases.forEach(function(canvas,i){this.style(canvas.wave,{marginLeft:-pos+"px"})},this);this.updateCursorPosition(pos);if(this.progressWave)this.style(this.progressWave,{width:pos+"px"})},updateCursorPosition:function(pos){if(pos===
undefined)pos=this.getCurrentPosition();var cursorPos=pos-(this.params.cursorAlignment=="right"?0:this.params.cursorAlignment=="middle"?this.params.cursorWidth/2:this.params.cursorWidth);this.style(this.cursor,{left:cursorPos+"px"})},getCurrentPosition:function(){var progress=!this.wavesurfer.audioIsReady?this.wavesurfer.initialSeekPosition():this.wavesurfer.backend.getPlayedPercents();return Math.round(this.width/this.wavesurfer.params.pixelRatio*progress)},getCurrentProgress:function(){if(!this.wavesurfer.audioIsReady)return this.wavesurfer.initialSeekPosition();
return this.wavesurfer.backend.getPlayedPercents()},getScrollWidth:function(){return this.width/this.params.pixelRatio},getImage:function(type,quality){var availableCanvas=[];this.canvases.forEach(function(canvas){availableCanvas.push(canvas.wave.toDataURL(type,quality))});return availableCanvas.length>1?availableCanvas:availableCanvas[0]}});WaveSurfer.Drawer.None=Object.create(WaveSurfer.Drawer);WaveSurfer.util.extend(WaveSurfer.Drawer.None,{initDrawer:function(params){this.maxCanvasWidth=params.maxCanvasWidth!=
null?params.maxCanvasWidth:4E3;this.maxCanvasElementWidth=Math.round(this.maxCanvasWidth/this.params.pixelRatio);if(this.maxCanvasWidth<=1)throw"maxCanvasWidth must be greater than 1.";if(this.maxCanvasWidth%2==1)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor;this.halfPixel=.5/this.params.pixelRatio;this.canvases=[]},createElements:function(){var test=document.createElement("div");return[test]},updateSize:function(){},addCanvas:function(){},
removeCanvas:function(){},updateDimensions:function(canvas,width,height){},clearCanvas:function(){},clearWaveType:function(canvas){},drawBars:function(peaks,channelIndex,start,end){},drawWave:function(peaks,channelIndex,start,end){},drawLine:function(peaks,absmax,halfH,offsetY,start,end){},drawLineToContext:function(canvas,ctx,peaks,absmax,halfH,offsetY,start,end){},fillRect:function(x,y,width,height){},fillRectToContext:function(ctx,x,y,width,height){},setFillStyles:function(canvas){},updateProgress:function(pos){},
getImage:function(type,quality){}});WaveSurfer.Drawer.SplitWavePointPlot=Object.create(WaveSurfer.Drawer.Canvas);WaveSurfer.util.extend(WaveSurfer.Drawer.SplitWavePointPlot,{defaultPlotParams:{plotNormalizeTo:"whole",plotTimeStart:0,plotMin:0,plotMax:1,plotColor:"#f63",plotProgressColor:"#F00",plotPointHeight:2,plotPointWidth:2,plotSeparator:true,plotSeparatorColor:"black",plotRangeDisplay:false,plotRangeUnits:"",plotRangePrecision:4,plotRangeIgnoreOutliers:false,plotRangeFontSize:12,plotRangeFontType:"Ariel",
waveDrawMedianLine:true,plotFileDelimiter:"\t"},plotTimeStart:0,plotTimeEnd:-1,plotArrayLoaded:false,plotArray:[],plotPoints:[],plotMin:0,plotMax:1,initDrawer:function(params){var my=this;for(var paramName in this.defaultPlotParams)if(this.params[paramName]===undefined)this.params[paramName]=this.defaultPlotParams[paramName];this.plotTimeStart=this.params.plotTimeStart;if(this.params.plotTimeEnd!==undefined)this.plotTimeEnd=this.params.plotTimeEnd;if(Array.isArray(params.plotArray)){this.plotArray=
params.plotArray;this.plotArrayLoaded=true}else{var onPlotArrayLoaded=function(plotArray){my.plotArray=plotArray;my.plotArrayLoaded=true;my.fireEvent("plot_array_loaded")};this.loadPlotArrayFromFile(params.plotFileUrl,onPlotArrayLoaded,this.params.plotFileDelimiter)}},drawPeaks:function(peaks,length,start,end){if(this.plotArrayLoaded==true){this.setWidth(length);this.splitChannels=true;this.params.height=this.params.height/2;if(peaks[0]instanceof Array)peaks=peaks[0];this.params.barWidth?this.drawBars(peaks,
1,start,end):this.drawWave(peaks,1,start,end);this.params.height=this.params.height*2;this.calculatePlots();this.drawPlots()}else{var my=this;my.on("plot-array-loaded",function(){my.drawPeaks(peaks,length,start,end)})}},drawPlots:function(){var height=this.params.height*this.params.pixelRatio/2;var $=.5/this.params.pixelRatio;this.waveCc.fillStyle=this.params.plotColor;if(this.progressCc)this.progressCc.fillStyle=this.params.plotProgressColor;for(var i in this.plotPoints){var x=parseInt(i);var y=
height-this.params.plotPointHeight-this.plotPoints[i]*(height-this.params.plotPointHeight);var pointHeight=this.params.plotPointHeight;this.waveCc.fillRect(x,y,this.params.plotPointWidth,pointHeight);if(this.progressCc)this.progressCc.fillRect(x,y,this.params.plotPointWidth,pointHeight)}if(this.params.plotSeparator){this.waveCc.fillStyle=this.params.plotSeparatorColor;this.waveCc.fillRect(0,height,this.width,$)}if(this.params.plotRangeDisplay)this.displayPlotRange()},displayPlotRange:function(){var fontSize=
this.params.plotRangeFontSize*this.params.pixelRatio;var maxRange=this.plotMax.toPrecision(this.params.plotRangePrecision)+" "+this.params.plotRangeUnits;var minRange=this.plotMin.toPrecision(this.params.plotRangePrecision)+" "+this.params.plotRangeUnits;this.waveCc.font=fontSize.toString()+"px "+this.params.plotRangeFontType;this.waveCc.fillText(maxRange,3,fontSize);this.waveCc.fillText(minRange,3,this.height/2)},calculatePlots:function(){this.plotPoints={};this.calculatePlotTimeEnd();var pointsForAverage=
[];var previousWaveIndex=-1;var maxPlot=0;var minPlot=99999999999999;var maxSegmentPlot=0;var minSegmentPlot=99999999999999;var duration=this.plotTimeEnd-this.plotTimeStart;for(var i=0;i<this.plotArray.length;i++){var dataPoint=this.plotArray[i];if(dataPoint.value>maxPlot)maxPlot=dataPoint.value;if(dataPoint.value<minPlot)minPlot=dataPoint.value;if(dataPoint.time>=this.plotTimeStart&&dataPoint.time<=this.plotTimeEnd){var waveIndex=Math.round(this.width*(dataPoint.time-this.plotTimeStart)/duration);
pointsForAverage.push(dataPoint.value);if(waveIndex!==previousWaveIndex)if(pointsForAverage.length>0){var avgPlot=this.avg(pointsForAverage);if(avgPlot>maxSegmentPlot)maxSegmentPlot=avgPlot;if(avgPlot<minSegmentPlot)minSegmentPlot=avgPlot;this.plotPoints[previousWaveIndex]=avgPlot;pointsForAverage=[]}previousWaveIndex=waveIndex}}if(this.params.plotNormalizeTo=="whole"){this.plotMin=minPlot;this.plotMax=maxPlot}else if(this.params.plotNormalizeTo=="values"){this.plotMin=this.params.plotMin;this.plotMax=
this.params.plotMax}else{this.plotMin=minSegmentPlot;this.plotMax=maxSegmentPlot}this.normalizeValues()},normalizeValues:function(){var normalizedValues={};if(this.params.plotNormalizeTo==="none")return;for(var i in this.plotPoints){var normalizedValue=(this.plotPoints[i]-this.plotMin)/(this.plotMax-this.plotMin);if(normalizedValue>1){if(!this.params.plotRangeIgnoreOutliers)normalizedValues[i]=1}else if(normalizedValue<0){if(!this.params.plotRangeIgnoreOutliers)normalizedValues[i]=0}else normalizedValues[i]=
normalizedValue}this.plotPoints=normalizedValues},loadPlotArrayFromFile:function(plotFileUrl,onSuccess,delimiter){if(delimiter===undefined)delimiter="\t";var plotArray=[];var options={url:plotFileUrl,responseType:"text"};var fileAjax=WaveSurfer.util.ajax(options);fileAjax.on("load",function(data){if(data.currentTarget.status==200){var plotLines=data.currentTarget.responseText.split("\n");for(var i=0;i<plotLines.length;i++){var plotParts=plotLines[i].split(delimiter);if(plotParts.length==2)plotArray.push({time:parseFloat(plotParts[0]),
value:parseFloat(plotParts[1])})}onSuccess(plotArray)}})},calculatePlotTimeEnd:function(){if(this.params.plotTimeEnd!==undefined)this.plotTimeEnd=this.params.plotTimeEnd;else this.plotTimeEnd=this.plotArray[this.plotArray.length-1].time},avg:function(values){var sum=values.reduce(function(a,b){return a+b});return sum/values.length}});WaveSurfer.util.extend(WaveSurfer.Drawer.SplitWavePointPlot,WaveSurfer.Observer);WaveSurfer.PeakCache={init:function(){this.clearPeakCache()},clearPeakCache:function(){this.peakCacheRanges=
[];this.peakCacheLength=-1},addRangeToPeakCache:function(length,start,end){if(length!=this.peakCacheLength){this.clearPeakCache();this.peakCacheLength=length}var uncachedRanges=[],i=0;while(i<this.peakCacheRanges.length&&this.peakCacheRanges[i]<start)i++;if(i%2==0)uncachedRanges.push(start);while(i<this.peakCacheRanges.length&&this.peakCacheRanges[i]<=end){uncachedRanges.push(this.peakCacheRanges[i]);i++}if(i%2==0)uncachedRanges.push(end);uncachedRanges=uncachedRanges.filter(function(item,pos,arr){if(pos==
0)return item!=arr[pos+1];else if(pos==arr.length-1)return item!=arr[pos-1];else return item!=arr[pos-1]&&item!=arr[pos+1]});this.peakCacheRanges=this.peakCacheRanges.concat(uncachedRanges);this.peakCacheRanges=this.peakCacheRanges.sort(function(a,b){return a-b}).filter(function(item,pos,arr){if(pos==0)return item!=arr[pos+1];else if(pos==arr.length-1)return item!=arr[pos-1];else return item!=arr[pos-1]&&item!=arr[pos+1]});var uncachedRangePairs=[];for(i=0;i<uncachedRanges.length;i+=2)uncachedRangePairs.push([uncachedRanges[i],
uncachedRanges[i+1]]);return uncachedRangePairs},getCacheRanges:function(){var peakCacheRangePairs=[];for(var i=0;i<this.peakCacheRanges.length;i+=2)peakCacheRangePairs.push([this.peakCacheRanges[i],this.peakCacheRanges[i+1]]);return peakCacheRangePairs}};return WaveSurfer});
WaveSurfer.Regions={capitalizeFirstLetter:function(string){return string.charAt(0).toUpperCase()+string.slice(1)},init:function(wavesurfer){var my=this;this.wavesurfer=wavesurfer;this.wavesurferRegionClassNameDefault="";this.createDataIdAttributes=false;this.roundRanges=1E3;this.wrapper=this.wavesurfer.drawer.wrapper;var regionWrapper=this.regionWrapper=document.createElement("div");this.wrapper.appendChild(regionWrapper);WaveSurfer.Drawer.style(regionWrapper,{position:"absolute",display:"inline-block",
height:"100%",overflow:"hidden"});regionWrapper.className="wavesurfer-regionwrapper";this.list={};this.regionAction=undefined;this.activeRegion=undefined;this.mousedOverRegion=undefined;var duration=my.wavesurfer.getDuration();var clientXStart,dragStart,drag,resize,touchId,initialTime,initialStart,initialEnd;this.defaultDrawerCursor=window.getComputedStyle(this.wrapper).cursor;my.onDown=function(evt){var currentRegion=evt.currentTarget.wavesurferRegion;if(evt.touches&&evt.touches.length>1)return;
clientXStart=evt.clientX;my.activeRegion=currentRegion;touchId=evt.targetTouches?evt.targetTouches[0].identifier:null;initialTime=my.wavesurfer.drawer.handleEvent(evt,true)*duration;initialStart=currentRegion.start;initialEnd=currentRegion.end;if(my.regionAction!==undefined)return;if(evt.target.tagName.toLowerCase()=="handle"){if(evt.target.classList.contains("wavesurfer-handle-start")&&currentRegion.resizeStart){resize="start";my.regionAction="resize_from_start"}else if(currentRegion.resizeEnd){resize=
"end";my.regionAction="resize_from_end"}evt.stopPropagation()}else if(my.drag){my.regionAction="dragstart";dragStart=true;evt.stopPropagation()}my.updateCursor()};my.onUp=function(evt){var activeRegion=my.activeRegion;if((drag||resize)&&typeof clientXStart=="undefined"){my.wavesurfer.params.interact=false;if(my.wavesurfer.drawer)my.wavesurfer.drawer.params.interact=false;if(my.wavesurfer.wrapper)my.wavesurfer.wrapper.params.interact=false;setTimeout(function(){my.wavesurfer.params.interact=true;if(my.wavesurfer.drawer)my.wavesurfer.drawer.params.interact=
true;if(my.wavesurfer.wrapper)my.wavesurfer.wrapper.params.interact=true},0)}if(typeof dragStart=="undefined"&&typeof drag=="undefined"&&typeof resize=="undefined")return;dragStart=undefined;my.regionAction=undefined;my.updateCursor();if(evt.touches&&evt.touches.length>1)return;if(drag||resize){if(typeof clientXStart=="undefined"){if(typeof resize!="undefined"){activeRegion.fireEventPropagate("resize-end");activeRegion.fireEventPropagate("resize_from_"+resize+"-end")}if(typeof drag!="undefined")activeRegion.fireEventPropagate("drag-end");
activeRegion.fireEventPropagate("update-end",evt)}drag=undefined;resize=undefined}my.activeRegion=undefined};my.onMove=function(evt){var activeRegion=my.activeRegion;if(typeof clientXStart!="undefined"&&evt.clientX==clientXStart)return;clientXStart=undefined;if(evt.touches&&evt.touches.length>1)return;if(evt.targetTouches&&evt.targetTouches[0].identifier!=touchId)return;if(dragStart){dragStart=undefined;drag=true;if(activeRegion.drag)my.regionAction="drag"}if(drag||resize){var time=my.wavesurfer.drawer.handleEvent(evt)*
duration;if(resize)if(resize=="start")if(time<activeRegion.resizeStartMin)time=activeRegion.resizeStartMin;else{if(time>activeRegion.resizeStartMax)time=activeRegion.resizeStartMax}else if(time<activeRegion.resizeEndMin)time=activeRegion.resizeEndMin;else if(time>activeRegion.resizeEndMax)time=activeRegion.resizeEndMax;if(activeRegion.drag&&drag)activeRegion.onDrag(initialStart,initialEnd,time-initialTime);if(activeRegion.resize&&resize)activeRegion.onResize(resize,initialStart,initialEnd,time)}};
my.onMouseOver=function(evt){var currentRegion=evt.currentTarget.wavesurferRegion;if(!currentRegion.drag)return;my.mousedOverRegion=currentRegion;my.updateCursor()};my.onMouseOut=function(evt){var currentRegion=evt.currentTarget.wavesurferRegion;if(!currentRegion.drag)return;my.mousedOverRegion=undefined;my.updateCursor()};document.body.addEventListener("mouseleave",my.onUp);document.body.addEventListener("mouseup",my.onUp);document.body.addEventListener("touchend",my.onUp);my.regionWrapper.addEventListener("mousemove",
my.onMove);my.regionWrapper.addEventListener("touchmove",my.onMove,{passive:false});my.on("remove",function(){my.onUp();document.body.removeEventListener("mouseleave",my.onUp);document.body.removeEventListener("mouseup",my.onUp);document.body.removeEventListener("touchend",my.onUp);my.regionWrapper.removeEventListener("mousemove",my.onMove);my.regionWrapper.removeEventListener("touchmove",my.onMove)});my.wavesurfer.on("drawer-update-size",function(){var drawer=wavesurfer.drawer;var totalWidth=Math.round(drawer.width/
drawer.params.pixelRatio);regionWrapper.style.width=totalWidth+"px"});my.wavesurfer.on("destroy",function(){document.body.removeEventListener("mouseup",my.onUp);document.body.removeEventListener("touchend",my.onUp)})},add:function(params){var region=Object.create(WaveSurfer.Region);region.init(params,this.wavesurfer,this);this.list[region.id]=region;region.on("remove",function(){delete this.list[region.id]}.bind(this));return region},clear:function(){Object.keys(this.list).forEach(function(id){this.list[id].remove()},
this)},enableDragSelection:function(params){var my=this,drag,start,region,touchId,slope=params.slope||2,pxMove=0;var eventDown=function(evt){if(evt.touches&&evt.touches.length>1)return;if(evt.target.childElementCount>0)return;touchId=evt.targetTouches?evt.targetTouches[0].identifier:null;drag=true;start=my.wavesurfer.drawer.handleEvent(evt,true);region=null};this.regionWrapper.addEventListener("mousedown",eventDown);this.regionWrapper.addEventListener("touchstart",eventDown);this.on("disable-drag-selection",
function(){my.regionWrapper.removeEventListener("touchstart",eventDown);my.regionWrapper.removeEventListener("mousedown",eventDown)});var eventUp=function(evt){if(evt.touches&&evt.touches.length>1)return;drag=false;pxMove=0;if(region)region.fireEventPropagate("update-end",evt);region=null};this.regionWrapper.addEventListener("mouseup",eventUp);this.regionWrapper.addEventListener("touchend",eventUp);this.on("disable-drag-selection",function(){my.regionWrapper.removeEventListener("touchend",eventUp);
my.regionWrapper.removeEventListener("mouseup",eventUp)});var eventMove=function(evt){if(!drag)return;if(++pxMove<=slope)return;if(evt.touches&&evt.touches.length>1)return;if(evt.targetTouches&&evt.targetTouches[0].identifier!=touchId)return;if(!region)region=my.add(params||{});var duration=my.wavesurfer.getDuration();var end=my.wavesurfer.drawer.handleEvent(evt);region.update({start:Math.min(end*duration,start*duration),end:Math.max(end*duration,start*duration)})};this.regionWrapper.addEventListener("mousemove",
eventMove);this.regionWrapper.addEventListener("touchmove",eventMove);this.on("disable-drag-selection",function(){my.regionWrapper.removeEventListener("touchmove",eventMove);my.regionWrapper.removeEventListener("mousemove",eventMove)})},updateCursor:function(){var my=this;WaveSurfer.Drawer.style(my.wrapper,{cursor:my.regionAction=="resize_from_start"||my.regionAction=="resize_from_end"?"col-resize":my.regionAction=="dragstart"||my.regionAction=="drag"||my.mousedOverRegion&&my.mousedOverRegion.drag?
"move":this.defaultDrawerCursor})},disableDragSelection:function(){this.fireEvent("disable-drag-selection")}};WaveSurfer.util.extend(WaveSurfer.Regions,WaveSurfer.Observer);
WaveSurfer.Region={style:WaveSurfer.Drawer.style,init:function(params,wavesurfer,regionManager){this.wavesurfer=wavesurfer;this.wrapper=wavesurfer.drawer.wrapper;this.regionManager=regionManager;this.regionWrapper=regionManager.regionWrapper;this.id=params.id==null?WaveSurfer.util.getId():params.id;this.start=Number(params.start)||0;this.end=params.end==null?this.start+4/this.wrapper.scrollWidth*this.wavesurfer.getDuration():Number(params.end);this.resize=params.resize===undefined?true:Boolean(params.resize);
this.showTitle=params.showTitle===undefined?true:Boolean(params.showTitle);this.classList={};this.styleList={};if(params.classList===undefined)params.classList={};if(params.styleList===undefined)params.styleList={};["region","resize","resizeStart","resizeEnd"].forEach(function(prop){this.classList[prop]=params.classList[prop]||undefined;this.styleList[prop]=params.styleList[prop]||undefined},this);this.resizeStart=params.resizeStart===undefined?true:Boolean(params.resizeStart);this.resizeEnd=params.resizeEnd===
undefined?true:Boolean(params.resizeEnd);this.drag=params.drag===undefined?true:Boolean(params.drag);this.loop=Boolean(params.loop);this.color=params.color||"rgba(0, 0, 0, 0.1)";this.data=params.data||{};this.attributes=params.attributes||{};this.maxLength=params.maxLength;this.minLength=params.minLength;this.resizeStartMin=params.resizeStartMin;this.resizeStartMax=params.resizeStartMax;this.resizeEndMin=params.resizeEndMin;this.resizeEndMax=params.resizeEndMax;this.bindInOut();this.render();this.onZoom=
this.updateRender.bind(this);this.wavesurfer.on("zoom",this.onZoom);this.wavesurfer.fireEvent("region-created",this)},fireEventPropagate:function(eventName,evt){this.wavesurfer.fireEvent("region-"+eventName,this,evt)},update:function(params){var my=this;var updatedList={};[{"start":Number},{"end":Number},{"loop":Boolean},{"color":undefined},{"data":undefined},{"resize":Boolean},{"drag":Boolean},{"maxLength":Number},{"minLength":Number},{"resizeStartMin":Number},{"resizeStartMax":Number},{"resizeEndMin":Number},
{"resizeEndMax":Number},{"attributes":undefined}].forEach(function(object){var param=Object.keys(object)[0];if(params[param]==null)return;var func=typeof object[param]=="undefined"?function(n){return n}:object[param];var wrappedValue=func(params[param]);if(this[param]==wrappedValue)return;updatedList[param]=true;this[param]=wrappedValue},this);if(Object.keys(updatedList).length==0)return;this.updateRender();if(this.regionManager.regionAction&&(this.regionManager.regionAction=="resize_from_start"||
this.regionManager.regionAction=="resize_from_end")){if(updatedList.start)this.fireEventPropagate("resize_from_start");if(updatedList.end)this.fireEventPropagate("resize_from_end");if(updatedList.end||updatedList.start)this.fireEventPropagate("resize")}if(this.regionManager.regionAction&&this.regionManager.regionAction=="drag")if(updatedList.end||updatedList.start)this.fireEventPropagate("drag");this.fireEventPropagate("update")},remove:function(){if(this.element){this.regionWrapper.removeChild(this.element);
this.element=null;this.wavesurfer.un("zoom",this.onZoom);this.fireEventPropagate("remove")}},play:function(){this.wavesurfer.play(this.start,this.end);this.fireEventPropagate("play")},playLoop:function(){this.play();this.once("out",this.playLoop.bind(this))},render:function(){var regionEl=document.createElement("region");var className=this.regionManager.wavesurferRegionClassNameDefault+(this.classList.region!==undefined?" "+this.classList.region:"");if(className)regionEl.className=className;if(this.showTitle)regionEl.title=
this.formatTime(this.start,this.end);if(this.regionManager.createDataIdAttributes)regionEl.setAttribute("data-id",this.id);for(var attrname in this.attributes)regionEl.setAttribute("data-region-"+attrname,this.attributes[attrname]);this.style(regionEl,this.styleList.region!==undefined?this.styleList.region:{position:"absolute",zIndex:2,height:"100%",top:"0px"});if(this.resize){var resizeStyle=this.styleList.resize!==undefined?this.styleList.resize:{cursor:"col-resize",position:"absolute",left:"0px",
top:"0px",width:"1%",maxWidth:"4px",height:"100%"};var resizeClass=this.classList.resize!==undefined?" "+this.classList.resize:"";["start","end"].forEach(function(side){var handleNamePartial="resize"+this.regionManager.capitalizeFirstLetter(side);if(!this[handleNamePartial])return;var handle=this[handleNamePartial+"Handle"]=regionEl.appendChild(document.createElement("handle"));handle.className="wavesurfer-handle wavesurfer-handle-"+side+resizeClass+(this.classList[handleNamePartial]!==undefined?
" "+this.classList[handleNamePartial]:"");this.style(handle,resizeStyle);if(this.styleList[handleNamePartial]!==undefined)this.style(handle,this.styleList[handleNamePartial]);if(side=="end")this.style(handle,{left:"100%"})},this)}this.element=this.regionWrapper.appendChild(regionEl);this.element.wavesurferRegion=this;this.updateRender();this.bindEvents(regionEl)},formatTime:function(start,end){return(start==end?[start]:[start,end]).map(function(time){return[Math.floor(time%3600/60),("00"+Math.floor(time%
60)).slice(-2)].join(":")}).join("-")},getWidth:function(){return(this.wavesurfer.drawer.width||this.wavesurfer.getComputedWidthAndRange().width)/this.wavesurfer.params.pixelRatio},updateRender:function(){var duration=this.wavesurfer.getDuration();var width=this.getWidth();if(this.start<0){this.start=0;this.end=this.end-this.start}if(this.end>duration){this.end=duration;this.start=duration-(this.end-this.start)}if(this.minLength!=null)this.end=Math.max(this.start+this.minLength,this.end);if(this.maxLength!=
null)this.end=Math.min(this.start+this.maxLength,this.end);if(this.regionManager.roundRanges){var roundRanges=this.regionManager.roundRanges;this.end=Math.round(this.end*roundRanges)/roundRanges;this.start=Math.round(this.start*roundRanges)/roundRanges}if(this.element!=null){var left=Math.round(this.start/duration*width);var regionWidth=Math.round(this.end/duration*width)-left;this.style(this.element,{left:left+"px",width:regionWidth+"px",backgroundColor:this.color});this.regionManager.updateCursor();
this.updateResizeHandleDisplay();for(var attrname in this.attributes)this.element.setAttribute("data-region-"+attrname,this.attributes[attrname]);if(this.showTitle)this.element.title=this.formatTime(this.start,this.end)}},updateResizeHandleDisplay:function(){if(this.resizeStartHandle)this.resizeStartHandle.style.display=this.resizeStart?"":"none";if(this.resizeEndHandle)this.resizeEndHandle.style.display=this.resizeEnd?"":"none"},bindInOut:function(){var my=this;my.firedIn=false;my.firedOut=false;
var onProcess=function(time){var timeRounded=Math.round(time*100)/100;var isInsideBand=timeRounded>my.start&&timeRounded<my.end;if(isInsideBand==my.firedIn)return;my.firedIn=isInsideBand;my.firedOut=!isInsideBand;my.fireEventPropagate(my.firedIn?"in":"out")};this.wavesurfer.backend.on("audioprocess",onProcess);this.on("remove",function(){my.wavesurfer.backend.un("audioprocess",onProcess)});this.on("out",function(){if(my.loop)my.wavesurfer.play(my.start)})},bindEvents:function(){var my=this;this.element.addEventListener("mouseenter",
function(evt){my.fireEventPropagate("mouseenter",evt)});this.element.addEventListener("mouseleave",function(evt){my.fireEventPropagate("mouseleave",evt)});this.element.addEventListener("click",function(evt){evt.preventDefault();my.fireEventPropagate("click",evt)});this.element.addEventListener("dblclick",function(evt){evt.stopPropagation();evt.preventDefault();my.fireEventPropagate("dblclick",evt)});var element=my.element,regionManager=my.regionManager;element.addEventListener("mouseover",regionManager.onMouseOver);
element.addEventListener("mouseout",regionManager.onMouseOut);element.addEventListener("mousedown",regionManager.onDown);element.addEventListener("touchstart",regionManager.onDown,{passive:false})},onDrag:function(initialStart,initialEnd,delta){var maxEnd=this.wavesurfer.getDuration();this.update({start:initialStart+delta<0?0:initialStart+delta,end:initialEnd+delta>maxEnd?maxEnd:initialEnd+delta})},onResize:function(direction,initialStart,initialEnd,newTime){var limitPosition=direction=="start"?initialEnd:
initialStart;this.update({start:Math.min(newTime,limitPosition),end:Math.max(newTime,limitPosition)})}};WaveSurfer.util.extend(WaveSurfer.Region,WaveSurfer.Observer);WaveSurfer.initRegions=function(){if(!this.regions){this.regions=Object.create(WaveSurfer.Regions);this.regions.init(this)}};WaveSurfer.addRegion=function(options){this.initRegions();return this.regions.add(options)};WaveSurfer.clearRegions=function(){this.regions&&this.regions.clear()};
WaveSurfer.enableDragSelection=function(options){this.initRegions();this.regions.enableDragSelection(options)};WaveSurfer.disableDragSelection=function(){this.regions.disableDragSelection()};
function history_control_object(settings){var history_main=this;if(typeof settings=="undefined")settings={};history_main.overwrite_first_state=typeof settings.overwrite_first_state!="undefined"&&settings.overwrite_first_state==false?false:true;var var_name=typeof settings.var_name!="undefined"?settings.var_name:"page";history_main.base_filename=typeof settings.base_filename!="undefined"?settings.base_filename:"";history_main.onbeforestatechange=settings.onbeforestatechange;history_main.onstatechange=
settings.onstatechange;history_main.initial_page=settings.initial_page;history_main.app_url_vars=settings.app_url_vars;history_main.can_do_popstate=settings.can_do_popstate;history_main.current_state={};var extras={};var next_title=undefined,next_url=undefined,next_callback=undefined;var first_load=true;var history_control_locked=false;var ever_pushed_something=false;var initial_url=location.href;window.addEventListener("popstate",function(evt){var onload_pop=!ever_pushed_something&&location.href==
initial_url;ever_pushed_something=true;if(onload_pop)return;if(history_control_locked||typeof history_main.can_do_popstate!="undefined"&&!history_main.can_do_popstate(evt.state)){set_page_state(history_main.current_state,undefined,false,true);return}history_control_locked=true;if(evt.state==null)return;set_page_state(evt.state,undefined,false)});history_main.complete=function(){if(history_main.defer){history_main.defer();delete history_main.defer}if(history_main.defer_callback){history_main.defer_callback();
delete history_main.defer_callback}};function set_page_state(new_state,settings,record_history,ignore_history){if(typeof history_main.app_url_vars!="undefined"){for(var i in history_main.app_url_vars)delete history_main.app_url_vars[i];merge_into(history_main.app_url_vars,new_state)}var hash=formUrlVars(new_state,{record_undefined_values:false});if(typeof settings!="undefined"){if(typeof settings.title!="undefined")history_main.title=settings.title;if(typeof settings.url!="undefined")history_main.url=
settings.url;if(typeof settings.callback!="undefined")history_main.callback=settings.callback;if(typeof history_main.url=="undefined"){history_main.url=location.protocol+"//"+location.host+location.pathname+history_main.base_filename;history_main.url+=hash}}if(record_history==true){extras[hash]={};extras[hash].title=history_main.title;extras[hash].url=history_main.url;extras[hash].callback=history_main.callback}else history_main[var_name]=new_state[var_name];var current_extras=extras[hash];var current_title=
current_extras?current_extras.title:undefined;var current_url=current_extras?current_extras.url:undefined;var current_callback=current_extras?current_extras.callback:undefined;delete history_main.url;delete history_main.callback;function change_url_and_title(){document.title=typeof current_title!="undefined"?current_title:"";if(record_history==true||!!ignore_history){var state_action=(first_load?"replace":"push")+"State";var new_state_temp=Object.assign({},new_state);for(var prop in new_state_temp)if(typeof new_state_temp[prop]==
"undefined")delete new_state_temp[prop];history[state_action](new_state_temp,current_title,current_url)}}if(settings&&(settings.defer_url_and_title||settings.defer))history_main.defer=change_url_and_title;else change_url_and_title();if(!first_load)ever_pushed_something=true;var old_state=history_main.current_state;history_main.current_state=new_state;if(first_load==true)first_load=false;if(!ignore_history)if(typeof history_main.onstatechange!="undefined")history_main.onstatechange(new_state,function(){history_control_locked=
false;if(typeof current_callback!="undefined")current_callback()},old_state);else{history_control_locked=false;if(typeof current_callback!="undefined")current_callback()}if(settings&&settings.element_container){var container=settings.element_container,arr=[];for(var prop in container)if(typeof container[prop]=="function")arr.push(prop);if(arr.includes(new_state.page)){var old_element=container.element,old_elements=container.elements;container.element=undefined;container.elements=[];function run_it(){if(old_element&&
old_element.parentNode)old_element.parentNode.removeChild(old_element);if(old_elements)old_elements.forEach(function(element){if(element.parentNode)element.parentNode.removeChild(element)})}if(!settings.defer&&!settings.defer_callback)run_it();else history_main.defer_callback=run_it}}}history_main.add_preset=function(init){if(init.new_state)var preset_new_state=shallowcopy(init.new_state);if(init.settings)var preset_settings=shallowcopy(init.settings);return{complete:function(){history_main.complete.apply(null,
arguments)},insert_page:function(){history_main.insert_page.apply(null,arguments)},load_page:function(new_state,settings){if(preset_new_state)merge_into(new_state,preset_new_state);if(preset_settings)merge_into(settings,preset_settings);history_main.load_page.apply(history_main,arguments)}}};history_main.load_page=function(new_state,settings){if(history_control_locked)return;history_control_locked=true;if(typeof new_state=="undefined")new_state={};if(typeof settings=="undefined")settings={};new_state=
shallowcopy(new_state);settings=shallowcopy(settings);if(first_load==true&&history_main.overwrite_first_state==true){getUrlVars(new_state);if(typeof history_main[var_name]=="undefined")history_main[var_name]=history_main.initial_page}if(typeof new_state[var_name]=="undefined")new_state[var_name]=history_main[var_name];if(typeof history_main.onbeforestatechange!="undefined")history_main.onbeforestatechange(new_state,settings,function(){set_page_state(new_state,settings,true)});else set_page_state(new_state,
settings,true)};function formUrlVars(variable_list,options){if(typeof options=="undefined")options={};if(typeof options.record_undefined_values=="undefined")options.record_undefined_values=true;var return_value="";for(var i in variable_list)if(typeof variable_list[i]!="undefined"||options.record_undefined_values==true)return_value+="\x26"+i+"\x3d"+variable_list[i];if(return_value!="")return_value="?"+return_value.slice(1,return_value.length);return return_value}function getUrlVars(variable_object){if(typeof variable_object!=
"object"||variable_object==null)var variable_object={};var variable_list=window.location.href.slice(window.location.href.indexOf("?")+1).split("\x26");var curlen=variable_list.length;for(var i=0;i<curlen;i++){var current_variable=variable_list[i].split("\x3d");if(typeof current_variable[1]=="undefined")continue;variable_object[current_variable[0]]=decodeURIComponent(current_variable[1])}return variable_object}function merge_into(target,source){if(typeof source=="undefined")return target;for(var property in source)target[property]=
source[property];return target}function shallowcopy(source){if(typeof source!=="object"||source==null)return source;var copy=source instanceof Array?[]:{};for(var i in source){var property=source[i];if(typeof property!="object"||!(property instanceof Array)){copy[i]=property;continue}copy[i]=property.slice()}return copy}}
function Semaphore(init){var semaphore=this;semaphore.max_active_default=init.max_active_default;semaphore.max_active=init.max_active;var queue={};var run_count={};semaphore.add=function(){add.apply(null,arguments)};function add(function_name,function_object){if(typeof queue[function_name]=="undefined"){queue[function_name]=[];run_count[function_name]=0}var subqueue=queue[function_name];var args=Array.prototype.slice.call(arguments);var semaphore_fragment={complete:function(){complete(this,function_name)}};
args.shift();args.shift();args.unshift(semaphore_fragment);var max_active=typeof semaphore.max_active[function_name]!="undefined"?semaphore.max_active[function_name]:typeof semaphore.max_active_default!="undefined"?semaphore.max_active_default:10;if(run_count[function_name]==max_active)subqueue.push([function_object,args]);else run_function(function_object,function_name,undefined,args);return semaphore_fragment}function complete(semaphore_fragment,function_name){run_count[function_name]-=1;var subqueue=
queue[function_name];if(subqueue.length==0)return;run_function(subqueue[0][0],function_name,semaphore_fragment.index,subqueue[0][1]);subqueue.shift()}function run_function(function_object,function_name,index,args){run_count[function_name]+=1;var semaphore_fragment=args[0];semaphore_fragment.index=typeof index!="undefined"?index:run_count[function_name]-1;function_object.apply(null,args)}}if(typeof module==="object"&&module.exports)module.exports=Semaphore;
void function(){var h={};if(typeof module=="undefined")var module={};module.exports=h;if(typeof window!="undefined")global=window;if(global)global.helperjs=h;h.library_settings={misc_polyfills:true,alt_names:true,timer:true,physical_control:true,sorting:true,object_manipulation:true,logic:true,math:true,date_manipulation:true,string_manipulation:true,dom_position:true,ajax:true,download:true,gui_widgets:true,dom_manipulation:true,domain_and_directory:true,audio:true,graphics:true,feature_detection:true,
cookie:true,font_loading:true,misc:true,use_prototypes:true,use_camelcases:true,use_underscores:true};h.proto={NodeList:{},HTMLCollection:{},HTMLElement:{},String:{},Array:{},Math:{},Date:{}};void function(){h.library_settings.is_library_container=true;void function(obj){obj.is_library_container=true;for(var target_name in obj)obj[target_name].is_library_container=true}(h.proto)}();if(h.library_settings.misc_polyfills){if(typeof console=="undefined")console={};if(typeof console.log=="undefined")console.log=
function(){};if(typeof document!=="undefined"&&!("classList"in document.documentElement))(function(view){if(!("HTMLElement"in view)&&!("Element"in view))return;var classListProp="classList",protoProp="prototype",elemCtrProto=(view.HTMLElement||view.Element)[protoProp],objCtr=Object,strTrim=String[protoProp].trim||function(){return this.replace(/^\s+|\s+$/g,"")},arrIndexOf=Array[protoProp].indexOf||function(item){var i=0,len=this.length;for(;i<len;i++)if(i in this&&this[i]===item)return i;return-1},
DOMEx=function(type,message){this.name=type;this.code=DOMException[type];this.message=message},checkTokenAndGetIndex=function(classList,token){if(token==="")throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(token))throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character");return arrIndexOf.call(classList,token)},ClassList=function(elem){var trimmedClasses=strTrim.call(elem.className),classes=trimmedClasses?trimmedClasses.split(/\s+/):[],i=
0,len=classes.length;for(;i<len;i++)this.push(classes[i]);this._updateClassName=function(){elem.className=this.toString()}},classListProto=ClassList[protoProp]=[],classListGetter=function(){return new ClassList(this)};DOMEx[protoProp]=Error[protoProp];classListProto.item=function(i){return this[i]||null};classListProto.contains=function(token){token+="";return checkTokenAndGetIndex(this,token)!==-1};classListProto.add=function(){var tokens=arguments,i=0,l=tokens.length,token,updated=false;do{token=
tokens[i]+"";if(checkTokenAndGetIndex(this,token)===-1){this.push(token);updated=true}}while(++i<l);if(updated)this._updateClassName()};classListProto.remove=function(){var tokens=arguments,i=0,l=tokens.length,token,updated=false;do{token=tokens[i]+"";var index=checkTokenAndGetIndex(this,token);if(index!==-1){this.splice(index,1);updated=true}}while(++i<l);if(updated)this._updateClassName()};classListProto.toggle=function(token,forse){token+="";var result=this.contains(token),method=result?forse!==
true&&"remove":forse!==false&&"add";if(method)this[method](token);return!result};classListProto.toString=function(){return this.join(" ")};if(objCtr.defineProperty){var classListPropDesc={get:classListGetter,enumerable:true,configurable:true};try{objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc)}catch(ex){if(ex.number===-2146823252){classListPropDesc.enumerable=false;objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc)}}}else if(objCtr[protoProp].__defineGetter__)elemCtrProto.__defineGetter__(classListProp,
classListGetter)})(self);if(/(msie|trident)/i.test(navigator.userAgent))void function(){var innerhtml_get=Object.getOwnPropertyDescriptor(HTMLElement.prototype,"innerHTML").get;var innerhtml_set=Object.getOwnPropertyDescriptor(HTMLElement.prototype,"innerHTML").set;Object.defineProperty(HTMLElement.prototype,"innerHTML",{get:function(){return innerhtml_get.call(this)},set:function(new_html){var childNodes=this.childNodes;for(var curlen=childNodes.length,i=curlen;i>0;i--)this.removeChild(childNodes[0]);
innerhtml_set.call(this,new_html)}})}();if(/(msie|trident)/i.test(navigator.userAgent))Object.defineProperty(HTMLImageElement.prototype,"start",{writable:true});window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1E3/60)}}()}if(h.library_settings.alt_names){h.add_event=function(evt_target,evt_type,
evt_listener,use_capture){evt_target.addEventListener(evt_type,evt_listener,use_capture)};h.remove_event=function(evt_target,evt_type,evt_listener,use_capture){evt_target.removeEventListener(evt_type,evt_listener,use_capture)}}if(h.library_settings.timer)void function(){var set_timeout_upgraded=h.set_timeout_upgraded=function(){var args=Array.prototype.slice.call(arguments);var curtime=(new Date).getTime();return{timeLeft:args[1],start:curtime,pause:function(){if(this.paused)return;this.paused=true;
this.timeLeft=(new Date).getTime()-this.start;if(this.timeLeft<=0)return;window.clearTimeout(this.id)},resume:function(){if(!this.paused)return;delete this.paused;this.start=(new Date).getTime();args[1]=this.timeLeft;this.id=window.setTimeout.apply(window,args)},restart:function(){if(this.paused)delete this.paused;window.clearTimeout(this.id);this.start=(new Date).getTime();this.id=window.setTimeout.apply(window,args)},id:setTimeout.apply(window,args)}};var set_interval_upgraded=h.set_interval_upgraded=
function(){var args=Array.prototype.slice.call(arguments);return{pause:function(){if(typeof this.paused=="undefined"){window.clearInterval(this.id);this.paused=true}},resume:function(){if(typeof this.paused!="undefined"){this.id=window.setInterval.apply(window,args);delete this.paused}},id:window.setInterval.apply(window,args)}};function is_attached(obj){while(true){obj=obj.parentNode;if(obj==document.documentElement)return true;if(obj==null)return false}}h.proto.HTMLElement.set_timeout_upgraded=
function(obj,callback,calltime){function callback_wrapper(){if(is_attached(obj))callback.apply(null,Array.prototype.slice.call(arguments))}var timeout_object=set_timeout_upgraded(callback_wrapper,calltime);return timeout_object};h.proto.HTMLElement.set_interval_upgraded=function(obj,callback,calltime){function callback_wrapper(){if(!is_attached(obj)){window.clearInterval(obj.id);return}callback.apply(null,Array.prototype.slice.call(arguments))}return set_interval_upgraded(callback_wrapper,calltime)};
h.proto.HTMLElement.set_timeout=function(obj,callback,calltime){function callback_wrapper(){if(is_attached(obj))callback.apply(null,Array.prototype.slice.call(arguments))}return window.setTimeout(callback_wrapper,calltime)};h.proto.HTMLElement.set_interval=function(obj,callback,calltime){function callback_wrapper(){if(!is_attached(obj)){window.clearInterval(obj.id);return}callback.apply(null,Array.prototype.slice.call(arguments))}return window.setInterval(callback_wrapper,calltime)}}();if(h.library_settings.physical_control){var get_right_click=
h.get_right_click=function(evt){return evt.which?evt.which==3:evt.button?evt.button==2:false};h.get_wheel_data=function(evt){return evt.detail?evt.detail*-1:evt.wheelDelta/40};h.get_key_code_string=function(evt){var keyCode=evt.keyCode;var keyMap={37:"left",38:"up",39:"right",40:"down",107:"+",187:"+",109:"-",189:"-",16:"shift",27:"escape",13:"enter"};if(typeof keyCode[keyMap]=="undefined")return String.fromCharCode(keyCode).toUpperCase();else return keyCode[keyMap]};if(h.library_settings.dom_position){h.add_pinch_controls=
function(init){var target_obj=init.target,current_distance=false,zoom_x=undefined,zoom_y=undefined;target_obj.addEventListener("touchend",end_effect);target_obj.addEventListener("touchcancel",end_effect);target_obj.addEventListener("touchleave",end_effect);target_obj.addEventListener("touchstart",pinch);target_obj.addEventListener("touchmove",pinch);function end_effect(evt){if(current_distance!=false)if(typeof init.end_effect!="undefined")init.end_effect(evt)}function pinch(evt){if(evt.touches.length<
2){current_distance=false;return}if(evt.type=="touchmove")if(current_distance==false)return;else var last_distance=current_distance;else if(typeof init.start_condition!="undefined"&&init.start_condition(evt)===false)return;var xy0=get_x_y(evt.touches[0],target_obj);var x0=xy0[0];var y0=xy0[1];var xy1=get_x_y(evt.touches[1],target_obj);var x1=xy1[0];var y1=xy1[1];if(init.always_recalculate_zoom_target===true||current_distance==false)zoom_x=(x0+x1)/2,zoom_y=(y0+y1)/2;current_distance=Math.sqrt(Math.pow(Math.abs(x0-
x1),2)+Math.pow(Math.abs(y0-y1),2));if(evt.type=="touchstart"){if(typeof init.start_effect!="undefined")init.start_effect(evt,x0,y0,x1,y1);return}init.result_function(current_distance/last_distance,zoom_x,zoom_y);if(typeof init.move_effect!="undefined")init.move_effect(evt)}};h.add_swipe_controls=function(init){if(typeof init.is_mobile=="undefined")init.is_mobile=true;var target_obj=init.target,initial_x,initial_y,current_x,current_y,swipe_in_effect=false;target_obj.addEventListener(init.is_mobile?
"touchstart":"mousedown",swipe_start_event);target_obj.addEventListener(init.is_mobile?"touchmove":"mousemove",swipe_event);target_obj.addEventListener(init.is_mobile?"touchend":"mouseup",function(evt){if(swipe_in_effect==false)return;swipe_end_event(evt)});target_obj.addEventListener(init.is_mobile?"touchleave":"mouseout",function(evt){if(swipe_in_effect==false)return;swipe_end_event(evt)});target_obj.addEventListener(init.is_mobile?"touchcancel":"blur",function(evt){if(swipe_in_effect==false)return;
swipe_end(evt)});function swipe_end(evt){if(swipe_in_effect==false)return;swipe_in_effect=false;if(typeof init.end_effect!="undefined")init.end_effect(evt)}function swipe_start_event(evt){if(typeof init.start_condition!="undefined"&&init.start_condition(evt)==false)return;if(init.is_mobile&&evt.touches.length!=1)return;var xy=get_x_y(init.is_mobile?evt.touches[0]:evt,target_obj);initial_x=xy[0];initial_y=xy[1];current_x=initial_x;current_y=initial_y;if(swipe_in_effect==true)return;swipe_in_effect=
true;if(typeof init.start_effect!="undefined")init.start_effect(evt)}function swipe_event(evt){if(init.is_mobile&&evt.touches.length!=1||typeof init.continue_condition!="undefined"&&init.continue_condition(evt)===false){swipe_end(evt);return}var xy=get_x_y(init.is_mobile?evt.touches[0]:evt,target_obj);current_x=xy[0];current_y=xy[1];if(typeof init.swipe_move!="undefined")init.swipe_move({evt:evt,init:init,initial_x:initial_x,initial_y:initial_y,current_x:current_x,current_y:current_y,swipe_in_effect:swipe_in_effect})}
function swipe_end_event(evt){if(typeof init.continue_condition!="undefined"&&init.continue_condition(evt)===false){swipe_end(evt);return}if(current_x<initial_x){if(typeof init.swipe_left!="undefined")init.swipe_left(evt)}else if(current_x>initial_x&&typeof init.swipe_right!="undefined")init.swipe_right(evt);if(current_y<initial_y){if(typeof init.swipe_down!="undefined")init.swipe_down(evt)}else if(current_y>initial_y&&typeof init.swipe_up!="undefined")init.swipe_up(evt);swipe_end(evt)}}}}if(h.library_settings.sorting){h.sort_characters_in_string=
function(string_to_sort){return string_to_sort.split("").sort(sort_case_insensitive).join("")};var sort_case_insensitive=h.sort_case_insensitive=function(a,b){a=a.toLowerCase();b=b.toLowerCase();if(a>b)return 1;if(a<b)return-1;return 0};h.sort_linked_arrays=function(input_array,linked_array,sort_function){if(typeof sort_function=="undefined"){if(input_array.length==0)returnsor;var starts=[0];var ends=[input_array.length];while(starts.length){var p=starts.pop();var q=ends.pop();var pivot=input_array[p];
var i=p,swapInput,swapLinked;for(var j=p+1;j<q;j++)if(input_array[j]<pivot){i++;swapInput=input_array[i];input_array[i]=input_array[j];input_array[j]=swapInput;swapLinked=linked_array[i];linked_array[i]=linked_array[j];linked_array[j]=swapLinked}swapInput=input_array[p];input_array[p]=input_array[i];input_array[i]=swapInput;swapLinked=linked_array[p];linked_array[p]=linked_array[i];linked_array[i]=swapLinked;if(q-i>2){starts.push(i+1);ends.push(q)}if(i-p>1){starts.push(p);ends.push(i)}}return}var curlen=
input_array.length;var input_array_obj=new Array(curlen);for(var i=0;i<curlen;i++)input_array_obj[i]=[input_array[i],linked_array[i]];input_array_obj.sort(sort_function);for(var i=0;i<curlen;i++){input_array[i]=input_array_obj[i][0];linked_array[i]=input_array_obj[i][1]}};h.get_indices_from_sort=function(input_array,sort_function){if(typeof sort_function=="undefined")var sort_function=function(a,b){if(a[0]>b[0])return 1;return-(a[0]<b[0])};var curlen=input_array.length;var input_array_obj=new Array(curlen);
input_array.forEach(function(entry,i){input_array_obj[i]=[entry,i]});input_array_obj.sort(sort_function);var output_array=new Array(curlen);input_array_obj.forEach(function(entry,i){output_array[entry[1]]=i});return output_array}}if(h.library_settings.object_manipulation){h.proto.Array.combine_with=function(obj,secondary){var primary=obj,primary_length=primary.length;secondary.forEach(function(current_entry){var target_found=false;for(var j=0;j<primary_length;j++)if(primary[j]===current_entry){target_found=
true;break}if(target_found!=true){primary.push(current_entry);primary_length+=1}});return primary};h.proto.Array.send_to_front=function(obj,target){var newobj=obj.map(function(element){return element});newobj.some(function(element,i){if(!objects_are_equal(element,target))return false;newobj.splice(i,1);newobj.splice(0,0,target);return true});return newobj};h.proto.Array.remove_empty_strings=function(obj){return obj.filter(function(element){return element!=""})};h.proto.Array.multiply=function(obj,
mult_value){return obj.map(function(element){return element*mult_value})};h.proto.Array.round=function(obj){function round(obj){return obj.map(function(element){return Math.round(element)})}};h.proto.Array.add=function(obj,add_value){return obj.map(function(element){return element+add_value})};h.proto.Array.shuffle=function(obj){var i=obj.length,t,r;while(0!==i){r=Math.floor(Math.random()*i);i-=1;t=obj[i];obj[i]=obj[r];obj[r]=t}return obj};h.search_array_of_objects=function(init){var text_list=init.text;
if(typeof text_list=="undefined"||!(text_list instanceof Array)&&text_list.trim()=="")return init.array;if(!(text_list instanceof Array))text_list=[text_list];var input_array=init.array;var attribute_list=init.attribute;if(!(attribute_list instanceof Array))attribute_list=[attribute_list];var attribute_list_length=attribute_list.length;var case_insensitive=typeof init.case_insensitive!="undefined"?init.case_insensitive:true;var output_array=[];var curlen=input_array.length;for(var i=0;i<curlen;i++){var current_entry=
input_array[i];var continue_loop=false;for(var j=0;j<attribute_list_length;j++){if(typeof text_list[j]=="undefined")continue;if(case_insensitive==true){if((current_entry[attribute_list[j]]+"").search(new RegExp(text_list[j],"i"))==-1){continue_loop=true;break}}else if((current_entry[attribute_list[j]]+"").search(text_list[j])==-1){continue_loop=true;break}}if(continue_loop==true)continue;output_array.push(current_entry)}return output_array};h.merge_objects=function(secondary,primary){if(typeof secondary==
"undefined")var primary=primary.primary,secondary=primary.secondary;var new_object={};for(var property in secondary)new_object[property]=secondary[property];for(var property in primary)new_object[property]=primary[property];return new_object};h.merge_objects_with_options=function(secondary,primary,options){if(typeof options=="undefined")options={};if(typeof secondary=="undefined")var primary=primary.primary,secondary=primary.secondary;var new_object={};for(var property in secondary)new_object[property]=
secondary[property];for(var property in primary){if(options.merge_subfunctions&&typeof secondary[property]=="function"&&typeof primary[property]=="function"){new_object[property]=function(){var args=Array.prototype.slice.call(arguments);secondary[property].apply(this,args);primary[property].apply(this,args)};continue}new_object[property]=primary[property]}return new_object};var objects_are_equal=h.objects_are_equal=function(a,b){function generalType(o){var t=typeof o;if(t!="object")return t;if(o instanceof
String)return"string";if(o instanceof Number)return"number";return t}function uniqueArray(a){if(!(a instanceof Array))return;a.sort();for(var i=1;i<a.length;i++)if(a[i-1]==a[i])a.splice(i,1)}function keys(map){var list=[];for(var prop in map)if(map.hasOwnProperty(prop))list.push(prop);return list}if(a===b)return true;if(generalType(a)!=generalType(b))return false;if(a==b)return true;if(typeof a!="object")return false;if(a instanceof Object!=b instanceof Object)return false;if(a instanceof Date||b instanceof
Date)if(a instanceof Date!=b instanceof Date||a.getTime()!=b.getTime())return false;var all_keys=[].concat(keys(a),keys(b));uniqueArray(all_keys);for(var i=0;i<all_keys.length;i++){var prop=all_keys[i];if(!objects_are_equal(a[prop],b[prop]))return false}return true};h.shallowcopy=function(source){if(typeof source!=="object"||source==null)return source;var copy=source instanceof Array?[]:{};for(var i in source)copy[i]=source[i];return copy};var deepcopy=h.deepcopy=function(source){if(typeof source!==
"object"||source==null)return source;var copy=source instanceof Array?[]:{};for(var i in source){var property=source[i];if(typeof property!="object"){copy[i]=property;continue}if(!(property instanceof Array)){copy[i]=deepcopy(property);continue}copy[i]=[];for(var j=0,curlen=property.length;j<curlen;j++){if(typeof property[j]!="object"){copy[i].push(property[j]);continue}copy[i].push(deepcopy(property[j]))}}return copy};h.strip_dom_keys=function(source){var copy={};var props=Object.keys(source);var dummy=
document.createElement("div");var dom_keys=Object.keys(dummy);for(var pi=0,curlen=props.length;pi<curlen;pi++){var p=props[pi];if(dom_keys.indexOf(p)!=-1)continue;copy[p]=source[p]}return copy};h.deep_extend=function(destination,source){for(var property in source)if(source[property]&&source[property].constructor&&source[property].constructor===Object){destination[property]=destination[property]||{};arguments.callee(destination[property],source[property])}else destination[property]=source[property];
return destination};h.replace_property=function(init){var obj=init.search_object;var search_property=init.search_property;var replace_function=init.replace_function;recurse_test(obj,null,null);function recurse_test(cur_obj,parent,ref){if(typeof cur_obj[search_property]!="undefined"){parent[ref]=replace_function(cur_obj[search_property]);return}for(var i in cur_obj)recurse_test(cur_obj[i],cur_obj,i)}};h.grid_create=function(target,xsize,ysize,constructor_inner,constructor_outer){var x=0,y=0;if(typeof constructor_outer!=
"undefined")if(typeof constructor_inner!="undefined")for(x=0;x<xsize;x++){eval("target[x]\x3d"+constructor_outer);for(y=0;y<xsize;y++)eval("target[x][y]\x3d"+constructor_inner)}else for(x=0;x<xsize;x++)eval("target[x]\x3d"+constructor_outer);else if(typeof constructor_inner!="undefined")for(x=0;x<xsize;x++){target[x]=[];for(y=0;y<xsize;y++)eval("target[x][y]\x3d"+constructor_inner)}else for(x=0;x<xsize;x++)target[x]=[];return target};h.grid_clone=function(source,target,constructor_outer,constructor_initial){if(typeof target==
"undefined")if(typeof constructor_initial=="undefined")if(source.constructor==Array)var target=new Array(source.length);else var target=new source.constructor;else eval("var target\x3d"+constructor_initial);if(source.constructor==Array){var xsize=source.length;var s0=source[0];if(s0 instanceof Int8Array||s0 instanceof Uint8Array||s0 instanceof Uint8ClampedArray||s0 instanceof Int16Array||s0 instanceof Uint16Array||s0 instanceof Int32Array||s0 instanceof Uint32Array||s0 instanceof Float32Array||s0 instanceof
Float64Array)for(var x=0;x<xsize;x++)target[x]=new source[x].constructor(source[x].buffer,source[x].byteOffset);return target}var ysize=source[0].length;for(var x=0;x<xsize;x++){if(typeof constructor_outer=="undefined")target[x]=new source[0].constructor;else eval("target[x]\x3d"+constructor_outer);for(var y=0;y<ysize;y++)target[x][y]=source[x][y]}return target};h.grid_copy=function(source,target){if(source.constructor==Array){var xsize=source.length;var s0=source[0];if(s0 instanceof Int8Array||s0 instanceof
Uint8Array||s0 instanceof Uint8ClampedArray||s0 instanceof Int16Array||s0 instanceof Uint16Array||s0 instanceof Int32Array||s0 instanceof Uint32Array||s0 instanceof Float32Array||s0 instanceof Float64Array)for(var x=0;x<xsize;x++)target[x]=new source[x].constructor(source[x].buffer,source[x].byteOffset);return target}var ysize=source[0].length;for(var x=0;x<xsize;x++)for(var y=0;y<ysize;y++)target[x][y]=source[x][y];return target};h.grid_normalize=function(curobj,xsize,ysize,oldmax,newmax,toint){var x=
0,y=0;if(toint){var oldmax=0;for(x=0;x<xsize;x++)for(y=0;y<ysize;y++)if(oldmax<curobj[x][y])oldmax=curobj[x][y];for(x=0;x<xsize;x++)for(y=0;y<ysize;y++)curobj[x][y]=Math.round(newmax*curobj[x][y]/oldmax)}else for(x=0;x<xsize;x++)for(y=0;y<ysize;y++)curobj[x][y]=parseInt(curobj[x][y]/oldmax*newmax);return curobj};h.grid_clear=function(target,xsize,ysize){var x=0,y=0;for(x=0;x<xsize;x++)for(y=0;y<ysize;y++)delete target[x][y];return target};h.grid_set=function(target,xsize,ysize,value){var x=0,y=0;
for(x=0;x<xsize;x++)for(y=0;y<ysize;y++)target[x][y]=value;return target};h.mapobject=function(func,obj){var result=new Object;for(var i in obj)result[i]=func(i,obj[i]);return result};h.extend=function(source,target){var target=target||new Object;mapobject(function(k,v){try{target[k]=v}catch(err){console.log(err)}},source);return target};h.is_empty=function(obj){if(Object.keys(obj).length==0)return true}}if(h.library_settings.logic){h.numeric_to_truthy=function(value){if(+value!=0)return true;else return false};
h.truthy_to_numeric=function(value){if(value==true)return 1;else return 0};h.bit_clear=function(n,p){return n&=~(1<<p)};h.bit_set=function(n,p){return n|=1<<p};h.bit_toggle=function(n,p){return n^=1<<p}.bit_is_set=function(n,p){return n&1<<p!=0};h.bit_count=function(n){n=n-(n>>1&1431655765);n=(n&858993459)+(n>>2&858993459);return(n+(n>>4)&252645135)*16843009>>24}}if(h.library_settings.math){Math.rad=function(degree){return Math.PI/180*degree};Math.randInt=function(min,max){return min+Math.floor(Math.random()*
(max-min+1))};Math.randBool=function(){return 0==Math.floor(Math.random()*2)};Math.GCD=function(){var array_array=Array.prototype.slice.call(arguments);if(!array_array.length)return 0;var r,a;if(array_array[0]instanceof Array)var gcd=array_array[0][0];else var gcd=array_array[0];for(var i=0,curlen_i=array_array.length;i<curlen_i;i++){if(array_array[i]instanceof Array)var current_array=array_array[i];else var current_array=[array_array[i]];for(var j=0,curlen_j=current_array.length;j<curlen_j;j++){a=
current_array[j];do{r=a%gcd;if(r==0)break;a=gcd;gcd=r}while(true)}}return gcd};Math.randBMT=function(){var x=0,y=0,rds,c;do{x=Math.random()*2-1;y=Math.random()*2-1;rds=x*x+y*y}while(rds==0||rds>1);c=Math.sqrt(-2*Math.log(rds)/rds);var x=(x*c+1)/2;if(x>1)x=1;else if(x<0)x=0;return x};Math.weightedSample=function(obj){var total=0;for(var i in obj)total+=obj[i];total*=Math.random();for(var i in obj){total-=obj[i];if(total<0)return i}};h.math={};h.math.get_rotated_size=function(width,height,degrees){degrees=
degrees%180;width=degrees<90?width:-width;var radians=Math.PI/180*degrees,cosine=Math.cos(radians),sine=Math.sin(radians);return[Math.ceil(Math.abs(cosine*width+sine*height)),Math.ceil(Math.abs(cosine*height+sine*width))]};h.math.eval=function(expression,replace_list){if(typeof replace_list=="undefined")replace_list={};do{var do_exit=true;for(var i in replace_list){if(replace_list[i]===null)continue;var new_expression=expression.replace(i.toString(),replace_list[i].toString());if(new_expression!=
expression)do_exit=false;expression=new_expression}break;if(do_exit)break}while(true);return eval(expression)}}if(h.library_settings.date_manipulation){void function(){var monthName=["January","February","March","April","May","June","July","August","September","October","November","December"];var shortMonthName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];h.proto.Date.get_UTC_time=function(obj){return obj.getTime()+obj.getTimezoneOffset()*6E4};h.proto.Date.get_month_namev=
function(obj){return monthName[obj.getMonth()]};h.proto.Date.get_short_month_name=function(obj){return shortMonthName[obj.getMonth()]};h.proto.Date.get_HHMM_locale_time_string=function(obj){return shortMonthName[obj.getMonth()]};h.proto.Date.days_in_a_month=function(obj){var d=new Date(obj.getFullYear(),obj.getMonth()+1,0);return d.getDate()};h.proto.Date.set_time_object=function(obj,n){obj.setTime(n);return obj}}();h.get_date_from_mysql_format=function(mysql_string){var mysql_array=mysql_string.split(" ");
var ymd=mysql_array[0].split("-");var hms=mysql_array[1].split(":");return new Date(ymd[0],ymd[1]-1,ymd[2],hms[0],hms[1],hms[2],0)};h.get_mysql_format_from_date=function(unix_timestamp){var date=new Date(unix_timestamp*1E3);var current_month=date.getUTCMonth()+1;if(current_month<10)current_month="0"+current_month;var current_day=date.getUTCDate();if(current_day<10)current_day="0"+current_day;var current_hour=date.getUTCHours();if(current_hour<10)current_hour="0"+current_hour;var current_minute=date.getUTCMinutes();
if(current_minute<10)current_minute="0"+current_minute;var current_second=date.getUTCSeconds();if(current_second<10)current_second="0"+current_second;return date.getUTCFullYear()+"-"+current_month+"-"+current_day+" "+current_hour+":"+current_minute+":"+current_second};h.mysql_date=function(unix_timestamp){return mysql_date_from_unix_timestamp(unix_timestamp)};h.mysql_date_from_unix_timestamp=function(unix_timestamp){var date=new Date(unix_timestamp*1E3);var current_month=date.getUTCMonth()+1;if(current_month<
10)current_month="0"+current_month;var current_day=date.getUTCDate();if(current_day<10)current_day="0"+current_day;return date.getUTCFullYear()+"-"+current_month+"-"+current_day};h.unix_timestamp_from_mysql_date=function(mysql_date){var mysql_date_array=mysql_date.split("-");return parseInt((new Date(mysql_date_array[0],mysql_date_array[1]-1,mysql_date_array[2],0,0,0,0)).getUTCTime()/1E3)};h.date_format=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,timezone=
/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){val=String(val);len=len||2;while(val.length<len)val="0"+val;return val};return function(date,mask,utc){var dF=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(date)=="[object String]"&&!/\d/.test(date)){mask=date;date=undefined}date=date?new Date(date):new Date;if(isNaN(date))throw SyntaxError("invalid date");
mask=String(dF.masks[mask]||mask||dF.masks["default"]);if(mask.slice(0,4)=="UTC:"){mask=mask.slice(4);utc=true}var _=utc?"getUTC":"get";var d=date[_+"Date"]();var D=date[_+"Day"]();var m=date[_+"Month"]();var y=date[_+"FullYear"]();var H=date[_+"Hours"]();var M=date[_+"Minutes"]();var s=date[_+"Seconds"]();var L=date[_+"Milliseconds"]();var o=utc?0:date.getTimezoneOffset();var flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+
12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(L>99?Math.round(L/10):L),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-
1)})}}();h.date_format.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};var date_format=h.date_format.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday",
"Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};h.proto.Date.format=function(obj,mask,utc){return date_format(obj,mask,utc)}}if(h.library_settings.string_manipulation){h.proto.String.repeat=function(obj,num){return(new Array(num+1)).join(obj)};h.proto.String.to_char_code=function(obj,n){return obj.charCodeAt(n)};h.proto.String.index_of_multi_char=
function(obj,searchstring,startpos){if(typeof startpos=="undefined")startpos=0;var curlen=obj.length;for(var i=startpos;i<curlen;i++)if(searchstring.indexOf(obj[i])!=-1)return i;return false};h.proto.String.cushort=function(obj){return((obj.charCodeAt(1)&255)<<8)+(obj.charCodeAt(0)&255)};h.proto.String.cuint=function(obj){return((obj.charCodeAt(3)&255)<<24)+((obj.charCodeAt(2)&255)<<16)+((obj.charCodeAt(1)&255)<<8)+(obj.charCodeAt(0)&255)};h.proto.String.l2br=function(obj){return obj.replace(/(\r\n|\n\r|\r|\n)/g,
"\x3cbr/\x3e")};h.proto.String.ltrim=function(obj){return obj.replace(/^\s+/,"")};h.proto.String.rtrim=function(obj){return obj.replace(/\s+$/,"")};h.proto.String.split_and_trim=function(obj,divisor){if(obj==null)return[];var result=obj.split(divisor);var j=0;for(var i=0,curlen=result.length;i<curlen;i++){var current_result=result[i].replace(/^\s+|\s+$/g,"");if(current_result=="")continue;result[j]=current_result;j+=1}result.splice(j,curlen-j);return result};h.proto.String.capitalize=function(obj){return obj.toLowerCase().replace(/^[a-z]|\s[a-z]/g,
conv);function conv(){return arguments[0].toUpperCase()}};var capitalize_first_letter=h.proto.String.capitalize_first_letter=function(obj){return obj.charAt(0).toUpperCase()+obj.slice(1)};h.proto.String.stripslashes=function(obj){return(obj+"").replace(/\\(.?)/g,function(s,n1){switch(n1){case "\\":return"\\";case "0":return"\x00";case "":return"";default:return n1}})};h.shorten_text=function(text,maximum_length){if(text.length>maximum_length)text=text.slice(0,maximum_length-4)+"...";return text};
h.split_string_by_sentences=function(curstr){var curobj=curstr.match(/.*?[.?!][")}\]]*( |$)/g);var curlen=curobj.length;for(var i=0;i<curlen;i++)curobj[i]=curobj[i].trim();return curobj};h.format_add_commas_to_number=function(input_string){var arr=(input_string+"").split(".");var predot=arr[0];var postdot=arr.length>1?"."+arr[1]:"";var the_regex=/(\d+)(\d{3})/;while(the_regex.test(predot))predot=predot.replace(the_regex,"$1"+","+"$2");return predot+postdot};h.grammar={"single_noun_general_preposition":function(curstring){if(typeof curstring==
"undefined")return"";var firstletter=curstring[0];var starts_with_an="aeiou";if(starts_with_an.indexOf(firstletter)==-1){var dotFound=curstring.indexOf(".");var spaceFound=curstring.indexOf(" ");if(dotFound==-1||spaceFound!=-1&&spaceFound<dotFound)return"a "+curstring}return"an "+curstring}}}if(h.library_settings.dom_position){var get_x_y=h.get_x_y=function(evt,target){if(typeof target=="undefined")target=evt.target;var rect=target.getBoundingClientRect();return[evt.clientX-rect.left,evt.clientY-
rect.top]};var get_x=h.get_x=function(evt,target){if(typeof target=="undefined")target=evt.target;return evt.clientX-target.getBoundingClientRect().left};var get_y=h.get_y=function(evt,target){if(typeof target=="undefined")target=evt.target;return evt.clientY-target.getBoundingClientRect().top};var findabspos=h.findabspos=function(obj,lastobj){var curleft=0,curtop=0,borderWidthTest=0;if(typeof lastobj=="undefined")lastobj=null;do{borderWidthTest=parseFloat(window.getComputedStyle(obj).borderLeftWidth);
if(!isNaN(borderWidthTest))curleft+=borderWidthTest;borderWidthTest=parseFloat(window.getComputedStyle(obj).borderTopWidth);if(!isNaN(borderWidthTest))curtop+=borderWidthTest;if(obj.offsetParent==lastobj)return[curleft,curtop];curleft+=obj.offsetLeft;curtop+=obj.offsetTop;obj=obj.offsetParent}while(true)};h.findabspos_x=function(obj,lastobj){var curleft=0,borderWidthTest=0;if(typeof lastobj=="undefined")lastobj=null;do{borderWidthTest=parseFloat(window.getComputedStyle(obj).borderLeftWidth);if(!isNaN(borderWidthTest))curleft+=
borderWidthTest;if(obj.offsetParent==lastobj)return curleft;curleft+=obj.offsetLeft;obj=obj.offsetParent}while(true)};h.findabspos_y=function(obj,lastobj){var curtop=0,borderWidthTest=0;if(typeof lastobj=="undefined")lastobj=null;do{borderWidthTest=parseFloat(window.getComputedStyle(obj).borderTopWidth);if(!isNaN(borderWidthTest))curtop+=borderWidthTest;if(obj.offsetParent==lastobj)return curtop;curtop+=obj.offsetTop;obj=obj.offsetParent}while(true)};var findabspos_zoom=h.findabspos_zoom=function(obj,
lastobj){var curleft=0,curtop=0,zoom_level_x=0,zoom_level_y=0,borderWidthTest=0;if(typeof lastobj=="undefined")lastobj=null;do{if(obj.offsetParent==lastobj){zoom_level_x=1;zoom_level_y=1}else{zoom_level_x=get_inherited_transform(obj.offsetParent,{transform_type:"scale",xy:"x"});zoom_level_y=get_inherited_transform(obj.offsetParent,{transform_type:"scale",xy:"y"})}borderWidthTest=parseFloat(window.getComputedStyle(obj).borderLeftWidth);if(!isNaN(borderWidthTest))curleft+=borderWidthTest*zoom_level_x;
borderWidthTest=parseFloat(window.getComputedStyle(obj).borderTopWidth);if(!isNaN(borderWidthTest))curtop+=borderWidthTest*zoom_level_y;if(obj.offsetParent==lastobj)return[curleft,curtop];curleft+=obj.offsetLeft*zoom_level_x;curtop+=obj.offsetTop*zoom_level_y;obj=obj.offsetParent}while(true)};var findabspos_zoom_x=h.findabspos_zoom_x=function(obj,lastobj){var curleft=0,zoom_level_x=0,borderWidthTest=0;if(typeof lastobj=="undefined")lastobj=null;do{if(obj.offsetParent==lastobj)zoom_level_x=1;else zoom_level_x=
get_inherited_transform(obj.offsetParent,{transform_type:"scale",xy:"x"});borderWidthTest=parseFloat(window.getComputedStyle(obj).borderLeftWidth);if(!isNaN(borderWidthTest))curleft+=borderWidthTest*zoom_level_x;if(obj.offsetParent==lastobj)return curleft;curleft+=obj.offsetLeft*zoom_level_x;obj=obj.offsetParent}while(true)};var findabspos_zoom_y=h.findabspos_zoom_y=function(obj,lastobj){var curtop=0,zoom_level_y=0,borderWidthTest=0;if(typeof lastobj=="undefined")lastobj=null;do{if(obj.offsetParent==
lastobj)zoom_level_y=1;else zoom_level_y=get_inherited_transform(obj.offsetParent,{transform_type:"scale",xy:"y"});borderWidthTest=parseFloat(window.getComputedStyle(obj).borderTopWidth);if(!isNaN(borderWidthTest))curtop+=borderWidthTest*zoom_level_y;if(obj.offsetParent==lastobj)return curtop;curtop+=obj.offsetTop*zoom_level_y;obj=obj.offsetParent}while(true)};var get_inherited_transform=h.get_inherited_transform=function(obj,init){var transform_type=init.transform_type;var xy=init.xy;var transform_string=
"";var transform_array=[];switch(transform_type){case "scale":var scale=1;while(true){transform_string=getTransformString(obj);if(transform_string!=false){transform_array=transform_string.slice(7,transform_string.length-6).split(",");switch(xy){case "x":scale*=parseFloat(transform_array[0]);break;case "y":scale*=parseFloat(transform_array[3]);break}}var obj=obj.parentNode;if(obj.parentNode==null)break}return scale}function getTransformString(obj){var transform_string=window.getComputedStyle(obj)["Transform"];
if(typeof transform_string=="undefined")transform_string=window.getComputedStyle(obj)["msTransform"];if(typeof transform_string=="undefined")transform_string=window.getComputedStyle(obj)["webkitTransform"];if(typeof transform_string=="undefined")transform_string=window.getComputedStyle(obj)["MozTransform"];if(typeof transform_string=="undefined")transform_string=window.getComputedStyle(obj)["OTransform"];if(typeof transform_string=="undefined"||transform_string=="none")return false;return transform_string}
}}if(h.library_settings.download){h.file_download=function(url,data_array){if(!url||!data_array)return;var input_text="";for(var i in data_array){current_value=data_array[i];input_text+='\x3cinput type\x3d"hidden" name\x3d"'+i+'" value\x3d"'+current_value+'" /\x3e'}var hidden_form=document.createElement("form");hidden_form.action=url;hidden_form.method="post";hidden_form.innerHTML=input_text;document.body.appendChild(hidden_form);hidden_form.submit();document.body.removeChild(hidden_form)};h.ajax=
function(){var ajax={};function merge_objects(secondary,primary){if(typeof secondary=="undefined")var primary=primary.primary,secondary=primary.secondary;var new_object={};for(var property in secondary)new_object[property]=secondary[property];for(var property in primary)new_object[property]=primary[property];return new_object}var ajax_queue=ajax.queue=function(){var ajax_queue={};var queue_list={};ajax_queue.enqueue=ajax_queue.add=function(init){var name=typeof init.name!="undefined"?init.name:"default";
if(typeof queue_list[name]=="undefined")queue_list[name]={locked:false,queue:[]};var queue=queue_list[name];if(queue.locked){queue.queue_function.push(init.function);queue.queue_data.push(init.data);return}process(init)};function process(init){var name=init.name;var data=init.data;queue_list[name].locked=true;init.function.apply(null,init.data)["success","error","callback"].forEach(function(func){init.data[func]=function(){queue_list[name].locked=false;init.data[func].apply(null,Array.prototype.slice.call(arguments))}})}
}();ajax.create_accumulator=function(init){var default_function=init.function;var func_list=[];var run_list=[];var resolve_func=undefined;var test_counter=0;var accumulator={add:add,add_custom:add_custom,resolve:resolve,test:test};return accumulator;function add(){func_list.push(default_function);run_list.push(Array.prototype.slice.call(arguments))}function add_custom(init){var func=typeof init.function!="undefined"?init.function:default_function;func_list.push(func);run_list.push(init.data)}function resolve(new_resolve_func){if(typeof new_resolve_func!=
"undefined")resolve_func=new_resolve_func;test_counter+=run_list.length;run_list.forEach(function(params,i){func_list[i].apply(null,params)});return accumulator}function test(){test_counter-=1;if(accumulator.test_progress)accumulator.test_progress(run_list.length-test_counter,run_list.length);if(test_counter==0&&resolve_func)resolve_func()}};ajax.get_data=function(params){var send_data_as_plaintext=params.send_data_as_plaintext||params.plaintext||false;var is_asynchronous=true;if(typeof params.is_asynchronous!=
"undefined")is_asynchronous=params.is_asynchronous;if(typeof params.async!="undefined")is_asynchronous=params.async;var charset=typeof params.charset!="undefined"?params.charset:"";var data=typeof params.data!="undefined"?params.data:"";var ignore_request_status=typeof params.ignore_request_status!="undefined"?params.ignore_request_status:false;var response_type=typeof params.response_type!="undefined"?params.response_type:undefined;var header_list=typeof params.header_list!="undefined"?params.header_list:
undefined;var http_request_result=make_request(params.file,data,send_data_as_plaintext,charset,is_asynchronous,response_type,header_list,params.request_method);var http_request=http_request_result["http_request"];if(is_asynchronous==false)return process_http_request();http_request.onreadystatechange=function(){if(http_request.readyState==4)process_http_request()};return http_request;function process_http_request(){var response_text=http_request.responseText;if(http_request.status!=200&&ignore_request_status==
false)response_text={error:true,errormessage:response_text};else if(send_data_as_plaintext!=true&&response_text!="")try{response_text=JSON.parse(response_text)}catch(err){response_text={error:true,errormessage:response_text};if(is_asynchronous==false)return response_text;else{if(params.error)params.error(response_text);return}}if(response_text!=""&&response_text.error==true){if(typeof params.error!="undefined")if(is_asynchronous==false)return response_text;else return params.error(response_text);
return}if(is_asynchronous==false)return response_text;if(typeof params.success!="undefined")params.success(response_text)}};ajax.get_text_data=function(params){return get_data(merge_objects(params,{plaintext:true}))};ajax.set_innerhtml_from_url=function(params){return get_data(merge_objects(params,{plaintext:true,success:function(result){obj.innerHTML=result;params.success()}}))};if(typeof JSZip!="undefined"){function zip_imagelist_object(){var zip_src_to_generated_img_list=this.zip_src_to_generated_img_list=
{};var deferred_list_src={},deferred_list_img={};this.load=function(init){zip_load_images({filename:init.filename,async:true,callback:load_complete});function load_complete(result){var webworker_func=function(evt){var result=evt.data;if(typeof result=="number"){self.arrayBuffer_list_total=result;return}if(typeof self.arrayBuffer_list=="undefined"){self.arrayBuffer_list=[];self.arrayBuffer_list_loaded=0}self.arrayBuffer_list.push(result);arrayBuffer_list_loaded+=1;if(arrayBuffer_list_loaded!=arrayBuffer_list_total)return;
var output=[];for(var i=0,curlen=arrayBuffer_list.length;i<curlen;i++)output.push(new Blob([arrayBuffer_list[i]],{type:"image/png"}));postMessage(output)};if(typeof window.URL=="undefined")window.URL=window.webkitURL;var web_worker=new Worker(window.URL.createObjectURL(new Blob(["onmessage \x3d "+webworker_func.toString()])));web_worker.onmessage=function(evt){var web_worker_output=evt.data;function get_domain_and_directory(url){var last_index=url.lastIndexOf("/")+1;return url.substring(0,last_index)}
var filename_dir=get_domain_and_directory(init.filename);var load_count=0;for(var i=0,curlen=result_keys.length;i<curlen;i++){var relative_url=filename_dir+result_keys[i];var img=new Image;load_count+=1;img.src=window.URL.createObjectURL(web_worker_output[i]);img.onload=test_load_count;zip_src_to_generated_img_list[relative_url]=img;var test_deferred=deferred_list_src[relative_url];if(typeof test_deferred!="undefined"){for(var t=0;t<test_deferred.length;t++){var test_deferred_current=test_deferred[t];
test_deferred_current[0][test_deferred_current[1]]=img.src}delete deferred_list_src[relative_url]}var test_deferred=deferred_list_img[relative_url];if(typeof test_deferred!="undefined"){for(var t=0;t<test_deferred.length;t++){var test_deferred_current=test_deferred[t];test_deferred_current[0][test_deferred_current[1]]=img}delete deferred_list_img[relative_url]}}function test_load_count(evt){load_count-=1;if(load_count==0)if(typeof init.callback!="undefined")init.callback()}};var result_values=[],
result_keys=[];for(var i in result){result_values.push(result[i]);result_keys.push(i)}web_worker.postMessage(result_values.length);for(var i=0,curlen=result_values.length;i<curlen;i++)web_worker.postMessage(result_values[i],[result_values[i]])}};this.get_src=function(zip_src){return typeof zip_src_to_generated_img_list[zip_src]=="undefined"?zip_src:zip_src_to_generated_img_list[zip_src].src};this.get_img=function(zip_src){return typeof zip_src_to_generated_img_list[zip_src]=="undefined"?zip_src:zip_src_to_generated_img_list[zip_src]};
this.get_src_deferred=function(zip_src,obj,prop){if(zip_src.trim()=="")return"";if(typeof zip_src_to_generated_img_list[zip_src]=="undefined"){if(typeof deferred_list_src[zip_src]=="undefined")deferred_list_src[zip_src]=[];deferred_list_src[zip_src].push([obj,prop]);return zip_src}else return zip_src_to_generated_img_list[zip_src].src};this.get_img_deferred=function(zip_src,obj,prop){if(zip_src.trim()=="")return"";if(typeof zip_src_to_generated_img_list[zip_src]=="undefined"){if(typeof deferred_list_img[zip_src]==
"undefined")deferred_list_img[zip_src]=[];deferred_list_img[zip_src].push([obj,prop]);return zip_src}else return zip_src_to_generated_img_list[zip_img]}}ajax.zip_load_images=function(init){var filename=init.filename;var async=typeof init.async!="undefined"?init.async:true;var callback=typeof init.callback!="undefined"?init.callback:function(){};var charset=typeof init.charset!="undefined"?init.charset:undefined;var base_url=window.location.protocol+"//"+window.location.host+"/";var make_request_result=
make_request(filename,"",undefined,charset,async,"arraybuffer",undefined,"GET");var http_request=make_request_result["http_request"];if(async==false)return process_http_request();http_request.onreadystatechange=function(){if(http_request.readyState==4&&http_request.status==200)process_http_request()};function process_http_request(){var URL=window.URL;var webworker_func=function(evt){var response=evt.data;if(typeof response=="string"){self.base_url=response;return}window={};importScripts(self.base_url+
"js/plugins/jszip/jszip.js");importScripts(self.base_url+"js/plugins/jszip/jszip-deflate.js",self.base_url+"js/plugins/jszip/jszip-inflate.js");importScripts(self.base_url+"js/plugins/jszip/jszip-load.js");var zip=new JSZip(response,{base64:false});var buffer_list={};for(var filename_in_loop in zip.files){if(filename_in_loop.trim().substr(-1,1)=="/")continue;buffer_list[filename_in_loop]=zip.file(filename_in_loop).asArrayBuffer()}self.postMessage(buffer_list)};var web_worker=new Worker(window.URL.createObjectURL(new Blob(["onmessage \x3d "+
webworker_func.toString()])));web_worker.onmessage=function(evt){var buffer_list=evt.data;if(typeof callback!="undefined")callback(buffer_list)};web_worker.postMessage(base_url);web_worker.postMessage(http_request.response)}}}function make_request(url,data,send_data_as_plaintext,charset,is_asynchronous,response_type,header_list,request_method){if(typeof send_data_as_plaintext=="undefined"||send_data_as_plaintext!==true)send_data_as_plaintext=false;if(typeof is_asynchronous=="undefined"||is_asynchronous!=
false)is_asynchronous=true;if(typeof charset=="undefined"||charset=="")charset="";else charset="; charset\x3d"+charset;var http_request=new XMLHttpRequest;if(!http_request)alert("Cannot create an XMLHTTP instance for some reason. Please try reloading the page.");if(typeof request_method=="undefined")var request_method=data===null||data===""?"GET":"POST";if(request_method=="GET"){if(typeof data=="string"){var altchar=data[0]!="\x26"?"\x26":"";var connecting_character=url.indexOf("?")==-1?"?":altchar;
url+=connecting_character+data}data=null}http_request.open(request_method,url,is_asynchronous);if(typeof response_type!="undefined")http_request.responseType=response_type;if(send_data_as_plaintext===true){http_request.setRequestHeader("Content-type","application/x-www-form-urlencoded"+charset);if(typeof http_request.overrideMimeType!="undefined")http_request.overrideMimeType("text/plain; charset\x3dx-user-defined")}else http_request.setRequestHeader("Content-type","application/x-www-form-urlencoded"+
charset);if(header_list)header_list.forEach(function(header){http_request.setRequestHeader(header.name,header.content)});http_request.send(data);return{"http_request":http_request}}ajax.is_library_container=true;return ajax}();h.get_data=h.ajax.get_data}if(h.library_settings.gui_widgets){h.message_emitter_create=function(){if(typeof this=="undefined"||this==window)return new message_emitter;var main=this;main.event_list={};main.event_listener_list=[];main.addEvent=function(event_name,func){main.event_list[event_name]=
func};main.addEventListener=function(event_name,func){if(typeof main.event_listener_list[event_name]=="undefined")main.event_listener_list[event_name]=[];main.event_listener_list[event_name].push(func)};main.message_silent=false;main.send_message=function(message){console.log(message);var triggered_events={};for(var evt_name in main.event_list){var evt=main.event_list[evt_name];if(evt(message))triggered_events[evt_name]=main.event_listener_list[evt_name]}for(var evt_name in triggered_events){var event_listener_sublist=
main.event_listener_list[evt_name];for(var i=0,curlen=event_listener_sublist.length;i<curlen;i++)event_listener_sublist[i]()}if(main.message_silent==true)alert(message,{},function(){main.message_silent=true});main.message_silent=false}};h.add_li_menu_options=function(parent,options){for(var i=0,curlen=options.length;i<curlen;i++){var temp_li=document.createElement("li");parent.appendChild(temp_li);var current_option=options[i];temp_li.innerHTML=current_option.text;temp_li.addEventListener("click",
current_option.func);if(typeof current_option.immediate_func=="function")current_option.immediate_func(temp_li);for(var p in current_option)if(p!="text"&&p!="func"&&p!="immediate_func")temp_li[p]=current_option[p]}};h.button=function(init){var button_div=document.createElement("div");var parent=init.parent;var className=init.className;var style=init.style;var text=init.text;button_div.destroy=function(){for(var property in init)if(["parent","className","style","text"].indexOf(property)==-1)button_div.removeEventListener(property,
init[property]);button_div.parentNode.removeChild(button_div);button_div=null};for(var property in init)if(["parent","className","style","text"].indexOf(property)==-1)button_div.addEventListener(property,init[property]);if(typeof text!="undefined")button_div.innerHTML=text;if(typeof className!="undefined")button_div.className=className;if(typeof style!="undefined")setStyle(button_div,style);Object.defineProperty(button_div,"text",{get:function(){return button_div.innerHTML},set:function(text){button_div.innerHTML=
text}});parent.appendChild(button_div);return button_div};h.gui_close_button=function(init){var close_button=document.createElement("div");init.parent.appendChild(close_button);close_button.className="gui-window-close_button";addEvent(close_button,"click",function(evt){init.close_function();evt.stopPropagation();return false});return close_button};h.sliderbar=function(init){var main=typeof init.main_element!="undefined"?init.main_element:document.createElement("div");Object.defineProperty(main,"parent",
{get:function(){return parent},set:function(new_parent){if(typeof new_parent!="object"||!(new_parent instanceof HTMLElement))return;parent=new_parent;new_parent.appendChild(main);if(main.textbox)new_parent.appendChild(main.textbox)}});var parent=main.parent=init.parent;var background_style=init.background_style;var foreground_container_style=init.foreground_container_style;var foreground_style=init.foreground_style;var foreground_inverse_style=init.foreground_inverse_style;var background_class=init.background_class;
var foreground_container_class=init.foreground_container_class;var foreground_class=init.foreground_class;var foreground_inverse_class=init.foreground_inverse_class;var background_beyond_max_style=init.background_beyond_max_style;var pivot_slice_style=init.pivot_slice_style;var pivot_slice_class=init.pivot_slice_class;var control_style=init.control_style;var control_image_src=init.control_image;var control_class=init.control_class;var point_initial=typeof init.point_initial!="undefined"?init.point_initial:
0;var orientation=typeof init.orientation!="undefined"&&init.orientation=="vertical"?"vertical":"horizontal";var use_touch_events=typeof init.use_touch_events!="undefined"&&init.use_touch_events==true?true:false;var use_mouse_events=typeof init.use_mouse_events=="undefined"||init.use_mouse_events==true?true:false;main.start_condition=typeof init.start_condition!="undefined"?init.start_condition:undefined;main.events={update:"events"in init?init.events.update:undefined};main.point_maximum=typeof init.point_maximum==
"number"?init.point_maximum:100;main.pivot_point=typeof init.pivot_point=="number"?init.pivot_point:0;main.point_upper_limit=typeof init.point_upper_limit=="number"?init.point_upper_limit:100;main.textbox_enabled=init.textbox_enabled||false;main.control_unit_offset=typeof init.control_unit_offset=="number"?init.control_unit_offset:0;main.css_unit_type=init.css_unit_type||"px";main.recalculate_size=typeof init.recalculate_size!="undefined"?init.recalculate_size:true;var width_height=orientation=="horizontal"?
"width":"height";var left_top=orientation=="horizontal"?"left":"top";var pageXY=orientation=="horizontal"?"pageX":"pageY";var orientation_xy=orientation=="horizontal"?"x":"y";var findabspos_zoom=orientation=="horizontal"?h.findabspos_zoom_x:h.findabspos_zoom_y;var px_to_css_unit_type_fixed=undefined;var zoom_level_fixed=undefined;if(main.textbox_enabled!=true)var textbox=main.textbox=undefined;else{var textbox=main.textbox=document.createElement("div");textbox.className=init.textbox_class||"";h.add_style(textbox,
init.textbox_style||"");parent.appendChild(textbox);if(typeof init.textbox_prefix!="undefined"){var textbox_prefix=document.createElement("div");textbox_prefix.className=init.textbox_prefix_class||"";h.add_style(textbox_prefix,init.textbox_prefix_style||"");textbox_prefix.innerHTML=init.textbox_prefix||"";textbox.appendChild(textbox_prefix)}var textbox_number=document.createElement("input");h.add_style(textbox_number,init.textbox_number_style||"");textbox_number.className=init.textbox_number_class||
"";textbox_number.type="text";textbox_number.readOnly=false;textbox_number.addEventListener("input",textbox_change);textbox_number.addEventListener("keypress",textbox_keypress);textbox.appendChild(textbox_number);if(typeof init.textbox_suffix!="undefined"){var textbox_suffix=document.createElement("div");textbox_suffix.className=init.textbox_suffix_class||"";h.add_style(textbox_suffix,init.textbox_suffix_style||"");textbox_suffix.innerHTML=init.textbox_suffix||"";textbox.appendChild(textbox_suffix)}}main.className=
init.background_class||"";if(typeof background_style!="undefined")h.add_style(main,background_style);if(typeof background_beyond_max_style!="undefined"||typeof background_beyond_max_class!="undefined"){main.background_beyond_max=document.createElement("div");main.background_beyond_max.className=init.background_beyond_max_class||"";h.add_style(main.background_beyond_max,background_beyond_max_style||"");main.appendChild(main.background_beyond_max)}main.foreground_container=document.createElement("div");
h.add_style(main.foreground_container,"position: relative; overflow: hidden; "+width_height+": 100%; line-height: 0");main.foreground_container.className=foreground_container_class||"";h.add_style(main.foreground_container,foreground_container_style||"");main.appendChild(main.foreground_container);main.foreground_container.style.pointerEvents="none";main.foreground=document.createElement("div");main.foreground.className=foreground_class||"";h.add_style(main.foreground,foreground_style||"");main.foreground_container.appendChild(main.foreground);
main.foreground.style.pointerEvents="none";main.foreground_inverse=document.createElement("div");main.foreground_inverse.className=foreground_inverse_class||"";h.add_style(main.foreground_inverse,foreground_inverse_style||"");main.foreground_container.appendChild(main.foreground_inverse);main.foreground_inverse.style.pointerEvents="none";var control_element_type=typeof control_image_src!="undefined"?"img":"div";main.control=document.createElement(control_element_type);main.control.style.pointerEvents=
"none";main.control.className=control_class||"";h.add_style(main.control,control_style||"");if(typeof control_image_src!="undefined")main.control.src=control_image_src;main.appendChild(main.control);if(typeof pivot_slice_style!="undefined"){main.pivot_slice=document.createElement("div");main.pivot_slice.className=pivot_slice_class||"";h.add_style(main.pivot_slice,pivot_slice_style||"");main.appendChild(main.pivot_slice)}main.update=function(){update(main)};main.update();var startscroll=false,startxy=
0,offsetxy=0;if(use_mouse_events){main.addEventListener("mousedown",mousedown);main.addEventListener("mouseover",mousemove);main.addEventListener("mousemove",mousemove);document.addEventListener("mouseup",mouseup_or_blur);window.addEventListener("blur",mouseup_or_blur);window.addEventListener("mouseout",mouseout)}if(use_touch_events){main.addEventListener("touchstart",touchstart);main.addEventListener("touchmove",mousemove);document.addEventListener("touchend",mouseup_or_blur);window.addEventListener("touchcancel",
mouseup_or_blur);window.addEventListener("touchleave",mouseup_or_blur)}if(main.textbox){document.removeEventListener(!use_touch_events?"mousedown":"touchstart",textbox_blur);textbox_number.removeEventListener(!use_touch_events?"click":"touchend",textbox_focus);textbox_number.removeEventListener("input",textbox_change);textbox_number.removeEventListener("keypress",textbox_keypress)}main.update_position=function(pxc,zoom_level){if(typeof pxc=="undefined")pxc=px_to_css_unit_type();if(typeof zoom_level==
"undefined")zoom_level=calculate_zoom_level();startxy=findabspos_zoom(main)/(pxc*zoom_level)};main.set_position=function(new_position,trigger_update_event,pxc,evt){return set_position(new_position,trigger_update_event,pxc,evt)};main.set_position_percent=function(new_point_value,trigger_update_event,evt){main.set_position(main.position_physical_max*new_point_value/main.point_upper_limit,trigger_update_event,px_to_css_unit_type(),evt)};main.get_position_percent=function(){return main.position/main.position_physical_max*
main.point_upper_limit};main.destroy=function(){return destroy(main,use_mouse_events,use_touch_events)};var MutationObserver=window.MutationObserver||window.WebkitMutationObserver;if(typeof MutationObserver!="undefined"){var observer=new MutationObserver(function(mutation_list){for(var i=0,curlen_i=mutation_list.length;i<curlen_i;i++){var mutation_item=mutation_list[i];if(mutation_item.type!="childList")return;for(var j=0,curlen_j=mutation_item.removedNodes.length;j<curlen_j;j++){if(mutation_item.removedNodes[j]!=
main)continue;main.destroy();observer.disconnect();return}}});observer.observe(parent,{attributes:false,childList:true,subtree:false})}return main;function px_to_css_unit_type(){if(main.css_unit_type=="px")return 1;if(!main.recalculate_size&&typeof px_to_css_unit_type_fixed!="undefined")return px_to_css_unit_type_fixed;var mydiv=document.createElement("div");mydiv.style.visibility="hidden";mydiv.style.width="1"+main.css_unit_type;parent.appendChild(mydiv);var w=mydiv.getBoundingClientRect().width;
parent.removeChild(mydiv);if(!main.recalculate_size)px_to_css_unit_type_fixed=w;return w}function calculate_physical_max(pxc,zoom_level){if(typeof zoom_level=="undefined")zoom_level=calculate_zoom_level();if(typeof pxc=="undefined")pxc=px_to_css_unit_type();var style=window.getComputedStyle(main);var box_sizing=style.boxSizing!=""?style.boxSizing:style.mozBoxSizing;if(box_sizing=="border-box")var border_and_padding_adjustment=0;else var border_and_padding_adjustment=orientation=="horizontal"?parseFloat(window.getComputedStyle(main).borderLeftWidth)+
parseFloat(window.getComputedStyle(main).borderRightWidth):parseFloat(window.getComputedStyle(main).borderTopWidth)+parseFloat(window.getComputedStyle(main).borderBottomWidth);border_and_padding_adjustment+=orientation=="horizontal"?parseFloat(window.getComputedStyle(main).paddingLeft)+parseFloat(window.getComputedStyle(main).paddingRight):parseFloat(window.getComputedStyle(main).paddingTop)+parseFloat(window.getComputedStyle(main).paddingBottom);if(isNaN(border_and_padding_adjustment))border_and_padding_adjustment=
0;var is_not_border_box=box_sizing!="border-box"?1:0;return(main.getBoundingClientRect()[width_height]-main.control.getBoundingClientRect()[width_height])/(pxc*zoom_level)-border_and_padding_adjustment/pxc-main.control_unit_offset*2}function calculate_zoom_level(){if(!main.recalculate_size&&typeof zoom_level_fixed!="undefined")return zoom_level_fixed;var zoom_level=h.get_inherited_transform(main,{transform_type:"scale",xy:orientation_xy});if(!main.recalculate_size)zoom_level_fixed=zoom_level;return zoom_level}
function textbox_change(evt){var curvalue=parseFloat(textbox_number.value);if(isNaN(curvalue)||curvalue<0)curvalue=0;if(curvalue>main.point_upper_limit)curvalue=main.point_upper_limit;main.set_position_by_point_value(curvalue)}function textbox_keypress(evt){var keyCode=evt.keyCode;if(keyCode==13)textbox_number.blur()}function textbox_update_value(pxc){if(typeof pxc=="undefined")pxc=px_to_css_unit_type();textbox_number.value=Math.round(main.point_upper_limit*main.position/calculate_physical_max(pxc))}
function textbox_blur(evt){if(main.textbox_enabled==false)return;if(evt.currentTarget==textbox_number)return;textbox_number.blur()}function textbox_focus(evt){if(main.textbox_enabled==true)return;if(evt.currentTarget==textbox_number)return;textbox_number.focus()}function update_foreground_width_height(){main.foreground.style[width_height]=(main.position+main.control_unit_offset>=0?main.position:0)+main.css_unit_type}function mousedown(evt){evt.preventDefault();if(evt.target!=evt.currentTarget)return;
if(h.get_right_click(evt)||main.start_condition&&!main.start_condition(main)||startscroll==true)return;var pxc=px_to_css_unit_type();var zoom_level=calculate_zoom_level();main.update_position(pxc,zoom_level);offsetxy=main.control.getBoundingClientRect()[width_height]/2/(zoom_level*pxc);startscroll=true;mousemove(evt,pxc,zoom_level)}function touchstart(evt){mousemove(evt);mousedown(evt)}function mousemove(evt,pxc,zoom_level){if(evt.currentTarget==main)evt.preventDefault();if(startscroll==false)return;
if(typeof pxc=="undefined")pxc=px_to_css_unit_type();if(typeof zoom_level=="undefined")zoom_level=calculate_zoom_level();var xy=(evt.changedTouches?evt.changedTouches[0]:evt)[pageXY]/(zoom_level*pxc);main.set_position(xy-offsetxy-startxy-main.control_unit_offset,true,pxc,evt)}function mouseout(evt){evt.preventDefault();var coords=evt.changedTouches?evt.changedTouches[0]:evt;var mouseX=coords.pageX,mouseY=coords.pageY;var windowScrollX=typeof window.scrollX!="undefined"?window.scrollX:document.body.scrollLeft;
var windowScrollY=typeof window.scrollY!="undefined"?window.scrollY:document.body.scrollTop;if(mouseY>=0&&mouseY<=window.innerHeight+windowScrollY&&(mouseX>=0&&mouseX<=window.innerWidth+windowScrollX))return;mouseup_or_blur(evt)}function mouseup_or_blur(evt){if(startscroll==false)return;if(evt.target!=main)main.events.update(main,evt);else mousemove(evt,px_to_css_unit_type(),calculate_zoom_level());startscroll=false}function update(main){var pxc=px_to_css_unit_type();var zoom_level=calculate_zoom_level();
main.position_physical_max=calculate_physical_max(pxc,zoom_level);if(main.point_upper_limit!=0)main.position_logical_max=main.position_physical_max*(main.point_maximum/main.point_upper_limit);if(typeof main.position!="undefined"&&main.position_logical_max!=0)var logical_position=main.position/main.position_logical_max;if(typeof main.position=="undefined"){if(main.point_upper_limit!=0)main.position=main.position_physical_max*(point_initial/main.point_upper_limit)}else if(typeof main.position_logical_max!=
"undefined"&&typeof logical_position!="undefined")main.position=logical_position*main.position_logical_max;main.control.style[left_top]=main.position+main.control_unit_offset+main.css_unit_type;update_foreground_width_height();if(typeof background_beyond_max_style!="undefined"||typeof background_beyond_max_class!="undefined"){main.background_beyond_max.style[width_height]=main.position_physical_max-main.position_logical_max+main.css_unit_type;main.background_beyond_max.style[left_top]=main.position_logical_max+
main.css_unit_type}if(typeof pivot_slice_style!="undefined"){main.pivot_start=main.position_physical_max*(main.pivot_point/main.point_upper_limit);main.pivot_end=main.position;main.pivot_slice.style[width_height]=Math.abs(main.pivot_end-main.pivot_start)+main.css_unit_type;main.pivot_slice.style[left_top]=(main.pivot_end>main.pivot_start?main.pivot_start:main.pivot_end)+main.css_unit_type}if(main.textbox)textbox_update_value(pxc)}function set_position(new_position,trigger_update_event,pxc,evt){main.position=
new_position;main.position_logical_max=main.position_physical_max*(main.point_maximum/main.point_upper_limit);if(main.position>main.position_logical_max)main.position=main.position_logical_max;else if(main.position<0)main.position=0;main.control.style[left_top]=main.position+main.control_unit_offset+main.css_unit_type;update_foreground_width_height();if(typeof pivot_slice_style!="undefined"){main.pivot_start=main.position_physical_max*(main.pivot_point/main.point_upper_limit);main.pivot_end=main.position;
update_foreground_width_height()}if(main.textbox_enabled==true)textbox_update_value(pxc);if(trigger_update_event&&main.events.update)main.events.update(main,evt)}function destroy(main,use_mouse_events,use_touch_events){if(use_mouse_events){main.removeEventListener("mousedown",mousedown);main.removeEventListener("mouseover",mousemove);main.removeEventListener("mousemove",mousemove);document.removeEventListener("mouseup",mouseup_or_blur);window.removeEventListener("blur",mouseup_or_blur);window.removeEventListener("mouseout",
mouseout)}if(use_touch_events){main.removeEventListener("touchstart",touchstart);main.removeEventListener("touchmove",mousemove);document.removeEventListener("touchend",mouseup_or_blur);window.removeEventListener("touchcancel",mouseup_or_blur);window.removeEventListener("touchleave",mouseup_or_blur)}if(main.textbox){document.removeEventListener(!use_touch_events?"mousedown":"touchstart",textbox_blur);textbox_number.removeEventListener(!use_touch_events?"click":"touchend",textbox_focus);textbox_number.removeEventListener("input",
textbox_change);textbox_number.removeEventListener("keypress",textbox_keypress)}var current_parent=main.parentNode;if(current_parent!=null)current_parent.removeChild(main)}};h.red_blue_arrow=function(init){var parent=init["parent"];var style=init["style"];var main=document.createElement("div");parent.appendChild(main);main.thickness=parseFloat(init["thickness"]);main.bar_length=parseFloat(init["bar length"]);main.tip_length=parseFloat(init["tip length"]);main.left=document.createElement("img");main.appendChild(main.left);
main.middle=document.createElement("img");main.appendChild(main.middle);main.right=document.createElement("img");main.appendChild(main.right);if(typeof main.thickness=="undefined")main.thickness="63px";if(typeof main.bar_length=="undefined")main.bar_length="428px";if(typeof main.tip_length=="undefined")main.tip_length="32px";main.left.src="images/gui/interface-blue-red arrow left.png";setStyle(main.left,"position:absolute; height:"+main.thickness+"px; width:"+main.tip_length+"px; top:0; left:0");
main.middle.src="images/gui/interface-blue-red arrow middle.png";setStyle(main.middle,"position:absolute; height:"+main.thickness+"px; width:"+main.bar_length+"px; top:0; left:"+main.tip_length+"px");main.right.src="images/gui/interface-blue-red arrow right.png";setStyle(main.right,"position:absolute; height:"+main.thickness+"px; width:"+main.tip_length+"px; top:0; left:"+(main.tip_length+main.bar_length)+"px");setStyle(main,style);main.style.display="inline-block";main.style.width=main.tip_length*
2+main.bar_length+"px";main.style.height=main.thickness+"px";return main};h.loadingbar_object=function(init){var loadingbar=document.createElement("div");loadingbar.parent=init.parent;loadingbar.loading_string=init.loading_string||"Loading... ";loadingbar.percent=init.percent||0;loadingbar.show_percent=init.show_percent||true;loadingbar.loadinginnerbar=document.createElement("div");loadingbar.loadingouterbar=document.createElement("div");var loadingbar_position=typeof init.position!="undefined"?init.position:
"absolute";setStyle(loadingbar,"position:"+loadingbar_position+"; z-index:0; width:50%; height:2.5em; border: 1px solid #8F8F8F");setStyle(loadingbar.loadingouterbar,"position:absolute; left:0; top:0; height:100%; width:100%; background-color:#8F0000");setStyle(loadingbar.loadinginnerbar,"position:absolute; left:0; top:0; height:100%; width:0%; background-color:#FFFFFF");loadingbar.loadingbartext1=document.createElement("div");setStyle(loadingbar.loadingbartext1,"position:absolute; left:0; top:0; margin:.125em; width:100%; text-align:center; color:#C0C0C0; font-size:1.5em; font-family:arial; display:block");
loadingbar.appendChild(loadingbar.loadingouterbar);loadingbar.appendChild(loadingbar.loadinginnerbar);loadingbar.appendChild(loadingbar.loadingbartext1);loadingbar.parent.appendChild(loadingbar);if(loadingbar_position=="absolute"){loadingbar.style.left=parseFloat((loadingbar.parent.clientWidth-loadingbar.clientWidth)/2)+"px";loadingbar.style.top=parseFloat((loadingbar.parent.clientHeight-loadingbar.clientHeight)/2)+"px"}else if(loadingbar_position=="fixed"){loadingbar.style.left="50%";loadingbar.style.top=
"50%";loadingbar.style.marginLeft=-(loadingbar.clientWidth/2)+"px";loadingbar.style.marginTop=-(loadingbar.clientHeight/2)+"px"}loadingbar.set_percent=function(percent){loadingbar.percent=percent;loadingbar.update()};loadingbar.add_percent=function(percent_to_add){loadingbar.percent+=percent_to_add;loadingbar.update()};loadingbar.update=function(){var rounded_percent=Math.round(loadingbar.percent);if(rounded_percent>=100){remove_all_descendants_and_self(loadingbar);return}var percentstring=rounded_percent.toString();
loadingbar.loadinginnerbar.style.width=percentstring+"%";loadingbar.loadingbartext1.innerHTML=loadingbar.loading_string+(loadingbar.show_percent==true?percentstring+"% done.":"")};loadingbar.update();return loadingbar}}if(h.library_settings.dom_manipulation){["forEach"].forEach(function(op){h.proto.NodeList[op]=h.proto.HTMLCollection[op]=function(obj,callback,thisArg){return Array.prototype.slice.call(obj)[op](callback,thisArg)}});h.proto.HTMLElement.is_attached=function(obj){while(true){obj=obj.parentNode;
if(obj==document.documentElement)return true;if(obj==null)return false}};h.proto.HTMLElement.append_children_of=function(obj,source){while(source.firstChild)obj.appendChild(source.firstChild);return obj};h.proto.HTMLElement.set_position_on_left=function(obj){var marginLeft_stored=parseFloat(window.getComputedStyle(obj)["marginLeft"]);var width_stored=obj.offsetWidth;obj.style.marginLeft=-width_stored+"px";obj.style.left=width_stored-marginLeft_stored+"px"};h.proto.HTMLElement.set_position_on_right=
function(obj){var marginRight_stored=parseFloat(window.getComputedStyle(obj)["marginRight"]);var width_stored=obj.offsetWidth;obj.style.marginRight=-width_stored+"px";obj.style.right=width_stored+marginRight_stored+"px";return obj};h.proto.HTMLElement.set_position_on_center=function(obj){obj.style.left=(get_client_width_full(obj.parentNode,{margin:obj})-get_client_width_full(obj,{margin:obj}))/2+"px";return obj};h.get_caret_position=function(obj){if(obj.selectionStart)return obj.selectionStart;if(document.selection){obj.focus();
var r=document.selection.createRange();if(r==null)return 0;var re=obj.createTextRange();rc=re.duplicate();re.moveToBookmark(r.getBookmark());rc.setEndPoint("EndToStart",re);return rc.text.length}return 0};h.set_caret_position=function(obj,pos){if(obj.setSelectionRange){obj.focus();obj.setSelectionRange(pos,pos)}else if(obj.createTextRange){var range=obj.createTextRange();range.collapse(true);range.moveEnd("character",pos);range.moveStart("character",pos);range.select()}};h.set_scrolltop=function(amount,
obj){if(typeof obj=="undefined"||obj==null)if(typeof window.opera=="undefined"){document.body.scrollTop-=amount;document.documentElement.scrollTop-=amount}};h.clearfocus=function(){var hocuspocus=document.createElement("input");document.body.appendChild(hocuspocus);hocuspocus.focus();document.body.removeChild(hocuspocus);hocuspocus=null};h.set_style=function(element,text){if(typeof element=="object"&&element instanceof Array){element.forEach(function(current_element){setStyle(current_element,text)});
return}element.setAttribute("style",check_for_missing_properties(element,text))};var add_style=h.add_style=function(element,text){if(typeof element=="object"&&element instanceof Array){element.forEach(function(current_element){add_style(current_element,text)});return}if(element.getAttribute("style")==null){element.setAttribute("style",check_for_missing_properties(element,text));return}element.setAttribute("style",check_for_missing_properties(element,element.getAttribute("style"))+"; "+text)};var check_for_missing_properties=
h.check_for_missing_properties=function(element,text){if(!getComputedStyle(document.documentElement,null)["BoxSizing"]&&!!getComputedStyle(document.documentElement,null)["MozBoxSizing"])text=text.replace(/box-sizing/g,"-moz-box-sizing");return text};h.get_vendor_specific_property_name=function(){var prefixes=["Moz","Webkit","Khtml","O","Ms"];element=element||document.documentElement;var style=element.style,prefixed;if(typeof style[propName]=="string")return propName;propName=propName.charAt(0).toUpperCase()+
propName.slice(1);for(var i=0,l=prefixes.length;i<l;i++){prefixed=prefixes[i]+propName;if(typeof style[prefixed]=="string")return prefixed}};h.get_stylesheet_property_value=function(class_name,property_name){var temp=document.createElement("div");temp.class_name=class_name;document.body.appendChild(temp);if(window.getComputedStyle)var property_value=window.getComputedStyle(temp,null).getPropertyValue(property_name);else if(temp.currentStyle)var property_value=temp.currentStyle[property_name];else var property_value=
null;document.body.removeChild(temp);return property_value};h.add_stylesheet_rule=function(obj,new_rule){if(typeof obj.styleSheetRuleAmount=="undefined")obj.styleSheetRuleAmount=0;if(typeof obj.styleSheetRuleArray=="undefined")obj.styleSheetRuleArray=[];document.styleSheets[0].insertRule(new_rule,0);obj.styleSheetRuleArray.push(new_rule);obj.styleSheetRuleAmount+=1};h.remove_all_stylesheet_rules=function(obj){if(typeof obj.styleSheetRuleAmount=="undefined")return;var curlen=obj.styleSheetRuleAmount;
var styleSheetRuleArray=obj.styleSheetRuleArray;for(var i=0;i<curlen;i++)document.styleSheets[0].deleteRule(styleSheetRuleArray[i]);obj.styleSheetRuleArray=[];obj.styleSheetRuleAmount=0};var remove_all_descendants_and_self=h.remove_all_descendants_and_self=function(cell){if(cell.hasChildNodes())while(cell.childNodes.length>0)remove_all_descendants_and_self(cell.firstChild);if(cell.parentNode)cell.parentNode.removeChild(cell);if(cell==window.cell)delete window.cell;cell=null};var remove_all_descendants=
h.remove_all_descendants=function(cell){var childNodes=cell.childNodes;if(!childNodes)return;var childNodes=Array.prototype.slice.call(childNodes);for(var i=0,curlen=childNodes.length;i<curlen;i++){remove_all_descendants(childNodes[i]);cell.removeChild(childNodes[i])}};var get_client_width_full=h.get_client_width_full=function(obj,init){var style=window.getComputedStyle(obj);if(typeof init!="undefined"&&typeof init.margin!="undefined"&&init.margin==true)var margin=parseFloat(style.marginLeft)+parseFloat(style.marginRight);
else var margin=0;return obj.clientWidth+margin+parseFloat(style.borderLeftWidth)+parseFloat(style.borderRightWidth)};h.get_client_height_full=function(obj,init){var style=window.getComputedStyle(obj);if(typeof init!="undefined"&&typeof init.margin!="undefined"&&init.margin==true)var margin=parseFloat(style.marginTop)+parseFloat(style.marginBottom);else var margin=0;return obj.clientHeight+margin+parseFloat(style.borderTopWidth)+parseFloat(style.borderBottomWidth)};h.get_document_scroll_position=
function(){return Array(document.documentElement&&document.documentElement.scrollLeft||window.pageXOffset||self.pageXOffset||document.body.scrollLeft,document.documentElement&&document.documentElement.scrollTop||window.pageYOffset||self.pageYOffset||document.body.scrollTop)};h.prevent_context_menu=function(obj,do_prevent,omitformtags){if(typeof do_prevent=="undefined"||do_prevent==true){if(typeof omitformtags=="undefined"){var omitformtags=["input","textarea","select","span","p","h1","h2","h3","h4",
"h5","h6","td","tr","th"];var omitformtags=omitformtags.join("|")}void function(omitformtags){function contextmenu_event_handler(evt){var current_target=evt.target;if(typeof current_target.tagName=="undefined")return;if(omitformtags.indexOf(current_target.tagName.toLowerCase())!=-1)return true;evt.preventDefault();return false}obj.oncontextmenu=contextmenu_event_handler}(omitformtags)}else obj.oncontextmenu=null};h.move_to_top=function(evt){var obj=evt.currentTarget,parent=obj.parentNode;if(parent.childNodes[parent.childNodes.length-
1]==obj)return;parent.appendChild(obj)};h.disable_selection=function(obj){obj.setAttribute("unselectable","on");obj.style.WebkitTapHighlightColor="rgba(255, 255, 255, 0)";obj.style.WebkitHighlightColor="transparent";obj.style.MozUserSelect="none";obj.style.OUserSelect="none";obj.style.KhtmlUserSelect="none";obj.style.WebkitUserSelect="none";obj.style.MsUserSelect="none";obj.style.userSelect="none"};h.enable_selection=function(obj){obj.setAttribute("unselectable","off");obj.style.WebkitTapHighlightColor=
"";obj.style.WebkitHighlightColor="";obj.style.MozUserSelect="text";obj.style.OUserSelect="text";obj.style.KhtmlUserSelect="text";obj.style.WebkitUserSelect="text";obj.style.MsUserSelect="text";obj.style.userSelect="text"};h.add_background_filter_image=function(init){var parent=init.parent;var filter_image=init.filter;var opacity=init.opacity||100;var zIndex=init.zIndex||100;var filter=document.createElement("img");filter.src=filter_image;filter.style.position="absolute";filter.style.border=0;filter.style.margin=
0;filter.style.padding=0;filter.style.left=0;filter.style.top=0;filter.style.width="100%";filter.style.height="100%";filter.style.display="block";filter.style.zIndex=zIndex;filter.style.opacity=opacity;parent.appendChild(filter);this.remove=function(){if(filter.parentNode==null)return;filter.parentNode.removeChild(filter)}};h.hide_siblings=function(obj){var parent=obj.parentNode;for(var i=0,curlen=parent.childNodes.length;i<curlen;i++){var current_child=parent.childNodes[i];if(current_child==obj){obj.style.display=
null;continue}current_child.style.display="none"}};h.make_label_and_input=function(init){var parent=init.parent;var label_text=init.label;var input_name=init.name;var pre=init.pre;var post=init.post;var input_type=init.input_type;var input_attributes=init.input_attributes;var input_sub_elements=init.input_sub_elements;var input_element=init.input_element;var use_default_styles=typeof init.use_default_styles=="undefined"?true:init.use_default_styles;var nest_input=typeof init.nest_input=="undefined"?
false:init.nest_input;var main=document.createElement("div");if(use_default_styles)main.style.display="block";var label=document.createElement("label");label.innerHTML=label_text;if(typeof pre!="undefined"){var templabel=document.createElement("div");templabel.innerHTML=pre;label.appendChild(templabel);if(use_default_styles){templabel.style.display="inline-block";templabel.style.right=0;templabel.style.verticalAlign="middle";templabel.style.position="absolute"}}if(typeof input_type=="undefined")input_type=
"text";if(typeof input_element=="undefined")input_element="input";var input=document.createElement(input_element);if(typeof init.value!="undefined")input.value=init.value;if(typeof init.disabled!="undefined")input.disabled=init.disabled;if(typeof init.readonly!="undefined"){if(init.readonly==true)init.readonly="readonly";input.readOnly=init.readonly}if(input_element=="input")input.type=input_type;input.oncontextmenu=function(){return true};input.name=input_name;if(typeof init.checked!="undefined")input.checked=
init.checked;if(use_default_styles)input.style.display="inline-block";if(nest_input==true){var input_wrapper=document.createElement("span");input_wrapper.className=typeof init.input_wrapper_cssclass!="undefined"?init.input_wrapper_cssclass:"input_wrapper_default";if(typeof init.input_wrapper_style!="undefined")add_style(input_wrapper,init.input_wrapper_style);input_wrapper.appendChild(input)}var input_to_append=nest_input==true?input_wrapper:input;if(init.input_first==true){main.appendChild(input_to_append);
main.appendChild(label)}else{main.appendChild(label);main.appendChild(input_to_append)}if(typeof post!="undefined"){var templabel=document.createElement("div");templabel.innerHTML=post;if(use_default_styles)templabel.style.display="inline-block";main.appendChild(templabel)}main.className=typeof init.cssclass!="undefined"?init.cssclass:"input_main_default";label.className=typeof init.label_cssclass!="undefined"?init.label_cssclass:"input_label_default";input.className=typeof init.input_cssclass!="undefined"?
init.input_cssclass:"input_input_default";if(typeof init.label_style!="undefined")add_style(label,init.label_style);if(typeof init.input_style!="undefined")add_style(input,init.input_style);if(typeof init.style!="undefined")add_style(main,init.style);for(var attribute_name in input_attributes)input[attribute_name]=input_attributes[attribute_name];if(typeof input_sub_elements!="undefined"){var curlen=input_sub_elements.length;for(var i=0;i<curlen;i++)input.appendChild(input_sub_elements[i])}parent.appendChild(main);
main.input=input;main.label=label;return main};h.make_text=function(init){var parent=init.parent;if(typeof init.element_type=="undefined")init.element_type="p";if(typeof init.link!="undefined"){var text_element=document.createElement("a");text_element.href=init.link}else var text_element=document.createElement(init.element_type);text_element.innerHTML=init.text;if(typeof init.cssclass!="undefined")text_element.className=init.cssclass;if(typeof init.style!="undefined")add_style(text_element,init.style);
parent.appendChild(text_element);return text_element};h.prevent_native=function(obj,native_function){obj[native_function]=function(){throw new Error('Error: "'+native_function+'()" is not allowed for this object!');}};h.append_br=function(parent){return parent.appendChild(document.createElement("br"))};h.set_display_based_on_children=function(obj,regular_display){var children=obj.childNodes,curlen=children.length,all_hidden=true,new_display="none";for(var i=0;i<curlen;i++)if(children[i].style.display!=
"none"){new_display=regular_display;all_hidden=false;break}obj.style.display=new_display};h.set_object_class_by_value=function(init){var key_value_list=init.key_value_list,class_name_string="";if(!(init.value instanceof Array))var value=[init.value];else var value=init.value;var curlen=init.value;for(var i=0;i<curlen;i++)class_name_string+=init.key_value_list[value[i]];init.obj.className=class_name_string};h.convert_form_elements_to_string=function(form_obj){var input_elements=form_obj.elements;var curlen=
input_elements.length;var result_string="";for(var i=0;i<curlen;i++){var curelement=input_elements[i];if(typeof curelement.name=="undefined"||curelement.name=="")continue;if(curelement.type=="select-multiple"&&curelement.multiple==true){var result_list=[];var curlen_j=curelement.options.length;for(var j=0;j<curlen_j;j++){var current_option=curelement.options[j];if(current_option.selected==false)continue;result_list.push(encodeURIComponent(current_option.value))}var result_value=result_list.join(",")}else{if(curelement.type==
"radio"||curelement.type=="checkbox")if(curelement.checked==false)continue;var result_value=encodeURIComponent(curelement.value)}result_string+="\x26"+curelement.name+"\x3d"+result_value}return result_string};h.make_label_and_textbox=function(init){var textarea=document.createElement("textarea");textarea.rows=init.rows;var merged_init=merge_objects({primary:init,secondary:{input_type:textarea}});return make_label_and_input(merged_init)};h.parent_get_elements_by_name=function(parent,test_name){var elements=
[parent.getElementsByTagName("*")];var result_array=[];var curlen_i=elements.length;for(var i=0;i<curlen_i;i++){var sub_elements=elements[i];var curlen_j=sub_elements.length;for(var j=0;j<curlen_j;j++)if(sub_elements[j].getAttribute("name")==test_name)result_array.push(sub_elements[j])}return result_array};h.focus_default_text=function(focus_obj,default_text){if(focus_obj.value==default_text)focus_obj.value=""};h.blur_default_text=function(focus_obj,default_text){if(focus_obj.value=="")focus_obj.value=
default_text};h.create_dom_option_list=function(option_text_array){var curlen=option_text_array.length;var dom_option_list=new Array(curlen);for(var i=0;i<curlen;i++){var current_option_data=option_text_array[i];var current_option=document.createElement("option");dom_option_list[i]=current_option;switch(typeof current_option_data){case "string":current_option.value=current_option_data;current_option.innerHTML=capitalize_first_letter(current_option_data);break;case "number":current_option.value=current_option_data;
current_option.innerHTML=current_option_data;break;default:for(var attribute_name in current_option_data)current_option[attribute_name]=current_option_data[attribute_name];break}}return dom_option_list};h.get_data_string_from_input_list=function(input_object_list){var data_array=[];for(var input_object_name in input_object_list){var current_string_fragment="\x26"+input_object_name+"\x3d"+encodeURIComponent(input_object_list[input_object_name].input.value);data_array.push(current_string_fragment)}return data_array.join("")};
h.create_empty_dom_row=function(init){var row=document.createElement(init.dom_type);var leftdiv=document.createElement(init.leftdiv_dom_type);leftdiv.className=init.leftdiv_cssclass;setStyle(leftdiv,init.leftdiv_style);row.appendChild(leftdiv);var rightdiv=document.createElement(init.rightdiv_dom_type);rightdiv.className=init.rightdiv_cssclass;setStyle(rightdiv,init.rightdiv_style);row.appendChild(rightdiv);row.className=init.cssclass;setStyle(row,init.style);var parent=init.parent;init.parent.appendChild(row);
row.leftdiv=leftdiv;row.rightdiv=rightdiv;return row};h.set_to_biggest_width=function(arr){var biggest_width=0;arr.forEach(function(obj){if(biggest_width<obj.offsetWidth)biggest_width=obj.offsetWidth});arr.forEach(function(obj){obj.style.width=biggest_width+"px"})};h.dom_object_intersects_line=function(obj,x,y){var xy=findabspos(obj);if(x<xy[0])return false;if(y<xy[1])return false;if(xy[0]+obj.clientWidth>x)return false;if(xy[1]+obj.clientHeight>y)return false;return true};h.timed_remove=function(element,
ms){return setTimeout(function(){parent=element.parentNode;if(parent==null)return;parent.removeChild(element)},ms)};h.dom_to_static_element_list=function(html_collection){return Array.prototype.slice.call(html_collection)};h.convert_to_px_units=function(parent,measure){var mydiv=document.createElement("div");mydiv.style.visibility="hidden";mydiv.style.width="1"+measure;parent.appendChild(mydiv);w=mydiv.getBoundingClientRect().width;parent.removeChild(mydiv);return w};h.get_rem_units=function(obj,
property){return parseFloat(window.getComputedStyle(obj)[property])/parseFloat(document.documentElement.style.fontSize)};h.css_set_scale=function(sw,sh,obj){obj.setAttribute("transform","scale("+sw+" "+sh+")")};h.table_add_headers=function(init){function resort(evt){var attribute_name=evt.currentTarget.sort_attribute;var curlen=sort_order.length;for(var i=0;i<curlen;i++){if(sort_order[i][0]!=attribute_name)continue;var attribute_direction=sort_order[i][1];if(i==0)attribute_direction=!attribute_direction;
sort_order.splice(i,1);sort_order.splice(0,0,[attribute_name,attribute_direction])}if(typeof sort_callback!="undefined")sort_callback()}var parent=init.parent;var header_list=init.header_list;var sort_order=init.sort_order;var sort_callback=init.sort_callback;var temp_tr=document.createElement("tr");parent.appendChild(temp_tr);var curlen=header_list.length;for(var i=0;i<curlen;i++){var temp_th=document.createElement("th");temp_th.style.cursor="pointer";if(typeof header_list[i]=="string"){var header_text=
header_list[i];temp_th.sort_attribute=header_text.toLowerCase()}else{var header_text=header_list[i].text.toLowerCase();temp_th.sort_attribute=header_list[i].attribute.toLowerCase()}temp_th.innerHTML=capitalize_first_letter(header_text);if(typeof sort_order!="undefined")addEvent(temp_th,"click",resort);temp_tr.appendChild(temp_th)}};h.sort_by_order=function(obj,order_list){obj.sort(function(a,b){var curlen=order_list.length;for(var i=0;i<curlen;i++){var attribute_name=order_list[i][0];var sort_down=
order_list[i][1];var custom_function=order_list[i][2];if(typeof custom_function!="undefined"){var result=custom_function(a[attribute_name],b[attribute_name]);if(result!=0)if(sort_down)return result;else return-result;continue}if(a[attribute_name]!=b[attribute_name])if(sort_down==true)if(a[attribute_name]>b[attribute_name])return 1;else return-1;else if(a[attribute_name]<b[attribute_name])return 1;else return-1}return 0})};var dom=h.dom={};dom.enhanceNative=function(nativeToEnhanceList){var enhanceList=
{"addEventListener":function(){var addEventListenerNative=HTMLElement.prototype.addEventListener;HTMLElement.prototype.addEventListener=function(){var args=Array.prototype.slice.call(arguments);if(typeof args[0]=="string"){addEventListenerNative.apply(this,args);return}if(Array.isArray(args[0])){var args0=args[0];args0.forEach(function(eventName){args[0]=eventName;addEventListenerNative.apply(this,args)},this)}}}};if(nativeToEnhanceList=="all"){enhanceList.forEach(function(func){func()});return}if(!Array.isArray(nativeToEnhanceList))nativeToEnhanceList=
[nativeToEnhanceList];nativeToEnhanceList.forEach(function(nativeToEnhance){if(nativeToEnhance in enhanceList)enhanceList[nativeToEnhance]()})};dom.removeEventListeners=function(element){element.dom.eventListenerArgumentList.forEach(function(eventListenerArgs){element.removeEventListener.apply(element,eventListenerArgs)});element.dom.eventListenerArgumentList=[]};dom.enableEventListenerTracking=function(element){element.addEventListenerOriginal=element.addEventListener;element.dom.eventListenerArgumentList=
[];element.addEventListener=function(){var args=Array.prototype.slice.call(arguments);element.dom.eventListenerArgumentList.push(args);element.addEventListenerOriginal.apply(element,args)};this.removeEventListenerOriginal=element.removeEventListener;this.removeEventListener=function(){var args=Array.prototype.slice.call(arguments);element.dom.eventListenerArgumentList.some(function(eventListenerArgs){if(eventListenerArgs.length!=args.length)return;return args.every(function(param,i){return param===
eventListenerArgs[i]})});element.removeEventListenerOriginal.apply(element,args)}};dom.setWidthLikeDiv=function(input){dom.matchElementDimensions(input,"width","inline-block","left","right","div")};dom.setHeightLikeDiv=function(input){dom.matchElementDimensions(input,"height","block","top","bottom","div")};dom.matchElementDimensions=function(input,dimension,temp_display_type,min_edge,max_edge,temporary_element_type){function capitalize(obj){return obj.toLowerCase().replace(/^[a-z]|\s[a-z]/g,conv);
function conv(){return arguments[0].toUpperCase()}}var dimension_c=capitalize(dimension),min_edge_c=capitalize(min_edge),max_edge_c=capitalize(max_edge);input.style[dimension]="";var s=window.getComputedStyle(input);var cousin=document.createElement(temporary_element_type);cousin.style.display=temp_display_type;(new Array("paddingLeft","paddingRight","paddingTop","paddingBottom","fontFamily","fontSize","fontWeight","letterSpacing","fontKerning","lineHeight","textIndent")).forEach(function(p){cousin.style[p]=
s[p]});cousin.innerHTML=input.value.replace(/[\n\r]/g,"\x3cbr/\x3e\x26nbsp;").replace(/^$/,"\x26nbsp;").replace(/ +$/,function(count){return"\x26nbsp;".repeat(count.length)});input.parentNode.insertBefore(cousin,input);input.style[dimension]=cousin["client"+dimension_c]+parseFloat(s["border"+min_edge_c+"Width"])+parseFloat(s["border"+max_edge_c+"Width"])+parseFloat(s["margin"+min_edge_c])+parseFloat(s["margin"+max_edge_c])+"px";cousin.parentNode.removeChild(cousin)};dom.isAttached=function(obj){while(true){obj=
obj.parentNode;if(obj==document.documentElement)return true;if(obj==null)return false}};dom.appendChildren=function(init){var parent=init.parent,children=init.children;children.forEach(function(child){parent.appendChild(child)})};dom.detachAll=function(parent,recursive){Array.prototype.slice.call(parent.childNodes).forEach(function(child){parent.removeChild(child);if(recursive)dom.detachAll(child,recursive)})};dom.detachAllOtherSiblings=function(exceptedChildren,recursive){if(!Array.isArray(exceptedChildren))exceptedChildren=
[exceptedChildren];var parent=exceptedChildren[0].parentNode;Array.prototype.slice.call(parent.childNodes).forEach(function(child){if(exceptedChildren.find(function(testchild){return testchild==child}))return;parent.removeChild(child);if(recursive)dom.detachAll(child,recursive)})};dom.detachAllRecursive=function(parent){return dom.detachAll(parent,true)};dom.detachAllOtherSiblingsRecursive=function(exceptedChildren,parent){return dom.detachAllOtherSiblings(exceptedChildren,parent,true)};dom.onRemoved=
function(element,callback){var MutationObserver=window.MutationObserver||window.WebkitMutationObserver;var observer=new MutationObserver(function(){if(!isAttached(element)){callback(element);observer.disconnect()}function isAttached(element){while(true){element=element.parentNode;if(element==document.documentElement)return true;if(element==null)return false}}});observer.observe(document,{childList:true,subtree:true});return observer};dom.insertBefore=function(element,sibling){element.parentNode.insertBefore(element,
sibling);return element};dom.create=function(type,init){var init=init||{};var children=init.children,events=init.events,parent=init.parent;delete init.children;delete init.events;delete init.parent;var element=document.createElement(type);if(init.className&&dom.processCss){element.className=dom.processCss(init.className);delete init.className}if(init.style){var style=init.style;for(var prop in style)element.style[prop]=style[prop];delete init.style}for(var prop in init)if(typeof prop!="undefined")element[prop]=
init[prop];if(typeof events!="undefined")for(var eventNameList in events){var event=events[eventNameList];if(eventNameList.indexOf(",")!=-1)eventNameList=eventNameList.split(",").map(function(n){return n.trim()});else eventNameList=[eventNameList];eventNameList.forEach(function(eventName){element.addEventListener(eventName,event)})}if(typeof parent!="undefined")parent.appendChild(element);element.dom={insertBefore:function(sibling){return dom.insertBefore(element,sibling)},classList:{add:function(string){element.classList.add.apply(element.classList,
string.split(" "));return element.dom},remove:function(string){element.classList.remove.apply(element.classList,string.split(" "));return element.dom}},children:{}};if(children)children.forEach(function(arr){var childName=arr[0],tagTypeName=arr[1],childData=arr[2];var child=dom.create(tagTypeName,childData);element.dom.children[childName]=child;element.appendChild(child)});return element};dom.createEventSubscriber=function(subscribeTarget,init){init=init||{};var subscribeToEventName="subscribeToEvent"in
init?init.subscribeToEvent:"subscribeToEvent";var dispatchEventName="dispatchEvent"in init?init.dispatchEvent:"dispatchEvent";var dispatchEventOriginalName="dispatchEventOriginal"in init?init.dispatchEventOriginal:"dispatchEventOriginal";subscribeTarget[dispatchEventOriginalName]=subscribeTarget.dispatchEvent;var dispatchEventFunction=function(eventName,evt){if(typeof eventName!="string"){subscribeTarget[dispatchEventOriginalName].apply(this,arguments);return}subscribeTarget[dispatchEventName](new CustomEvent(eventName,
{detail:evt}))};subscribeTarget[dispatchEventName]=dispatchEventFunction;var subscriber=function(element,eventNameList,func,doNotRemoveIfDetached){if(!("nodeName"in element)){var init=element,element=init.element,func=init.callback;if("column"in init){var eventNameList={};eventNameList[init.event]=init.column}else var eventNameList=init.event}if(!Array.isArray(eventNameList))eventNameList=[eventNameList];eventNameList.forEach(function(eventName){if(typeof eventName=="object"){var columnAffected=Object.values(eventName)[0];
eventName=Object.keys(eventName)[0]}var functionwrapper=function(evt){Object.defineProperty(evt,"type",{enumerable:true,configurable:true,writable:true});if(evt.detail){var detail=evt.detail;Object.defineProperty(evt,"detail",{enumerable:true,configurable:true,writable:true});delete evt.detail;Object.assign(evt,detail)}if(!("name"in evt))evt.name=eventName;if(!("target"in evt))evt.target=element;if(!doNotRemoveIfDetached&&!dom.isAttached(element)){subscribeTarget.removeEventListener(eventName,functionwrapper);
return}if(typeof columnAffected!="undefined"&&!evt.columnsAffected.includes(columnAffected))return;func.apply(element,[evt])};subscribeTarget.addEventListener(eventName,functionwrapper)})};subscribeTarget[subscribeToEventName]=subscriber;return subscriber};dom.databaseSyncSetter=function(init){var entry_name=init.entry_name;var database_action=init.database_action;var action_type=init.action_type;var entry_id_string=init.entry_id;var entry_container_string=init.entry_container;var central_data=init.central_data;
var query_parameters=init.query_parameters;var event_name=init.event_name;var event_dispatcher=init.event_dispatcher;var dbrequest_queue=init.dbrequest_queue;var wait_for_result=action_type=="create"||action_type=="remove"?true:"wait_for_result"in init?init.wait_for_result:false;var init=init.init;var entry_id=init[entry_id_string];var entry_container=central_data[entry_container_string];if(action_type=="set"){var entry=get_entry_object({container:entry_container,entry_id:entry_id});var entry_original=
Object.assign({},entry);var additions={},columns_affected=[];query_parameters.forEach(function(prop){if(prop in init){additions[prop]=init[prop];columns_affected.push(prop)}});Object.assign(entry,additions);event_name=typeof event_name=="string"?event_name:event_name(additions);var id_param={};id_param[entry_name]=entry;if(!wait_for_result)event_dispatcher.dispatchEvent(event_name,Object.assign({},id_param,{columnsAffected:columns_affected},additions))}if(typeof init.callback=="undefined")init.callback=
function(){};var callback_original=init.callback;init.callback=function(result){if(result&&result.error){additions={};if(action_type=="set"){query_parameters.forEach(function(prop){if(prop in init)additions[prop]=entry_original[prop]});event_dispatcher.dispatchEvent(event_name,Object.assign({},id_param,{columnsAffected:columns_affected},additions))}}else if(wait_for_result){var effects=typeof result=="object"?result.effects:undefined;if(effects)dispatch_events(effects);else event_dispatcher.dispatchEvent(event_name,
Object.assign({},id_param,{columnsAffected:columns_affected},additions))}callback_original(result)};dbrequest_queue(database_action,query_parameters.concat(entry_id_string),init);function get_entry_object(init){var container=init.container,entry_id=init.entry_id;if(typeof entry_id=="undefined")return container;if(Array.isArray(container))return container.find(function(test_entry){return test_entry.id==entry_id});else return container[entry_id]}function set_entry_object(init){var container=init.container,
entry_id=init.entry_id,entry=init.entry_data;var sort_column=init.sort_column,sort_direction=init.sort_direction;if(!Array.isArray(container))container[entry_id]=entry;else if(!sort_column)container.push(entry);else{var insert_position=container.findIndex(!sort_direction||sort_direction.toLowerCase()=="asc"?function(test_entry){return entry[sort_column]<test_entry[sort_column]}:function(test_entry){return entry[sort_column]>=test_entry[sort_column]});if(insert_position==-1)insert_position=container.length;
container.splice(insert_position,0,entry)}return entry}function delete_entry_object(init){var container=init.container,entry_id=init.entry_id;if(!Array.isArray(container)){var entry=container[entry_id];delete container[entry_id]}else{var entry_index=container.findIndex(function(entry){if(entry.id==entry_id)return true});var entry=container[entry_index];container.splice(entry_index,1)}return entry}function dispatch_events(event_list){var dispatch_list=[];for(var event_name in event_list){var event=
event_list[event_name];var columns_affected=[],id_param_list={},additions={};for(var entry_name in event){var entry_descriptor=event[entry_name];var location=entry_descriptor.location,data=entry_descriptor.data;var entry_container_string=location.container,entry_id=location.id;if(typeof data=="undefined")var entry=delete_entry_object({container:central_data[entry_container_string],entry_id:entry_id});else{var entry=get_entry_object({container:central_data[entry_container_string],entry_id:entry_id});
columns_affected=columns_affected.concat(Object.keys(data));if(typeof entry=="undefined"){var entry=set_entry_object({container:central_data[entry_container_string],entry_id:entry_id,entry_data:data,sort_column:location.sort_column,sort_direction:location.sort_direction});entry.id=entry_id}else Object.assign(entry,data);Object.assign(additions,data)}id_param_list[entry_name]=entry}dispatch_list.push([event_name,Object.assign({},id_param_list,{columnsAffected:columns_affected},Object.keys(event).length==
1?additions:{})])}dispatch_list.forEach(function(dispatch_data){event_dispatcher.dispatchEvent.apply(null,dispatch_data)})}}}if(h.library_settings.domain_and_directory){h.get_url_vars=function(variable_object){if(typeof variable_object!="object"||variable_object==null)variable_object={};var variable_list=window.location.href.slice(window.location.href.indexOf("?")+1).split("\x26");var curlen=variable_list.length;for(var i=0;i<curlen;i++){var current_variable=variable_list[i].split("\x3d");if(typeof current_variable[1]==
"undefined")continue;variable_object[current_variable[0]]=decodeURIComponent(current_variable[1])}return variable_object};h.form_url_vars=function(variable_list,options){if(typeof options=="undefined")options={};if(typeof options.record_undefined_values=="undefined")options.record_undefined_values=true;var return_value="";for(var i in variable_list)if(typeof variable_list[i]!="undefined"||options.record_undefined_values==true)return_value+="\x26"+i+"\x3d"+variable_list[i];if(return_value!="")return_value=
"?"+return_value.slice(1,return_value.length);return return_value};h.directory_normalize=function(dirpath){var part_list=dirpath.split("/");loop1:for(var i=0,curlen=part_list.length;i<curlen;i++){if(part_list[i]=="..")for(var j=i-1;j>=0;j--){if(part_list[j]==".."||part_list[j]=="")continue;part_list[j]="";part_list[i]="";continue loop1}part_list[i]="/"+part_list[i]}var dirpath=part_list.join("");dirpath=dirpath.substr(1,dirpath.length-1);return dirpath};h.strip_domain=function(url){var startAt=url.indexOf("://");
if(startAt==-1)return url;startAt=startAt==-1?0:startAt+3;var first_index=url.indexOf("/",startAt)+1;if(first_index==0)return url;return url.substring(first_index)};h.get_domain_and_directory=function(url){var last_index=url.lastIndexOf("/")+1;return url.substring(0,last_index)};h.strip_from_base_href=function(url){var startAt=url.indexOf("://");if(startAt==-1)return url;startAt=startAt==-1?0:startAt+3;var first_index=url.indexOf("/",startAt)+1;if(first_index==0)return url;return url.substring(first_index)};
h.strip_directory=function(url){var last_index=url.lastIndexOf("/")+1;if(last_index==0)return url;return url.substring(last_index)};h.strip_extension=function(url){return url.substring(0,url.lastIndexOf("."))};h.remove_base_url=function(url){var url_original=url;var base_url_pattern=/^https?:\/\/[a-z:0-9.]+/;var result="";var match=base_url_pattern.exec(url);if(match!=null)result=match[0];if(result.length>0)url=url.replace(result,"").substr(1);var base_element=document.querySelector("base");if(base_element!=
null){var base_href=base_element.getAttribute("href");base_href=base_href.substr(base_href.indexOf("/")+1)+"/";url=url.replace(new RegExp("^("+base_href+".)"),"")}return url};h.modify_href_if_relative=function(prefix_src,current_src){if(current_src.substr(0,7)!="http://")return prefix_src+current_src;else return current_src}}if(h.library_settings.audio){var play_audio=h.play_audio=function(filename,init){if(typeof init=="undefined")init={};if(init.play_howl)return new playHowl(filename,init);if(typeof init.container!=
"undefined")if(typeof init.container[filename]!="undefined"&&!init.force_refresh){var main=init.container[filename];main.loop=init.loop||false;main.volume=init.volume||1;main.start=typeof init.start!="undefined"?init.start:true;main.stopped=false;if(main.start==true){main.audio.play();if(main.loop==true)main.addEventListener("ended",main.play)}else if(main.loop==true)main.audio.loop=true;return main}if(typeof this=="undefined"||this==window)return new play_audio(filename,init);var main=this;if(typeof init.container!=
"undefined")init.container[filename]=main;Object.defineProperty(main,"duration",{get:function(){return main.audio.duration}});Object.defineProperty(main,"currentTime",{get:function(){return main.audio.currentTime},set:function(new_time){if(main.audio.readyState!=0){main.audio.currentTime=new_time;return}main.audio.addEventListener("loadedmetadata",set_new);function set_new(){main.audio.removeEventListener("loadedmetadata",set_new);main.audio.currentTime=new_time}}});Object.defineProperty(main,"volume",
{get:function(){return main.audio.volume},set:function(new_volume){main.audio.volume=new_volume}});Object.defineProperty(main,"paused",{get:function(){return main.audio.paused}});main.addEventListener=function(){return main.audio.addEventListener(arguments[0],arguments[1],false||arguments[2])};main.removeEventListener=function(){return main.audio.removeEventListener(arguments[0],arguments[1],false||arguments[2])};main.play=main.play_track=function(){main.audio.play()};main.stop=function(){main.stopped=
true;main.audio.pause();if(main.audio.readyState!=0)main.audio.currentTime=0;main.removeEventListener("ended",main.play_track)};main.pause=function(){main.stopped=true;main.audio.pause();main.removeEventListener("ended",main.play)};main.play=function(){main.resume()};main.resume=function(){if(main.stopped==true){main.stopped=false;main.play()}else main.audio.play();if(main.loop==true){main.audio.loop=true;main.audio.addEventListener("ended",main.play)}};main.set_loop=function(loop_value){if(loop_value==
true){main.loop=true;main.audio.loop=true;main.addEventListener("ended",main.play)}else{main.loop=false;main.audio.loop=false;main.removeEventListener("ended",main.play)}};main.restart=function(){main.play()};main.set_volume=function(new_volume){main.volume=new_volume};main.loop=init.loop;if(typeof main.loop=="undefined")main.loop=false;main.start=init.start;if(typeof main.start=="undefined")main.start=true;main.loaded=true;main.filename=filename;main.stopped=false;main.audio=new Audio;if(typeof init.no_source_tags!=
"undefined"&&init.no_source_tags==true||extension!=".ogg"&&extension!=".mp3"&&extension!=".wav")main.audio.src=main.filename;else{var extension=main.filename.slice(-4);var source=document.createElement("source");switch(extension){case ".ogg":source.type="audio/ogg";break;case ".mp3":source.type="audio/mpeg";break;case ".wav":source.type="audio/wav";break}source.src=main.filename;main.audio.appendChild(source)}main.volume=init.volume||1;if(main.start==true){main.audio.play();if(main.loop==true)main.addEventListener("ended",
main.play)}else if(main.loop==true)main.audio.loop=true;return main};h.play_howl=function(src,init){if(typeof init=="undefined")init={};if(typeof init.container!="undefined")if(typeof init.container[src]!="undefined"&&!init.force_refresh){var main=init.container[src];main.volume=init.volume||1;if(typeof init.start=="undefined"||init.start==true)main.play();return main}if(typeof this=="undefined"||this==window)return new playHowl(src,init);var main=this;if(typeof init.container!="undefined")init.container[src]=
main;Object.defineProperty(main,"duration",{get:function(){return main.audio.duration}});Object.defineProperty(main,"currentTime",{get:function(){return main.audio.position},set:function(new_time){if(main.loaded){main.audio.position=new_time;return}main.addEventListener("load",set_new);function set_new(){main.audio.position=new_time;main.removeEventListener("load",set_new)}}});Object.defineProperty(main,"volume",{get:function(){return main.audio.volume},set:function(new_volume){main.audio.volume=
new_volume}});main.pause=function(){main.audio.pause();main.paused=true};main.play=function(){main.audio.play();main.paused=false};main.stop=function(){main.audio.pause();main.paused=true;main.currentTime=0};main.loaded=false;main.src=src;main.paused=true;var listeners=[];main.addEventListener=function(){listeners.push([arguments[0],arguments[1],arguments[2]||false])};main.removeEventListener=function(){var input_arguments=arguments;var index=listeners.findIndex(function(listener){if(listener[0]!==
input_arguments[0])return false;if(listener[1]!==input_arguments[1])return false;if(listener[2]!==(input_arguments[2]||false))return false;return true});if(index!=-1)listeners.splice(index,1)};main.audio=new Howl({src:main.src,buffersize:init.preload_buffer_size,bufferfile:init.preload_buffer_file,autoplay:typeof init.start=="undefined"||init.start==true,onend:function(){main.paused=true;listeners.forEach(function(listener){if(listener[0]!="ended")return;listener[1]()})},onload:function(){main.loaded=
true;listeners.forEach(function(listener){if(listener[0]!="load")return;listener[1]()})},onloaderror:function(){main.paused=true;listeners.forEach(function(listener){if(listener[0]!="loaderror")return;listener[1]()})},onpause:function(){main.paused=true;listeners.forEach(function(listener){if(listener[0]!="pause")return;listener[1]()})},onplay:function(){main.paused=false;listeners.forEach(function(listener){if(listener[0]!="play")return;listener[1]()})}});main.volume=init.volume||1;return main};
h.proto.HTMLElement.playAudio=function(obj){function is_attached(obj){while(true){obj=obj.parentNode;if(obj==document.documentElement)return true;if(obj==null)return false}}function parentNode_test(){if(is_attached(obj)){setTimeout(parentNode_test,50);return}audio_object.stop();if(typeof audio_object.release!="undefined")audio_object.release()}parentNode_test();var args=Array.prototype.slice.call(arguments);var audio_object=play_audio.apply(null,args);return audio_object}}if(h.library_settings.graphics){h.image_preload=
function(cursrc,init){if(typeof cursrc=="string"){var new_image=new Image;if(typeof init!="undefined"){if(typeof init.success!="undefined")new_image.onload=function(){init.success(new_image)};if(typeof init.error!="undefined")new_image.onerror=function(){init.error(new_image)}}new_image.src=cursrc;return new_image}else var init=cursrc;var dir_prefix=typeof init=="undefined"||typeof init.dir=="undefined"?"":init.dir;var image_list=init.image_list;var curlen=image_list.length;var load_counter=curlen;
for(var i=0;i<curlen;i++){var image_temp=new Image;image_temp.onload=function(){load_counter-=1};image_temp.onerror=function(){load_counter-=1};image_temp.src=dir_prefix+image_list[i]}var test_load_complete_interval=setTimeout(test_load_complete,30);function test_load_complete(){if(load_counter!=0){test_load_complete_interval=setTimeout(test_load_complete,30);return}clearInterval(test_load_complete_interval);if(typeof init.callback!="undefined")init.callback()}};h.set_text_shadow_color=function(element,
text_shadow_color){var text_shadow_string=window.getComputedStyle(element).textShadow;var text_shadow_array=text_shadow_string.split("rgb");text_shadow_array.shift();text_shadow_array.forEach(function(item,i,arr){var modified_item=item.slice(0,item.length-2).split(") ")[1];arr[i]=text_shadow_color+" "+modified_item});element.style.textShadow=text_shadow_array};h.add_webkit_text_stroke=function(init){var source_element=init.element;var text=source_element.innerHTML;var size_list=init.size;var color_list=
init.color;var stroke_units=stroke_units||"px";if(typeof size_list=="string")size_list=[size_list];if(typeof color_list=="string")color_list=[color_list];var lineheight_1_string=window.getComputedStyle(source_element).lineHeight;if(lineheight_1_string=="normal")var lineheight_adjustment=0;else{var lineheight_1=parseInt(lineheight_1_string);if(Number.isNaN(lineheight_1))lineheight_1=0;var test_element=document.createElement("div");test_element.style.whiteSpace="nowrap";test_element.style.fontSize=
"100px";test_element.innerHTML=source_element.innerHTML;document.body.appendChild(test_element);test_element.style.fontFamily=window.getComputedStyle(source_element).fontFamily;var lineheight_saved=source_element.style.lineHeight;source_element.style.lineHeight=test_element.getBoundingClientRect().height/100;document.body.removeChild(test_element);var lineheight_adjustment=(parseFloat(window.getComputedStyle(source_element).lineHeight)-lineheight_1)/2;source_element.style.lineHeight=lineheight_saved}source_element.innerHTML=
"";for(var n=0,curlen=text.length;n<curlen;n++){var sub=document.createElement("span");sub.style.position="relative";source_element.appendChild(sub);sub.innerHTML='\x3cspan style\x3d"position:relative; z-index:'+size_list.length+'"/\x3e'+text[n]+"\x3c/span\x3e";size_list.forEach(function(current_stroke_size,i){var current_stroke_size_unit=current_stroke_size.substr(current_stroke_size.match(/([A-Z])/i).index,current_stroke_size.length);var stroke_element=document.createElement("div");stroke_element.style.position=
"absolute";stroke_element.style.left=0;stroke_element.style.top=lineheight_adjustment+"px";stroke_element.style.zIndex=size_list.length-i-1;stroke_element.style.color=color_list[i];stroke_element.style.WebkitTextStrokeColor=color_list[i];stroke_element.style.WebkitTextStrokeWidth=parseFloat(current_stroke_size)*2+current_stroke_size_unit;stroke_element.innerHTML=text[n];sub.appendChild(stroke_element)})}};h.canvas_colorize=function(ctx,rpercent,gpercent,bpercent,octx){var i=0,curwidth=ctx.canvas.width,
curheight=ctx.canvas.height;var pixels=ctx.getImageData(0,0,curwidth,curheight);var pixels_data=pixels.data;for(var x=0;x<curwidth;x++)for(var y=0;y<curheight;y++){var pixelavg=(pixels_data[i]+pixels_data[i+1]+pixels_data[i+2])/3;var r=Math.round(pixelavg*rpercent);pixels_data[i]=r<=255?r:255;i++;var g=Math.round(pixelavg*gpercent);pixels_data[i]=g<=255?g:255;i++;var b=Math.round(pixelavg*bpercent);pixels_data[i]=b<=255?b:255;i++;i++}octx.putImageData(pixels,0,0,0,0,curwidth,curheight)};h.create_composite_set=
function(init){var load_counter=0;var result_list=[];function result_push(result,current_name){result.name=current_name;result_list.push(result);load_counter-=1}var object_list=init.object_list;for(var current_name in object_list){var curobj=object_list[current_name];load_counter+=1;void function(current_name){create_composite({layer_dir:init.layer_dir,layer_name:current_name,color_list:curobj.color_list,callback:function(result){result_push(result,current_name)}})}(current_name)}var test_load_complete_interval=
setTimeout(test_load_complete,30);function test_load_complete(){if(load_counter!=0){test_load_complete_interval=setTimeout(test_load_complete,30);return}clearInterval(test_load_complete_interval);init.callback(result_list)}};h.create_composite=function(init){var current_data={};current_data.layer_name=init.layer_name;current_data.layer_color_list=init.color_list;var layer_name_list=[];for(var i=0;i<current_data.layer_color_list.length;i++)layer_name_list.push(init.layer_dir+current_data.layer_name+
"-"+i+".png");merge_and_colorize({image_name_list:layer_name_list,color_list:current_data.layer_color_list,callback:init.callback})};var merge_and_colorize=h.merge_and_colorize=function(init){var image_name_list=init.image_name_list;var color_list=init.color_list;var load_counter=image_name_list.length;var image_list=[];for(var i=0;i<image_name_list.length;i++){image_list[i]=new Image;image_list[i].onload=function(){load_counter-=1};image_list[i].src=image_name_list[i]}var test_load_complete_interval=
setTimeout(test_load_complete,30);function test_load_complete(){if(load_counter!=0){test_load_complete_interval=setTimeout(test_load_complete,30);return}clearInterval(test_load_complete_interval);do_merge_and_colorize()}function do_merge_and_colorize(){var target=document.createElement("canvas");var imagedata_target=target.getContext("2d");var canvas_width=target.width=image_list[0].width;var canvas_height=target.height=image_list[0].height;var imagedata_target_get=imagedata_target.getImageData(0,
0,canvas_width,canvas_height);var imagedata_target_data=imagedata_target_get.data;imagedata_target.globalCompositeOperation="source-over";var r=0,g=0,b=0;var ctx_source_data_list=[];var source_list=[];var rgb_list=[];for(var i=0;i<image_name_list.length;i++){var source=document.createElement("canvas");var ctx_source=source.getContext("2d");source.width=image_list[i].width;source.height=image_list[i].height;ctx_source.drawImage(image_list[i],0,0);var rgb=hex_to_rgb(color_list[i]);rgb_list.push({r:rgb.r/
255,g:rgb.g/255,b:rgb.b/255});source_list.push(source);ctx_source_data_list.push(ctx_source.getImageData(0,0,source.width,source.height))}var curlen=ctx_source_data_list[0].data.length;for(var c=image_name_list.length-1;c>=0;c--){var imagedata_source_data=ctx_source_data_list[c].data;var current_rgb=rgb_list[c];for(var i=0;i<curlen;i+=4){var r=imagedata_source_data[i];r*=current_rgb.r;var g=imagedata_source_data[i+1];g*=current_rgb.g;var b=imagedata_source_data[i+2];b*=current_rgb.b;imagedata_source_data[i]=
r>255?255:r;imagedata_source_data[i+1]=g>255?255:g;imagedata_source_data[i+2]=b>255?255:b}var ctx=source_list[c].getContext("2d");ctx.putImageData(ctx_source_data_list[c],0,0);imagedata_target.drawImage(source_list[c],0,0)}init.callback(target)}};var hex_to_color=h.hex_to_color=function(hex){if(hex[0]=="#")hex=hex.substr(1);if(hex.length/2!=Math.round(hex.length/2))hex=hex.split("").reduce(function(accumulator,value){return accumulator+value+value},"");function hex2dec(v){return parseInt(v,16)}var result=
[];for(var i=0;i<hex.length/2;i++)result[i]=hex2dec(hex[i*2]+hex[i*2+1]);return result};h.hex_to_rgb=function(hex){var result=hex_to_color(hex);return{r:result[0],g:result[1],b:result[2]}};h.hex_to_rgba=function(hex){var result=hex_to_color(hex);return{r:result[0],g:result[1],b:result[2],a:result[3]}};h.rgb_to_hex=h.rgba_to_hex=h.color_to_hex=function(){function dec2hex(v){var hex=v.toString(16);if(hex.length==1)hex="0"+hex;return hex}var args=Array.prototype.slice.call(arguments);return"#"+args.reduce(function(accumulator,
value){return accumulator+dec2hex(value)},"")};h.create_single_color_image_elements=function(init){var obj_list={};var n=0;for(var i in init.files){n+=1;obj_list[i]=document.createElement("img");void function(refobject,refproperty,image_src){color_fill({image_src:image_src,color:init.color,callback:function(result){refobject[refproperty]=result;refobject[refproperty].className=init.class;n-=1;if(n==0)init.callback(obj_list)}})}(obj_list,i,init.files[i])}return obj_list};h.color_fill=function(init){var return_result=
typeof init.return_result!="undefined"&&init.return_result==true?true:false;if(typeof init.image=="undefined"){var image_obj=new Image;image_obj.src=init.image_src;if(return_result==true)return do_color_fill();else if(init.fix_ie_bug)load_timeout(image_obj,do_color_fill);else image_obj.addEventListener("load",do_color_fill)}else{var image_obj=init.image;if(init.image instanceof HTMLImageElement){if(typeof init.image_src!="undefined")image_obj.src=init.image_src;if(return_result==true)return do_color_fill();
else if(init.fix_ie_bug)load_timeout(image_obj,do_color_fill);else image_obj.addEventListener("load",do_color_fill)}if(init.image instanceof HTMLCanvasElement)if(return_result==true)return do_color_fill();else do_color_fill()}function load_timeout(element,callback){test_size();function test_size(){if(typeof element.naturalWidth=="undefined"||element.complete==false||element.naturalWidth==0){var test=setTimeout(test_size,20);return}element.width=element.naturalWidth;element.height=element.naturalHeight;
callback()}}function do_color_fill(){var rect_source=document.createElement("canvas");var rect_source_ctx=rect_source.getContext("2d");if(init.image instanceof HTMLImageElement&&init.fix_ie_bug){rect_source.width=image_obj.naturalWidth;rect_source.height=image_obj.naturalHeight}else{rect_source.width=image_obj.width;rect_source.height=image_obj.height}rect_source_ctx.fillStyle=init.color;rect_source_ctx.fillRect(0,0,rect_source.width,rect_source.height);if(typeof init.image=="undefined"||init.image instanceof
HTMLImageElement||typeof init.create_new!="undefined"&&init.create_new==true){var target=document.createElement("canvas");var target_ctx=target.getContext("2d");if(init.image instanceof HTMLImageElement&&init.fix_ie_bug){target.width=image_obj.naturalWidth;target.height=image_obj.naturalHeight}else{target.width=image_obj.width;target.height=image_obj.height}target_ctx.globalCompositeOperation="source-over";target_ctx.drawImage(image_obj,0,0)}if(init.image instanceof HTMLCanvasElement&&(typeof init.create_new==
"undefined"||init.create_new!=true)){var target=init.image;var target_ctx=target.getContext("2d")}target_ctx.globalCompositeOperation="source-in";target_ctx.drawImage(rect_source,0,0);if(typeof init.callback!="undefined")init.callback(target);if(return_result==true)return target}};h.canvas_filter=function(source,target,filter_function){var ctx=source.getContext("2d");var canvas_width=source.width,canvas_height=source.height;var source_data=source.getContext("2d").getImageData(0,0,canvas_width,canvas_height);
var source_data_buffer=source_data.data;for(var i=0,curlen=source_data_buffer.length;i<curlen;i+=4)filter_function(source_data_buffer,i);target.getContext("2d").putImageData(source_data,0,0)};h.canvas_clone=function(canvas){var new_canvas=document.createElement("canvas");for(var property in canvas)try{new_canvas[property]=canvas[property]}catch(err){}for(var property in canvas.style)new_canvas.style[property]=canvas.style[property];canvas.className=canvas;var ctx=new_canvas.getContext("2d");ctx.drawImage(canvas,
0,0);return new_canvas};h.canvas_trim_empty_space=function(init){if(init instanceof HTMLElement)var source_canvas=init;else{var source_canvas=init.source;var coordinates_only=typeof init.coordinates_only=="undefined"?false:coordinates_only}var canvas_initial_width=source_canvas.width,canvas_initial_height=source_canvas.height;var ctx=source_canvas.getContext("2d");var canvas_data=ctx.getImageData(0,0,canvas_initial_width,canvas_initial_height);var canvas_data_data=canvas_data.data;var curlen=canvas_data_data.length;
var x0=0,x1=canvas_initial_width,y0=0,y1=canvas_initial_height;for(var y=0;y<canvas_initial_height;y++){var y_address=y*canvas_initial_width;var all_empty=true;for(var x=0;x<canvas_initial_width;x++){var a=canvas_data_data[(y_address+x)*4+3];if(a!=0){all_empty=false;break}}if(all_empty==false){y0=y;break}}for(var y=canvas_initial_height-1;y>=0;y--){var y_address=y*canvas_initial_width;var all_empty=true;for(var x=0;x<canvas_initial_width;x++){var a=canvas_data_data[(y_address+x)*4+3];if(a!=0){all_empty=
false;break}}if(all_empty==false){y1=y;break}}for(var x=0;x<canvas_initial_width;x++){var all_empty=true;for(var y=0;y<canvas_initial_height;y++){var a=canvas_data_data[(y*canvas_initial_width+x)*4+3];if(a!=0){all_empty=false;break}}if(all_empty==false){x0=x;break}}for(var x=canvas_initial_width-1;x>=0;x--){var all_empty=true;for(var y=0;y<canvas_initial_height;y++){var a=canvas_data_data[(y*canvas_initial_width+x)*4+3];if(a!=0){all_empty=false;break}}if(all_empty==false){x1=x;break}}var new_width=
x1-x0+1,new_height=y1-y0+1;var result={x0:x0,x1:x1,y0:y0,y1:y1};if(!init.coordinates_only){var target_canvas=document.createElement("canvas");var target_ctx=target_canvas.getContext("2d");target_canvas.width=new_width;target_canvas.height=new_height;target_ctx.drawImage(source_canvas,x0,y0,new_width,new_height,0,0,new_width,new_height);result.canvas=target_canvas}return result};h.canvas_draw_path=function(init){var x=init.x||0;var y=init.y||0;var scale=init.scale||1;var data_string=init.data;var canvas=
init.canvas;var data_array=get_data_array_from_string(data_string);draw_func(data_array,canvas);function draw_func(data_array,canvas){var context=canvas.getContext("2d");if(typeof init.lineWidth!="undefined")context.lineWidth=init.lineWidth;if(typeof init.strokeStyle!="undefined")context.strokeStyle=init.strokeStyle;if(typeof init.lineJoin!="undefined")context.lineJoin=init.lineJoin;if(typeof init.lineCap!="undefined")context.lineCap=init.lineCap;context.beginPath();context.translate(init.x*scale,
init.y*scale);for(var n=0;n<data_array.length;n++){var c=data_array[n].command;var p=data_array[n].points;switch(c){case "L":context.lineTo(p[0],p[1]);break;case "M":context.moveTo(p[0],p[1]);break;case "C":context.bezierCurveTo(p[0],p[1],p[2],p[3],p[4],p[5]);break;case "z":context.closePath();break}}if(typeof init.lineWidth=="undefined"||init.lineWidth!=0)context.stroke();if(typeof init.fillPatternImage!="undefined"||typeof init.fillStyle!="undefined"){if(typeof init.fillPatternImage!="undefined"){var pattern=
context.createPattern(init.fillPatternImage,"no-repeat");if(typeof init.fillPatternOffset!="undefined"){context.save();context.translate(-init.fillPatternOffset[0]*scale,0);context.translate(0,-init.fillPatternOffset[1]*scale)}context.fillStyle=pattern}else context.fillStyle=init.fillStyle;context.fill()}if(typeof init.fillPatternOffset!="undefined")context.restore()}function get_data_array_from_string(data_string){var cs=data_string;var cc=["M","L","C"];cs=cs.replace(new RegExp(" ","g"),",");for(var n=
0;n<cc.length;n++)cs=cs.replace(new RegExp(cc[n],"g"),"|"+cc[n]);var arr=cs.split("|");var ca=[];var cpx=0,cpy=0;for(n=1;n<arr.length;n++){var str=arr[n];var c=str.charAt(0);str=str.slice(1);str=str.replace(new RegExp(",-","g"),"-");str=str.replace(new RegExp("-","g"),",-");str=str.replace(new RegExp("e,-","g"),"e-");var p=str.split(",");if(p.length>0&&p[0]==="")p.shift();for(var i=0;i<p.length;i++)p[i]=parseFloat(p[i])*scale;while(p.length>0){if(isNaN(p[0]))break;var cmd=null;var points=[];var startX=
cpx,startY=cpy;switch(c){case "L":cpx=p.shift();cpy=p.shift();points.push(cpx,cpy);break;case "M":cpx=p.shift();cpy=p.shift();cmd="M";points.push(cpx,cpy);c="L";break;case "C":points.push(p.shift(),p.shift(),p.shift(),p.shift());cpx=p.shift();cpy=p.shift();points.push(cpx,cpy);break}ca.push({command:cmd||c,points:points,start:{x:startX,y:startY}})}if(c==="z"||c==="Z")ca.push({command:"z",points:[],start:undefined})}return ca}};h.path2d_scale=function(path,scale){var numstring="";var otherstring="";
var bigstring="";for(var i=0,curlen=path.length;i<curlen;i++){var s=path[i];if(s=="-"||s=="+"||s=="."||s=="0"||s=="1"||s=="2"||s=="3"||s=="4"||s=="5"||s=="6"||s=="7"||s=="8"||s=="9"){if(otherstring.length>0){bigstring+=otherstring;otherstring=""}numstring+=s}else{if(numstring.length>0){bigstring+=parseFloat(numstring)*scale;numstring=""}otherstring+=s}}if(otherstring.length>0)bigstring+=otherstring;if(numstring.length>0)bigstring+=parseFloat(numstring)*scale;return bigstring};h.on_background_image_url_load=
function(current_div,callback){function get_domain_and_directory(url){var last_index=url.lastIndexOf("/")+1;return url.substring(0,last_index)}var background_image_raw=current_div.style.backgroundImage;if(background_image_raw==""||background_image_raw=="none"){background_image_raw=window.getComputedStyle(current_div)["backgroundImage"];if(background_image_raw==""||background_image_raw=="none")callback(null)}var base_dir=get_domain_and_directory(window.location.href);background_image_raw=background_image_raw.replace('url("'+
base_dir,"").replace('")',"");background_image_raw=background_image_raw.replace("url('"+base_dir,"").replace("')","");background_image_raw=background_image_raw.replace("url("+base_dir,"").replace(")","");background_image_raw=background_image_raw.replace('url("',"").replace('")',"");background_image_raw=background_image_raw.replace("url('","").replace("')","");background_image_raw=background_image_raw.replace("url(","").replace(")","");var temp_image=new Image;temp_image.onload=function(){callback(temp_image)};
temp_image.src=background_image_raw};h.handle_css_hover_effects=function(init){var init=init||{};var handle_touch_events=init.handle_touch_events||true;var handle_mouse_events=init.handle_mouse_events||true;var hover_class=init.hover_class||"hover";var delay_preferences=init.delay_preferences||{touch:{add:500,remove:500}};function default_handler(curobj,input_type,op){var hovered_element_selector="*"+(op=="add"?":hover":"."+hover_class);var hovered_elements=Array.prototype.slice.call(document.body.querySelectorAll(hovered_element_selector));
var modified_list=[];while(true){if(curobj==null||curobj==document.documentElement)break;if(hovered_elements.indexOf(curobj)!=-1)modified_list.push(curobj);curobj=curobj.parentNode}function do_hover_change(){modified_list.forEach(function(curobj){curobj.classList[op](hover_class)})}if(!delay_preferences[input_type]||!delay_preferences[input_type][op])do_hover_change();else setTimeout(do_hover_change,delay_preferences[input_type][op])}if(handle_mouse_events){document.body.addEventListener("mouseover",
function(evt){var curobj=evt.target;default_handler(curobj,"mouse","add")});document.body.addEventListener("mouseout",function(evt){var curobj=evt.target;default_handler(curobj,"mouse","remove")});document.body.addEventListener("click",function(evt){var curobj=evt.target;default_handler(curobj,"mouse","remove")})}if(handle_touch_events){document.body.addEventListener("touchstart",function(evt){var curobj=evt.target;default_handler(curobj,"touch","add")});document.body.addEventListener("touchend",
function(evt){var curobj=evt.target;default_handler(curobj,"touch","remove")});document.body.addEventListener("touchmove",function(evt){var curobj=evt.target;var hovered_elements=Array.prototype.slice.call(document.body.querySelectorAll("*:hover"));var lastobj=null;evt=evt.changedTouches[0];var elements_at_point=get_elements_at_point(evt.pageX,evt.pageY);while(true){if(curobj==null||curobj==document.documentElement)break;if(hovered_elements.indexOf(curobj)!=-1&&elements_at_point.indexOf(curobj)==
-1)lastobj=curobj;curobj=curobj.parentNode}if(lastobj==null)return;if(!delay_preferences.touch||!delay_preferences.touch.remove)lastobj.classList.remove(hover_class);else setTimeout(function(){lastobj.classList.remove(hover_class)},delay_preferences.touch.remove);function get_elements_at_point(x,y){var el_list=[],pe_list=[];while(true){var curobj=document.elementFromPoint(x,y);if(curobj==null||curobj==document.documentElement)break;el_list.push(curobj);pe_list.push(curobj.style.pointerEvents);curobj.style.pointerEvents=
"none"}el_list.forEach(function(current_element,i){current_element.style.pointerEvents=pe_list[i]});return el_list}})}};h.hex_color_blend=function(color1,color2,strength){if(color1[0]=="#")color1=color1.substr(1);if(color2[0]=="#")color2=color2.substr(1);function dec2hex(v){var hex=v.toString(16);if(hex.length==1)hex="0"+hex;return hex}function hex2dec(v){return parseInt(v,16)}return"#"+Array(color1.length/2).fill(0,0,color1.length/2).reduce(function(accumulator,value,n){var start=n*2,end=(n+1)*2;
var color=Math.round(hex2dec(color1.slice(start,end))*strength+hex2dec(color2.slice(start,end))*(1-strength));if(color>256)color=256;return accumulator+dec2hex(color)},"")};h.cleanup_canvases=function(parent){check_children(parent);function check_children(parent){var children=parent.childNodes;for(var i=0,curlen=children.length;i<curlen;i++){var curchild=children[i];if(curchild instanceof HTMLCanvasElement){curchild.width=0;curchild.height=0;continue}check_children(curchild)}}}}if(h.library_settings.feature_detection){h.detect_device_type=
function(obj){var ua=navigator.userAgent.toLowerCase();obj.is_iphone=/iphone/i.test(ua);obj.is_ipad=/ipad/i.test(ua);obj.is_idevice=obj.is_iphone||obj.is_ipad;obj.is_android=/android/i.test(ua);obj.is_chromium=/chrome/i.test(ua);obj.is_windows_phone=/windows phone/i.test(ua);obj.is_phone_or_tablet="ontouchstart"in window||(obj.is_idevice||obj.is_android||obj.is_windows_phone)};h.detect_scrollbar_thickness=function(){var scrollDiv=document.createElement("div");scrollDiv.style.width="100px";scrollDiv.style.height=
"100px";scrollDiv.style.overflow="scroll";scrollDiv.style.position="absolute";scrollDiv.style.top="-9999px";document.body.appendChild(scrollDiv);var scrollbar_width=scrollDiv.offsetWidth-scrollDiv.clientWidth;document.body.removeChild(scrollDiv);return scrollbar_width};h.detect_event_is_supported=function(event_name){var TAGNAMES={"select":"input","change":"input","submit":"form","reset":"form","error":"img","load":"img","abort":"img"};if(typeof window["on"+event_name]!="undefined")return true;var element=
document.createElement("div"||TAGNAMES[event_name]);event_name="on"+event_name;var is_supported=typeof element[event_name]!="undefined";return is_supported};h.detect_pixels_per_inch=function(){var dom_body=document.getElementsByTagName("body")[0];var dom_div=document.createElement("div");dom_div.style="width: 1in; visibility:hidden";dom_body.appendChild(dom_div);var w=document.defaultView.getComputedStyle(dom_div,null).width;dom_body.removeChild(dom_div);return parseInt(w)}}if(h.library_settings.cookie)h.readcookie=
function(name){var name_eq=name+"\x3d",ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" ")c=c.substring(1,c.length);if(c.indexOf(name_eq)==0)return decodeURIComponent(c.substring(name_eq.length,c.length))}return null};if(h.library_settings.font_loading){h.load_web_fonts=function(font_list,callback,timeout_attempt_limit){var timeout_attempt_limit=typeof timeout_attempt_limit=="undefined"?300:timeout_attempt_limit;var loaded_font_amount=0;font_list.forEach(function(font_family){if(typeof font_family==
"string"){load_font_by_family_and_size(font_family,"normal");return}var font_weight_list=font_family.font_weight,font_family=font_family.font_family;font_weight_list.forEach(function(font_weight){load_font_by_family_and_size(font_family,font_weight)})});if(typeof callback=="undefined")return;check_that_all_fonts_have_loaded();function load_font_by_family_and_size(font_family,font_weight){var node=document.createElement("span");node.innerHTML="giItT1WQy@!-/#";node.style.fontFamily="sans-serif";node.style.position=
"absolute";node.style.left="-10000px";node.style.top="-10000px";node.style.fontSize="300px";node.style.fontVariant="normal";node.style.fontWeight=font_weight;node.style.letterSpacing="0";document.body.appendChild(node);node.original_width=node.getBoundingClientRect().width;node.style.fontFamily=font_family;check_font(node,0)}function check_font(node,timeout_attempt){if(node.offsetWidth==node.original_width&&timeout_attempt<timeout_attempt_limit){timeout_attempt+=1;var check_font_timeout=setTimeout(function(){check_font(node,
timeout_attempt)},30);return}loaded_font_amount+=1;node.parentNode.removeChild(node)}function check_that_all_fonts_have_loaded(){if(loaded_font_amount<font_list.length){setTimeout(check_that_all_fonts_have_loaded,30);return}callback()}};h.fit_text_to_parent=function(element,init,transform_scale){if(typeof init=="undefined")init={};var unit_type=typeof init.unit_type!="undefined"?init.unit_type:"px";var transform_scale=typeof init.transform_scale!="undefined"?init.transform_scale:1;var iteration_max=
typeof init.iteration_max!="undefined"?init.iteration_max:200;var parent_rectangle=element.parentNode.getBoundingClientRect();var height=parent_rectangle.height/transform_scale;var width=parent_rectangle.width/transform_scale;var iterations=0;function find_best_size(min_size,max_size,best_size){var middle_size=+((max_size+min_size)/2).toFixed(2);element.style.fontSize=middle_size+unit_type;var rect=element.getBoundingClientRect();var inner_height=element.scrollHeight+(parseInt(rect.height/transform_scale)-
rect.height/transform_scale);var inner_width=element.scrollWidth+(parseInt(rect.width/transform_scale)-rect.width/transform_scale);if(min_size===middle_size||max_size===middle_size)return best_size;if(iterations<iteration_max){if(inner_height>height||inner_width>width){iterations+=1;return find_best_size(min_size,middle_size,best_size)}if(inner_height<=height&&inner_width<=width){iterations+=1;return find_best_size(middle_size,max_size,middle_size)}}return best_size}var best=find_best_size(typeof init.min_size!=
"undefined"?init.min_size:0,typeof init.max_size!="undefined"?init.max_size:120,typeof init.best_size!="undefined"?init.best_size:0);if(typeof init.min_size!="undefined")if(best<init.min_size)best=init.min_size;element.style.fontSize=best+unit_type};h.fit_text_horizontally=function(init){var parent=init.parent;var children=init.children;var scale_ratio_max=init.scale_ratio_max;var scale_ratio_step=init.scale_ratio_step;var adjust_elements=init.adjust_elements;if(!Array.isArray(children))children=
[children];if(!Array.isArray(adjust_elements))adjust_elements=[adjust_elements];var adjust_elements_font_size=[];adjust_elements.forEach(function(adjust_element,i){adjust_elements_font_size[i]=parseFloat(window.getComputedStyle(adjust_element).getPropertyValue("font-size"))});while(true){parent.style.width="auto";var scale_ratio=parent.clientWidth;parent.style.width="";scale_ratio/=parent.clientWidth;if(scale_ratio<=scale_ratio_max)break;adjust_elements.forEach(function(adjust_element,i){adjust_elements_font_size[i]*=
scale_ratio_step;adjust_element.style.fontSize=adjust_elements_font_size[i]+"px"})}}}if(h.library_settings.misc){h.time_defer=function(init,timeout_in_ms){var condition_function=init.condition;var result_function=init.result;void function function_test(){if(!condition_function()){setTimeout(function_test,timeout_in_ms);return}result_function()}()};h.callback_compose=function(function_list,result,callback){var n=0,next_callback=function(){n+=1;inner()};function inner(){if(n==function_list.length-1)next_callback=
callback;function_list[n](result,next_callback)}inner()}}void function(){var convert_to_prototypes=h.convert_to_prototypes=function(obj,window){var proto=obj.proto;for(var target_name in proto){if(target_name=="is_library_container"||target_name=="isLibraryContainer")continue;var target=proto[target_name];for(var func_name in target){if(func_name=="is_library_container"||func_name=="isLibraryContainer")continue;var func=target[func_name];void function(func){window[target_name].prototype[func_name]=
function(){return func.apply(null,[this].concat(Array.prototype.slice.call(arguments)))}}(func)}}};var convert_subproto_to_regular_functions=convert_subproto_to_regular_functions=function(obj){var proto=obj.proto;for(var target_name in proto){if(target_name=="is_library_container"||target_name=="isLibraryContainer")continue;var target=proto[target_name];for(var func_name in target){if(func_name=="is_library_container"||func_name=="isLibraryContainer")continue;var func=target[func_name];if(!obj[func_name])obj[func_name]=
func}}};if(h.library_settings.use_camelcases){h.convert_to_camelcase=function(obj){function camelize(str){return str.replace(/_([a-zA-Z])/g,function(match){return match.slice(1).toUpperCase()})}convert_props(obj);function convert_props(obj){var camelCaseList={};for(var prop in obj){if(typeof obj[prop]!="object"&&typeof obj[prop]!="function")continue;if(obj[prop].is_library_container)convert_props(obj[prop]);camelCaseList[camelize(prop)]=obj[prop]}for(var prop in camelCaseList)obj[prop]=camelCaseList[prop]}
};h.convert_to_camelcase(h)}if(!h.library_settings.use_underscores)void function(obj){remove_props(obj);function remove_props(obj){for(var prop in obj){if(typeof obj[prop]!="object"&&typeof obj[prop]!="function")continue;if(obj[prop].is_library_container)remove_props(obj[prop]);if(prop.indexOf("_")==-1)continue;delete obj[prop]}}}(h);if(h.library_settings.use_prototypes)convert_to_prototypes(h,window);convert_subproto_to_regular_functions(h)}()}();
var extrautilfuncs=function(helperjs){var h=helperjs,e={},dom=h.dom;e.string_to_array=function(init){var string=init.string,replace=init.replace,separators=init.separators,containers=init.containers,ending_separator_character=init.ending_separator_character;var arr=string.split(""),open_pointer=[],accumulator="";string="";var append_separator_character=undefined;arr.forEach(function(current_character){var just_went_into_outer_string=false;if(containers.includes(current_character))if(current_character==
open_pointer[open_pointer.length-1]){open_pointer.shift(-1);if(open_pointer.length==0){string+=replace(accumulator+current_character);accumulator="";just_went_into_outer_string=true}}else{open_pointer.push(current_character);if(open_pointer.length==1){string+=replace(accumulator);accumulator=""}}if(!just_went_into_outer_string)accumulator+=current_character});if(open_pointer.length==0)string+=replace(accumulator);else string+=accumulator;var arr=string.split(""),open_pointer=[],accumulator="",result=
[];arr.forEach(function(current_character){if(containers.includes(current_character)){if(current_character==open_pointer[open_pointer.length-1])open_pointer.shift(-1);else open_pointer.push(current_character);accumulator+=current_character;return}var current_separator=separators[current_character];if(!current_separator||open_pointer.length!=0){accumulator+=current_character;return}handle_separator(current_separator,current_character)});handle_separator(separators[ending_separator_character],"");return result;
function handle_separator(current_separator,current_character){if(!current_separator.separate_empty&&accumulator=="")return;if(current_separator.trim)accumulator=trim_specific_character(accumulator,current_separator.trim);result.push(accumulator);accumulator="";if(append_separator_character){var asc=append_separator_character,aso=separators[asc],append_arr=[];if((aso.append_for=="previous"||aso.append_for=="both")&&result.length>1)append_arr.push(result.length-2);if(aso.append_for=="current"||aso.append_for==
"both")append_arr.push(result.length-1);append_arr.forEach(function(n){if(aso.append_to=="front"||aso.append_to=="both")result[n]=asc+result[n];if(aso.append_to=="back"||aso.append_to=="both")result[n]=result[n]+asc});append_separator=undefined}if(current_separator.append)append_separator_character=current_character}function trim_specific_character(s,c){if(c==="]")c="\\]";if(c==="\\")c="\\\\";return s.replace(new RegExp("^["+c+"]+|["+c+"]+$","g"),"")}};e.shuffle=function(arr){for(var i=arr.length-
1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var x=arr[i];arr[i]=arr[j];arr[j]=x}return arr};e.highlight_word=function(init){var word_with_parens=init.match_whole_words_only+"("+init.word+")"+init.match_whole_words_only;var textarea_list=init.textarea_list?init.textarea_list:[init.textarea];textarea_list.forEach(function(element){element.innerHTML=element.innerHTML.replace(new RegExp(word_with_parens,"g"+init.match_case),'\x3cspan class\x3d"'+init.marked_class+'"\x3e$1\x3c/span\x3e')})};e.unhighlight_all_words=
function(init){var textarea_list=init.textarea_list?init.textarea_list:[init.textarea],marked_class=init.marked_class;textarea_list.forEach(function(textarea){var marked_list=textarea.querySelectorAll("."+marked_class);if(marked_list==null)return;Array.from(marked_list).forEach(function(highlighted_text){highlighted_text.outerHTML=highlighted_text.innerHTML})})};e.trigger_once_on_condition=function(condition,callback,interval_time,timeout_time,run_on_timeout){var interval_time=interval_time?interval_time:
10;var timeout_time=timeout_time?timeout_time:1E4;var timeout_counter=0;var interval=window.setInterval(function(){var result=condition();if(!result){timeout_counter+=interval_time;if(timeout_time!=0&&timeout_counter>=timeout_time){clearInterval(interval);if(run_on_timeout)callback(result)}return}clearInterval(interval);callback(result)},interval_time)};e.debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,
args)};clearTimeout(timeout);timeout=setTimeout(later,wait);var callNow=immediate&&!timeout;if(callNow)func.apply(context,args)}};e.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:Date.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=Date.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);
context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false)timeout=setTimeout(later,remaining);return result}};e.create_color_picker=function(init){var color_picker=dom.create("div",init);color_picker.style.overflow="hidden";var color_picker_inner=color_picker.color_picker_inner=dom.create("input",{parent:color_picker,type:"color",style:"width: 150%; height: 150%; margin-top: -25%; margin-left: -25%; padding: 0; cursor: pointer"});
color_picker.set_color=function(color){if(typeof color!="undefined")this.color_picker_inner.value=color};color_picker.get_color=function(){return this.color_picker_inner.value};color_picker_inner.set_color=function(color){this.value=color};color_picker_inner.get_color=function(){return this.value};color_picker.addEventListener=color_picker_inner.addEventListener;Object.defineProperty(color_picker,"disabled",{get:function(){return color_picker_inner.disabled},set:function(value){color_picker_inner.disabled=
value}});return color_picker};e.match_id_to_index=function(list,init){var id_to_index_name="id_to_index"in init?init.id_to_index:"id_to_index";var index_to_id_name="index_to_id"in init?init.index_to_id:"index_to_id";var id_to_index={},index_to_id=[],i=0;for(var id in list){id_to_index[id]=i;index_to_id[i]=id;i+=1}var result={};result[id_to_index_name]=id_to_index;result[index_to_id_name]=index_to_id;return result};e.decolumnize_object=function(object){var columns=object.columns;var data=object.data;
var output={};if(typeof columns!="undefined"&&typeof data!="undefined"&&typeof data["id"]!="undefined")for(var i=0;i<data["id"].length;i++){var entry={};columns.forEach(function(column_name){entry[column_name]=data[column_name][i]});output[data.id[i]]=entry}return output};e.decolumnize_array=function(object){var columns=object.columns;var data=object.data;var output=[];if(typeof columns!="undefined"&&typeof data!="undefined"&&typeof data["id"]!="undefined")for(var i=0;i<data["id"].length;i++){var entry=
{};columns.forEach(function(column_name){entry[column_name]=data[column_name][i]});output.push(entry)}return output};e.timeFormat={secondsToString:function(seconds,useMilliseconds,useHoursIfZero){if(!useMilliseconds)seconds=Math.round(seconds);else seconds=Math.round(seconds*1E3)/1E3;var useHoursIfZero=typeof useHoursIfZero=="undefined"?true:useHoursIfZero;var hours=Math.floor(seconds/3600),seconds=seconds-hours*3600;var minutes=Math.floor(seconds/60),seconds=seconds-minutes*60;if(useMilliseconds)var milliseconds=
Math.floor((seconds-Math.floor(seconds))*1E3);var seconds=useMilliseconds?Math.floor(seconds):Math.round(seconds);return(hours!=0||useHoursIfZero?"0".repeat(2-(hours+"").length)+hours+":":"")+"0".repeat(2-(minutes+"").length)+minutes+":"+"0".repeat(2-(seconds+"").length)+seconds+(!useMilliseconds?"":":"+("0".repeat(2-(milliseconds+"").length)+milliseconds))}};e.colorFormat={compose:function(colorFormat,c){switch(colorFormat){case "hex":return"#"+c[0].toString(16)+c[1].toString(16)+c[2].toString(16)+
(typeof c[3]=="undefined"?"ff":c[3].toString(16));case "rgb":return"rgb("+c[0]+", "+c[1]+", "+c[2]+")";case "rgba":return"rgba("+c[0]+", "+c[1]+", "+c[2]+", "+(typeof c[3]=="undefined"?1:c[3])+")";case "hsl":return"hsl("+c[0]+", "+c[1]+"%, "+c[2]+"%)";case "hsla":return"hsla("+c[0]+", "+c[1]+"%, "+c[2]+"%, "+(typeof c[3]=="undefined"?1:c[3])+")"}},convert:function(from,to,source,getComponents){switch(from){case "dec":var remainder=from;var b=remainder%256;remainder=(remainder-b)/256;var g=remainder%
256;remainder=(remainder-g)/256;var r=remainder%256;remainder=(remainder-r)/256;var a=remainder%256;case "hex":var r=parseInt(source[1]+source[2],16);var g=parseInt(source[3]+source[4],16);var b=parseInt(source[5]+source[6],16);if(typeof source[7]=="undefined")var a=1;else{if(typeof source[8]=="undefined")source[8]=source[7];var a=Math.round(parseInt(source[7]+source[8],16)/256*100)/100}break;case "rgb":case "rgba":var rgba=source.split(",");rgba[0]=rgba[0].split("(")[1];rgba[rgba.length-1]=rgba[rgba.length-
1].split(")")[0];rgba=rgba.map(function(n){return parseFloat(n.trim(),10)});var r=rgba[0],g=rgba[1],b=rgba[2],a=rgba.length==4?rgba[3]:1;break;case "hsl":case "hsla":var hsla=source.split(",");hsla[0]=hsla[0].split("(")[1];hsla[hsla.length-1]=hsla[hsla.length-1].split(")")[0];hsla=hsla.map(function(n){return parseFloat(n.trim(),10)});var h=hsla[0],s=hsla[1]/100,L=hsla[2]/100,a=hsla.length==4?hsla[3]:1;var c=(1-Math.abs(2*L-1))*s;var x=c*(1-Math.abs(h/60%2-1));var m=L-c/2;var rgb=function(){if(h<60)return[c,
x,0];if(h<120)return[x,c,0];if(h<180)return[0,c,x];if(h<240)return[0,x,c];if(h<300)return[x,0,c];if(h<360)return[c,0,x]}().map(function(n){return(n+m)*255});var r=rgb[0],g=rgb[1],b=rgb[2];break}switch(to){case "hex":return getComponents?[r,g,b,a]:"#"+r.toString(16)+g.toString(16)+b.toString(16)+a.toString(16);case "dec":return getComponents?[r,g,b,a]:a*16777216+r*65536+g*256+b;case "rgb":return getComponents?[r,g,b,a]:"rgb("+r+", "+g+", "+b+")";case "rgba":return getComponents?[r,g,b,a]:"rgba("+r+
", "+g+", "+b+", "+a+")";case "hsl":case "hsla":var rPrime=r/255,gPrime=g/255,bPrime=b/255;var cMax=Math.max(rPrime,gPrime,bPrime),cMin=Math.min(rPrime,gPrime,bPrime),delta=cMax-cMin;if(delta==0)var h=0;else switch(cMax){case rPrime:var h=60*(((gPrime-bPrime)/delta+6)%6);break;case gPrime:var h=60*((bPrime-rPrime)/delta+2);break;case bPrime:var h=60*((rPrime-gPrime)/delta+4);break}h=Math.round(h)%360;var L=(cMax+cMin)/2;var s=delta==0?0:Math.round(delta/(1-Math.abs(2*L-1))*100);L=Math.round(L*100);
if(getComponents)return[h,s,L,a];return"hsla("+h+", "+s+"%, "+L+"%"+(to=="hsl"?"":", "+a)+")"}}};e.array={};e.array.assign_function=function(array,assigned_function){var assigned_function_new=function(){return assigned_function.call(this,array)};array.forEach(function(entry){entry.previous=assigned_function_new})};e.array.previous=function(array){var entry=this;var index=array.findIndex(function(test){return test==entry})-1;return index>=0?array[index]:undefined};e.getSelectionText=function(){if(window.getSelection)return window.getSelection().toString();
if(document.selection&&document.selection.type!="Control")return document.selection.createRange().text;return""};e.splitElement=function(init){if(init.target.innerHTML=="")return{new:init.target,old:init.target};var target=init.target,splitNode=init.splitNode,splitOffset=init.splitOffset,destructive=init.destructive;if(!destructive){var target=cloneChildNodes(target);function cloneChildNodes(element){var clone=element.cloneNode(false);if(element==splitNode)splitNode=clone;if(element.childNodes)element.childNodes.forEach(function(child){clone.appendChild(cloneChildNodes(child))});
return clone}}if(splitNode.nodeName=="#text"){var newNode=document.createTextNode(splitNode.textContent.substr(0,splitOffset));splitNode.parentNode.insertBefore(newNode,splitNode);splitNode.textContent=splitNode.textContent.substr(splitOffset);if(splitNode.parentNode==null)newNode.parentNode.appendChild(splitNode)}if(splitNode==target)splitNode=target.childNodes[splitOffset==0?0:splitOffset-1];while(true){var parent=splitNode.parentNode,cloneNew=parent.cloneNode(false),seenSplitChild=false;if(typeof previousCloneNew!=
"undefined")cloneNew.appendChild(previousCloneNew);Array.from(parent.childNodes).forEach(function(child){if(child==splitNode)seenSplitChild=true;if(!seenSplitChild)return;if(child!=splitNode||typeof previousCloneNew=="undefined"&&splitNode.nodeName=="#text")cloneNew.appendChild(child)});if(parent==target||parent.parentNode==null)break;splitNode=parent;var previousCloneNew=cloneNew}return{new:cloneNew,old:parent}};e.domColor={};e.domColor.backgroundColorHex=function(element){var original_color=window.getComputedStyle(element).backgroundColor;
if(original_color.substr(0,3)=="rgb"){var s=original_color.substr(0,3)=="rgb"?4:5;original_color=h.rgb_to_hex.apply(null,original_color.substr(s).split(",").map(function(n){return parseInt(n)}))}return original_color};e.domColor.backgroundFade=function(init){var element=init.element,start=init.start,end=init.end,duration=init.duration;var tick_size=100/(duration/25);var n=0;fade_color();function fade_color(){var new_color=h.hex_color_blend(start,end,1-n/100);element.style.backgroundColor=new_color;
if(n>=100){if(init.callback)init.callback();return}n+=tick_size;setTimeout(fade_color,25)}};e.callback_parallelize=function(op_list,callback){var count=op_list.length,result={};function completion_test(){count-=1;if(count==0)callback(result)}op_list.forEach(function(op_entry){var arr=op_entry.parameters||[];arr.push(function(data){result[op_entry.output]=data;completion_test()});op_entry.function.apply(null,arr)})};var gui=e.gui={};gui.dropdown={create:function(init){var dropdown={onCollapse:init.onCollapse,
onExpand:init.onExpand,closeOnClick:typeof init.closeOnClick!="undefined"?init.closeOnClick:true,onHeaderChange:init.onHeaderChange,onBeforeSelect:init.onBeforeSelect,onBeforeChange:init.onBeforeChange,onSelect:init.onSelect,onChange:init.onChange,selected:init.selected,clickEventType:init.clickEventType,hideMethod:init.hideMethod,element:dom.create("div"),preventDefault:typeof init.preventDefault!="undefined"?init.preventDefault:true,autoexit:typeof init.autoexit!="undefined"?init.autoexit:true,
autoLeftMargin:typeof init.autoLeftMargin!="undefined"?init.autoLeftMargin:document.body,initialValue:init.initialValue,list:init.list};var classDefault="dropdown";dropdown.className=typeof init.className=="function"?init.className(classDefault):typeof init.className=="undefined"?classDefault:init.className;init.parent.appendChild(dropdown.element);var generator=this;dropdown.destroy=function(){generator.destroy.apply(dropdown,Array.from(arguments))};dropdown.refresh=function(){generator.refresh.apply(dropdown,
Array.from(arguments))};dropdown.add=function(){generator.add.apply(dropdown,Array.from(arguments))};dropdown.remove=function(){generator.remove.apply(dropdown,Array.from(arguments))};dropdown.update=function(){generator.update.apply(dropdown,Array.from(arguments))};dropdown.refreshObserver=function(){generator.refreshObserver.apply(dropdown,Array.from(arguments))};dropdown.refresh();return dropdown},destroy:function(){if(this.element)this.element.removeEventListener(this.clickEventType,this.onCollapseExpandEvent)},
refreshObserver:function(){var dropdown=this;e.observeDOMRemoval({element:dropdown.element,dataContainer:dropdown,callback:function(){dropdown.destroy()}})},refresh:function(){function isAttached(element){while(true){element=element.parentNode;if(element==document.documentElement)return true;if(element==null)return false}}var dropdown=this;dropdown.destroy();var element=dropdown.element;dropdown.refreshObserver();element.dropdownControl=dropdown;element.innerHTML="";if(!dropdown.clickEventType)dropdown.clickEventType=
"click";if(!dropdown.hideMethod)dropdown.hideMethod="display";dropdown.isCollapsed=true;element.classList.add(dropdown.className);if(!dropdown.dropdownCollapseEvent){dropdown.dropdownCollapseEvent=function(evt){if(dropdown.isCollapsed)return;if(dropdown.element.contains(evt.target))return;if(!isAttached(dropdown.element)){document.body.removeEventListener(dropdown.clickEventType,dropdown.dropdownCollapseEvent);return}dropdown.isCollapsed=true;dropdown.onCollapseExpand({currentTarget:{dropdownControl:dropdown}})};
document.body.addEventListener(dropdown.clickEventType,dropdown.dropdownCollapseEvent)}dropdown.onCollapseExpand=function(){dropdown.headerElement.className=dropdown.className+"-header "+(dropdown.className+"-header-"+(dropdown.isCollapsed?"collapsed":"expanded"));var optionContainer=dropdown.optionContainer;switch(dropdown.hideMethod){case "display":optionContainer.style.display=dropdown.isCollapsed?"none":"";break;case "visibility":optionContainer.style.visibility=dropdown.isCollapsed?"hidden":
"";break;break}if(dropdown.isCollapsed)optionContainer.style.left="";else if(dropdown.autoLeftMargin){var optRect=optionContainer.getBoundingClientRect();var leftOverflow=document.body.getBoundingClientRect().width-optRect.x-optRect.width;if(leftOverflow<0)optionContainer.style.left=leftOverflow+"px"}var callback=dropdown[dropdown.isCollapsed?"onCollapse":"onExpand"];if(callback)callback(dropdown.isCollapsed)};dropdown.onChangeEvent=function(evt,selected){var selected=evt.currentTarget.dropdownOption;
if(!dropdown.onBeforeChange)onChange();else dropdown.onBeforeChange(evt,selected,function(success){if(success)onChange()});function onChange(){dropdown.setSelected(selected);if(dropdown.onChange)dropdown.onChange(evt,selected);if(dropdown.closeOnClick==true){dropdown.isCollapsed=true;dropdown.onCollapseExpand()}}};dropdown.setSelected=function(selected){dropdown.selected=selected;if(dropdown.selectedElement)dropdown.selectedElement.classList.remove(dropdown.className+"-selected");if(dropdown.checkElement&&
dropdown.checkElement.parentNode==dropdown.selectedElement)dropdown.selectedElement.removeChild(dropdown.checkElement);if(dropdown.headerElement&&dropdown.headerElement.parentNode==headerElementWrapper)headerElementWrapper.removeChild(dropdown.headerElement);if(typeof selected=="undefined")return;var selectedElement=dropdown.selectedElement=selected.element;selectedElement.classList.add(dropdown.className+"-selected");var checkElement=dropdown.checkElement=dom.create("span");checkElement.className=
dropdown.className+"-check";selectedElement.insertBefore(checkElement,selectedElement.firstChild);var headerElement=dropdown.headerElement=dom.create("div");headerElement.className=dropdown.className+"-header "+(dropdown.className+"-header-"+(dropdown.isCollapsed?"collapsed":"expanded"));headerElement.innerHTML=dropdown.onHeaderChange?dropdown.onHeaderChange(selected.text):selected.text;dropdown.addArrow(headerElement);headerElementWrapper.appendChild(headerElement)};dropdown.addArrow=function(headerElement){var arrow=
dom.create("span");arrow.className=dropdown.className+"-arrow";headerElement.appendChild(arrow)};dropdown.onSelectEvent=function(evt){evt.stopPropagation();if(dropdown.preventDefault)evt.preventDefault();var selected=evt.currentTarget.dropdownOption;if(!dropdown.onBeforeSelect)onSelect();else dropdown.onBeforeSelect(evt,selected,function(success){if(success)onSelect()});function onSelect(){dropdown.onChangeEvent(evt,selected);if(dropdown.onSelect)dropdown.onSelect(evt,selected)}};var optionContainerWrapper=
dropdown.optionContainerWrapper=dom.create("div");element.appendChild(optionContainerWrapper);optionContainerWrapper.className=dropdown.className+"-option_container_wrapper";var optionContainer=dropdown.optionContainer=dom.create("div");optionContainerWrapper.appendChild(optionContainer);optionContainer.className=dropdown.className+"-option_container";switch(dropdown.hideMethod){case "display":optionContainer.style.display="none";break;case "visibility":optionContainer.style.visibility="hidden";break}var selected=
undefined;dropdown.list.forEach(function(option){dropdown.add(option,{doNotPush:true});if(option.selected)selected=option;if(typeof dropdown.initialValue!="undefined"&&dropdown.initialValue==option.value)selected=option});var headerElementWrapper=dom.create("div");headerElementWrapper.className=dropdown.className+"-header_wrapper";element.insertBefore(headerElementWrapper,element.firstChild);if(!selected)selected=dropdown.list[0];dropdown.setSelected(selected);Object.defineProperty(element,"selectedIndex",
{configurable:true,get:function(){return Array.from(optionContainer.children).indexOf(dropdown.selectedElement)},set:function(index){if(index==-1)return;var selectedElement=optionContainer.children[index];return dropdown.onChangeEvent({currentTarget:{value:selectedElement.value,dropdownOption:selectedElement.dropdownOption}})}});element.options=optionContainer.childNodes;element.addEventListener(dropdown.clickEventType,function(evt){if(dropdown.headerElement.contains(evt.target)||dropdown.closeOnClick==
true||dropdown.isCollapsed){dropdown.isCollapsed=!dropdown.isCollapsed;dropdown.onCollapseExpand()}});return dropdown},add:function(option,options){var dropdown=this;if(!options||!options.doNotPush)dropdown.list.push(option);if(!options)options={};var child=dom.create("div");option.element=child;child.dropdownOption=option;child.className=dropdown.className+"-option";child.innerHTML=option.text;child.value=option.value;Object.defineProperty(child,"value",{get:function(value){return option.value},
set:function(value){option.value=value}});if(options.insertBefore){var referenceNode=dropdown.list.find(function(test){return test.value==options.insertBefore}).element;dropdown.optionContainer.insertBefore(child,referenceNode)}else dropdown.optionContainer.appendChild(child);child.addEventListener(dropdown.clickEventType,dropdown.onSelectEvent)},remove:function(option){var dropdown=this;var foundOptionIndex=dropdown.list.findIndex(function(test){return test.value==option.value});if(foundOptionIndex==
-1)return;var foundOption=dropdown.list[foundOptionIndex];foundOption.element.parentNode.removeChild(foundOption.element);dropdown.list.splice(foundOptionIndex,1);if(dropdown.element.selectedIndex==foundOptionIndex){dropdown.headerElement.innerHTML=typeof option.altIndex=="undefined"?"":option.altIndex;dropdown.addArrow(dropdown.headerElement)}},update:function(option){var dropdown=this;var foundOptionIndex=dropdown.list.findIndex(function(test){return test.value==option.value});if(foundOptionIndex==
-1)return;var foundOption=dropdown.list[foundOptionIndex];foundOption.element.innerHTML=option.text;if(option.newValue)foundOption.value=option.newValue;if(dropdown.element.selectedIndex==foundOptionIndex){dropdown.headerElement.innerHTML=option.text;dropdown.addArrow(dropdown.headerElement)}}};gui.checkbox={create:function(init){var checkbox={onChange:init.onChange,clickEventType:init.clickEventType,element:dom.create("div"),initialValue:init.initialValue,text:init.text};var classDefault="checkbox";
checkbox.className=typeof init.className=="function"?init.className(classDefault):typeof init.className=="undefined"?classDefault:init.className;init.parent.appendChild(checkbox.element);var generator=this;checkbox.refresh=function(){generator.refresh.apply(checkbox,Array.from(arguments))};checkbox.refresh();return checkbox},refresh:function(){var checkbox=this,element=checkbox.element;element.checkboxControl=checkbox;element.innerHTML="";if(!checkbox.clickEventType)checkbox.clickEventType="click";
checkbox.isChecked=checkbox.initialValue;element.classList.add(checkbox.className);checkbox.label=dom.create("label",{parent:element});checkbox.input=dom.create("input",{parent:checkbox.label,name:checkbox.inputName,type:"checkbox"});checkbox.slider=dom.create("span",{parent:checkbox.label});checkbox.control=dom.create("span",{parent:checkbox.slider});checkbox.text=dom.create("span",{parent:element,innerHTML:checkbox.text});checkbox.input.checked=checkbox.isChecked;if(checkbox.onChange)checkbox.input.addEventListener("change",
checkbox.onChange);return checkbox}};gui.progressbar={create:function(init){var progressbar={clickEventType:init.clickEventType,element:dom.create("div")};var classDefault="progressbar";progressbar.className=typeof init.className=="function"?init.className(classDefault):typeof init.className=="undefined"?classDefault:init.className;init.parent.appendChild(progressbar.element);var generator=this;progressbar.refresh=function(){generator.refresh.apply(progressbar,Array.from(arguments))};progressbar.update=
function(){generator.update.apply(progressbar,Array.from(arguments))};progressbar.refresh(init);return progressbar},refresh:function(init){var progressbar=this,element=progressbar.element;element.progressbarControl=progressbar;element.innerHTML="";if(!progressbar.clickEventType)progressbar.clickEventType="click";element.classList.add(progressbar.className);progressbar.bar=dom.create("div",{parent:element});progressbar.text=dom.create("div",{parent:element});progressbar.update(init);return progressbar},
update:function(init){var percent=init.percent,text=init.text;var progressbar=this;progressbar.bar.classList[percent==100?"add":"remove"](progressbar.className+"-complete");progressbar.bar.style.width=percent+"%";progressbar.text.innerHTML=text+" ("+percent+"%)"}};e.observeDOMRemoval=function(init){var element=init.element,dataContainer=init.dataContainer,callback=init.callback;if(dataContainer.removalObserver){dataContainer.removalObserver.disconnect();delete dataContainer.removalObserver}var parent=
element.parentNode;if(!parent)return undefined;var MutationObserver=window.MutationObserver||window.WebkitMutationObserver;if(typeof MutationObserver=="undefined")return;var observer=dataContainer.removalObserver=new MutationObserver(function(mutation_list){for(var i=0,curlen_i=mutation_list.length;i<curlen_i;i++){var mutation_item=mutation_list[i];if(mutation_item.type!="childList")return;for(var j=0,curlen_j=mutation_item.removedNodes.length;j<curlen_j;j++){if(mutation_item.removedNodes[j]!=element)continue;
observer.disconnect();dataContainer.removalObserver=undefined;callback();return}}});observer.observe(parent,{childList:true,attributes:false,characterData:false,subtree:false});return observer};e.observeDOMAppend=function(init){var element=init.element,search=init.search,dataContainer=init.dataContainer,callback=init.callback;if(!dataContainer.additionObserverList)dataContainer.additionObserverList=[];var MutationObserver=window.MutationObserver||window.WebkitMutationObserver;if(typeof MutationObserver==
"undefined")return;var observer=new MutationObserver(function(mutation_list){for(var i=0,curlen_i=mutation_list.length;i<curlen_i;i++){var mutation_item=mutation_list[i];if(mutation_item.type!="childList")return;for(var j=0,curlen_j=mutation_item.addedNodes.length;j<curlen_j;j++){if(mutation_item.addedNodes[j]!=search())continue;observer.disconnect();dataContainer.additionObserverList.some(function(observer_test,i){if(observer_test==observer){dataContainer.additionObserverList.splice(i,1);return true}});
callback();return}}});dataContainer.additionObserverList.push(observer);observer.observe(element,{childList:true,attributes:false,characterData:false,subtree:false});return observer};e.autocomplete=function(init){var tree={branches:{}};tree.add=function(text){var lText=text.toLowerCase();var branch=this.branches;for(var i=0;i<lText.length;i++){if(typeof branch[lText[i]]=="undefined")branch[lText[i]]={};branch=branch[lText[i]]}branch[lText]=text};tree.search=function(text,hint){if(text=="")return"";
var lText=text.toLowerCase();var branch=this.branches;for(var i=0;i<lText.length;i++){branch=branch[lText[i]];if(typeof branch=="undefined")return false}if(typeof branch[lText]=="undefined"){if(!hint)return i;while(true){var keys=Object.keys(branch);if(typeof branch[keys[0]]=="string")return branch[keys[0]];var branch=branch[keys[Math.floor(Math.random()*Math.floor(keys.length))]];if(typeof branch=="string")return branch}}return branch[lText]};if(init.list)init.list.forEach(function(w){tree.add(w)});
return tree};e.getScript=function(file,success,error){e.get_script({file:file,success:success,error:error})};e.get_script_list=function(init){var file_list=init.file_list,success=init.success,error=init.error,callback=init.callback;var count=file_list.length;if(file_list.length==0){setTimeout(function(){success();callback()},0);return}file_list.forEach(function(filename){e.get_script({file:filename,success:success,error:error,callback:function(){count-=1;if(count==0&&callback)callback()}})})};e.get_script=
function(init){var file=init.file,success=init.success,error=init.error,callback=init.callback;var script=document.createElement("script");var prior=document.getElementsByTagName("script")[0];script.async=1;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;script=undefined;if(!success&&!error&&!callback)return;setTimeout(function(){if(!isAbort){if(success)success()}else if(error)error();
if(callback)callback()})}};script.src=file;prior.parentNode.insertBefore(script,prior)};e.add_or_update_meta_tags=function(meta_list){var target_insertion_point=document.head.querySelectorAll("head meta");target_insertion_point=target_insertion_point[target_insertion_point.length-1];if(target_insertion_point==null)target_insertion_point=document.head.firstChild;if(target_insertion_point!=null)target_insertion_point=target_insertion_point.nextSibling;for(var meta_name in meta_list){var meta_data=meta_list[meta_name];
var meta_tag=document.head.querySelector('head meta[name\x3d"'+meta_name+'"]');if(!meta_tag)meta_tag=dom.create("meta",{parent:document.head}).dom.insertBefore(target_insertion_point);meta_tag.name=meta_name;meta_tag.content=meta_data}};return e};
function create_search(init){var h=helperjs,main=init.main,gs=main.gs,e=gs.extrautilfuncs,dom=h.dom;var css_class_prefix=gs.css_class_prefix;var search=init.main.views.search={};search.elements=[];var history_control=main.history_control.add_preset({settings:{element_container:search}});search.set_subview=function(init){search[init.state.page].apply(null,arguments)};function create_search_input(init){var parent=init.parent,className=init.className;var placeholder_text="Search by symbol, company name, or keyword.";
return dom.create("input",{parent:parent,className:className,type:"text",placeholder:placeholder_text})}search.search=function(init){var q=init.state.q,source_user=undefined;if(q)get_search_results(q,function(result){create_search_container();populate_search_results(result);source_user=result.source_user;history_control.complete()});else create_search_container();function create_search_container(){var parent=init.parent;parent.style.backgroundColor="";parent.innerHTML="";add_meta_tags(q);var search_container=
search.element=dom.create("div",{parent:parent,className:q?"compact_search":"initial_search"});var search_main_wrapper=dom.create("div",{parent:search_container,className:"search-main_wrapper"});var search_header=dom.create("div",{parent:search_main_wrapper,className:"search-header"});var search_header_inner=dom.create("div",{parent:search_header});var search_searchbox=dom.create("div",{parent:search_main_wrapper,className:"search-searchbox"});var search_input=create_search_input({parent:search_searchbox,
className:"search-searchbox-input"});search_input.type="search";if(q){search.result_list=dom.create("div",{parent:search_container,className:"search-result_list"});search_input.value=q}search_input.addEventListener("change",function(evt){history_control.load_page({page:"search",q:search_input.value},{defer:true,title:"Search"})});function add_meta_tags(q){var meta_list={title:q+" - TranscriptShare Search",description:"Transcriptshare search results for "+q};e.add_or_update_meta_tags(meta_list)}}function list_fragment_details_event(evt,
list_fragment_details_options){list_fragment_details_options=list_fragment_details_options?list_fragment_details_options:{};var currentTarget=evt.currentTarget;var entry=currentTarget.parentNode.parentNode;if(currentTarget.getAttribute("data-expand-state")=="expanding")return;function list_fragment_details_close(options){entry.subresult_element_list.forEach(function(subresult_element){if(subresult_element.parentNode)subresult_element.parentNode.removeChild(subresult_element)});set_expand_state(currentTarget,
"collapsed",options)}if(currentTarget.getAttribute("data-expand-state")=="expanded"&&!list_fragment_details_options.ignore_expanded_state){list_fragment_details_close();return}set_expand_state(currentTarget,"expanding");var filtered_query=filter_query({q:q,source_user:source_user});q_without_symbol_or_company_name_list=filtered_query.q_without_symbol_or_company_name_list;q_intext_keywords_only_list=filtered_query.q_intext_keywords_only_list;if(entry.getAttribute("data-or_only"))var q_without_symbol_or_company_name_list=
q_without_symbol_or_company_name_list.map(function(keyword){return keyword[0]=="+"?keyword.slice(1):keyword});h.get_data({file:"/dbrequest.php",data:"action\x3dtranscript-list\x26f\x3d1\x26transcript_id\x3d"+entry.getAttribute("data-transcript_id")+"\x26q\x3d"+query_encode(q_without_symbol_or_company_name_list.join(" ")),error:function(result){set_expand_state(currentTarget,"collapsed");main.send_errormessage(result)},success:function(result){main.action_lock.clear();callback(result)}});var callback=
function(search_result){if(list_fragment_details_options.callback_pre)list_fragment_details_options.callback_pre();set_expand_state(currentTarget,"expanded");var fragment_speaker_list=search_result.fragment_speaker_list;var fragment_list=Object.values(search_result.fragment_list);if(fragment_list.length==0||typeof fragment_list[0].speaker_id=="undefined"){var fragment_container_empty=dom.create("div",{parent:entry,className:"search-result-fragment_container_empty"});var q_or_only=q_without_symbol_or_company_name_list.map(function(keyword){return keyword[0]==
"+"?keyword.slice(1):keyword});fragment_container_empty.innerHTML="Couldn't find transcript fragments with all of the search terms in at least one fragment. Search for any (instead of all) of the search terms instead? \x3cb\x3e(\""+q_or_only.join(" ")+'")\x3c/b\x3e. \x26nbsp;';var redo_search_link=dom.create("a",{parent:fragment_container_empty,style:{display:"inline-block"}});redo_search_link.innerHTML="OK!";redo_search_link.href="or-only";redo_search_link.addEventListener(gs.events.POINT,function(evt){evt.preventDefault();
if(main.action_lock.state)return;main.action_lock.set();entry.setAttribute("data-or_only",true);list_fragment_details_event({currentTarget:currentTarget},{ignore_expanded_state:true,callback_pre:function(){list_fragment_details_close({instant:true})}})});entry.subresult_element_list=[fragment_container_empty]}else{var current_result_view=0;var fragment_container=dom.create("div",{parent:entry,className:"search-result-fragment_container"});if(fragment_list.length>1)var navigation=create_navigation({sibling:entry.entry_title});
var result=create_timeline({parent:entry.entry_title});var result_timeline=result.result_timeline,result_region_container=result.region_container;entry.subresult_element_list=[fragment_container,result_timeline,result_region_container];if(navigation)entry.subresult_element_list.push(navigation.container);load_search_subresult(current_result_view)}function load_search_subresult(n){fragment_container.innerHTML="";var fragment_data=fragment_list[n];var speaker_id=fragment_data.speaker_id;var speaker_data=
fragment_speaker_list[speaker_id];var fragment=dom.create("div",{parent:fragment_container,className:"search-result-fragment"});var fragment_header=dom.create("div",{parent:fragment,className:"no-print editor-fragment-header"});var edit_controls=dom.create("div",{parent:fragment_header,className:"editor-fragment-edit_controls"});var expand_button=dom.create("div",{parent:edit_controls,className:"editor-fragment-share_button"});expand_button.innerHTML='\x3cdiv\x3eexpand\x3c/div\x3e\x3cdiv class\x3d"custom_symbols custom_symbols-link"\x3e\x3c/div\x3e';
expand_button.addEventListener(gs.events.POINT,click_fragment_link);expand_button.entry=entry;expand_button.href="https://www.transcriptshare.com/play/"+fragment_data.u;expand_button.style.backgroundColor=speaker_data.c;var fragment_textarea=dom.create("div",{parent:fragment,className:"search-result-fragment-textarea tmagic--editor-fragment-textarea"});fragment_textarea.innerHTML=fragment_data.t;highlight_word_list(fragment_textarea,q_intext_keywords_only_list);var speaker_div=dom.create("div",{parent:fragment_textarea.firstChild,
className:"tmagic--editor-fragment-textarea-speaker-name"}).dom.insertBefore(fragment_textarea.firstChild.firstChild);speaker_div.innerHTML=speaker_data.n+":\x26nbsp";update_navigation(navigation,n);function update_navigation(navigation,index){if(!navigation)return;navigation.text.innerHTML="";dom.create("span",{parent:navigation.text,className:"search-result-fragment_navigation-text-result"});dom.create("span",{parent:navigation.text,innerHTML:index+1});dom.create("span",{parent:navigation.text,
className:"search-result-fragment_navigation-text-of"});dom.create("span",{parent:navigation.text,innerHTML:fragment_list.length})}}function create_navigation(init){var sibling=init.sibling;var navigation={};var container=navigation.container=dom.create("div",{parent:sibling.parentNode,className:"search-result-fragment_navigation-container"}).dom.insertBefore(sibling);var nav_left=navigation.nav_left=dom.create("div",{parent:container,className:"glyphicon glyphicon-chevron-left  search-result-fragment_navigation-button"});
var text=navigation.text=dom.create("div",{parent:container,className:"search-result-fragment_navigation-text"});var nav_right=navigation.nav_right=dom.create("div",{parent:container,className:"glyphicon glyphicon-chevron-right search-result-fragment_navigation-button"});refresh_disabled_navs();nav_left.addEventListener(gs.events.POINT,function(){if(nav_left_disabled)return;if(current_result_view<=0)return;current_result_view-=1;load_search_subresult(current_result_view);refresh_disabled_navs()});
nav_right.addEventListener(gs.events.POINT,function(){if(nav_right_disabled)return;if(current_result_view>=fragment_list.length-1)return;current_result_view+=1;load_search_subresult(current_result_view);refresh_disabled_navs()});return navigation;var nav_left_disabled,nav_right_disabled;function refresh_disabled_navs(){nav_left_disabled=current_result_view==0;nav_right_disabled=current_result_view==fragment_list.length-1;nav_left.classList[nav_left_disabled?"add":"remove"](gs.css("search-result-fragment_navigation-button-disabled"));
nav_right.classList[nav_right_disabled?"add":"remove"](gs.css("search-result-fragment_navigation-button-disabled"))}}function create_timeline(init){var parent=init.parent;var result={};var result_timeline=result.result_timeline=dom.create("div",{parent:parent,className:"tmagic--search-result-timeline-background"});var result_region_container=result.region_container=dom.create("div",{parent:parent,className:"tmagic--search-result-timeline-region_container"});result_timeline.style.display="none";result_region_container.style.display=
"none";return result}};function highlight_word_list(textarea,list){var marked_class=gs.css("editor-search_highlight");list.forEach(function(word){e.highlight_word({textarea:textarea,word:word,match_whole_words_only:"\\b",match_case:"i",marked_class:marked_class})})}function click_fragment_link(evt){if(main.action_lock.state)return;main.action_lock.set();evt.preventDefault();var subheader=evt.currentTarget,shorturl=subheader.href.substr(subheader.href.lastIndexOf("/")+1);var entry=subheader.entry;
var loading_bar=dom.create("div",{parent:entry.entry_title,className:"search-result-loading_bar"}).dom.insertBefore(entry.entry_link);entry.entry_title.parentNode.classList.add(gs.css("search-result-loading"));var n=0,load_interval=setInterval(function(){n+=1;loading_bar.style.width=n+"%";if(n>=100)clearInterval(load_interval)},20);search_get_transcript_header(shorturl,function(result){main.action_lock.clear();if(result.error){main.send_errormessage(result);return}var load_vars={};if(result.stock_symbol){load_vars.username=
result.stock_symbol.toLowerCase();load_vars.page="symbol"}else{load_vars.page="play";load_vars.username=result.username}load_vars.urlname=result.urlname;load_vars.fragment_id=result.fragment_id;history_control.load_page(load_vars,{defer:true})})}}function populate_search_results(search_result){var transcript_list=search_result.transcript_list;if(typeof transcript_list=="undefined"){var no_results=dom.create("div",{parent:search.result_list,className:"search-result search-result-no_results"});no_results.innerHTML=
"No results found.";return}transcript_list.forEach(function(header_data){var entry=dom.create("div",{parent:search.result_list,className:"search-result"});entry.setAttribute("data-transcript_id",header_data.id);var entry_header=dom.create("div",{parent:entry,className:"search-result-header"});if(search_result.might_have_fragments){var entry_expand=dom.create("div",{parent:entry_header,className:"search-result-expand glyphicon glyphicon-chevron-down"});entry_expand.addEventListener(gs.events.POINT,
list_fragment_details_event)}var entry_date=dom.create("div",{parent:entry_header,className:"search-result-date"});var record_date=header_data.record_date;if(record_date!==null){record_date*=1E3;entry_date.innerHTML=moment.utc(record_date).format("MMM Y");entry_date.classList.add(gs.css("month_color-"+moment.utc(record_date).format("MMMM").toLowerCase()))}var entry_title=entry.entry_title=dom.create("div",{parent:entry_header,className:"search-result-title"});var entry_link=entry.entry_link=dom.create("a",
{parent:entry_title});entry_link.innerHTML=header_data.name;if(search_result.source_user&&search_result.source_user.s)entry_link.href="https://www.transcriptshare.com/s/"+search_result.source_user.s.toLowerCase()+"/"+header_data.urlname;else entry_link.href="https://www.transcriptshare.com/play/"+header_data.shorturl;entry_link.dataset.shorturl=header_data.shorturl;entry_link.addEventListener(gs.events.POINT,click_link)});function click_link(evt){if(main.action_lock.state)return;main.action_lock.set();
evt.preventDefault();var entry_header=evt.currentTarget,shorturl=entry_header.dataset.shorturl;var entry_title=evt.currentTarget.parentNode;var loading_bar=dom.create("div",{parent:entry_title,className:"search-result-loading_bar"}).dom.insertBefore(evt.currentTarget);entry_title.parentNode.parentNode.classList.add(gs.css("search-result-loading"));var n=0,load_interval=setInterval(function(){n+=1;loading_bar.style.width=n+"%";if(n>=100)clearInterval(load_interval)},20);search_get_transcript_header(shorturl,
function(result){main.action_lock.clear();if(result.error){main.send_errormessage(result);return}var load_vars={};if(result.stock_symbol){load_vars.username=result.stock_symbol.toLowerCase();load_vars.page="s"}else{load_vars.username=result.username;load_vars.page="play"}load_vars.urlname=result.urlname;history_control.load_page(load_vars,{defer:true})})}}function search_get_transcript_header(shorturl,callback){h.get_data({file:"/dbrequest.php",data:"action\x3dtranscript-header\x26shorturl\x3d"+shorturl,
error:callback,success:callback})}function get_search_results(query_string,callback){if(main.action_lock.state)return;main.action_lock.set();h.get_data({file:"/dbrequest.php",data:"action\x3dtranscript-list\x26q\x3d"+query_encode(query_string),error:function(result){main.send_errormessage(result)},success:function(result){main.action_lock.clear();callback(result)}})}};function set_expand_state(target,op,options){options=options||{};target.setAttribute("data-expand-state",op);target.classList[op==
"expanded"?"add":"remove"]("glyphicon-chevron-up");target.classList[op=="collapsed"?"add":"remove"]("glyphicon-chevron-down");target.classList[op=="expanding"?"add":"remove"]("glyphicon-hourglass")}function query_encode(query_string){return encodeURI(query_string).replace(/\-/g,"%2D").replace(/\+/g,"%2B")}function filter_query(init){var q=init.q,source_user=init.source_user;var q_array=e.string_to_array({string:q,separators:{" ":{trim:[" "],separate_empty:false,append:false}},replace:function(string){return string.replace(/\s\+\s/g,
" ")},containers:['"',"'"],ending_separator_character:" "});var q_without_symbol_or_company_name_list=q_array.filter(function(keyword){if(source_user&&typeof source_user.u!="undefined"&&keyword.toLowerCase()==source_user.u.toLowerCase())return false;if(source_user&&typeof source_user.s!="undefined"&&keyword.toLowerCase()==source_user.s.toLowerCase())return false;return true});var q_intext_keywords_only_list=q_array.filter(function(keyword){var keyword=keyword.toLowerCase().trim();if(source_user&&
typeof source_user.u!="undefined"&&keyword==source_user.u.toLowerCase())return false;if(source_user&&typeof source_user.s!="undefined"&&keyword==source_user.s.toLowerCase())return false;var is_quote=keyword[0]=='"'&&keyword[keyword.length-1]=='"'||keyword[0]=="'"&&keyword[keyword.length-1]=="'";if(!is_quote&&keyword.includes(":"))return false;return true});q_intext_keywords_only_list=q_intext_keywords_only_list.map(function(keyword){keyword=keyword[0]=="+"?keyword.slice(1):keyword;var is_quote=keyword[0]==
'"'&&keyword[keyword.length-1]=='"'||keyword[0]=="'"&&keyword[keyword.length-1]=="'";if(is_quote)keyword=keyword.substr(1,keyword.length-2);return keyword});return{q_without_symbol_or_company_name_list:q_without_symbol_or_company_name_list,q_intext_keywords_only_list:q_intext_keywords_only_list}}return search}
function create_login(init){var h=helperjs,main=init.main,gs=main.gs,dom=h.dom,css_class_prefix=gs.css_class_prefix;var make_text=h.make_text,make_label_and_input=h.make_label_and_input,append_br=h.append_br;var set_to_biggest_width=h.set_to_biggest_width,get_data=h.get_data;function set_labels_to_biggest_width(row_list){return set_to_biggest_width(labels_from_rows(Object.values(row_list)))}function labels_from_rows(row_array){return row_array.map(function(row){return row.label})}var login_menu=init.main.views.login=
{};var history_control=main.history_control.add_preset({settings:{element_container:login_menu}});login_menu.set_subview=function(init){init.parent.style.backgroundColor="";init.parent.innerHTML="";var main_form=login_menu.element=dom.create("form",{parent:init.parent,className:"login_menu-form"});main_form.addEventListener("submit",function(evt){evt.preventDefault()});login_menu[init.state.page]({parent:main_form})};login_menu.resend_activation_code_request=function(init){var parent=init.parent;
var form_top=dom.create("div",{parent:parent,className:"login_menu-form_top"});var header_image=dom.create("div",{parent:form_top,className:"login_menu-header_image"});var text_and_inputs=dom.create("div",{parent:form_top,className:"login_menu-form_top-text_and_inputs"});var header_text=dom.create("p",{parent:text_and_inputs,className:"login_menu-header_text",innerHTML:"Please enter your username or email address to re-send an activation code link."});var username_or_emailaddress=dom.create("div",
{parent:text_and_inputs,style:{width:"100%"},className:"login_menu-input_row",children:[["input","input",{type:"text",name:"username_emailaddress",style:{display:"inline-block",width:"100%"}}]]});var form_bottom=dom.create("div",{parent:parent,className:"login_menu-form_bottom"});parent.onsubmit=function(){return false};var submit_button=dom.create("button",{parent:form_bottom,form_obj:parent,innerHTML:"Send Link",className:"login_menu-button "+css_class_prefix+"button "+css_class_prefix+"button-green",
events:{"click":process_reset_password_request}});var bottom_text_div=dom.create("div",{parent:form_bottom,className:"login_menu-bottom_text"});var login_text=dom.create("a",{parent:bottom_text_div,innerHTML:"Have a login?",className:"login_menu-dark",style:{display:"inline-block",marginRight:"8px"},events:{"click":function(){history_control.load_page({page:"login"},{title:"Login"})}}});var register_text=dom.create("a",{parent:bottom_text_div,innerHTML:"Need to register?",className:"login_menu-dark",
style:{display:"inline-block"},events:{"click":function(){history_control.load_page({page:"register"},{title:"Register"})}}});function process_reset_password_request(){function success(successmessage){main.action_lock.clear();smoke.alert(successmessage["message"],function(){history_control.load_page({page:"login"},{title:"Login"})})}if(main.action_lock.state)return;main.action_lock.set();get_data({success:success,error:main.send_errormessage,file:"/dbrequest.php",data:"action\x3dresend_activation_code_request"+
"\x26username_emailaddress\x3d"+encodeURIComponent(username_or_emailaddress.querySelector("input").value)})}};login_menu.reset_password_request=function(init){var parent=init.parent;var form_top=dom.create("div",{parent:parent,className:"login_menu-form_top"});var header_image=dom.create("div",{parent:form_top,className:"login_menu-header_image"});var text_and_inputs=dom.create("div",{parent:form_top,className:"login_menu-form_top-text_and_inputs"});dom.create("p",{parent:text_and_inputs,className:"login_menu-header_text",
innerHTML:"Please enter your username or email address to send a password reset link."});var username_or_emailaddress=dom.create("div",{parent:text_and_inputs,style:{width:"100%"},className:"login_menu-input_row",children:[["input","input",{type:"text",name:"username_emailaddress",style:{display:"inline-block",width:"100%"}}]]});var form_bottom=dom.create("div",{parent:parent,className:"login_menu-form_bottom"});parent.onsubmit=function(){return false};var submit_button=document.createElement("button");
submit_button.className="login_menu-button "+css_class_prefix+"button "+css_class_prefix+"button-green";submit_button.innerHTML="Send Link";submit_button.form_obj=parent;form_bottom.appendChild(submit_button);submit_button.addEventListener("click",process_reset_password_request);var bottom_text_div=document.createElement("div");bottom_text_div.className="login_menu-bottom_text";form_bottom.appendChild(bottom_text_div);var login_text=make_text({parent:bottom_text_div,text:"Have a login?",style:"display: inline-block; margin-right: 8px",
cssclass:"login_menu-dark",element_type:"a"});var register_text=make_text({parent:bottom_text_div,text:"Need to register?",style:"display: inline-block",cssclass:"login_menu-dark",element_type:"a"});login_text.addEventListener("click",function(){history_control.load_page({page:"login"},{title:"Login"})});register_text.addEventListener("click",function(){history_control.load_page({page:"register"},{title:"Register"})});function process_reset_password_request(){function success(successmessage){main.action_lock.clear();
smoke.alert(successmessage["message"],function(){history_control.load_page({page:"login"},{title:"Login"})})}if(main.action_lock.state)return;main.action_lock.set();get_data({success:success,error:main.send_errormessage,file:"/dbrequest.php",data:"action\x3dreset_password_request"+"\x26username_emailaddress\x3d"+encodeURIComponent(username_or_emailaddress.querySelector("input").value)})}};login_menu.reset_password=function(init){var parent=init.parent;var form_top=document.createElement("div");form_top.className=
"login_menu-form_top";var header_image=document.createElement("div");header_image.className="login_menu-header_image";form_top.text_and_inputs=document.createElement("div");form_top.text_and_inputs.className="login_menu-form_top-text_and_inputs";form_top.appendChild(header_image);form_top.appendChild(form_top.text_and_inputs);make_text({parent:form_top.text_and_inputs,text:"Please enter a new password for your account.",cssclass:"login_menu-header_text"});var password_obj=make_label_and_input({cssclass:"login_menu-input_row",
parent:form_top.text_and_inputs,label:"New password:",name:"password",input_type:"password"});var form_bottom=document.createElement("div");form_bottom.className="login_menu-form_bottom";parent.appendChild(form_top);parent.appendChild(form_bottom);parent.onsubmit=function(){return false};var submit_button=document.createElement("button");submit_button.className="login_menu-button "+css_class_prefix+"button "+css_class_prefix+"button-green";submit_button.innerHTML="Ok";submit_button.form_obj=parent;
form_bottom.appendChild(submit_button);submit_button.addEventListener("click",process_password_reset);var bottom_text_div=document.createElement("div");bottom_text_div.className="login_menu-bottom_text";form_bottom.appendChild(bottom_text_div);var login_text=make_text({parent:bottom_text_div,text:"Have a login? ",style:"display: inline-block; margin-right: 8px",cssclass:"login_menu-dark",element_type:"a"});var register_text=make_text({parent:bottom_text_div,text:"Need to register? ",style:"display: inline-block",
cssclass:"login_menu-dark",element_type:"a"});login_text.addEventListener("click",function(){history_control.load_page({page:"login"},{title:"Login"})});register_text.addEventListener("click",function(){history_control.load_page({page:"register"},{title:"Register"})});function process_password_reset(){function success(successmessage){main.action_lock.clear();smoke.alert(successmessage["message"],function(){history_control.load_page({page:"login"},{title:"Login"})})}if(main.action_lock.state)return;
main.action_lock.set();get_data({success:success,error:main.send_errormessage,file:"/dbrequest.php",data:"action\x3dreset_password"+"\x26user_id\x3d"+encodeURIComponent(gs.url_vars.user_id)+"\x26password\x3d"+encodeURIComponent(password_obj.input.value)+(typeof gs.url_vars.password_reset_key!="undefined"?"\x26password_reset_key\x3d"+gs.url_vars.password_reset_key:"")+(typeof gs.url_vars.activation_code!="undefined"?"\x26activation_code\x3d"+gs.url_vars.activation_code:"")})}};login_menu.activate_account=
function(init){function success(successmessage){main.action_lock.clear();smoke.alert(successmessage["message"],function(){history_control.load_page({page:"login"},{title:"Login"})})}if(main.action_lock.state)return;main.action_lock.set();get_data({success:success,error:main.send_errormessage,file:"/dbrequest.php",data:"action\x3dactivate_account"+"\x26user_id\x3d"+encodeURIComponent(gs.url_vars.user_id)+"\x26activation_code\x3d"+gs.url_vars.activation_code})};login_menu.login=function(init){var parent=
init.parent;var form_top=dom.create("div",{parent:parent,className:"login_menu-form_top"});var header_image=dom.create("div",{parent:form_top,className:"login_menu-header_image"});form_top.text_and_inputs=document.createElement("div");form_top.text_and_inputs.className="login_menu-form_top-text_and_inputs";form_top.appendChild(form_top.text_and_inputs);var newiframe=document.createElement("iframe");form_top.appendChild(newiframe);newiframe.style.display="none";newiframe.addEventListener("load",function(){var newiframe_doc=
newiframe.contentDocument;var parent=row_list.username.input.parentNode;var username_row_temp=newiframe_doc.getElementById("username");parent.replaceChild(username_row_temp,row_list.username.input);row_list.username.input=username_row_temp;var parent=row_list.password.input.parentNode;var password_row_temp=newiframe_doc.getElementById("password");parent.replaceChild(password_row_temp,row_list.password.input);row_list.password.input=password_row_temp});newiframe.contentDocument=document.createElement("document");
newiframe.srcdoc='\x3chtml\x3e\x3chead\x3e\x3cmeta charset\x3d"utf-8"/\x3e\x3cmeta http-equiv\x3d"content-type" content\x3d"text/html; charset\x3dutf-8"/\x3e\x3c/head\x3e\x3cbody\x3e\x3cform src\x3d"/dummy.htm" target\x3d"dummy_target" id\x3d"form_obj"\x3e\x3cinput id\x3d"username" type\x3d"text"     autocomplete\x3d"on"\x3e\x3cinput id\x3d"password" type\x3d"password" autocomplete\x3d"on"\x3e\x3cinput type\x3d"submit" value\x3d"login" /\x3e\x3c/form\x3e\x3c/body\x3e\x3c/html\x3e';var row_list={};
row_list.username=make_label_and_input({cssclass:"login_menu-input_row",parent:form_top.text_and_inputs,label:"Username:",name:"username"});row_list.password=make_label_and_input({cssclass:"login_menu-input_row",parent:form_top.text_and_inputs,label:"Password:",name:"password",input_type:"password"});var form_bottom=document.createElement("div");form_bottom.className="login_menu-form_bottom";parent.appendChild(form_bottom);set_labels_to_biggest_width(row_list);var buttons=dom.create("div",{parent:form_bottom});
var register_button=document.createElement("div");register_button.className="login_menu-button "+css_class_prefix+"button "+css_class_prefix+"button-magenta";register_button.style.display="inline-block";register_button.style.marginRight="40px";register_button.innerHTML="Register";buttons.appendChild(register_button);register_button.addEventListener("click",function(){history_control.load_page({page:"register"},{title:"Register"})});parent.onsubmit=function(){return false};var submit_button=document.createElement("button");
submit_button.className="login_menu-button "+css_class_prefix+"button "+css_class_prefix+"button-green";submit_button.style.display="inline-block";submit_button.innerHTML="Sign In";submit_button.form_obj=parent;buttons.appendChild(submit_button);submit_button.addEventListener("click",process_login);var bottom_text_div=document.createElement("div");bottom_text_div.className="login_menu-bottom_text";form_bottom.appendChild(bottom_text_div);form_bottom.appendChild(bottom_text_div);var forgot_password_text=
make_text({parent:bottom_text_div,text:"Forgot password?",style:"",cssclass:"login_menu-dark",element_type:"a"});var resend_activation_code_text=make_text({parent:bottom_text_div,text:"Resend activation code.",style:"",cssclass:"login_menu-dark",element_type:"a"});forgot_password_text.addEventListener("click",function(){history_control.load_page({page:"reset_password_request"},{title:"Forgot Password"})});resend_activation_code_text.addEventListener("click",function(){history_control.load_page({page:"resend_activation_code_request"},
{title:"Resend Activation Code"})});function process_login(){if(row_list.username.input.value=="")return;if(row_list.password.input.value=="")return;function success(successmessage){main.action_lock.clear();history_control.load_page({page:"transcribe"},{title:"Transcribe"})}if(main.action_lock.state)return;main.action_lock.set();get_data({success:success,error:main.send_errormessage,file:"/dbrequest.php",data:"action\x3dlogin\x26username\x3d"+encodeURIComponent(row_list.username.input.value)+"\x26password\x3d"+
encodeURIComponent(row_list.password.input.value)})}};login_menu.register=function(init){var form_parent=init.parent;var parent=document.createElement("form");form_parent.appendChild(parent);var form_top=document.createElement("div");form_top.className="login_menu-form_top";var header_image=document.createElement("div");header_image.className="login_menu-header_image";form_top.text_and_inputs=document.createElement("div");form_top.text_and_inputs.className="login_menu-form_top-text_and_inputs";form_top.appendChild(header_image);
form_top.appendChild(form_top.text_and_inputs);make_text({parent:form_top.text_and_inputs,text:"Please fill out this short form to register. You'll receive a confirmation email right away!",cssclass:"login_menu-header_text"});var row_array=[];row_array.push(make_label_and_input({cssclass:"login_menu-input_row",style:"display: inline-block; margin-right: 20px",parent:form_top.text_and_inputs,label:"Your first name:",name:"firstname"}));row_array.push(make_label_and_input({cssclass:"login_menu-input_row",
style:"display: inline-block",parent:form_top.text_and_inputs,label:"Your last name:",name:"lastname"}));append_br(form_top.text_and_inputs);row_array.push(make_label_and_input({cssclass:"login_menu-input_row",style:"display: inline-block; margin-right: 20px",parent:form_top.text_and_inputs,label:"*Email address:",name:"emailaddress"}));row_array.push(make_label_and_input({cssclass:"login_menu-input_row",style:"display: inline-block",parent:form_top.text_and_inputs,label:"*Re-type email:",name:"emailaddress_confirmation"}));
append_br(form_top.text_and_inputs);row_array.push(make_label_and_input({cssclass:"login_menu-input_row",style:"display: inline-block; margin-right: 20px",parent:form_top.text_and_inputs,label:"*Username:",name:"username"}));row_array.push(make_label_and_input({cssclass:"login_menu-input_row",style:"display: inline-block",parent:form_top.text_and_inputs,label:"*Password:",name:"password",input_type:"password"}));var form_bottom=document.createElement("div");form_bottom.className="login_menu-form_bottom";
parent.appendChild(form_top);parent.appendChild(form_bottom);set_to_biggest_width(labels_from_rows(row_array));parent.onsubmit=function(){return false};var submit_button=document.createElement("button");submit_button.className="login_menu-button "+css_class_prefix+"button "+css_class_prefix+"button-magenta";submit_button.innerHTML="Register";submit_button.form_obj=parent;form_bottom.appendChild(submit_button);submit_button.addEventListener("click",submit_form);var bottom_text_div=document.createElement("div");
bottom_text_div.className="login_menu-bottom_text";form_bottom.appendChild(bottom_text_div);var forgot_password_text=make_text({parent:bottom_text_div,text:"Forgot password?",style:"display: inline-block; margin-right: 8px",cssclass:"login_menu-dark",element_type:"a"});var login_text=make_text({parent:bottom_text_div,text:"Have a login?",style:"display: inline-block",cssclass:"login_menu-dark",element_type:"a"});forgot_password_text.addEventListener("click",function(){history_control.load_page({page:"reset_password_request"},
{title:"Reset Password Request"})});login_text.addEventListener("click",function(){history_control.load_page({page:"login"},{title:"Login"})});function submit_form(evt){if(typeof evt=="undefined")evt=window.event;function success(successmessage){main.action_lock.clear();smoke.alert(successmessage["message"],function(){history_control.load_page({page:"login"},{title:"Login"})})}var form=evt.currentTarget.form_obj;var data_array=new Array;var input_elements=form.elements;var temp_string="";for(var i=
0,curlen=input_elements.length;i<curlen;i++){if(typeof input_elements[i].name=="undefined")continue;var curelement=input_elements[i];if(curelement.name=="")continue;if(curelement.type=="radio"||curelement.type=="checkbox")if(curelement.checked==false)continue;temp_string="\x26"+input_elements[i].name+"\x3d"+encodeURIComponent(input_elements[i].value);data_array.push(temp_string)}if(main.action_lock.state)return;main.action_lock.set();get_data({success:success,error:main.send_errormessage,file:"/dbrequest.php",
data:"action\x3dregister"+data_array.join("")})}};return login_menu}
function create_transcript_upload_button(init){var parent=init.parent;var smoke=init.smoke,gs=init.gs,e=gs.extrautilfuncs,get_data=init.get_data,main=init.main,h=init.helperjs,dom=h.dom;var history_control=init.history_control,generate_and_render_transcript=init.generate_and_render_transcript;var progress_modal=undefined;var upload_button=dom.create("div");var new_transcript_name=undefined;var audio_element_upload_thing_invisible=dom.create("div",{style:{"diplay":"none"}});var audio_uploader=undefined;
var uploader_init={debug:false,button:upload_button,element:audio_element_upload_thing_invisible,callbacks:get_uploader_callbacks()};if(gs.plugins.qq)audio_uploader=new qq.FineUploaderBasic(uploader_init);else e.get_script({file:"/js/plugins/fineuploader/fineuploader-5.14.5.min.js",success:function(){gs.plugins.qq=qq;audio_uploader=new qq.FineUploaderBasic(uploader_init)},error:main.send_errormessage});function get_uploader_callbacks(){return{onSubmit:function(id,name){var promise=new qq.Promise;
inner();function inner(){var prompt=smoke.prompt("Please give this transcript a unique name.",function(result){if(result===false||result==""||main.action_lock.state){prompt.dialog.destroy();promise.failure();return}main.action_lock.set();new_transcript_name=result;get_data({file:"/dbrequest.php",data:"action\x3dtranscript_name_is_not_duplicate\x26transcript_name\x3d"+encodeURIComponent(new_transcript_name),error:function(err){prompt.dialog.destroy();promise.failure();main.send_errormessage(err)},
success:function(is_unique){if(is_unique==false){prompt.dialog.destroy();main.send_errormessage('Another transcript of yours already has the name "'+new_transcript_name+'"!',{callback:inner});return}audio_uploader.setEndpoint("dbrequest.php?action\x3dtranscript-create\x26transcript_name\x3d"+encodeURIComponent(new_transcript_name));prompt.dialog.destroy();progress_modal=smoke.alert("");progress_modal.dialog.text.style.lineHeight=0;progress_modal.dialog.buttons.saved_display=progress_modal.dialog.buttons.style.display;
progress_modal.dialog.buttons.style.display="none";progress_modal.progressbar=e.gui.progressbar.create({parent:progress_modal.dialog.text,className:gs.css("progressbar"),percent:0,text:"Uploading."});promise.success()}})},{autoclose:false})}return promise},onProgress:function(id,name,uploadedBytes,totalBytes){progress_modal.progressbar.update({percent:Math.round(uploadedBytes/totalBytes*.8*100),text:uploadedBytes<totalBytes?"Uploading.":"Generating pcm file. This might take a moment."})},onComplete:function(id,
name,transcript_data){progress_modal.progressbar.update({percent:90,text:"Loading pcm file."});if(typeof transcript_data.error!="undefined"){var err=transcript_data;progress_modal.dialog.destroy();main.send_errormessage(err);return}var load_count=0,err_invoked=false,transcript_data,peaks;function send_errormessage_single(err){if(err_invoked)return;err_invoked=true;progress_modal.dialog.destroy();main.send_errormessage(err)}load_count+=1;main.db.color_ideas_get({success:function(result){main.color_ideas=
result;test()}});load_count+=1;main.transcribe.load_pcm_file({transcript_id:transcript_data.header.id,error:send_errormessage_single,success:function(result_peaks){peaks=result_peaks;test()}});function test(){load_count-=1;if(load_count!=0)return;main.action_lock.clear();progress_modal.dialog.buttons.style.display=progress_modal.dialog.buttons.saved_display;progress_modal.progressbar.update({percent:100,text:"Processing complete!"});progress_modal=undefined;var transcript_name=transcript_data.header.name;
var transcript_shortname=transcript_name.replace(/ /g,"-").toLowerCase();history_control.insert_page({page:"transcribe",username:gs.session_data.username,transcript_name:transcript_shortname},{title:""});generate_and_render_transcript({transcript_data:transcript_data,peaks:peaks})}}}}parent.appendChild(upload_button);return upload_button}
function create_transcript_database_query_functions(init){var dom=init.dom,get_data=init.get_data,main=init.main;var event_dispatcher=init.event_dispatcher,transcript_container=init.transcript_container;var db={};var semaphore=db.semaphore=new Semaphore({max_active_default:1,max_active:{dbrequest:1}});db.request_queue=function(action,query_parameters,init){if(!("error"in init))init.error=main.send_errormessage_single;semaphore.add("dbrequest",dbrequest_si,action,query_parameters,init);function dbrequest_si(semaphore,
action,query_parameters,oldinit){var oldinit=Object.assign({},oldinit);var complete_ran=false;function semaphore_complete(){if(complete_ran)return;else{complete_ran=true;semaphore.complete()}}var init=Object.assign({},oldinit);var callback_list=["callback","success","error","short_circuit"];callback_list.forEach(function(func){init[func]=function(result){if(oldinit[func])oldinit[func](result);setTimeout(semaphore_complete,0)}});db.request(action,query_parameters,init)}};db.request=function(action,
query_parameters,init){test();function test(){if(init.use_action_lock)if(main.action_lock.state){setTimeout(test,100);return}else main.action_lock.set();if("begin"in init){var result=init.begin();if(typeof result=="undefined"||result==false){if(init.use_action_lock)main.action_lock.clear();init.short_circuit();return}}var query_string="";query_parameters.forEach(function(parameter){if(parameter in init)query_string+="\x26"+parameter+"\x3d"+encodeURIComponent(init[parameter])});var callback=init.callback?
init.callback:function(){};var success=init.success?init.success:function(){};var error=init.error?init.error:function(){};get_data({success:function(result){if(init.use_action_lock)main.action_lock.clear();success(result);callback(result)},error:function(result){if(init.use_action_lock)main.action_lock.clear();error(result);callback(result)},file:"/dbrequest.php",data:"action\x3d"+action+query_string})}};function get_transcript_id(init){return"transcript_id"in init?init.transcript_id:transcript_container.transcript.data.header.id}
db.color_ideas_get=function(init){db.request("color_ideas-get",[],Object.assign({},init,{use_action_lock:false}))};db.fragment_get=function(init){db.request_queue("fragment-get",["fragment_id"],init)};db.speaker_create=function(init){db.request_queue("speaker-create",["name","color","owner_id","transcript_id"],Object.assign({},init,{transcript_id:get_transcript_id(init)}))};db.speaker_get=function(init){db.request_queue("speaker-get",["speaker_id"],init)};db.speaker_remove=function(init){db.request_queue("speaker-remove",
["speaker_id","transcript_id"],init)};db.speaker_instance_create=function(init){db.request_queue("speaker_instance-create",["speaker_id","transcript_id","color"],Object.assign({},init,{transcript_id:get_transcript_id(init)}))};db.speaker_instance_get=function(init){db.request_queue("speaker_instance-get",["speaker_id","transcript_id","color"],init)};db.speaker_instance_remove=function(init){db.request_queue("speaker_instance-remove",["speaker_id","transcript_id"],init)};db.transcript_get=function(init){db.request_queue("transcript-get",
["urlname","source_username","transcript_id"],Object.assign({},init,{transcript_id:get_transcript_id(init)}))};db.images_list=function(init){db.request_queue("images-list",["transcript_id"],Object.assign({},init,{transcript_id:get_transcript_id(init)}))};db.transcript_set=function(init){database_sync_setter_pattern(Object.assign({},init,{transcript_id:get_transcript_id(init)}),"transcript","set",["name","shortname","urlname","urlname_alt1","urlname_alt2","urlname_alt3","description","record_date",
"record_timezone","view_permissions","sentence_break_suggestion_permissions","transcript_id"],{entry_id:undefined,entry_container:"header",generic_event_name:true})};db.fragment_create=function(init){database_sync_setter_pattern(init,"fragment","create",["fragment_id","split_time","old_fragment_text","new_fragment_text"],{generic_event_name:true})};db.fragment_set=function(init){database_sync_setter_pattern(init,"fragment","set",["text","time_end","slide_name","slide_width","slide_height","speaker_id"],
{generic_event_name:true,wait_for_result:false})};db.fragment_remove=function(init){database_sync_setter_pattern(init,"fragment","remove",["fragment_id"],{generic_event_name:true})};db.speaker_set=function(init){database_sync_setter_pattern(init,"speaker","set",["name","color"],{generic_event_name:false})};db.speaker_instance_set=function(init){database_sync_setter_pattern(init,"speaker_instance","set",["color"],{generic_event_name:false})};db.section_create=function(init){database_sync_setter_pattern(init,
"section","create",["fragment_id","name","color","section_template_id"],{generic_event_name:true})};db.section_set=function(init){database_sync_setter_pattern(init,"section","set",["name","color"],{generic_event_name:false})};db.section_remove=function(init){database_sync_setter_pattern(init,"section","remove",["section_id"],{generic_event_name:true})};function database_sync_setter_pattern(init,entry_name,action_type,query_parameters,settings){var settings=settings||{};dom.databaseSyncSetter({init:init,
entry_name:entry_name,database_action:entry_name+"-"+action_type,action_type:action_type,entry_id:"entry_id"in settings?settings.entry_id:entry_name+"_id",entry_container:"entry_container"in settings?settings.entry_container:entry_name+"_list",central_data:transcript_container.transcript.data,query_parameters:query_parameters,event_name:settings.generic_event_name==true?entry_name+"-set":function(additions){return entry_name+"-set_"+query_parameters.find(function(param){if(param in additions)return entry_name})},
event_dispatcher:event_dispatcher,dbrequest_queue:db.request_queue,wait_for_result:settings.wait_for_result})}return db}
function create_survey(init){var main=init.main,parent=init.parent;var gs=main.gs,h=helperjs,dom=h.dom,e=gs.extrautilfuncs;var looking_for_surveys_text=init.looking_for_surveys_text,is_bonus_survey=init.is_bonus_survey;var pe=pollfishExtras,transcript_data=main.transcript.data;if(init.skip_request)survey_initialize();else{var poll_request_text="We need $ to pay our developers and transcriptionists. To help financially support our product \x3cb\x3eand reveal the full content of the transcript\x3c/b\x3e, please complete a short survey. (Your answers are anonymous.) Thank you!";var modal=
smoke.alert(poll_request_text,function(){container.removeChild(modal.dialog);survey_initialize()},{ok:"Let's start this quick survey, then.",title:{text:"Quick survey request"},autoexit:false});modal.dialog.classList.add("smoke-dialog-survey_request");var container=main.fragment_list_container;modal.parentNode.removeChild(modal);container.insertBefore(modal.dialog,container.childNodes[0]);container.classList.add(gs.css("editor-fragment_list-container-blur-075"));setTimeout(function(){container.classList.remove(gs.css("editor-fragment_list-container-blur-075"));
container.classList.add(gs.css("editor-fragment_list-container-blur-150"))},500)}function survey_initialize(){var script_list=[];if(!gs.plugins.aesjs)script_list.push("/js/plugins/aes-js/aes-js.min.js");if(!gs.plugins.jquery)script_list.push("https://code.jquery.com/jquery-3.3.1.min.js");e.get_script_list({file_list:script_list,callback:function(result){gs.plugins.aesjs=aesjs;gs.plugins.jquery=jQuery;var script_list=[];if(!gs.plugins.pollfish){script_list.push("https://storage.googleapis.com/pollfish_production/sdk/webplugin/pollfish.min.js");
["#pollfishIndicator","#pollfish-analytics"].forEach(function(hideEntry){e.observeDOMAppend({element:document.body,search:function(){return document.querySelector(hideEntry)},dataContainer:{},callback:function(){document.querySelector(hideEntry).style.display="none"}})})}e.get_script_list({file_list:script_list,callback:function(result){gs.plugins.pollfish=PollfishHelper;show_survey()},error:main.send_errormessage})},error:main.send_errormessage})}function show_survey(){var modal=smoke.alert("",function(){},
{autoexit:false,title:{text:"Cheerful and quick survey"}});var loading_message=dom.create("p",{parent:modal.dialog.text,innerHTML:looking_for_surveys_text?looking_for_surveys_text:"Looking for surveys..."});var poll=document.querySelector("#pollfishSurveyFrame");modal.dialog.style.height="800px";modal.dialog.buttons.ok.style.display="none";modal.dialog.text.appendChild(poll);poll.style.display="none";var poll_search_timeout_time=3500;var poll_search_timeout=setTimeout(function(){loading_message.parentNode.removeChild(loading_message);
modal.dialog.text.innerHTML="Couldn't find a survey within "+poll_search_timeout_time/1E3+" seconds. We'll unlock the transcript for you anyway! Stand by...";clear_all_callbacks();modal.dialog.buttons.ok.style.display="";survey_done({completed:false})},poll_search_timeout_time);pe.surveyNotAvailable=function(){loading_message.parentNode.removeChild(loading_message);modal.dialog.text.innerHTML="No surveys available. But we will unlock the transcript for you anyway! Stand by... :)";clear_all_callbacks();
modal.dialog.buttons.ok.style.display="";survey_done({completed:false})};pe.surveyAvailable=function(){loading_message.parentNode.removeChild(loading_message);modal.dialog.style.height="calc(100% - 70px)";modal.dialog.text.style.height="100%";clear_some_callbacks();poll.style.display="block"};pe.userNotEligibleCallback=function(){modal.dialog.text.innerHTML="Seems like you aren't eligible to finish the survey. But we will unlock the transcript for you anyway! Stand by... :)";modal.dialog.text.style.height=
"";clear_all_callbacks();modal.dialog.buttons.ok.style.display="";survey_done({completed:false})};pe.surveyCompletedCallback=function(){modal.dialog.text.innerHTML="Thank you for completing this survey. Unlocking transcript. Stand by... :)";modal.dialog.text.style.height="";clear_all_callbacks();modal.dialog.buttons.ok.style.display="";survey_done({completed:false})};pe.closeCallback=e.closeAndNoShowCallback=function(){clear_all_callbacks();modal.dialog.close()};Pollfish.showFullSurvey();document.querySelector("#pollfishOverlay").style.display=
"none";function clear_all_callbacks(){pe.surveyNotAvailable=undefined;pe.surveyAvailable=undefined;pe.surveyCompletedCallback=undefined;pe.closeCallback=undefined;pe.userNotEligibleCallback=undefined;pe.closeAndNoShowCallback=undefined;clearTimeout(poll_search_timeout)}function clear_some_callbacks(){pe.surveyNotAvailable=undefined;pe.surveyAvailable=undefined;pe.userNotEligibleCallback=undefined;clearTimeout(poll_search_timeout)}function survey_done(options){var options=options||{};var completed=
"completed"in options?options.completed:true;h.get_data({file:"dbrequest.php?action\x3dsurvey_done\x26is_bonus_survey\x3d"+is_bonus_survey+"\x26completed\x3d"+completed+"\x26encryption_id\x3d"+transcript_data.header.encryption_id+"\x26transcript_id\x3d"+main.transcript.data.header.id,error:main.send_errormessage,success:function(encryption_key){setTimeout(function(){container.classList.remove(gs.css("editor-fragment_list-container-blur-150"));main.transcribe.decrypt_text(encryption_key,modal.dialog.close)},
1500)}})}}}
function create_help_menu(init){var h=helperjs,dom=h.dom,main=init.main,gs=main.gs;var transcript=main.transcript;var help_menu={};var open_button=help_menu.open_button=dom.create("div",{parent:init.parent,className:"custom_symbols custom_symbols-question editor-help_button"});open_button.addEventListener(gs.events.POINT,get_contents);return help_menu;function get_contents(){h.get_data({file:"help.htm",plaintext:true,success:help_menu_received});function help_menu_received(result){var modal=smoke.alert(result,
function(){},{title:{text:"Help",close_reference:smoke.close_reference}});modal.dialog.classList.add("smoke-dialog-stretch-textonly");modal.dialog.text.classList.add("smoke-dialog-text-help_menu");modal.dialog.buttons.parentNode.removeChild(modal.dialog.buttons);var help_menu=modal.dialog.text.querySelector("."+gs.css_class_prefix+"help-menu");help_menu.style.display="";var a_list=help_menu.querySelectorAll("a");a_list.forEach(function(element){if(element.href.indexOf("mailto:")==0)return;element.addEventListener(gs.events.POINT,
jump_to);var scroll_target=document.querySelector(element.href.substr(element.href.indexOf("#")));scroll_target.style.display="none";var h1=scroll_target.querySelector("h1");h1.innerHTML="\x3cspan\x3e"+h1.innerHTML+"\x3c/span\x3e";var back_button=dom.create("div",{parent:h1,className:"glyphicon glyphicon-chevron-left smoke-soft_button smoke-dialog-text-help_menu-back_button",events:{"click":back_to_main_menu}}).dom.insertBefore(h1.firstChild)});function back_to_main_menu(evt){evt.preventDefault();
var parent_panel=evt.currentTarget.parentNode.parentNode;parent_panel.style.display="none";help_menu.style.display="";modal.dialog.text.scrollTop=0}function jump_to(evt){evt.preventDefault();var element=evt.currentTarget;var scroll_target=document.querySelector(element.href.substr(element.href.indexOf("#")));scroll_target.style.display="";help_menu.style.display="none";modal.dialog.text.scrollTop=0}}}}
function create_contextmenu(init){var h=helperjs,main=init.main,gs=main.gs,e=gs.extrautilfuncs,dom=h.dom,db=main.db;var transcript=main.transcript;var testarea=main.fragment_list_container_wrapper;var dropdown=e.gui.dropdown.create({parent:testarea,clickEventType:gs.events.POINT,className:gs.css("dropdown"),closeOnClick:true,onSelect:function(result,selected_item){switch(selected_item.value){case "clear_highlight":main.transcribe.marker.clear();break;case "copy":document.execCommand("Copy");break;
case "mark_error":break;case "select_section":var text_selection=window.getSelection();text_selection.removeAllRanges();var range=document.createRange();range.selectNodeContents(selection.fragment.fragment_element.textarea);text_selection.addRange(range);break;case "copy_all":copy_text_to_buffer();var modal=smoke.alert("\x3cp\x3eYou copied the transcript text. Now paste it in \x3cbr/\x3e a text editor (like Microsoft Word) to print it!\x3c/p\x3e",function(){},{title:{text:"Copy success!"},ok:"OK!"});
modal.dialog.style.width="auto";modal.dialog.title_element.classList.add("smoke-dialog-title-success");modal.classList.add("smoke-dialog-detailed_text");break;case "search_transcript":var search_text=selection.text;main.transcribe.marker.highlight_word(search_text);if(gs.is_mobile_view)menu_open(testarea);break;case "search_for":var modal=smoke.prompt("",function(result){if(result===false||result.trim()=="")return;main.transcribe.marker.highlight_word(result);if(gs.is_mobile_view)menu_open(testarea)},
{title:{text:"Search"},align_body_on:"text"});var search_content_div=dom.create("div",{parent:modal.dialog.text,innerHTML:"\x3cp\x3ePlease enter the word or phrase to search for.\x3c/p\x3e",style:{display:"inline-block",textAlign:"left"}});search_content_div.appendChild(modal.dialog.prompt);modal.dialog.prompt.input.focus();var match_case=e.gui.checkbox.create({initialValue:gs.user_data.options.transcript.search_settings.match_case,onChange:toggle_match_case,text:"Match case",parent:search_content_div,
className:gs.css("checkbox")});var match_whole_words_only=e.gui.checkbox.create({initialValue:gs.user_data.options.transcript.search_settings.match_whole_words_only,onChange:toggle_match_whole_words_only,text:"Match whole words only",parent:search_content_div,className:gs.css("checkbox")});function toggle_match_case(evt){var checked=evt.currentTarget.checked;gs.user_data.options.transcript.search_settings.match_case=checked;window.localStorage.setItem("user_data.options.transcript.search_settings.match_case",
checked)}function toggle_match_whole_words_only(evt){var checked=evt.currentTarget.checked;gs.user_data.options.transcript.search_settings.match_whole_words_only=checked;window.localStorage.setItem("user_data.options.transcript.search_settings.match_whole_words_only",checked)}break;case "search_related_transcripts":var text=selection.text;if(text.indexOf(" ")!=-1)text='"'+text+'"';var q=(transcript.data.header.stock_symbol?"symbol:"+transcript.data.header.stock_symbol.toLowerCase()+" ":"")+text;if(false)main.history_control.load_page({page:"search",
q:q},{title:"Search"});else{window.open("/search?q\x3d"+q);break}break;case "search_google":window.open("https://www.google.com/search?q\x3d"+selection.text);break}},hideMethod:"display",initialValue:undefined,list:[{text:"Clear highlight",value:"clear_highlight"},{text:"Copy",value:"copy"},{text:"Select section",value:"select_section"},{text:"Copy all",value:"copy_all"},{text:"Search transcript",value:"search_transcript"},{text:"Search for...",value:"search_for"},{text:"Search related transcripts",
value:"search_related_transcripts"},{text:"Search Google",value:"search_google"}]});var element=dropdown.element;element.classList.add(gs.css("dropdown-simple"),gs.css("dropdown-contextmenu"));dropdown.custom={};Array.from(dropdown.optionContainer.children).forEach(function(child){dropdown.custom[child.value]=child});testarea.addEventListener("contextmenu",menu_open_event);window.subscribeToEvent(testarea,"contextmenu",menu_close_special);window.subscribeToEvent(testarea,gs.events.POINT,menu_close_event);
var selection={target:undefined,text:""};function menu_open_event(evt){evt.preventDefault();var target=evt.target,offsetLeft=0,offsetTop=0,fragment_element=undefined;while(true){if(target.classList.contains(gs.css("editor-fragment-fragment_content")))var textarea_found=true;if(target.classList.contains(gs.css("editor-fragment")))fragment_element=target;if(target.classList.contains(gs.css("editor-fragment_list-container_wrapper")))break;var isInline=window.getComputedStyle(target).display=="inline";
if(isInline){var savedDisplay=target.style.display;target.style.display="inline-block"}offsetLeft+=target.offsetLeft;offsetTop+=target.offsetTop;if(isInline)target.style.display=savedDisplay;target=target.offsetParent;if(target==null)return}if(!textarea_found)return;if(!gs.is_mobile_view){var isInline=window.getComputedStyle(evt.target).display=="inline";if(isInline){var savedDisplay=evt.target.style.display;evt.target.style.display="inline-block"}dropdown.element.style.left=evt.offsetX+offsetLeft+
"px";dropdown.element.style.top=evt.offsetY+offsetTop+"px";if(isInline)evt.target.style.display=savedDisplay}menu_open(target,fragment_element)}function menu_open(target,fragment_element){if(fragment_element){selection.fragment=fragment_element.fragment;selection.textarea=selection.fragment.fragment_element.textarea;selection.target=target;selection.text=e.getSelectionText().trim()}else{selection.fragment=undefined;selection.textarea=undefined;selection.target=undefined;selection.text=""}target.appendChild(dropdown.element);
dropdown.isCollapsed=false;dropdown.onCollapseExpand();dropdown.custom.search_related_transcripts.style.display=dropdown.custom.search_transcript.style.display=dropdown.custom.search_google.style.display=dropdown.custom.copy.style.display=selection.text==""?"none":"";dropdown.custom.select_section.style.display=dropdown.custom.copy_all.style.display=dropdown.custom.search_for.style.display=typeof fragment_element!="undefined"&&selection.text==""?"":"none";dropdown.custom.clear_highlight.style.display=
!main.transcribe.marker.current_highlighted_word?"none":"";if(selection.text!=""){var length_limit=30;var display_text=selection.text.length<=length_limit?selection.text:selection.text.substr(0,length_limit)+"...";dropdown.custom.search_transcript.innerHTML='Search transcript for "'+display_text+'"';dropdown.custom.search_related_transcripts.innerHTML='Search related transcripts for "'+display_text+'"';dropdown.custom.search_google.innerHTML='Search Google for "'+display_text+'"'}}function menu_close_event(evt){if(dropdown.element.contains(evt.target))return;
var element=dropdown.element;dropdown.isCollapsed=true;dropdown.onCollapseExpand()}function menu_close_special(evt){if(testarea.contains(evt.target))return;var element=dropdown.element;dropdown.isCollapsed=true;dropdown.onCollapseExpand()}main.addEventListener("transcript-highlight_word",function(evt){e.highlight_word({textarea_list:main.transcript.data.fragment_list.map(function(fragment){return fragment.fragment_element.textarea}),word:evt.detail.word,match_whole_words_only:gs.user_data.options.transcript.search_settings.match_whole_words_only?
"\\b":"",match_case:gs.user_data.options.transcript.search_settings.match_case?"":"i",marked_class:gs.css("editor-search_highlight")})});main.addEventListener("transcript-unhighlight_word",function(evt){e.unhighlight_all_words({textarea_list:main.transcript.data.fragment_list.map(function(fragment){return fragment.fragment_element.textarea}),marked_class:gs.css("editor-search_highlight")})});function copy_text_to_buffer(){main.session.log_standard({name:"copy_text_to_buffer"});var copy_text=dom.create("div");
var info_header_clone=main.info_header.cloneNode(true);info_header_clone.classList.remove("only-print");copy_text.appendChild(info_header_clone);dom.create("br",{parent:copy_text,className:"do-print"});var fragment_list_container=dom.create("div",{parent:copy_text,className:"editor-fragment_list-container editor-fragment_list-container-with_padding"});var fragment_list=main.transcript.data.fragment_list;fragment_list.forEach(function(fragment,i){var fragment_textarea_clone=fragment.fragment_element.textarea.cloneNode(true);
var br_list=Array.from(fragment_textarea_clone.querySelectorAll("br")).forEach(function(br){br.outerHTML=""});if(fragment.section_host){var section_clone=fragment.section_host.section_element.cloneNode(true);fragment_list_container.appendChild(section_clone)}fragment_list_container.appendChild(fragment_textarea_clone)});copy_text.querySelectorAll(gs.css(".editor-fragment-slide")).forEach(function(element){element.parentNode.removeChild(element)});var transcript_footer=main.transcript_footer.cloneNode(true);
transcript_footer.style.marginLeft="";copy_text.appendChild(transcript_footer);dom.create("br",{parent:copy_text});var source_link=dom.create("a",{parent:copy_text,style:{display:"block"},href:window.location.href,innerHTML:window.location.href});document.body.appendChild(copy_text);copy_text.className="do-print do-select";var savedBackground=document.body.style.background;document.body.style.background="none";document.body.appendChild(copy_text);var text_selection=window.getSelection();text_selection.removeAllRanges();
var range=document.createRange();range.selectNodeContents(copy_text);text_selection.addRange(range);document.execCommand("Copy");text_selection.removeAllRanges();document.body.removeChild(copy_text);document.body.style.background=savedBackground}}
function create_menu_system(init){var gs=init.gs;var dom=init.dom;var menu_system={};menu_system.set_title_text=function(text){menu_system.title.style.display=typeof text=="undefined"?"none":"";menu_system.title.innerHTML=typeof text=="undefined"?"":text};menu_system.collapse=function(){menu_system.expanded=false;menu_system.title.innerHTML="";menu_system.title.style.display="none";menu_system.expander.style.display="";menu_system.ribbonmenu.style.display="none";if(menu_system.collapse_callback)menu_system.collapse_callback(menu_system)};
menu_system.expand=function(evt,expander_icon_type){if(menu_system.expander.icon_type!=expander_icon_type)menu_system.expander.set_class_name(expander_icon_type);menu_system.expanded=true;menu_system.title.style.display="none";menu_system.expander.style.display="none";menu_system.ribbonmenu.style.display="";if(menu_system.expand_callback)menu_system.expand_callback(menu_system)};menu_system.populate=function(init){this.collapse_callback=init.collapse_callback;this.expand_callback=init.expand_callback;
this.parent=init.parent;this.menu_list=function(){return{children:init.children}};this.expander.classList.add.apply(this.expander.classList,init.expander_className.split(" "));this.ribbonmenu.classList.remove.apply(this.ribbonmenu.classList,init.className.split(" "));var parent=init.parent;parent.appendChild(this.ribbonmenu);parent.insertBefore(this.expander,parent.firstChild)};menu_system.init=function(init){menu_system.menu_list=init.menu_list;menu_system.page_state=init.page_state;var events=init.events;
menu_system.dom={};var listMenu=menu_system.listMenu=new ListMenu({container_tag:"ul",list_item_tag:"li",animate:function(){},touch_events:init.touch_events});var ribbonmenu=menu_system.ribbonmenu=dom.create("ul",{style:{userSelect:"none"},className:"menulist menulist-horizontal normalul "+"gui-ribbonmenu"});menu_system.expanded=false;var expander=menu_system.expander=dom.create("div");var expander_button=menu_system.expander_button=dom.create("button",{parent:expander});if(init.expander_button_style)expander_button.style.cssText=
init.expander_button_style;menu_system.title=dom.create("div",{parent:expander,className:gs.css("ribbonmenu-title")});var expander_icon_type_list={default:init.expander_default?init.expander_default:"menu-hamburger",close:init.expander_close?init.expander_close:"chevron-left"};expander.set_class_name=function(new_icon_type){expander.icon_type=new_icon_type==""||typeof new_icon_type=="undefined"?"default":new_icon_type;expander_button.className=init.processCss("glyphicon glyphicon-"+expander_icon_type_list[expander.icon_type]+
" "+init.css_class_prefix+"top_bar-button item_button-{skin_top_foreground} "+init.expander_button_class)};expander_button.setAttribute("aria-label","menu");expander.set_class_name();expander_button.addEventListener(events.POINT,function(evt){if(menu_system.close_event){menu_system.close_event();delete menu_system.close_event}menu_system.expand(evt)});menu_system.update=function(menu_element){if(typeof menu_element!="undefined"){leaf_update_by_menu_element(menu_element);return}if(menu_system.expanded)menu_system.expand();
else menu_system.collapse();var menu_list=typeof menu_system.menu_list=="function"?menu_system.menu_list():menu_system.menu_list;var page_state=typeof menu_system.page_state=="function"?menu_system.page_state():menu_system.page_state;if(typeof menu_list!="undefined")ribbonmenu.innerHTML="";branch(ribbonmenu,menu_list);listMenu.create_menu(ribbonmenu);Array.from(ribbonmenu.childNodes).forEach(function(child){if(page_state!=null&&child.page_state==page_state)listMenu.set_selected(child)});expander.insertBefore(expander_button,
expander.firstChild)};if(menu_system.menu_list)menu_system.update();function leaf_update_by_menu_element(curli){var curitem=curli.item_constructor;if(typeof curitem=="undefined")return;if(typeof curitem.condition=="function"&&!!curitem.condition()==false)return;if(typeof curitem.condition!="undefined"&&curitem.condition==false)return;get_leafdiv(curli.parentNode,curitem,curli)}function branch(itemdiv,item){item.children.forEach(function(curitem){if(typeof curitem=="undefined")return;if(typeof curitem.condition==
"function"&&!!curitem.condition()==false)return;if(typeof curitem.condition!="undefined"&&curitem.condition==false)return;var leafdiv=get_leafdiv(itemdiv,curitem);if(typeof curitem.children=="undefined")return;var uldiv=dom.create("ul");leafdiv.appendChild(uldiv);branch(uldiv,curitem)})}function get_leafdiv(parent,curitem,item){return leaf(parent,curitem,item,curitem.label,curitem.className,curitem.label_link,curitem.page_state,curitem.click,curitem.close,curitem.callback);function leaf(parent,item_constructor,
curli_initial,label,label_class,label_link,page_state,click_event,close_event,callback){var curli=typeof curli_initial!="undefined"?curli_initial:dom.create("li");curli.item_constructor=item_constructor;curli.innerHTML=typeof label=="function"?label():label;if(typeof label_class!="undefined")curli.className=label_class;if(typeof label_link!="undefined")label_link.link=curli;if(typeof page_state!="undefined"){curli.page_state=page_state;if(typeof curli_initial=="undefined")curli.addEventListener(events.POINT,
function(evt){var descendant=evt.target,parent=evt.currentTarget;if(descendant!=parent&&typeof descendant.page_state=="undefined")while(true){descendant=descendant.parentNode;if(descendant==parent)break}if(descendant.page_state==parent.page_state)set_page_state(parent.page_state)})}if(typeof curli_initial=="undefined"){if(typeof click_event!="undefined")curli.addEventListener(events.POINT,function(evt){click_event(evt);if(typeof close_event!="undefined")menu_system.close_event=close_event});parent.appendChild(curli)}if(callback)callback(curli);
return curli}}};function disable_selection(obj){obj.setAttribute("unselectable","on");obj.style.WebkitTapHighlightColor="rgba(255, 255, 255, 0)";obj.style.WebkitHighlightColor="transparent";obj.style.MozUserSelect="none";obj.style.OUserSelect="none";obj.style.KhtmlUserSelect="none";obj.style.WebkitUserSelect="none";obj.style.MsUserSelect="none";obj.style.userSelect="none"}return menu_system}
function create_top_bar_middle(init){function clear_all_except(arr){if(typeof arr=="undefined")arr=[];else if(!Array.isArray(arr))arr=[arr];Array.from(element.childNodes).forEach(function(element){element.style.display=arr.some(function(arr_element){return element==arr_element})?"":"none"})}var main=init.main,parent=init.parent,e=init.e,dom=init.dom,gs=init.gs,menu_system=gs.menu_system,gui=init.gui;var transcript_set=init.transcript_set;var top_bar_middle={};var tbm=top_bar_middle;main.set_transcript_title=
function(){tbm.set_transcript_title.apply(null,arguments)};var element=tbm.element=dom.create("div",{parent:parent,className:"top_bar-left"+" top_bar-left-"+gs.user_data.options.transcript.view.title_position});var system_message=tbm.system_message=main.system_message={};system_message.element=dom.create("div",{parent:element,className:"top_bar-left-text top_bar-left-system_message"});var title_wrapper=dom.create("div",{parent:element,className:"top_bar-left-transcript_title_wrapper"});var title_input_wrapper=
dom.create("div",{parent:title_wrapper});var title_input=tbm.title_input=dom.create("div",{parent:title_input_wrapper,style:"pointer-events: none",className:"top_bar-left-text top_bar-left-transcript_title_input",type:"text",contentEditable:false});tbm.title_input_shortname=dom.create("div",{parent:title_input_wrapper,className:"top_bar-left-text top_bar-left-transcript_title_input top_bar-left-transcript_title_input-shortname"});var playpause=tbm.playpause=dom.create("button",{parent:title_wrapper,
className:"glyphicon glyphicon-play top_bar-left-play_button"});playpause.setAttribute("aria-label","play");main.addEventListener("transcript-load",function(){title_input.contentEditable=main.transcript.data.writable});title_input.enable=function(){title_input.contentEditable=true;title_input.style.pointerEvents="";title_input.focus()};title_input.disable=function(){title_input.contentEditable=false;title_input.style.pointerEvents="none"};title_input_wrapper.addEventListener(gs.events.POINT,function(evt){if(main.transcript&&
main.transcript.data.writable)title_input.enable(evt)});title_input.addEventListener("blur",title_input.disable);title_input.addEventListener(["change","input"],function(evt){transcript_set({"name":title_input.textContent})});playpause.addEventListener("mousedown",function(evt){evt.preventDefault()});playpause.addEventListener(gs.events.POINT,function(){main.wavesurfer.running_from_sub_player=undefined;main.wavesurfer.savePlayStateOnDrag=true;main.wavesurfer[main.wavesurfer.isPlaying()?"pause":"play"]()});
main.addEventListener("transcript-play",function(evt){gui.set_playpause_icon_status(playpause,"playing")});main.addEventListener("transcript-pause",function(evt){gui.set_playpause_icon_status(playpause,"resting")});tbm.set_transcript_title=function(new_text){title_input.innerHTML=new_text;if(title_input.parentNode==null)return;if(system_message.element.innerHTML=="")clear_all_except(title_wrapper);if(menu_system.listMenu)menu_system.collapse()};system_message.set=function(new_text){if(new_text==""){system_message.clear();
return}system_message.element.innerHTML=new_text;clear_all_except(system_message.element)};system_message.clear=function(){system_message.element.innerHTML="";if(title_input.innerHTML=="")clear_all_except();else clear_all_except(title_wrapper)};tbm.expand=function(){tbm.element.style.visibility=""};tbm.collapse=function(){tbm.element.style.visibility="hidden";tbm.system_message.clear()};system_message.clear();return top_bar_middle}
function create_loading_arrows(init){var parent=init.parent,dom=init.dom;var loading_arrows={};var element_wrapper=loading_arrows.element_wrapper=dom.create("div",{parent:parent,className:"loading_arrows-outer loading_arrows-outer-blue loading_arrows-outer-96px"});var element=loading_arrows.element=dom.create("div",{parent:element_wrapper,className:"loading_arrows loading_arrows-96px loading_arrows-blue"});var fadeInInterval,fadeOutInterval;loading_arrows.interval=undefined;loading_arrows.set=function(parent){if(loading_arrows.timeout){clearTimeout(loading_arrows.timeout);
loading_arrows.timeout=undefined}if(loading_arrows.interval){clearInterval(loading_arrows.interval);loading_arrows.interval=undefined}loading_arrows.interval=createArrowFlow(parent,element_wrapper)};loading_arrows.clear=function(){if(loading_arrows.timeout){clearTimeout(loading_arrows.timeout);loading_arrows.timeout=undefined}if(loading_arrows.interval){clearInterval(loading_arrows.interval);loading_arrows.interval=undefined}if(element_wrapper.parentNode)fadeOut(element_wrapper,function(){element_wrapper.parentNode.removeChild(element_wrapper)})};
function fadeIn(element_wrapper,callback){var opacity=0;if(fadeInInterval){clearInterval(fadeInInterval);fadeInInterval=undefined}if(fadeOutInterval){clearInterval(fadeOutInterval);fadeOutInterval=undefined}element_wrapper.style.opacity=opacity;fadeInInterval=setInterval(function(){opacity+=.02;element_wrapper.style.opacity=opacity;if(opacity>=1){clearInterval(fadeInInterval);fadeInInterval=undefined;if(callback)callback()}},20)}function fadeOut(element_wrapper,callback){var opacity=1;if(fadeInInterval){clearInterval(fadeInInterval);
fadeInInterval=undefined}if(fadeOutInterval){clearInterval(fadeOutInterval);fadeOutInterval=undefined}element_wrapper.style.opacity=opacity;fadeOutInterval=setInterval(function(){opacity-=.06;element_wrapper.style.opacity=opacity;if(opacity<=0){clearInterval(fadeOutInterval);fadeOutInterval=undefined;if(callback)callback()}},20)}function createArrowFlow(parent,element,options){options=options?options:{};var arrowSize=options.arrowSize||96;var moveSpeed=options.moveSpeed||4;var intervalTime=options.intervalTime||
25;var timeBeforeLoading=options.timeBeforeLoading||750;var doFadeIn=options.doFadeIn||true;loading_arrows.timeout=setTimeout(function(){loading_arrows.timeout=undefined;parent.appendChild(element_wrapper);if(doFadeIn)fadeIn(element_wrapper);var elementInner=element.childNodes[0];var arrowSizeX2=arrowSize*2;var arrowMax=Math.ceil((elementInner.clientWidth-arrowSize)/arrowSize/2);var arrowCount=0;var progress=-arrowSize/2,progressMax=elementInner.clientWidth;var subProgress=arrowSizeX2+progress;elementInner.innerHTML=
"\x3cspan\x3e\x3c/span\x3e";loading_arrows.interval=setInterval(function(){subProgress+=moveSpeed;progress+=moveSpeed;if(subProgress==arrowSizeX2){subProgress=0;progress-=arrowSizeX2;if(arrowCount<=arrowMax){arrowCount+=1;var span=document.createElement("span");elementInner.appendChild(span);var span=document.createElement("span");elementInner.appendChild(span)}}elementInner.style.transform="translate("+progress+"px, 0)"},intervalTime)},timeBeforeLoading);return loading_arrows.interval}return loading_arrows}
function create_slide_modal(init){var h=helperjs;var slide_modal={};slide_modal.do_init=function(init){this.gs=init.gs;this.dom=init.dom;this.main=init.main};slide_modal.do_init(init);slide_modal.create_event=function(evt){this.create(evt.currentTarget.fragment_element.fragment)};slide_modal.create=function(fragment){var slide_modal=this;var main=this.main,gs=this.gs,dom=this.dom;var modal=this.modal=smoke.alert("",function(){main.removeEventListener("transcript-set_active_fragment",this.update)});
main.session.log_standard({name:"slide_enlarge"});modal.dialog.classList.add("smoke-dialog-stretch","smoke-dialog-stretch-with_buttons");var slide_image=fragment.fragment_element.slide_image;this.img=dom.create("img",{parent:modal.dialog.text});this.img.src=fragment.fragment_element.slide_image.src;var zoom_in_button=dom.create("div",{parent:modal.dialog.buttons,className:"smoke-dialog-buttons-ok",innerHTML:"Zoom In"});modal.dialog.buttons.appendChild(zoom_in_button);zoom_in_button.addEventListener(gs.events.POINT,
function(){slide_modal.create_slide_zoom()});main.addEventListener("transcript-set_active_fragment",function(evt){slide_modal.update_event(evt)})};slide_modal.update_event=function(evt){var fragment=evt.detail.fragment;if(fragment.slide_name==null)return;this.main.session.log_standard({name:"slide_update"});this.img.src=fragment.fragment_element.slide_image.src};slide_modal.create_slide_zoom=function(){var slide_modal=this;var img=slide_modal.img,modal=slide_modal.modal,main=slide_modal.main,gs=main.gs,
e=gs.extrautilfuncs,dom=h.dom;var slide_zoom_max=2;modal.dialog.classList.remove("smoke-dialog-stretch");modal.dialog.classList.remove("smoke-dialog-stretch-with_buttons");modal.dialog.classList.add("smoke-dialog-super_stretch");var close_button_wrapper=dom.create("div",{parent:modal.dialog,className:"smoke-dialog-title smoke-dialog-title-single_close_button"}).dom.insertBefore(modal.dialog.firstChild);var close_button=dom.create("div",{parent:close_button_wrapper,className:"custom_symbols custom_symbols-cross smoke-dialog-title-close"});
close_button.addEventListener(gs.events.POINT,modal.dialog.close);close_button_wrapper.style.zIndex=1;close_button_wrapper.style.position="fixed";close_button_wrapper.style.borderBottom="none";var imgMinWidth,imgMaxWidth,parentWidth,parentHeight;function getMinMaxValues(){img.removeAttribute("style");parentWidth=parseFloat(window.getComputedStyle(img.parentNode).width);parentHeight=parseFloat(window.getComputedStyle(img.parentNode).height);var imgStyle=window.getComputedStyle(img);var imgWidth=parseFloat(imgStyle.width);
var imgHeight=parseFloat(imgStyle.height);if(imgWidth/imgHeight>parentWidth/parentHeight){imgMinWidth=parentWidth;imgMaxWidth=imgWidth;img.style.width=parentWidth+"px";img.style.left=0;img.style.top=(parentHeight-parentWidth*(imgHeight/imgWidth))/2+"px"}else{imgMinWidth=parentHeight*(imgWidth/imgHeight);imgMaxWidth=parentWidth;img.style.width=imgMinWidth+"px";img.style.left=(parentWidth-imgMinWidth)/2+"px";img.style.top=0}}main.subscribeToEvent(img,"window-resize",getMinMaxValues);getMinMaxValues();
var image_zoom=function(scale){var width=parseFloat(window.getComputedStyle(img).width);var oldwidth=width;var oldheight=parseFloat(window.getComputedStyle(img).height);width=width*scale;if(width<imgMinWidth)width=imgMinWidth;else if(width>imgMaxWidth*slide_zoom_max)width=imgMaxWidth*slide_zoom_max;var height=oldheight/oldwidth*width;img.style.width=width+"px";var imgLeft=minMaxConstraintLeft(parseFloat(img.style.left)+(oldwidth-width)/2);var imgTop=minMaxConstraintTop(parseFloat(img.style.top)+(oldheight-
height)/2);img.style.left=imgLeft+"px";img.style.top=imgTop+"px"};function minMaxConstraintLeft(imgLeft){var imgWidth=parseFloat(window.getComputedStyle(img).width);if(imgWidth<parentWidth)return(parentWidth-imgWidth)/2;if(imgLeft>0)return 0;if(imgLeft<parentWidth-imgWidth)return parentWidth-imgWidth;return imgLeft}function minMaxConstraintTop(imgTop){var imgHeight=parseFloat(window.getComputedStyle(img).height);if(imgHeight<parentHeight)return(parentHeight-imgHeight)/2;if(imgTop>0)return 0;if(imgTop<
parentHeight-imgHeight)return parentHeight-imgHeight;return imgTop}var clientStartX,clientStartY,moveActive;var image_zoom_move_end=function(evt){if(evt.targetTouches&&evt.targetTouches.length==0)return;var touch=evt.targetTouches?evt.targetTouches[0]:evt;clientStartX=touch.clientX-img.offsetLeft;clientStartY=touch.clientY-img.offsetTop};var image_move_start=function(evt){moveActive=true;var touch=evt.changedTouches?evt.changedTouches[0]:evt;clientStartX=touch.clientX-img.offsetLeft;clientStartY=
touch.clientY-img.offsetTop};var image_move=function(init){if(!moveActive)return;var evt=init.evt;var touch=evt.changedTouches?evt.changedTouches[0]:evt;img.style.left=minMaxConstraintLeft(touch.clientX-clientStartX)+"px";img.style.top=minMaxConstraintTop(touch.clientY-clientStartY)+"px"};var image_move_end=function(evt){moveActive=undefined};if(gs.is_phone_or_tablet)h.add_pinch_controls({target:img,end_effect:function(){image_zoom_move_end.apply(null,arguments)},result_function:function(){image_zoom.apply(null,
arguments)}});h.add_swipe_controls({is_mobile:gs.is_phone_or_tablet,target:img,swipe_move:function(){image_move.apply(null,arguments)},start_effect:function(evt){image_move_start(evt)},end_effect:function(evt){image_move_end(evt)}});img.addEventListener("dragstart",function(evt){evt.preventDefault()});img.addEventListener("wheel",function(evt){image_zoom(evt.deltaY<0?1.1:.9090909090909091)})};return slide_modal}
function smoke_extensions_add(gs,smoke,dom){if(typeof smoke=="undefined")return;smoke.point_event=gs.events.POINT;smoke.autofocus=true;smoke.use_wrapper=false;smoke.extend("align_body_on",function(value,modal,text,callback,settings){if(value=="text"){modal.dialog.prompt.input.style.width="100%";var activeElement=document.activeElement;modal.dialog.text.appendChild(modal.dialog.prompt);if(activeElement==modal.dialog.prompt.input)modal.dialog.prompt.input.focus()}});smoke.extend("tabs",function(value,
modal,text,callback,settings){var title_prefix=settings.title.text;var tabs=modal.tabs={list:value.list,instance:{}};for(var tab_name in tabs.list)tabs.list[tab_name].name=tab_name;tabs.open=function(tab_name){var open_condition=value.open_condition?value.open_condition:function(callback){callback()};open_condition(tab_name,function(){if(tabs.instance.current_tab&&tabs.instance.current_tab.name==tab_name)return;if(value.before_open)value.before_open(tab_name);tabs.instance.current_tab=tabs.list[tab_name];
tabs.instance.current_tab.open()})};tabs.refresh=function(){if(tabs.instance.tab_container){var text=modal.dialog.text;Array.from(text.childNodes).forEach(function(element){if(element!=tabs.instance.tab_container&&element!=modal.buttons)element.parentNode.removeChild(element)})}else{modal.dialog.title_element.classList.add("smoke-dialog-title_with_tabs");var text=modal.dialog.text;var tab_container=tabs.instance.tab_container=dom.create("div",{parent:modal.dialog,className:"smoke-dialog-tabs"}).dom.insertBefore(text);
for(var tab_name in tabs.list){var tab_data=tabs.list[tab_name];var tab_element=dom.create("div",{parent:tab_container,className:"smoke-dialog-tab",innerHTML:tab_data.title});tab_element.tab_name=tab_name;tab_element.addEventListener(gs.events.POINT,tab_open)}var tab_empty=dom.create("div",{parent:tab_container,className:"smoke-dialog-tab_empty"});function tab_open(evt){tabs.open(evt.currentTarget.tab_name)}}modal.dialog.title_element.text.innerHTML=title_prefix+": "+tabs.instance.current_tab.title;
Array.from(tabs.instance.tab_container.childNodes).forEach(function(element){element.classList[element.tab_name==tabs.instance.current_tab.name?"add":"remove"]("smoke-dialog-tab-active")});return modal};return tabs})}"use strict";
function history_control_object(settings){var history_main=this;if(typeof settings=="undefined")settings={};history_main.overwrite_first_state=typeof settings.overwrite_first_state!="undefined"&&settings.overwrite_first_state==false?false:true;var var_name=typeof settings.var_name!="undefined"?settings.var_name:"page";history_main.base_filename=typeof settings.base_filename!="undefined"?settings.base_filename:"";history_main.onbeforestatechange=settings.onbeforestatechange;history_main.onstatechange=
settings.onstatechange;history_main.initial_page=settings.initial_page;history_main.app_url_vars=settings.app_url_vars;history_main.can_do_popstate=settings.can_do_popstate;history_main.current_state={};var extras={};var next_title=undefined,next_url=undefined,next_callback=undefined;var first_load=true;var history_control_locked=false;var ever_pushed_something=false;var initial_url=location.href;window.addEventListener("popstate",function(evt){var onload_pop=!ever_pushed_something&&location.href==
initial_url;ever_pushed_something=true;if(onload_pop)return;if(history_control_locked||typeof history_main.can_do_popstate!="undefined"&&!history_main.can_do_popstate(evt.state)){set_page_state(history_main.current_state,undefined,false,true);return}history_control_locked=true;if(evt.state==null)return;set_page_state(evt.state,undefined,false)});history_main.complete=function(){if(history_main.defer){history_main.defer();delete history_main.defer}if(history_main.defer_callback){history_main.defer_callback();
delete history_main.defer_callback}};function set_page_state(new_state,settings,record_history,ignore_history){if(typeof history_main.app_url_vars!="undefined"){for(var i in history_main.app_url_vars)delete history_main.app_url_vars[i];merge_into(history_main.app_url_vars,new_state)}var hash=formUrlVars(new_state,{record_undefined_values:false});if(typeof settings!="undefined"){if(typeof settings.title!="undefined")history_main.title=settings.title;if(typeof settings.url!="undefined")history_main.url=
settings.url;if(typeof settings.callback!="undefined")history_main.callback=settings.callback;if(typeof history_main.url=="undefined"){history_main.url=location.protocol+"//"+location.host+location.pathname+history_main.base_filename;history_main.url+=hash}}if(record_history==true){extras[hash]={};extras[hash].title=history_main.title;extras[hash].url=history_main.url;extras[hash].callback=history_main.callback}else history_main[var_name]=new_state[var_name];var current_extras=extras[hash];var current_title=
current_extras?current_extras.title:undefined;var current_url=current_extras?current_extras.url:undefined;var current_callback=current_extras?current_extras.callback:undefined;delete history_main.url;delete history_main.callback;function change_url_and_title(){document.title=typeof current_title!="undefined"?current_title:"";if(record_history==true||!!ignore_history){var state_action=(first_load?"replace":"push")+"State";var new_state_temp=Object.assign({},new_state);for(var prop in new_state_temp)if(typeof new_state_temp[prop]==
"undefined")delete new_state_temp[prop];history[state_action](new_state_temp,current_title,current_url)}}if(settings&&(settings.defer_url_and_title||settings.defer))history_main.defer=change_url_and_title;else change_url_and_title();if(!first_load)ever_pushed_something=true;var old_state=history_main.current_state;history_main.current_state=new_state;if(first_load==true)first_load=false;if(!ignore_history)if(typeof history_main.onstatechange!="undefined")history_main.onstatechange(new_state,function(){history_control_locked=
false;if(typeof current_callback!="undefined")current_callback()},old_state);else{history_control_locked=false;if(typeof current_callback!="undefined")current_callback()}if(settings&&settings.element_container){var container=settings.element_container,arr=[];for(var prop in container)if(typeof container[prop]=="function")arr.push(prop);if(arr.includes(new_state.page)){var old_element=container.element,old_elements=container.elements;container.element=undefined;container.elements=[];function run_it(){if(old_element&&
old_element.parentNode)old_element.parentNode.removeChild(old_element);if(old_elements)old_elements.forEach(function(element){if(element.parentNode)element.parentNode.removeChild(element)})}if(!settings.defer&&!settings.defer_callback)run_it();else history_main.defer_callback=run_it}}}history_main.add_preset=function(init){if(init.new_state)var preset_new_state=shallowcopy(init.new_state);if(init.settings)var preset_settings=shallowcopy(init.settings);return{complete:function(){history_main.complete.apply(null,
arguments)},insert_page:function(){history_main.insert_page.apply(null,arguments)},load_page:function(new_state,settings){if(preset_new_state)merge_into(new_state,preset_new_state);if(preset_settings)merge_into(settings,preset_settings);history_main.load_page.apply(history_main,arguments)}}};history_main.load_page=function(new_state,settings){if(history_control_locked)return;history_control_locked=true;if(typeof new_state=="undefined")new_state={};if(typeof settings=="undefined")settings={};new_state=
shallowcopy(new_state);settings=shallowcopy(settings);if(first_load==true&&history_main.overwrite_first_state==true){getUrlVars(new_state);if(typeof history_main[var_name]=="undefined")history_main[var_name]=history_main.initial_page}if(typeof new_state[var_name]=="undefined")new_state[var_name]=history_main[var_name];if(typeof history_main.onbeforestatechange!="undefined")history_main.onbeforestatechange(new_state,settings,function(){set_page_state(new_state,settings,true)});else set_page_state(new_state,
settings,true)};function formUrlVars(variable_list,options){if(typeof options=="undefined")options={};if(typeof options.record_undefined_values=="undefined")options.record_undefined_values=true;var return_value="";for(var i in variable_list)if(typeof variable_list[i]!="undefined"||options.record_undefined_values==true)return_value+="\x26"+i+"\x3d"+variable_list[i];if(return_value!="")return_value="?"+return_value.slice(1,return_value.length);return return_value}function getUrlVars(variable_object){if(typeof variable_object!=
"object"||variable_object==null)var variable_object={};var variable_list=window.location.href.slice(window.location.href.indexOf("?")+1).split("\x26");var curlen=variable_list.length;for(var i=0;i<curlen;i++){var current_variable=variable_list[i].split("\x3d");if(typeof current_variable[1]=="undefined")continue;variable_object[current_variable[0]]=decodeURIComponent(current_variable[1])}return variable_object}function merge_into(target,source){if(typeof source=="undefined")return target;for(var property in source)target[property]=
source[property];return target}function shallowcopy(source){if(typeof source!=="object"||source==null)return source;var copy=source instanceof Array?[]:{};for(var i in source){var property=source[i];if(typeof property!="object"||!(property instanceof Array)){copy[i]=property;continue}copy[i]=property.slice()}return copy}}if(typeof Object.values!="function")Object.prototype.values=function(obj){var res=[];for(var i in obj)if(obj.hasOwnProperty(i))res.push(obj[i]);return res};
if(typeof Object.keys!="function")Object.keys=function(o,k,r){r=[];for(k in o)r.hasOwnProperty.call(o,k)&&r.push(k);return r};window.addEventListener("load",main);
function main(){helperjs.dom.enhanceNative("addEventListener");var h=helperjs,e=extrautilfuncs(helperjs),dom=h.dom;var main=dom.create("div");main.action_lock={state:false,set:function(){this.state=true},clear:function(){this.state=false}};main.session={};main.session.log_send=function(data){};main.session.add_standard_values=function(init){init.transcript_id=!main.transcript?null:main.transcript.data.header.id;init.active_fragment_id=!main.wavesurfer||!main.wavesurfer.active_fragment?null:main.wavesurfer.active_fragment.id;
init.position=!main.fragment_list_container_wrapper?null:Math.round(main.fragment_list_container_wrapper.scrollTop);return init};main.session.log_standard=function(init){if(main.transcript&&main.transcript.data.writable)return;var init=main.session.add_standard_values(init);main.session.log_send(init)};main.session.log_standard_queue=function(init){if(main.transcript&&main.transcript.data.writable)return;var operation_name=init.name;delete init.name;var limit=init.limit;delete init.limit;var init=
main.session.add_standard_values(init);if(typeof main.session.queue_list[operation_name]=="undefined"){main.session.queue_list[operation_name]={};var counter=main.session.queue_counter[operation_name]=0;for(var prop_name in init)main.session.queue_list[operation_name][prop_name]=[]}else var counter=main.session.queue_counter[operation_name]+=1;var queue=main.session.queue_list[operation_name];for(var prop_name in init)queue[prop_name].push(init[prop_name]);if(counter==limit-1){main.session.log_send(queue);
delete main.session.queue_list[operation_name];delete main.session.queue_counter[operation_name]}};main.session.queue_list={};main.session.queue_counter={};dom.enableEventListenerTracking(main);main.cleanup=function(){dom.detachAllRecursive(main);dom.removeEventListeners(main)};var send_errormessage=main.send_errormessage=function(text,options){if(!options)options={};if(options.unlock){if(main)main.action_lock.clear();delete options.unlock}if(typeof text!="string")text=text.errormessage;if(!options.title)options.title=
{};if(!options.title.text)options.title.text="Error!";var error_modal=smoke.alert(text,undefined,options);error_modal.dialog.title_element.classList.add("smoke-dialog-title-error");return error_modal};var err_window_single=undefined;var send_errormessage_single=main.send_errormessage_single=function(err,options){if(err_window_single&&err_window_single.parentNode!=null)err_window_single.dialog.text.innerHTML+="\x3cbr/\x3e"+err.errormessage;else err_window_single=main.send_errormessage(err,options);
return err_window_single};var gs=main.gs=new global_settings_object;function global_settings_object(){var gs=this;this.plugins={};this.localStorage={};this.link_url="https://www.transcriptshare.com";this.compose_slide_url=function(transcript_id,slide_name){if(slide_name==null||typeof slide_name=="undefined")return"";return"https://slides."+gs.link_url.substr(gs.link_url.indexOf("www.")+4)+"/"+"0".repeat(6-(transcript_id+"").length)+transcript_id+"/"+slide_name};this.compose_pcm_url=function(transcript_id){return"https://pcm."+
gs.link_url.substr(gs.link_url.indexOf("www.")+4)+"/pcm_"+"0".repeat(6-(transcript_id+"").length)+transcript_id+".txt"};this.mobile={};var max_device_width=window.getComputedStyle(document.body).getPropertyValue("--max-device-width");this.mobile.max_device_width=max_device_width==null?768:parseFloat(max_device_width.trim());this.mobile.matches_max_device_width=window.matchMedia("(max-device-width: "+this.mobile.max_device_width+"px)").matches;this.is_mobile_view=this.mobile.matches_max_device_width;
this.constants={MOUSE_LEFT:1,MOUSE_RIGHT:2};h.detect_device_type(this);this.events={};this.events.POINT="click";this.events.POINT_START=this.is_phone_or_tablet?"touchstart":"mousedown";this.events.POINT_MOVE=this.is_phone_or_tablet?"touchmove":"mousemove";this.events.POINT_END=this.is_phone_or_tablet?"touchend":"mouseup";this.audio_on=true;smoke_extensions_add(this,smoke,dom);var zoom=this.zoom={};zoom.last=window.devicePixelRatio;zoom.test=window.setInterval(function(){var zoom_current=window.devicePixelRatio;
if(zoom_current!=zoom.last){zoom.last=zoom_current;main.dispatchEvent("window-zoom")}},50);document.addEventListener("close",function(){main.session.log_standard({name:"transcript_closed"})});document.addEventListener("beforeprint",function(){main.session.log_standard({name:"transcript_print"})});document.addEventListener("visibilitychange",function(){main.dispatchEvent("document-visibilitychange")});var resize_test=e.throttle(function(){main.dispatchEvent("window-resize")},100);window.addEventListener("resize",
resize_test);window.addEventListener("hashchange",function(evt){main.dispatchEvent("window-hashchange")});return this}gs.url_vars={};var history_control=main.history_control=new history_control_object({"onbeforestatechange":function(state,settings,callback){if(main.action_lock.state)return;main.action_lock.set();gs.session_data={};function get_session_data(callback){h.get_data({success:callback,error:main.send_errormessage,file:"/dbrequest_start.php?action\x3dget_session_data"})}function get_transcript_header(input,
callback){if(typeof input.urlname=="undefined"&&typeof input.shorturl=="undefined"){callback({});return}var query="action\x3dtranscript-header"+(typeof input.state_page=="undefined"?"":"\x26state_page\x3d"+encodeURIComponent(input.state_page))+(typeof input.urlname=="undefined"?"":"\x26urlname\x3d"+encodeURIComponent(input.urlname))+(typeof input.username=="undefined"?"":"\x26source_username\x3d"+encodeURIComponent(input.username))+(typeof input.shorturl=="undefined"?"":"\x26shorturl\x3d"+encodeURIComponent(input.shorturl));
h.get_data({file:"/dbrequest_start.php",data:query,error:main.send_errormessage,success:function(data){if(!data.fragment_id)data.fragment_id=input.fragment_id;if(!data.urlname)data.urlname=input.urlname;if(!data.username)data.username=input.username;callback({disable_surveys:data.disable_surveys,urlname:data.urlname,username:data.username,transcript_id:data.transcript_id,fragment_id:data.fragment_id,transcript_name:data.transcript_name})},request_method:"GET"})}e.callback_parallelize([{output:"transcript_header",
function:get_transcript_header,parameters:[{state_page:state.page,urlname:state.urlname,username:state.username,shorturl:state.shorturl,fragment_id:state.fragment_id}]},{output:"new_session_data",function:get_session_data}],function(mixed_data){main.action_lock.clear();var new_session_data=mixed_data.new_session_data,transcript_header=mixed_data.transcript_header;gs.session_data=new_session_data;gs.website_name=gs.session_data.website_name;state.transcript_id=transcript_header.transcript_id;state.fragment_id=
transcript_header.fragment_id;state.username=transcript_header.username;state.owner_id=transcript_header.user_id||transcript_header.owner_id;state.urlname=transcript_header.urlname;state.transcript_name=transcript_header.transcript_name;state.disable_surveys=transcript_header.disable_surveys;if(new_session_data.user_type)gs.user_data.user_type=new_session_data.user_type;if(gs.user_data.user_type.is_transcriptionist)load_transcription_mandatory_files(keep_going);else keep_going();function load_transcription_mandatory_files(callback){var script_list=
[];if(!gs.plugins.he)script_list.push("/js/plugins/he/he.js");e.get_script_list({file_list:script_list,success:function(){},error:main.send_errormessage,callback:function(){gs.plugins.he=he;callback.apply(null,arguments)}})}function keep_going(){if(typeof gs.session_data.user_options=="undefined"||gs.session_data.user_options==null)gs.session_data.user_options={};if(gs.session_data.logged_in&&state.page=="play")state.page="transcribe";if(!gs.session_data.logged_in&&state.page=="transcribe")state.page=
"play";if((state.page==""||state.page=="transcribe")&&typeof state.transcript!="undefined"){if(state.page!="transcribe")state.page="transcribe";settings.title="Transcribe"}if(!settings.url){settings.url=state.page+h.formUrlVars({transcript:state.transcript},{record_undefined_values:false});if(state.username&&state.urlname)settings.url+="/"+state.username+"/"+state.urlname;if(state.fragment_id)settings.url+="#"+state.fragment_id;if(state.page=="search"&&state.q)settings.url+="?q\x3d"+state.q}if(state.transcript_name){settings.prefix=
"";settings.title=state.transcript_name;delete state.transcript_name}settings.title=history_control.generate_page_title(state,settings);callback()}})},"onstatechange":function(new_state,callback,old_state){if(main)main.dispatchEvent("page-change",old_state,new_state);if(this.user_defined.insert_page_action==true){history_control.user_defined.insert_page_action=false;callback();return}if(new_state.page=="")new_state.page="search";var view_set=false;void function(){for(var view_name in main.views)for(var prop in main.views[view_name])if(typeof main.views[view_name][prop]==
"function"&&prop!="set_subview"&&new_state.page==prop){view_set=true;main.views[view_name].set_subview({main:main,parent:content_div,state:new_state});return}}();if(!view_set)if(gs.session_data.logged_in||new_state.page=="symbol"||new_state.page=="s"||new_state.page=="transcribe"||new_state.page=="play"||new_state.page=="fragment")transcript_transcribe(main,{shorturl:new_state.shorturl,transcript_id:new_state.transcript_id,fragment_id:new_state.fragment_id});callback()},"initial_page":function(){var initial_page=
h.remove_base_url(window.location.href);if(initial_page[initial_page.length-1]=="/")initial_page=initial_page.substr(0,initial_page.length-1);if(initial_page.indexOf("?")!=-1)initial_page=initial_page.substr(0,initial_page.indexOf("?"));if(initial_page.indexOf("/")!=-1)initial_page=initial_page.substr(0,initial_page.indexOf("/"));return initial_page}(),"var_name":"page","app_url_vars":gs.url_vars});history_control.generate_page_title=function(state,settings){function capitalizeFirstLetter(current_string){return current_string.charAt(0).toUpperCase()+
current_string.slice(1)}var prefix=typeof settings.prefix!="undefined"?settings.prefix:"TranscriptShare";var suffix=settings.title?capitalizeFirstLetter(settings.title):"";var connector=prefix&&suffix?": ":"";return prefix+connector+suffix};history_control.user_defined={insert_page_action:false};history_control.insert_page=function(){history_control.user_defined.insert_page_action=true;history_control.load_page.apply(null,arguments)};gs.css_array=function(style_string){return gs.css(style_string,
true)};gs.css=function(style_string,return_array){if(style_string.includes("{"))for(var prop_name in gs.user_data.options.style)style_string=style_string.replace(new RegExp("{"+prop_name+"}","g"),gs.user_data.options.style[prop_name]);var prefix=gs.css_class_prefix="tmagic--",prefix_length=prefix.length;style_string=style_string.split(" ");gs.css_structure.convenience_replacements.forEach(function(search_string){style_string.forEach(function(n,i){n=n.trim();if(n.substr(0,prefix_length)!=prefix&&n.indexOf(search_string)==
0)n=prefix+n;style_string[i]=n})});return return_array?style_string:style_string.join(" ")};String.prototype.gs_css=function(){return gs.css(this)};dom.processCss=gs.css;gs.css_structure={convenience_replacements:["month_color","content_div","compact_search","initial_search","search","content_window","top_bar","editor","transcript","transcript_list","transcript_list_wrapper","theme","waveform_wrapper","share_link","link","transcript_settings","ribbonmenu","dropdown","checkbox","progressbar","colorwave",
"loading_spinner","loading_arrows"]};gs.user_data={user_type:{},options:{style:{skin:"ice",skin_top_foreground:"ice",use_fat_close_buttons:false},transcript:{edit_settings:{unknown_fragment_default_size_in_seconds:2,sloth_speed_percent:.5,slow_speed_percent:.75,normal_speed_percent:1,time_back_milliseconds:1E3,time_replay_milliseconds:4E3,time_loop_milliseconds:6E3,min_height:""},keys:{sloth_speed_key:"f6",slow_speed_key:"f7",normal_speed_key:"f8",time_back_key:"f9",time_loop_key:"f10",time_replay_start_key:"f11",
time_replay_end_key:"f12",pause_toggle_key:"pause",fragment_split_key:"tab"},search_settings:{match_case:window.localStorage.getItem("user_data.options.transcript.search_settings.match_case")=="true"?true:false,match_whole_words_only:window.localStorage.getItem("user_data.options.transcript.search_settings.match_whole_words_only")=="true"?true:true},behavior:{do_not_show_top_bar_when_loading:true,do_not_show_until_audio_is_loaded:false,do_not_show_until_wave_is_loaded:false,jump_to_playing_fragment_element:true,
jump_to_clicked_fragment_on_wave:true,jump_on_region_resize:true,slowly_scroll_playing_fragment_element:false,expand_controls_on_focus:true,expand_slides_on_focus:false,deletion_verify:true},view:{big_play_button:true,time_position:"top-right",title_position:"left",active_fragment_background_color:undefined,show_slides:true,larger_slides:window.localStorage.getItem("user_data.options.transcript.view.larger_slides")=="true"?true:false,show_playbar_slider:true,reset_playbar_slider_position_on_end:false,
autoscroll_offset_height:0,waveform_height:"normal",show_only_time_end_timestamp:true,share_in_colorbox:true,share_button_text:true,share_button_symbol:true,subplayer_individually_colored:true,share_button_color:undefined,subplayer_unique_linear_gradients:true,put_speaker_name_in_text:true,container_wrapper_no_margins:true,waveform_margin_in_percent:0,fragment_list_margin:"56px",fragment_list_padding:"40px 0 40px 0",speaker_list_visible_max:10}}}};smoke.close_reference=dom.create("div");var use_fat_close_buttons=
gs.user_data.options.style.use_fat_close_buttons;smoke.close_reference.classList.add(use_fat_close_buttons?"glyphicon":"custom_symbols",use_fat_close_buttons?"glyphicon-remove":"custom_symbols-cross");if(use_fat_close_buttons)smoke.close_reference.classList.add("smoke-dialog-title-close-fat");gs.extrautilfuncs=e;var content_div=main.parent=smoke.parent=dom.create("div",{parent:document.body,className:"content_div"});window.scrollTo(0,0);h.clearfocus();dom.createEventSubscriber(document.body);dom.createEventSubscriber(window);
dom.createEventSubscriber(main);var base_div=document.getElementsByTagName("head")[0].querySelector("base");if(base_div==null)var base_div=dom.create("base",{parent:document.getElementsByTagName("head")[0],href:"/"});main.className=gs.css("top_bar-{skin_top_foreground} transcript-main theme-{skin}");gs.menu_system=create_menu_system({gs:gs,dom:dom});gs.slide_modal=create_slide_modal({gs:gs,dom:dom,main:main});gs.menu_system.init({css_class_prefix:gs.css_class_prefix,expander_button_class:"top_bar-button-menu-left",
touch_events:gs.is_phone_or_tablet,events:{POINT:gs.events.POINT},page_state:function(){return gs.page_state},processCss:gs.css});window.onerror=function(message,url,lineNumber){var evt={message:message,url:url,lineNumber:lineNumber};h.get_data({file:"/dbrequest.php",data:"action\x3dlog_error\x26error\x3d"+JSON.stringify(evt)})};main.views={};main.views.login=create_login({main:main});main.views.search=create_search({main:main});parse_url_and_load_transcript();function parse_url_and_load_transcript(){var url=
h.remove_base_url(window.location.href);var url_split=url.split("/");var state={};var transcript_full=undefined;switch(url_split[0]){case "symbol":case "s":case "play":case "transcribe":switch(url_split.length){case 2:if(url_split[1].length==8)state.shorturl=url_split[1];else{if(url_split[0]=="symbol"||url_split[0]=="s"){history_control.load_page({page:"search",q:"symbol:"+url_split[1]},{defer:true,title:"Search",url:"symbol/"+url_split[1]});return}var transcript_full=url_split[1]}break;case 3:state.username=
url_split[1];var transcript_full=url_split[2];break}if(transcript_full){state.urlname=transcript_full.split("#")[0];state.fragment_id=transcript_full.split("#")[1]}break;default:break}history_control.load_page({owner_id:state.owner_id,username:state.username,urlname:state.urlname,shorturl:state.shorturl,fragment_id:state.fragment_id})}}
function render_waveform_overlay(init){render_fragment_regions({main:init.main,parent:init.transcript,fragment_list:init.transcript_data.fragment_list,wavesurfer:init.wavesurfer});function render_fragment_regions(init){var main=init.main;var gs=main.gs,h=helperjs,e=gs.extrautilfuncs,dom=h.dom,db=main.db;var transcript=main.transcript;var parent=init.parent,fragment_list=init.fragment_list,wavesurfer=init.wavesurfer;var transcript_data=main.transcript.data;var speaker_list=transcript_data.speaker_list;
wavesurfer.on("region-resize_from_start",function(region){if(region.previous_region){region.previous_region.end=region.start;region.previous_region.updateRender()}var resize_cursor_time=region.start,play_cursor_time=wavesurfer.getCurrentTime();var new_active_fragment=resize_cursor_time>play_cursor_time?region.previous_region.fragment:new_active_fragment=region.fragment;if(gs.user_data.options.transcript.behavior.jump_on_region_resize)if(new_active_fragment!=main.wavesurfer.active_fragment){wavesurfer.set_active_fragment(new_active_fragment);
main.fragment_list_container.jump_to_fragment(new_active_fragment)}var fragment=region.previous_region.fragment;var time_end=Math.round(region.start*1E3);fragment.time_end=time_end;var evt={fragment:fragment,columnsAffected:["time_end"],time_end:time_end};main.dispatchEvent("fragment-set",evt)});wavesurfer.on("region-resize_from_start-end",function(region){if(!region.previous_region)return;var previous_region=region.previous_region,previous_fragment=previous_region.fragment;var time_end=Math.round(region.start*
1E3);db.fragment_set({fragment_id:previous_fragment.id,time_end:time_end})});void function(){var previous_region=undefined;fragment_list.forEach(function(fragment,i){previous_region=add_fragment_region(fragment,previous_region,undefined,i)});wavesurfer.regionManager=previous_region.regionManager}();function add_fragment_region(fragment,previous_region,next_region,fragment_index){var time_start=previous_region?previous_region.fragment.time_end/1E3:0;var time_end=fragment.time_end/1E3;var region=wavesurfer.addRegion({start:time_start,
end:time_end,color:"black",showTitle:false,resizeStart:main.transcript.data.writable&&previous_region?true:false,resizeEnd:false,resizeStartMin:get_resize_start_min(fragment,fragment_index),resizeStartMax:get_resize_start_max(fragment,fragment_index),drag:false,classList:{},styleList:{region:{},resize:{cursor:"col-resize",position:"absolute",left:"-4px",top:0,width:"8px",height:"100%"}}});if(previous_region){previous_region.next_region=region;region.element.parentNode.insertBefore(region.element,
previous_region.element.nextSibling)}if(next_region)region.next_region=next_region;region.previous_region=previous_region;fragment.fragment_region=region;region.fragment=fragment;region.color=wavesurfer.compute_region_color(region);region.updateRender();return region;function get_resize_start_min(fragment,fragment_index){var last_last_fragment=fragment_list[(typeof fragment_index!="undefined"?fragment_index:fragment_list.indexOf(fragment))-2];return last_last_fragment?last_last_fragment.time_end/
1E3+.01:undefined}function get_resize_start_max(fragment,fragment_index){var next_fragment=fragment_list[typeof fragment_index!="undefined"?fragment_index:fragment_list.indexOf(fragment)];return next_fragment?next_fragment.time_end/1E3-.01:undefined}}main.subscribeToEvent(wavesurfer.container,"fragment-create",function(evt){var originating_fragment=evt.old_fragment,new_fragment=evt.new_fragment;var originating_region=originating_fragment.fragment_region;originating_region.color=wavesurfer.compute_region_color(originating_region);
originating_region.end=originating_fragment.time_end/1E3;originating_region.updateRender();var next_region_saved=originating_region.next_region;var new_region=add_fragment_region(new_fragment,originating_region,next_region_saved);if(next_region_saved){originating_region.next_region=new_region;next_region_saved.previous_region=new_region;update_subsequent_colors(next_region_saved)}originating_region.resizeStartMax=originating_region.fragment.time_end/1E3-.01;if(next_region_saved)next_region_saved.resizeStartMin=
originating_region.fragment.time_end/1E3+.01});main.subscribeToEvent(wavesurfer.container,{"fragment-set":"speaker_id"},function(evt){var fragment=evt.fragment,region=fragment.fragment_region;update_subsequent_colors(region);region.updateRender()});main.subscribeToEvent(wavesurfer.container,{"fragment-set":"time_end"},function(evt){var fragment=evt.fragment,region=fragment.fragment_region;var time_end_in_seconds=fragment.time_end/1E3;var index=fragment_list.indexOf(fragment)+1;if(index+1<fragment_list.length)fragment_list[index+
1].fragment_region.resizeStartMin=time_end_in_seconds+.01;fragment_list[index-1].fragment_region.resizeStartMax=time_end_in_seconds-.01;region.end=time_end_in_seconds;region.updateRender();var next_region=region.next_region;if(next_region){next_region.start=time_end_in_seconds;next_region.updateRender()}});main.subscribeToEvent(wavesurfer.container,"fragment-remove",function(evt){var fragment=evt.fragment,region=fragment.fragment_region;if(!region.previous_region){region.resizeStart=false;region.updateResizeHandleDisplay()}else{var previous_region=
region.previous_region;previous_region.next_region=region.next_region;previous_region.end=region.end;previous_region.updateRender()}var next_region=region.next_region;if(next_region){next_region.previous_region=region.previous_region;if(!region.previous_region)next_region.start=0}if(previous_region)previous_region.resizeStartMax=region.resizeStartMax;if(next_region)next_region.resizeStartMin=region.resizeStartMin;region.remove();update_subsequent_colors(previous_region||next_region);var fragment=
previous_region?previous_region.fragment:next_region.fragment;if(gs.user_data.options.transcript.behavior.expand_controls_on_focus)main.transcribe.focus(fragment)});function update_subsequent_colors(current_region){var last_speaker_id=current_region.fragment.speaker_id,current_speaker_id;while(true){current_region.color=wavesurfer.compute_region_color(current_region);current_region.updateRender();current_region=current_region.next_region;if(typeof current_region=="undefined")break;var speaker_id=
current_region.fragment.speaker_id;if(speaker_id!=last_speaker_id)break;else last_speaker_id=speaker_id}}main.subscribeToEvent(wavesurfer.container,"speaker-set_color",function(evt){var speaker_id=evt.speaker.id;fragment_list.forEach(function(fragment){var test_speaker_id=fragment.speaker_id;if(test_speaker_id!=speaker_id)return;var region=fragment.fragment_region;region.color=wavesurfer.compute_region_color(region);region.updateRender()})})}}
function render_info_header(init){var main=init.main,parent=init.parent;var gs=main.gs,h=helperjs,dom=h.dom;var info_header=main.info_header=dom.create("div",{parent:parent,className:"only-print",style:{pageBreakAfter:"always",textAlign:"left",backgroundColor:"white"}}).dom.insertBefore(parent.firstChild);var data_header=main.transcript.data.header;var text_title=dom.create("span",{parent:info_header,style:{display:"block",fontWeight:"normal",fontSize:"33px",fontFamily:"open sans"},innerHTML:main.transcript.data.header.name});
dom.create("br",{parent:info_header});if(data_header.record_date!=0)var text_date=dom.create("span",{parent:info_header,style:{display:"block",fontWeight:"normal",fontSize:"23.5px",fontFamily:"open sans"},innerHTML:format_time(data_header.record_date*1E3,data_header.record_timezone)+" to "+format_time(data_header.record_date*1E3+data_header.audio_length_in_ms,data_header.record_timezone)});function format_time(time,timezone){return moment.utc(time).format("MMMM Do, YYYY, h:mm a")+" "+timezone}dom.create("br",
{parent:info_header});dom.create("br",{parent:info_header});var text_speaker_list=dom.create("span",{parent:info_header,innerHTML:"\x3cb\x3eParticipants\x3c/b\x3e"});Object.values(main.transcript.data.speaker_list).forEach(function(speaker){if(speaker.is_background)return;dom.create("div",{parent:text_speaker_list,innerHTML:speaker.name})})}
function render_fragment_list(init){var h=helperjs,main=init.main,gs=main.gs,e=gs.extrautilfuncs,dom=h.dom,db=main.db;var transcript=main.transcript,parent=init.parent,fragment_list=init.fragment_list;var wavesurfer=main.wavesurfer,speaker_list=main.transcript.data.speaker_list;wavesurfer.fragment_time_start=function(fragment){var n=fragment_list.indexOf(fragment);return n==0?0:fragment_list[n-1].time_end/1E3};wavesurfer.play_fragment=function(fragment,fractional_position,play_callback){var sliderbar=
fragment.fragment_element.playbar_slider;var min=wavesurfer.fragment_time_start(fragment);var max=fragment.time_end/1E3;wavesurfer.running_from_sub_player=fragment;if(wavesurfer.active_fragment!=fragment)var fudge=.001;else var fudge=0;wavesurfer.set_active_fragment(fragment);if(typeof sliderbar=="undefined"){var time=wavesurfer.getCurrentTime();var time_start=time<max&&time>=min?time:min}else{var fractional_position=sliderbar.position/sliderbar.position_logical_max;var time_start=(max-min)*fractional_position+
min}wavesurfer.savePlayStateOnDrag=false;if(!play_callback)play_callback=function(){};var play_callback_original=play_callback;var play_callback=function(result){if(!result)return;main.session.log_standard({name:"play_fragment_from_subplayer"});play_callback_original()};wavesurfer.play(time_start+fudge,max,play_callback)};wavesurfer.seek_fragment=function(fragment,fraction,click_from_waveform){fraction=fraction||0;var time_start=wavesurfer.fragment_time_start(fragment);var time_end=fragment.time_end/
1E3;var duration=time_end-time_start;wavesurfer.seekTo((time_start+duration*fraction+.0001)/wavesurfer.computedDuration,click_from_waveform)};var parent_fragment=document.createDocumentFragment();var fragment_list_container_wrapper=main.fragment_list_container_wrapper=dom.create("div",{parent:parent_fragment,className:"editor-fragment_list-container_wrapper"});fragment_list_container_wrapper.style.visibility="visible";var fragment_list_container=main.fragment_list_container=dom.create("div",{parent:fragment_list_container_wrapper,
className:"editor-fragment_list-container"});if(!gs.is_mobile_view&&gs.user_data.options.transcript.view.container_wrapper_no_margins)main.fragment_list_container_wrapper.classList.add(gs.css("editor-fragment_list-container_wrapper-no_margins"));fragment_list_container.jump_to_fragment=function(fragment,use_offset){var element=fragment.section_host?fragment.section_host.section_element:fragment.fragment_element;if(gs.user_data.options.transcript.behavior.expand_controls_on_focus)main.transcribe.focus(fragment);
var container=main.fragment_list_container,container_wrapper=main.fragment_list_container_wrapper;var textarea=fragment.fragment_element.textarea;if(textarea)textarea.focus();var elementMarginTop=parseFloat(window.getComputedStyle(element).marginTop);var newScrollTop=fragment==fragment_list[0]?0:+element.offsetTop-(elementMarginTop>0?elementMarginTop:0)+parseFloat(window.getComputedStyle(container).marginTop)-(use_offset?gs.user_data.options.transcript.view.autoscroll_offset_height:0);if(newScrollTop<
0)newScrollTop=0;container_wrapper.scrollTop=newScrollTop};refresh_speaker_id_to_index_data();var speaker_dropdown_list=fragment_list_container.speaker_dropdown_list={};fragment_list.forEach(function(fragment){add_entry(fragment)});if(!main.transcript.data.writable)h.load_web_fonts(["Open Sans"],function(){h.set_to_biggest_width(Object.values(speaker_dropdown_list))});if(gs.user_data.options.transcript.behavior.expand_controls_on_focus)main.transcribe.focus_init(fragment_list[0].fragment_element);
if(main.transcript.data.writable&&gs.user_data.options.transcript.edit_settings.min_height){var min_height=gs.user_data.options.transcript.edit_settings.min_height;fragment_list_container.style.minHeight=gs.user_data.options.transcript.edit_settings.min_height;var bottom_element=dom.create("span",{parent:fragment_list_container,className:"editor-fragment_list-bottom"});var min_height=parseFloat(window.getComputedStyle(fragment_list_container).minHeight);bottom_element.addEventListener(gs.events.POINT,
function(evt){if(evt.currentTarget!=evt.target)return;var cs=window.getComputedStyle(fragment_list_container);if(parseFloat(cs.height)>min_height)return;var fragment=fragment_list[fragment_list.length-1];var input=fragment.fragment_element.textarea;var counter=0;while(true){counter+=1;input.innerHTML=input.innerHTML+"\x3cdiv\x3e\x3cbr\x3e\x3c/div\x3e";if(document.elementFromPoint(evt.clientX,evt.clientY)!=evt.currentTarget||counter>30)break}if(parseFloat(cs.height)>min_height)input.innerHTML=input.innerHTML.substr(0,
input.innerHTML.length-15);var range=document.createRange();range.selectNodeContents(input);range.collapse(false);var sel=window.getSelection();sel.removeAllRanges();sel.addRange(range);db.fragment_set({fragment_id:fragment.id,text:input.innerHTML})})}var transcript_footer=main.transcript_footer=dom.create("div",{parent:main.fragment_list_container_wrapper,className:gs.css("editor-transcript_footer"),innerHTML:"\u00a9 2018 TranscriptShare"});void function(){var margin=gs.user_data.options.transcript.view.fragment_list_margin;
var padding=gs.user_data.options.transcript.view.fragment_list_padding;if((margin!=""||padding!="")&&!gs.is_mobile_view){fragment_list_container.classList.add(gs.css("editor-fragment_list-container-with_padding"));var s=fragment_list_container.style;s.width="calc(100% - "+margin+" - "+margin+")";transcript_footer.style.marginLeft=s.marginLeft="calc("+margin+" + "+h.detect_scrollbar_thickness()/2+"px)";s.marginTop=margin;s.padding=padding}}();function add_section_event(evt){var fragment_id=evt.currentTarget.dataset.fragment_id;
var fragment=fragment_list.find(function(search_fragment){return search_fragment.id==fragment_id});if(fragment.section_host)return;db.section_create({fragment_id:fragment_id,color:0,name:"[insert title here]"})}function add_graphic_event(evt){var currentTarget=evt.currentTarget;if(currentTarget.dataset.opened=="true")return;currentTarget.dataset.opened="true";var fragment_id=currentTarget.dataset.fragment_id;var fragment=fragment_list.find(function(search_fragment){return search_fragment.id==fragment_id});
db.images_list({callback:function(image_list){var modal=smoke.alert("Select a graphic for this fragment.",function(){currentTarget.dataset.opened=""});modal.dialog.style.width="auto";var image_picker_container=dom.create("div",{parent:modal.dialog.text,className:"editor-image_picker-container"});var image_picker_options=dom.create("div",{parent:image_picker_container,className:"editor-image_picker-options"});var image_picker_selection=dom.create("div",{parent:image_picker_container,className:"editor-image_picker-selection"});
var image_picker_selection_image=dom.create("img",{parent:image_picker_selection,className:"editor-image_picker-selection-image"});image_picker_selection_image.src=gs.compose_slide_url(main.transcript.data.header.id,fragment.slide_name);image_picker_selection_image.style.visibility=typeof fragment.slide_name=="undefined"?"hidden":"visible";image_picker_selection.appendChild(modal.dialog.buttons);modal.dialog.buttons.ok.parentNode.removeChild(modal.dialog.buttons.ok);var clear_image=dom.create("div",
{parent:modal.dialog.buttons,className:"smoke-dialog-buttons-cancel",innerHTML:"Clear"});clear_image.dataset.slideName="null";clear_image.addEventListener(gs.events.POINT,image_select_slide_event);modal.dialog.buttons.classList.add(gs.css("editor-image_picker-selection-button"));var slide_show_order=Object.keys(image_list);slide_show_order.sort(function(a,b){var a_start=a.indexOf("img_")+4,a_dot=a.lastIndexOf("."),num_a=a_start==-1?a:+a.substr(a_start,(a_dot!=-1?a_dot:a.length)-a_start);var b_start=
b.indexOf("img_")+4,b_dot=b.lastIndexOf("."),num_b=b_start==-1?b:+b.substr(b_start,(b_dot!=-1?b_dot:b.length)-b_start);if(num_a>num_b)return 1;if(num_a<num_b)return-1;return 0});var in_use={},link_to_entry={};fragment_list.forEach(function(fragment_entry){if(fragment_entry.slide_name)in_use[fragment_entry.slide_name]=true});slide_show_order.forEach(function(filename){var file=image_list[filename];var entry=dom.create("div",{parent:image_picker_options});entry.dataset.slideName=filename;entry.dataset.width=
file.width;entry.dataset.height=file.height;var image=dom.create("img",{parent:entry});image.src=gs.compose_slide_url(main.transcript.data.header.id,filename);if(in_use[filename])entry.classList.add(gs.css("editor-image_picker-options-entry-in_use"));entry.addEventListener("mouseover",image_show_preview_event);entry.addEventListener("mouseout",image_hide_preview_event);entry.addEventListener(gs.events.POINT,image_select_slide_event);link_to_entry[filename]=entry});function image_show_preview_event(evt){image_picker_selection_image.src=
gs.compose_slide_url(main.transcript.data.header.id,evt.currentTarget.dataset.slideName);image_picker_selection_image.style.visibility="visible"}function image_hide_preview_event(evt){image_picker_selection_image.src=gs.compose_slide_url(main.transcript.data.header.id,evt.currentTarget.dataset.slideName);image_picker_selection_image.style.visibility=image_picker_selection_image.src==""?"hidden":"visible"}function image_select_slide_event(evt){in_use[fragment.slide_name]=false;if(fragment.slide_name){var entry=
link_to_entry[fragment.slide_name];entry.classList.remove(gs.css("editor-image_picker-options-entry-in_use"))}var dataset=evt.currentTarget.dataset;fragment.slide_name=dataset.slideName=="null"?null:dataset.slideName;if(fragment.slide_name==null){image_picker_selection_image.style.visibility="hidden";delete fragment.slide_name}else{image_picker_selection_image.style.visibility="visible";in_use[fragment.slide_name]=true;var entry=link_to_entry[fragment.slide_name];entry.classList.add(gs.css("editor-image_picker-options-entry-in_use"))}if(typeof fragment.slide_name==
"undefined"){add_or_update_slide_image(fragment,null,{immediate_render:true});db.fragment_set({fragment_id:fragment_id,slide_name:null,slide_width:null,slide_height:null,callback:function(result){}})}else{add_or_update_slide_image(fragment,fragment.slide_name,{immediate_render:true});db.fragment_set({fragment_id:fragment_id,slide_name:fragment.slide_name,slide_width:dataset.width,slide_height:dataset.height,callback:function(result){}});modal.dialog.close()}}}})}var fragment_set_text_event=e.throttle(function(textarea,
alternative_text){var fragment=textarea.fragment_element.fragment;var text=typeof alternative_text=="undefined"?textarea.innerHTML:alternative_text;db.fragment_set({fragment_id:fragment.id,text:text,callback:function(){}})},1E3);function add_entry(fragment,insertAfterElement){var element=dom.create("div",{parent:fragment_list_container,className:"editor-fragment",events:{"click":function(evt){if(gs.user_data.options.transcript.behavior.expand_controls_on_focus)main.transcribe.focus(evt.currentTarget.fragment)}}});
if(insertAfterElement)element.dom.insertBefore(insertAfterElement.nextSibling);var header=element.header=dom.create("div",{parent:element,className:"no-print editor-fragment-header"});var edit_controls=element.edit_controls=dom.create("div",{parent:header,className:"editor-fragment-edit_controls"});if(main.transcript.data.writable){var add_section=edit_controls.add_section=dom.create("div",{parent:edit_controls,className:"editor-fragment-symbol_button custom_symbols custom_symbols-book"});add_section.addEventListener(gs.events.POINT,
add_section_event);var add_graphic=edit_controls.add_graphic=dom.create("div",{parent:edit_controls,className:"editor-fragment-symbol_button custom_symbols custom_symbols-image"});add_graphic.addEventListener(gs.events.POINT,add_graphic_event);add_graphic.dataset.fragment_id=add_section.dataset.fragment_id=fragment.id}var speaker_colorbox=element.speaker_colorbox=main.transcribe.create_colorbox({click_event_on:share_in_colorbox,className:"editor-fragment-speaker-colorbox",fragment:fragment,disabled:!main.transcript.data.writable,
parent:edit_controls,speaker:function(){return speaker_list[fragment.speaker_id]},color:!main.transcript.data.writable&&gs.user_data.options.transcript.view.share_button_color?gs.user_data.options.transcript.view.share_button_color:undefined});if(!main.transcript.data.writable){if(!gs.user_data.options.transcript.view.put_speaker_name_in_text){var speaker_name=dom.create("p",{parent:edit_controls,className:"editor-fragment-speaker-name"});speaker_name.innerHTML=speaker_list[fragment.speaker_id].name;
speaker_dropdown_list[fragment.id]=speaker_name;speaker_name.addEventListener(gs.events.POINT,function(){wavesurfer.seek_fragment(fragment,0,true)})}}else{var speaker_name=dom.create("select",{parent:edit_controls,className:"editor-fragment-speaker-dropdown"});speaker_name.fragment=fragment;element.speaker_dropdown=speaker_name;speaker_dropdown_list[fragment.id]=speaker_name;speaker_dropdown_update(speaker_name,fragment_list_container.dropdown_data.speaker_id_to_index[fragment.speaker_id]);speaker_name.addEventListener("change",
fragment_set_speaker_event)}if(speaker_name)speaker_name.colorbox=speaker_colorbox;var playbar=dom.create("div",{parent:edit_controls,className:"editor-fragment-playbar"});var playbar_playpause=dom.create("div",{parent:playbar,className:"editor-fragment-playbar-playpause glyphicon glyphicon-play"});playbar_playpause.addEventListener("mousedown",function(evt){evt.preventDefault()});playbar_playpause.addEventListener(gs.events.POINT,function(){playbar_playpause_click(fragment)});element.playbar_playpause=
playbar_playpause;if(gs.user_data.options.transcript.view.show_playbar_slider){var playbar_slider=element.playbar_slider=h.sliderbar({"parent":playbar,"use_touch_events":gs.is_phone_or_tablet,"control_unit_offset":0,"background_class":gs.css("editor-fragment-playbar-slider"+(gs.user_data.options.transcript.view.put_speaker_name_in_text&&!main.transcript.data.writable?" editor-fragment-playbar-slider-long":"")),"foreground_container_class":gs.css("editor-fragment-playbar-slider-foreground-container"),
"foreground_class":gs.css("editor-fragment-playbar-slider-foreground editor-fragment-playbar-slider-foreground-left"),"foreground_inverse_class":gs.css("editor-fragment-playbar-slider-foreground editor-fragment-playbar-slider-foreground-right"),"control_class":gs.css("editor-fragment-playbar-slider-control"),"events":{"update":function(sliderbar,evt){if(["mouseup","touchend","touchcancel","touchleave"].includes(evt.type)){playbar_slider.user_defined.mouse_down=false;wavesurfer.play_fragment(fragment)}else playbar_slider.user_defined.mouse_down=
true}}});playbar_slider.user_defined={}}if(gs.user_data.options.transcript.view.subplayer_individually_colored){playbar_playpause.addEventListener("mouseover",function(){playbar_playpause.style.color=speaker_list[fragment.speaker_id].slider_background_color});playbar_playpause.addEventListener("mouseout",function(){playbar_playpause.style.color="white"})}var playbar_time=dom.create("div",{parent:playbar,className:"editor-fragment-playbar-time"});element.playbar_time=playbar_time;playbar_time.update_self=
function(){playbar_time_update_self(playbar_time)};playbar_time.transcript={fragment:fragment};playbar_time.update_self();if(main.transcript.data.writable){edit_controls.right=dom.create("div",{parent:edit_controls,className:"editor-fragment-edit_controls-right"});var remove_button=dom.create("div",{parent:edit_controls.right,className:"editor-fragment-remove_button item_button item_button-small item_button-remove"});remove_button.addEventListener(gs.events.POINT,remove_button_function);function remove_button_function(){if(textarea.fragment_element.fragment.fragment_operations)return;
if(!gs.user_data.options.transcript.behavior.deletion_verify){fragment_remove_event(textarea);return}smoke.confirm('Are you sure you want to delete this fragment? (Deleting a fragment is "safe": it appends its contents to the closest fragment, instead of removing them.)',function(result){if(result)fragment_remove_event(textarea)})}}else{var share_in_colorbox=gs.user_data.options.transcript.view.share_in_colorbox;var share_button_text=gs.user_data.options.transcript.view.share_button_text;var share_button_symbol=
gs.user_data.options.transcript.view.share_button_symbol;var share_button=dom.create("div",{parent:share_in_colorbox?speaker_colorbox:header,fragment:fragment,className:"editor-fragment-share_button"});if(share_button_text)var inner_text=dom.create("div",{parent:share_button,innerHTML:"share"});if(share_button_symbol)var inner_share_icon=dom.create("div",{parent:share_button,className:"custom_symbols custom_symbols-share"});if(!share_button_text&&share_button_symbol)inner_share_icon.classList.add(gs.css("editor-fragment-share_button-symbol_only"));
if(!share_in_colorbox){share_button.classList.add(gs.css("editor-fragment-share_button-left"),gs.css("editor-fragment-share_button-separate"));share_button.dom.insertBefore(header.firstChild)}share_button.addEventListener(gs.events.POINT,share_button_function);function share_button_function(evt){wavesurfer.pause();var fragment=evt.currentTarget.fragment;var fragment_element=fragment.fragment_element;fragment_element.classList.add(gs.css("editor-fragment-highlighted"));var share_modal=smoke.alert("",
function(){fragment_element.classList.remove(gs.css("editor-fragment-highlighted"))},{title:{text:"Click link below to select and copy"}});main.session.log_standard({name:"share_link_begin",fragment_id:fragment.id});share_modal.dialog.classList.add("smoke-dialog-short");share_modal.dialog.buttons.style.display="none";var share_link_input=dom.create("input",{parent:share_modal.dialog.text,className:"share_link",readOnly:true,value:gs.link_url+"/play/"+fragment.shorturl});share_link_input.addEventListener(gs.events.POINT,
copy_success);function copy_success(){main.session.log_standard({name:"share_link_complete",fragment_id:fragment.id});share_link_input.removeEventListener(gs.events.POINT,copy_success);share_link_input.select();document.execCommand("Copy");share_modal.dialog.title_element.text.innerHTML="Copy success!";share_modal.dialog.buttons.style.display="";share_modal.dialog.text.appendChild(dom.create("p",{innerHTML:"You've copied the link. Now paste it to your favorite social media website!"}));share_modal.dialog.title_element.classList.add("smoke-dialog-title-success")}
}}function clean_html_text(input,options){var options=options||{};var clean_style_tag=options.clean_style_tag,clean_class_tag=options.clean_class_tag,clean_autocomplete_suggestions=options.clean_autocomplete_suggestions;var selection=window.getSelection(),range=selection.getRangeAt(0);var tempStart=range.startOffset;var tempEnd=range.endOffset;var tempStartContainer=range.startContainer;var tempEndContainer=range.endContainer;if(input.firstChild&&input.firstChild.nodeName=="#text"&&input.firstChild.textContent.trim()!=
""){var textNode=input.firstChild;var newDiv=document.createElement("div");input.insertBefore(newDiv,textNode);newDiv.appendChild(textNode)}Array.from(input.querySelectorAll("span")).forEach(function(element){var parentNode=element.parentNode;Array.from(element.childNodes).forEach(function(child){parentNode.insertBefore(child,element)});parentNode.removeChild(element)});Array.from(input.querySelectorAll("pre, p")).forEach(function(element){var newElement=document.createElement("div");newElement.innerHTML=
element.innerHTML;var parentNode=element.parentNode;parentNode.insertBefore(newElement,element);parentNode.removeChild(element)});var brList=Array.from(input.querySelectorAll("br"));brList.forEach(function(br){if(br.parentNode==input)br.outerHTML="\x3cdiv\x3e\x3cbr/\x3e\x3c/div\x3e"});var divs=Array.from(input.querySelectorAll("div"));divs.forEach(function(currentDiv){if(currentDiv.childNodes.length==0){currentDiv.parentNode.removeChild(currentDiv);return}if(currentDiv.children.length==0)return;var children=
Array.from(currentDiv.children);var divDetected=children.some(function(child){if(child.nodeName.toLowerCase()=="div")return true});if(divDetected)children.forEach(function(child){currentDiv.parentNode.insertBefore(child,currentDiv)})});var selection=window.getSelection(),range=selection.getRangeAt(0);commentSearch(input);function commentSearch(element){Array.from(element.childNodes).forEach(function(child){if(child.nodeName=="#comment"){child.parentNode.removeChild(child);return}if(child.nodeName==
"#text"){if(child==range.endContainer)var tempEnd=range.endOffset;if(child==range.startContainer)var tempStart=range.startOffset;child.textContent=he.decode(child.textContent);if(typeof tempEnd!="undefined")range.setEnd(child,tempEnd);if(typeof tempStart!="undefined")range.setStart(child,tempStart);return}if(child.dataset.autocomplete)child.dataset.autocomplete="";if(child.removeAttribute){if(clean_style_tag)child.removeAttribute("style");if(clean_class_tag)child.removeAttribute("class")}if(child.childNodes.length>
0)commentSearch(child)})}if(typeof tempEndContainer!="undefined")range.setEnd(tempEndContainer,tempEnd);if(typeof tempStartContainer!="undefined")range.setStart(tempStartContainer,tempStart)}function add_word_suggestion(textarea){var selection=window.getSelection(),range=selection.getRangeAt(0);var startContainer=range.startContainer;if(startContainer!=range.endContainer)return;if(startContainer.nodeName!="#text")return;var string=startContainer.textContent;var searchString=string.substr(string.lastIndexOf(" ")+
1);var autocompleteString=transcript.data.autocomplete_tree.search(searchString,true);if(autocompleteString===false)autocompleteString="";startContainer.parentNode.setAttribute("data-autocomplete",autocompleteString.substr(searchString.length));startContainer.parentNode.setAttribute("data-autocomplete-full",autocompleteString);return true}function fragment_set_text(textarea){clean_html_text(textarea,{clean_style_tag:true,clean_class_tag:true,clean_autocomplete_suggestions:true});var autocomplete_in_use=
add_word_suggestion(textarea);var new_text=undefined;if(autocomplete_in_use){var temp_element=dom.create("div",{innerHTML:textarea.innerHTML});Array.from(temp_element.querySelectorAll("[data-autocomplete]")).forEach(function(element){delete element.dataset.autocomplete});Array.from(temp_element.querySelectorAll("[data-autocomplete-full]")).forEach(function(element){delete element.dataset.autocompleteFull});var new_text=temp_element.innerHTML}fragment_set_text_event(textarea,new_text)}function text_history_add(textarea,
evt){var undo_level_max=64;var inputType=evt.inputType;if(typeof textarea.text_history_data=="undefined"){textarea.text_history_data=[fragment.text];textarea.text_history_cursor_tree=[undefined];textarea.text_history_input_type=["init"];textarea.text_history_level=0}fragment_set_text(textarea);var level=textarea.text_history_level;var new_cursor_tree=cursor_tree_get(textarea);var do_replace=level!=0&&evt.data!=" "&&evt.inputType==textarea.text_history_input_type[level]&&evt.inputType=="insertText"&&
cursor_tree_position_is_one_ahead(new_cursor_tree,textarea.text_history_cursor_tree[level]);if(!do_replace)level=textarea.text_history_level+=1;textarea.text_history_cursor_tree[level]=new_cursor_tree;textarea.text_history_input_type[level]=evt.inputType;switch(evt.inputType){default:textarea.text_history_data[level]=textarea.innerHTML;break}if(textarea.text_history_data.length>level+1){var removal_count=textarea.text_history_cursor_tree.length-level-1;textarea.text_history_data.splice(level+1,removal_count);
textarea.text_history_cursor_tree.splice(level+1,removal_count);textarea.text_history_input_type.splice(level+1,removal_count);level=textarea.text_history_level=textarea.text_history_data.length-1}if(level>undo_level_max){var removal_count=level-undo_level_max;textarea.text_history_data.splice(0,removal_count);textarea.text_history_cursor_tree.splice(0,removal_count);textarea.text_history_input_type.splice(0,removal_count);textarea.text_history_data[0]=textarea.text_history_data[0];textarea.text_history_cursor_tree[0]=
textarea.text_history_cursor_tree[0];textarea.text_history_input_type[0]="init";level=textarea.text_history_level=textarea.text_history_data.length-1}}function text_history_undoredo(textarea,undoredo){if(undoredo=="undo"){if(textarea.text_history_level==0)return;textarea.text_history_level-=1}else{if(textarea.text_history_level==textarea.text_history_data.length-1)return;textarea.text_history_level+=1}var level=textarea.text_history_level;switch(textarea.text_history_input_type[level]){default:textarea.innerHTML=
textarea.text_history_data[level];break}cursor_tree_set(textarea,textarea.text_history_cursor_tree[level]);fragment_set_text(textarea)}function cursor_tree_position_is_one_ahead(cursorTreeA,cursorTreeB){if(!cursorTreeA||!cursorTreeB)return false;if(cursorTreeA[0][0].length!=cursorTreeB[0][0].length)return false;if(cursorTreeA[1][0].length!=cursorTreeB[1][0].length)return false;if(cursorTreeA[0][1]-cursorTreeB[0][1]>1)return false;if(cursorTreeA[1][1]-cursorTreeB[1][1]>1)return false;var doesNotMatch=
[[cursorTreeA[0][0],cursorTreeB[0][0]],[cursorTreeA[1][0],cursorTreeB[0][0]]].some(function(arrCombo){var arr1=arrCombo[0],arr2=arrCombo[1];var doesNotMatch=arr1.some(function(offset,i){return arr1[i]!=arr2[i]});return doesNotMatch});return!doesNotMatch}function cursor_tree_set(textarea,cursorTree){if(typeof cursorTree=="undefined")return;var selection=window.getSelection(),range=selection.getRangeAt(0);[["Start",cursorTree[0][0],cursorTree[0][1]],["End",cursorTree[1][0],cursorTree[1][1]]].forEach(function(arrCombo){var startOrEnd=
arrCombo[0],arr=arrCombo[1],lastOffset=arrCombo[2];var pointer=textarea;var isError=arr.some(function(offset,i){pointer=pointer.childNodes[offset];if(typeof pointer=="undefined")return true});if(lastOffset>pointer.length)isError=true;if(!isError)range["set"+startOrEnd](pointer,lastOffset)})}function cursor_tree_get(textarea){var selection=window.getSelection(),range=selection.getRangeAt(0);var treeStart=[],treeEnd=[];var success=true;Array.from([[range.startContainer,treeStart],[range.endContainer,
treeEnd]]).forEach(function(arrCombo){var pointer=arrCombo[0],arr=arrCombo[1];while(true){if(pointer==null){success=false;break}if(pointer==textarea)break;offset=0,child=pointer;while((child=child.previousSibling)!=null)offset++;arr.push(offset);pointer=pointer.parentNode}});return success?[[treeStart,range.startOffset],[treeEnd,range.endOffset]]:undefined}function autocomplete_keydown_test(evt){if(evt.code.toLowerCase()!="arrowright")return;var selection=window.getSelection(),range=selection.getRangeAt(0);
var startContainer=range.startContainer;if(startContainer!=range.endContainer)return;if(startContainer.nodeName!="#text")return;var autocompleteString=startContainer.parentNode.getAttribute("data-autocomplete");if(autocompleteString===null||autocompleteString=="")return;var autocompleteStringFull=startContainer.parentNode.getAttribute("data-autocomplete-full");evt.preventDefault();startContainer.textContent=startContainer.textContent.substr(0,startContainer.textContent.length-autocompleteStringFull.length+
autocompleteString.length)+autocompleteStringFull;startContainer.parentNode.setAttribute("data-autocomplete","");range.setStart(startContainer,startContainer.textContent.length);range.collapse(true);selection.removeAllRanges();selection.addRange(range)}var fragment_content=element.fragment_content=dom.create("div",{parent:element,className:"editor-fragment-fragment_content"});var textarea=element.textarea=dom.create("div",{parent:fragment_content,className:"editor-fragment-textarea",contentEditable:main.transcript.data.writable,
events:!main.transcript.data.writable?undefined:{"keydown":function(evt){if(evt.ctrlKey)if(evt.key=="z"||evt.key=="y"){text_history_undoredo(textarea,evt.key=="z"?"undo":"redo");evt.preventDefault();return false}},"input":function(evt){if(evt.inputType=="historyUndo"||evt.inputType=="historyRedo"){evt.preventDefault();return false}text_history_add(textarea,evt)}}});textarea.addEventListener("keydown",autocomplete_keydown_test);textarea.innerHTML=fragment.text;textarea.childNodes.forEach(function(node){if(node.nodeName!=
"#text")return;var div=document.createElement("div");node.parentNode.insertBefore(div,node);div.appendChild(node)});if(!main.transcript.data.writable&&gs.user_data.options.transcript.view.put_speaker_name_in_text){var speaker_text=dom.create("div",{innerHTML:speaker_list[fragment.speaker_id].name+": ",className:"editor-fragment-textarea-speaker-name"});var insertion_parent=textarea.firstChild?textarea.firstChild:textarea;insertion_parent.insertBefore(speaker_text,insertion_parent.firstChild)}textarea.addEventListener(gs.events.POINT,
function(){if(fragment!=wavesurfer.active_fragment){wavesurfer.pause();wavesurfer.seek_fragment(fragment,0,false)}});textarea.fragment_element=fragment.fragment_element=element;element.textarea=textarea;element.fragment=fragment;if(typeof fragment.slide_name!="undefined"&&fragment.slide_name!=null)add_or_update_slide_image(fragment,fragment.slide_name);playbar_color_update(fragment)}function playbar_time_update_self(playbar_time){var fragment=playbar_time.transcript.fragment;var time_end=fragment.time_end/
1E3;if(gs.user_data.options.transcript.view.show_only_time_end_timestamp)playbar_time.innerHTML=e.timeFormat.secondsToString(time_end,false,false);else{var time_start=wavesurfer.fragment_time_start(fragment);var duration=time_end-time_start;playbar_time.innerHTML=e.timeFormat.secondsToString(time_start,false,false)+" - "+e.timeFormat.secondsToString(time_end,false,false)}if(playbar_time.transcript.clone)playbar_time.transcript.clone.innerHTML=playbar_time.innerHTML}function add_or_update_slide_image(fragment,
slide_name,options){var options=options||{};var element=fragment.fragment_element;if(!element.slide_image&&slide_name==null)return;if(element.slide_image){if(slide_name==null){element.slide_wrapper.parentNode.removeChild(element.slide_wrapper);delete element.slide_wrapper;element.slide_image.parentNode.removeChild(element.slide_image);delete element.slide_image;element.slide_control.parentNode.removeChild(element.slide_control);delete element.slide_control}else{fragment.slide_name=slide_name;element.slide_image.src=
gs.compose_slide_url(main.transcript.data.header.id,slide_name)}return}var slide_wrapper=element.slide_wrapper=dom.create("div",{parent:element.fragment_content,className:"editor-fragment-slide-right editor-fragment-slide"+(gs.user_data.options.transcript.view.larger_slides?" editor-fragment-slide-larger":"")});var slide_image=element.slide_image=dom.create("img",{parent:slide_wrapper});slide_image.setAttribute("role","presentation");slide_wrapper.fragment_element=element;if(!options.immediate_render);
else slide_image.src=gs.compose_slide_url(main.transcript.data.header.id,fragment.slide_name);var slide_control=element.slide_control=dom.create("div",{parent:slide_wrapper,className:"custom_symbols custom_symbols-enlarge"});slide_wrapper.dom.insertBefore(element.fragment_content.firstChild);slide_wrapper.addEventListener(gs.events.POINT,function(evt){gs.slide_modal.create_event(evt)})}main.subscribeToEvent(fragment_list_container,"document-visibilitychange",function(evt){if(!("hidden"in document)||
document.hidden==false)return;if(main.wavesurfer.active_fragment&&main.wavesurfer.running_from_sub_player)wavesurfer.pause()});main.subscribeToEvent(fragment_list_container,"transcript-attach_to_dom",function(evt){slides_precompute_heights();update_sliderbars_and_playbar_times()});main.subscribeToEvent(fragment_list_container,"transcript-ready_event_completed",function(evt){slides_set_srcs()});function update_sliderbars_and_playbar_times(){var sliderbar_width=undefined;fragment_list_container.classList[gs.mobile.matches_max_device_width?
"add":"remove"](gs.css("editor-fragment_list-container-time_is_inside_playbar"));fragment_list.forEach(function(fragment){var sliderbar=fragment.fragment_element.playbar_slider;sliderbar.update();if(gs.mobile.matches_max_device_width){var playbar_time=fragment.fragment_element.playbar_time;var playbar_time_clone=playbar_time.cloneNode(false);playbar_time_clone.innerHTML=playbar_time.innerHTML;playbar_time.transcript={clone:playbar_time_clone};sliderbar.foreground_container.appendChild(playbar_time_clone);
sliderbar.foreground_inverse.appendChild(playbar_time);playbar_time_clone.style.color="white";playbar_time.style.color="black";playbar_time.style.zIndex=1}})}function slides_precompute_heights(){fragment_list.forEach(function(fragment){var slide_image=fragment.fragment_element.slide_image;if(!slide_image)return;var style=window.getComputedStyle(slide_image);fragment.slide_image_height=(parseFloat(style.width)-(style.boxSizing=="content-box"?0:parseFloat(style.borderWidth)))*fragment.slide_height/
fragment.slide_width+"px"});fragment_list.forEach(function(fragment){var slide_image=fragment.fragment_element.slide_image;if(!slide_image)return;slide_image.style.height=fragment.slide_image_height;delete fragment.slide_image_height})}function slides_set_srcs(){var scrollTop=fragment_list_container_wrapper.scrollTop+h.findabspos_y(fragment_list_container_wrapper);var windowHeight=window.innerHeight;var scrollBuffer=0;var loadDelayForOutsideImagesInMilliseconds=1E3;fragment_list.forEach(function(fragment){var slide_image=
fragment.fragment_element.slide_image;if(!slide_image)return;var style=window.getComputedStyle(slide_image);var top=h.findabspos_y(slide_image),height=parseFloat(style.height);var cond1=top+height+scrollBuffer>=scrollTop;var cond2=top<=scrollTop+windowHeight+scrollBuffer;if(cond1&&cond2)set_src();else setTimeout(set_src,loadDelayForOutsideImagesInMilliseconds);function set_src(){slide_image.src=gs.compose_slide_url(main.transcript.data.header.id,fragment.slide_name);slide_image.addEventListener("load",
function(){slide_image.style.height=""})}})}function playbar_playpause_click(fragment){var should_play=fragment!=wavesurfer.active_fragment||!wavesurfer.isPlaying();if(should_play){main.transcribe.reset_slider_position_if_at_max(fragment);wavesurfer.play_fragment(fragment)}else wavesurfer.pause()}void function(){function clear_replay_timer(){if(!main.transcript||!main.transcript.replay)return;if(main.transcript.replay.timer)window.clearInterval(main.transcript.replay.timer.id);delete main.transcript.replay}
wavesurfer.on("play",function(){clear_replay_timer();main.dispatchEvent("transcript-play")});wavesurfer.on("pause",function(){clear_replay_timer();main.dispatchEvent("transcript-pause")});wavesurfer.on("finish",function(){clear_replay_timer();main.dispatchEvent("transcript-pause")})}();main.subscribeToEvent(fragment_list_container,["speaker-set_name","speaker-create","speaker-remove"],speaker_dropdown_list_update);main.subscribeToEvent(fragment_list_container,"speaker-set_color",playbar_color_update_event);
main.subscribeToEvent(fragment_list_container,{"fragment-set":"speaker_id"},function(evt){playbar_color_update(evt.fragment)});main.subscribeToEvent(fragment_list_container,{"fragment-set":"text"},function(evt){var textarea=evt.fragment.fragment_element.textarea;if(document.activeElement==textarea)return;textarea.innerHTML=evt.fragment.text});main.subscribeToEvent(fragment_list_container,{"fragment-set":"time_end"},function(evt){var element=evt.fragment.fragment_element;element.playbar_time.update_self();
main.transcribe.set_subslider_position_from_audio_position(wavesurfer.getCurrentTime())});main.subscribeToEvent(fragment_list_container,"fragment-create",function(evt){add_entry(evt.new_fragment,evt.old_fragment.fragment_element);wavesurfer.set_active_fragment(evt.new_fragment);main.fragment_list_container.jump_to_fragment(evt.new_fragment)});main.subscribeToEvent(fragment_list_container,"fragment-remove",function(evt){var element=evt.fragment.fragment_element;element.parentNode.removeChild(element)});
parent.appendChild(parent_fragment);function speaker_dropdown_list_update(){refresh_speaker_id_to_index_data();for(var id in fragment_list_container.speaker_dropdown_list)speaker_dropdown_update(fragment_list_container.speaker_dropdown_list[id])}function playbar_color_update_event(evt){var speaker=evt.speaker;for(var id in fragment_list){var fragment=fragment_list[id];if(fragment.speaker_id==speaker.id)playbar_color_update(fragment)}}function playbar_color_update(fragment){var fragment_element=fragment.fragment_element;
var speaker=speaker_list[fragment.speaker_id];if(fragment_element.edit_controls.add_section)fragment_element.edit_controls.add_section.style.color=fragment_element.edit_controls.add_graphic.style.color=speaker.color;fragment.fragment_element.speaker_colorbox.set_color(!main.transcript.data.writable&&gs.user_data.options.transcript.view.share_button_color?gs.user_data.options.transcript.view.share_button_color:speaker.color);if(gs.user_data.options.transcript.view.subplayer_individually_colored){var slider_foreground_color=
speaker.color;var slider_background_color=h.hex_color_blend(slider_foreground_color,"#ffffff",.15)+"ff";if(gs.user_data.options.transcript.view.subplayer_unique_linear_gradients){var initial_color=e.colorFormat.convert("hex","hsla",speaker.color,true);var bar_colors={};bar_colors.normal=[initial_color[0],initial_color[1],initial_color[2]];bar_colors.light=[initial_color[0],initial_color[0]==0?0:58,88];bar_colors.really_dark=[initial_color[0],initial_color[0]==0?0:65,33];bar_colors.dark=[initial_color[0],
initial_color[0]==0?0:55,26];for(var bar_color_name in bar_colors)bar_colors[bar_color_name]=e.colorFormat.compose("hsla",bar_colors[bar_color_name].map(function(n){return n>0?n:0}));slider_foreground_color=bar_colors.normal;slider_background_color=bar_colors.light}speaker.slider_background_color=slider_background_color;var playbar_playpause=fragment_element.playbar_playpause;playbar_playpause.style.backgroundColor=playbar_playpause.style.borderColor=slider_foreground_color;playbar_playpause.style.color=
"white";if(gs.user_data.options.transcript.view.show_playbar_slider){fragment_element.playbar_slider.querySelector("."+gs.css("editor-fragment-playbar-slider-foreground-container")).style.background=gs.user_data.options.transcript.view.subplayer_unique_linear_gradients?"linear-gradient(to left, "+bar_colors.really_dark+" 0%, "+bar_colors.dark+" 50%, "+bar_colors.normal+" 100%)":slider_foreground_color;fragment_element.playbar_slider.querySelector("."+gs.css("editor-fragment-playbar-slider-foreground-right")).style.background=
slider_background_color}}}function refresh_speaker_id_to_index_data(){fragment_list_container.dropdown_data=e.match_id_to_index(speaker_list,{id_to_index:"speaker_id_to_index",index_to_id:"speaker_index_to_id"})}function speaker_dropdown_update(speaker_dropdown,selectedIndex){if(typeof selectedIndex=="undefined")selectedIndex=speaker_dropdown.selectedIndex;speaker_dropdown.innerHTML="";var speaker_list=main.transcript.data.speaker_list,index_to_id_list=fragment_list_container.dropdown_data.speaker_index_to_id;
index_to_id_list.forEach(function(speaker_id){var speaker_data=speaker_list[speaker_id];var dropdown_option=dom.create("option",{parent:speaker_dropdown});dropdown_option.innerHTML=speaker_data.name;dropdown_option.value=speaker_data.id});speaker_dropdown.selectedIndex=selectedIndex}function fragment_set_speaker_event(evt){if(main.action_lock.state)return;var speaker_dropdown=evt.currentTarget,original_value=speaker_dropdown.selectedIndex;var speaker_id=fragment_list_container.dropdown_data.speaker_index_to_id[speaker_dropdown.selectedIndex];
db.fragment_set({fragment_id:speaker_dropdown.fragment.id,speaker_id:speaker_id,callback:function(result){if(result.error)speaker_dropdown.selectedIndex=original_value}})}function fragment_remove_event(input){if(main.action_lock.state)return;var fragment_element=input.fragment_element,fragment=fragment_element.fragment;if(fragment.fragment_operations)return;fragment_element.style.display="none";db.fragment_remove({fragment_id:fragment.id,callback:function(result){fragment.fragment_operations=false;
if(result.error){fragment_element.style.display="";return}}})}}
function render_section_list(init){var h=helperjs,main=init.main,gs=main.gs,e=gs.extrautilfuncs,dom=h.dom,db=main.db;var transcript=main.transcript,parent=init.parent,section_list=init.section_list;var section_select_dropdown=function(){var top_bar_right=main.top_bar_right;var section_select=top_bar_right.section_select;if(section_select&&section_select.parentNode)section_select.parentNode.removeChild(section_select);var section_select_dropdown=e.gui.dropdown.create({parent:top_bar_right.label_container,
clickEventType:gs.events.POINT,className:gs.css("dropdown"),onSelect:section_select_event,hideMethod:"display",initialValue:undefined,list:main.transcribe.section_list_to_dropdown_array()});section_select_dropdown.element.classList.add.apply(section_select_dropdown.element.classList,gs.css_array("dropdown-simple editor-top_right_dropdown"));var section_select=top_bar_right.section_select=section_select_dropdown.element;var sibling=gs.user_data.options.transcript.view.time_position=="top-right"?top_bar_right.time_label:
top_bar_right.label_container.lastChild;section_select.parentNode.insertBefore(section_select,sibling);return section_select_dropdown}();function section_select_event(evt){if(!main.wavesurfer.seek_fragment)return;var section_id=evt.currentTarget.value;if(section_id==main.transcribe.section_id)return;main.transcribe.section_id=section_id;var section=section_list.find(function(test){return test.id==section_id});main.wavesurfer.seek_fragment(section.starting_fragment);return true}var section_set_text_event=
e.throttle(function(evt){var section_inner=evt.target,section_id=section_inner.dataset.section_id;db.section_set({section_id:section_id,name:section_inner.textContent})},1E3);main.addEventListener("transcript-set_active_fragment",function(evt){var fragment=evt.detail.fragment;if(fragment==evt.detail.previous_fragment)return;var section_list=main.transcript.data.section_list;if(section_list.length==0)return;var section_select=main.top_bar_right.section_select;var fragment_list=main.transcript.data.fragment_list;
var fragment_index=fragment_list.findIndex(function(test){return fragment==test});for(let f=fragment_index;f>=0;f--)if(fragment_list[f].section_host){var section_id=fragment_list[f].section_host.id;break}section_select.selectedIndex=Array.from(section_select.options).findIndex(function(option){if(option.value==section_id)return true})});main.addEventListener("section-set_name",function(evt){var section=evt.detail.section;section_select_dropdown.update({value:section.id,text:section.name});section.section_element_print.innerHTML=
section.name;var foundOption=section_select_dropdown.list.find(function(test){return test.value==section.id});foundOption.text=section.name});main.addEventListener("section-set_color",function(evt){var section=evt.detail.section;set_section_color(section,section.color)});function set_section_color(section,color){section.section_element_inner.style.backgroundColor=color;if(section.section_element_controls)Object.values(section.section_element_controls.buttons).forEach(function(button){button.style.color=
color})}function open_color_picker(evt){if(evt.currentTarget!=evt.target)return;var button=evt.currentTarget;button.childNodes[0].click()}function change_section_color_event(evt){var color_picker=evt.target,section_id=color_picker.dataset.section_id;var color=color_picker.get_color();db.section_set({section_id:section_id,color:color})}function remove_section_button_click_event(evt){var button=evt.target,section_id=button.dataset.section_id;smoke.confirm("Are you sure you want to remove this section?",
function(result){if(!result)return;db.section_remove({section_id:section_id})})}var fragment_list_container=main.fragment_list_container;main.subscribeToEvent(fragment_list_container,"section-set",function(evt){if(evt.fragment_id){var fragment_id=evt.fragment_id;var fragment=transcript.data.fragment_list.find(function(search_fragment){return search_fragment.id==fragment_id});move_section({section:evt.section,fragment:fragment})}});main.subscribeToEvent(fragment_list_container,"section-remove",function(evt){var section=
evt.section;section.section_element.parentNode.removeChild(section.section_element);section_select_dropdown.remove({value:section.id,altIndex:0});delete section.starting_fragment.section_host});main.addEventListener("section-create",function(evt){var section_list=main.transcript.data.section_list;var section=evt.detail.section;main.transcribe.sections.add(section);var section_index=section_list.findIndex(function(test){return test==section});var section_after_id=section_index==section_list.length-
1?undefined:section_list[section_index+1].id;section_select_dropdown.add({value:section.id,text:section.name},{insertBefore:section_after_id});add_section_element(section);main.transcribe.sections.fit_text(section)});section_list.forEach(add_section_element);function move_section(init){var section=init.section,fragment=init.fragment,section_element=section.section_element;section.starting_fragment=fragment;fragment.section_host=section;var fragment_element=section.starting_fragment.fragment_element;
main.transcribe.sections.sort();fragment_element.parentNode.insertBefore(section_element,fragment_element)}function add_section_element(section){var section_element=section.section_element=dom.create("div",{parent:parent,className:"no-print editor-section_element"}).dom.insertBefore(section.starting_fragment.fragment_element);if(main.transcript.data.writable){var section_element_controls=section.section_element_controls={};section_element_controls.buttons={};var section_element_controls_left=section_element_controls.left=
dom.create("div",{parent:section_element,className:"editor-section_element-controls"});var section_element_controls_right=section_element_controls.right=dom.create("div",{parent:section_element,className:"editor-section_element-controls"});var change_section_color_button=section_element_controls.buttons.change_section_color_button=e.create_color_picker({parent:section_element_controls.left,className:"editor-fragment-symbol_button custom_symbols custom_symbols-paint-format"});change_section_color_button.addEventListener(gs.events.POINT,
open_color_picker);var color_input=change_section_color_button.childNodes[0];color_input.style.display="none";color_input.dataset.section_id=section.id;color_input.addEventListener("change",change_section_color_event);var remove_section_button=section_element_controls.buttons.remove_section_button=dom.create("div",{parent:section_element_controls.left,className:"editor-fragment-symbol_button custom_symbols custom_symbols-cross"});remove_section_button.dataset.section_id=section.id;remove_section_button.addEventListener(gs.events.POINT,
remove_section_button_click_event);var load_section_template_button=section_element_controls.buttons.load_section_template_button=dom.create("div",{parent:section_element_controls.right,className:"editor-fragment-symbol_button custom_symbols custom_symbols-cloud-download"});var save_section_template_button=section_element_controls.buttons.save_section_template_button=dom.create("div",{parent:section_element_controls.right,className:"editor-fragment-symbol_button custom_symbols custom_symbols-cloud-upload"})}var section_element_inner=
section.section_element_inner=dom.create("div",{parent:section_element,className:"editor-section_element-inner"});if(main.transcript.data.writable)section_element_inner.parentNode.insertBefore(section_element_inner,section_element_controls.right);section_element_inner.dataset.section_id=section.id;set_section_color(section,section.color);if(main.transcript.data.writable){section_element_inner.setAttribute("contenteditable",true);section_element_inner.addEventListener("input",section_set_text_event)}var section_element_print=
section.section_element_print=dom.create("div",{parent:parent,className:gs.css("only-print editor-section_element")}).dom.insertBefore(section.starting_fragment.fragment_element);section_element_print.style.height="auto";section_element_print.style.textAlign="center";var section_element_inner_print=section.section_element_inner_print=dom.create("div",{parent:section_element_print,className:"editor-section_element-inner"});section_element_inner_print.style.backgroundColor=section.color}main.transcribe.sections.fit_text()}
function render_speaker_list(init){var main=init.main;var gs=main.gs,h=helperjs,e=gs.extrautilfuncs,dom=h.dom,db=main.db;var transcript=main.transcript;var parent=init.parent,speaker_list=init.speaker_list;if(main.speaker_list_container&&main.speaker_list_container.parentNode)main.speaker_list_container.parentNode.removeChild(main.speaker_list_container);var top_bar_right=main.top_bar_right;var speaker_label=top_bar_right.speaker_label;if(speaker_label&&speaker_label.parentNode)speaker_label.parentNode.removeChild(speaker_label);
var speaker_dropdown=e.gui.dropdown.create({parent:top_bar_right.label_container,clickEventType:gs.events.POINT,className:gs.css("dropdown"),preventDefault:!main.transcript.data.writable,closeOnClick:false,onHeaderChange:function(text){return"\x3cdiv\x3e"+text+'\x3c/div\x3e\x3cdiv class\x3d"custom_symbols '+gs.css("dropdown-header-helper_button custom_symbols-speaker-"+(main.transcript.data.writable?"add":"list"))+'"\x3e\x3c/div\x3e'},onBeforeSelect:function(evt,selected,success){success(false)},
onExpand:function(){if(speaker_list_container_brother)speaker_list_container_brother.style.display=""},onCollapse:function(){if(speaker_list_container_brother)speaker_list_container_brother.style.display="none"},hideMethod:"display",initialValue:undefined,list:main.transcribe.speaker_list_to_dropdown_array()});speaker_dropdown.element.dom.classList.add(gs.css("dropdown-simple dropdown-simple-speaker_list editor-top_right_dropdown editor-top_right_speaker_label"));speaker_dropdown.element.dom.insertBefore(top_bar_right.label_container.firstChild);
var speaker_label=top_bar_right.speaker_label=speaker_dropdown.element;var speaker_list_container=top_bar_right.speaker_label.dropdownControl.optionContainer;speaker_list_container.classList.add(gs.css("editor-speaker_list-container"),gs.css("editor-speaker_list-container-dropdown"));var speaker_list_container_wrapper=speaker_list_container.parentNode;speaker_list_container.parentNode.classList.add(gs.css("editor-speaker_list-container_wrapper"));main.addEventListener("transcript-set_active_fragment",
function(evt){var speaker_id=evt.detail.fragment.speaker_id,speaker_list=main.transcript.data.speaker_list;var speaker_array=Array.from(top_bar_right.speaker_label.options);top_bar_right.speaker_label.selectedIndex=speaker_array.findIndex(function(option){return option.value==speaker_id})});main.addEventListener("speaker-set_name",function(evt){var current_fragment=main.wavesurfer.active_fragment;if(evt.detail.speaker.id!=current_fragment.speaker_id)return;speaker_dropdown.headerElement.innerHTML=
main.transcript.data.speaker_list[current_fragment.speaker_id].name});main.addEventListener("fragment-set",function(evt){var current_fragment=main.wavesurfer.active_fragment;if(current_fragment!=evt.detail.fragment)return;if(!evt.detail.columnsAffected.includes("speaker_id"))return;speaker_dropdown.headerElement.innerHTML=main.transcript.data.speaker_list[current_fragment.speaker_id].name});speaker_list_container.initiateMaxHeight=function(){function getHeight(element){var style=window.getComputedStyle(element);
return element.clientHeight+parseFloat(style.marginTop)+parseFloat(style.marginBottom)}var saved_wrapper_display=speaker_list_container_wrapper.style.display;speaker_list_container_wrapper.style.display="";var saved_display=speaker_list_container.style.display;speaker_list_container.style.display="";var entry_height=[],children=speaker_list_container.childNodes;entry_height[0]=getHeight(children[0]);entry_height[1]=children.length>1?getHeight(children[1]):entry_height[0];entry_height[2]=getHeight(children[children.length-
1]);var adj_0=entry_height[0]-entry_height[1];var adj_1=entry_height[2]-entry_height[1];speaker_list_container.style.maxHeight=adj_0+adj_1+entry_height[1]*gs.user_data.options.transcript.view.speaker_list_visible_max+"px";speaker_list_container.style.display=saved_display;speaker_list_container_wrapper.style.display=saved_wrapper_display};var speaker_set_name_event=e.debounce(function(input){db.speaker_set({speaker_id:input.speaker.id,name:input.value})},200);var trim_name_on_blur=function(input){var new_value=
input.value.trim();if(new_value==input.value)return;input.value=new_value;db.speaker_set({speaker_id:input.speaker.id,name:input.value})};if(main.transcript.data.writable){var speaker_list_container_brother=dom.create("div",{parent:speaker_list_container_wrapper,className:"editor-speaker_list-container",style:{display:"none"}});var add_new={};add_new.element=dom.create("div",{parent:speaker_list_container_brother,className:"editor-speaker_list-entry editor-speaker_list-add_new"});add_new.colorbox=
e.create_color_picker({parent:add_new.element,className:"editor-colorbox editor-speaker-colorbox editor-speaker_list-entry-colorbox"});add_new.colorbox.set_color(main.transcript.paintbucket.pick_color());add_new.input=dom.create("input",{parent:add_new.element,type:"text"});add_new.button=dom.create("div",{parent:add_new.element,className:"item_button item_button-small item_button-add"});add_new.button.addEventListener(gs.events.POINT,speaker_create_event);add_new.update_margin=function(){add_new.element.style.marginRight=
"";var defaultMarginRight=parseFloat(window.getComputedStyle(add_new.element).marginRight);add_new.element.style.marginRight=defaultMarginRight+(Object.keys(speaker_list).length<=gs.user_data.options.transcript.view.speaker_list_visible_max?0:h.detect_scrollbar_thickness())+"px"}}for(var id in speaker_list)add_entry(speaker_list[id]);if(gs.user_data.options.transcript.view.speaker_list_visible_max&&speaker_list_container.style.maxHeight=="")speaker_list_container.initiateMaxHeight();function add_entry(speaker){var element=
Array.from(speaker_list_container.childNodes).find(function(option){return option.value==speaker.id});element.speaker=speaker;element.innerHTML="";element.classList.add(gs.css("editor-speaker_list-entry"));if(!main.transcript.data.writable)element.classList.add(gs.css("editor-speaker_list-entry-readonly"));var speaker_colorbox=main.transcribe.create_colorbox({className:"editor-speaker_list-entry-colorbox",disabled:!main.transcript.data.writable,parent:element,speaker:function(){return speaker}});
var input=dom.create("input",{parent:element,events:{"blur":function(evt){trim_name_on_blur(evt.currentTarget)},"change, input, paste":function(evt){speaker_set_name_event(evt.currentTarget)}},type:"text",value:speaker.name,readOnly:!main.transcript.data.writable,spellcheck:false});if(!main.transcript.data.writable)input.addEventListener(gs.events.POINT,toggle_highlighted_speaker);if(main.transcript.data.writable){var remove_button=dom.create("div",{parent:element,className:"item_button item_button-small item_button-remove"});
remove_button.addEventListener(gs.events.POINT,function(){speaker_remove_event(input)})}element.speaker_name_input=input;input.colorbox=speaker_colorbox;input.speaker=speaker;input.speaker_element=element;speaker.speaker_list_input=input;if(add_new)add_new.update_margin()}main.subscribeToEvent(speaker_list_container,"speaker-set_color",speaker_color_update);function speaker_color_update(evt){evt.speaker.speaker_list_input.colorbox.set_color(evt.color)}function speaker_create_event(){if(main.action_lock.state)return;
var name=add_new.input.value,color=add_new.colorbox.get_color();db.speaker_create({name:name,color:color,callback:function(result){add_new.input.value="";if(result.error)return;var new_speaker={id:result.id,name:name,color:color};main.transcript.data.speaker_list[result.id]=new_speaker;speaker_dropdown.add({text:new_speaker.name,value:new_speaker.id});add_entry(new_speaker);speaker_list_container.scrollTop=speaker_list_container.scrollHeight-speaker_list_container.clientTop;main.dispatchEvent("speaker-create",
{speaker:new_speaker});add_new.colorbox.set_color(main.transcript.paintbucket.pick_color())}})}function toggle_highlighted_speaker(evt){var parent=evt.currentTarget.parentNode,speaker=parent.speaker;main.transcribe.marker[main.transcribe.marker.current_highlighted_speaker==speaker?"clear":"highlight_speaker"](speaker)}main.addEventListener("transcript-highlight_speaker",function(evt){var speaker=evt.detail.speaker;Array.from(speaker_list_container.children).some(function(speaker_element){if(speaker_element.speaker==
speaker){speaker_element.classList.add(gs.css("editor-speaker_list-entry-highlighted"));return true}})});main.addEventListener("transcript-unhighlight_speaker",function(evt){var speaker=evt.detail.speaker;Array.from(speaker_list_container.children).some(function(speaker_element){if(speaker_element.speaker==speaker){speaker_element.classList.remove(gs.css("editor-speaker_list-entry-highlighted"));return true}})});function speaker_remove_event(input){if(main.action_lock.state)return;main.action_lock.set();
var speaker=input.speaker;db.speaker_remove({speaker_id:speaker.id,transcript_id:transcript.data.header.id,callback:function(result){main.action_lock.clear();if(result.error)return;speaker_dropdown.remove({value:speaker.id});delete main.transcript.data.speaker_list[speaker.id];add_new.update_margin();main.dispatchEvent("speaker_remove",{speaker:speaker})}})}}
function transcript_transcribe(main,options){if(options.fragment_id)options.fragment_id=+options.fragment_id;var transcript_search={shorturl:options.shorturl,transcript_id:options.transcript_id,fragment_id:options.fragment_id};var history_control=main.history_control;var parent=main.parent;var gs=main.gs;var menu_system=gs.menu_system;if(!history_control.defer)parent.style.backgroundColor="#efefef";main.transcribe={};main.setInterval(function(){var selection=window.getSelection(),target=selection.focusNode;
if(!target)return;while(true){target=target.parentNode;if(target==null)return;if(target.classList&&target.classList.contains(gs.css("editor-fragment-textarea")))break}main.transcribe.current_selection={target:target,anchorNode:selection.anchorNode,focusNode:selection.focusNode,anchorOffset:selection.anchorOffset,focusOffset:selection.focusOffset}},100);main.transcribe.set_subslider_position_from_audio_position=function(time){if(!gs.user_data.options.transcript.view.show_playbar_slider)return;var fragment_list=
main.transcript.data.fragment_list;var fragment=main.wavesurfer.active_fragment;if(!fragment)return;var playbar_slider=fragment.fragment_element.playbar_slider;if(playbar_slider.user_defined.mouse_down)return;var n=fragment_list.indexOf(fragment),min=n==0?0:fragment_list[n-1].time_end/1E3,max=fragment.time_end/1E3;var percent=(time-min)/(max-min)*100;if(percent>=100&&gs.user_data.options.transcript.view.reset_playbar_slider_position_on_end)percent=0;playbar_slider.set_position_percent(percent>=100?
100:percent)};main.transcribe.revert_focus_to_last_textarea=function(){var selection=main.transcribe.current_selection;if(!selection||!selection.focusNode||!selection.target.parentNode==null)return;var range=document.createRange();range.setStart(selection.anchorNode,selection.anchorOffset);range.setEnd(selection.focusNode,selection.focusOffset);var window_selection=window.getSelection();window_selection.removeAllRanges();window_selection.addRange(range)};main.transcribe.sections={};main.transcribe.sections.fit_text=
function(section_list){if(!section_list)var section_list=main.transcript.data.section_list;if(!(section_list instanceof Array))section_list=[section_list];section_list.forEach(function(section){var section_element_inner=section.section_element_inner;var text_sub=dom.create("div",{parent:section_element_inner});var text_sub_sub=dom.create("div",{parent:text_sub,innerHTML:section.name});h.fit_text_to_parent(text_sub_sub);var common_font_size=text_sub_sub.style.fontSize;section_element_inner.style.fontSize=
text_sub_sub.style.fontSize;section_element_inner.innerHTML=section.name;var section_element_print=section.section_element_print;var section_element_inner_print=section.section_element_inner_print;section_element_print.style.display="block";var text_sub=dom.create("div",{parent:section_element_inner_print});var text_sub_sub=dom.create("div",{parent:text_sub,innerHTML:section.name});text_sub_sub.style.fontSize=common_font_size;section_element_inner_print.style.fontSize=text_sub_sub.style.fontSize;
section_element_inner_print.innerHTML=section.name;section_element_print.style.display=""})};main.transcribe.sections.add=function(new_section){var fragment=main.transcript.data.fragment_list.find(function(search_fragment){return search_fragment.id==new_section.fragment_id});delete new_section.fragment_id;new_section.starting_fragment=fragment;fragment.section_host=new_section;main.transcribe.sections.sort()};main.transcribe.sections.sort=function(){var section_list=main.transcript.data.section_list;
section_list.forEach(function(section){section.time_end_temp=section.starting_fragment.time_end});section_list.sort(function(a,b){var at=a.time_end_temp,bt=b.time_end_temp;return at>bt?1:at<bt?-1:0});section_list.forEach(function(section,i){delete section.time_end_temp})};main.transcribe.decrypt_text=function(base64_encoded_encryption_key,callback){function Uint8ArrayFromString(decoded){const buffer=new Uint8Array(new ArrayBuffer(decoded.length));for(let i=0;i<decoded.length;i++)buffer[i]=decoded.charCodeAt(i);
return buffer}var encryption_key=Uint8ArrayFromString(Base64.decode(base64_encoded_encryption_key));var transcript_data=main.transcript.data,header=transcript_data.header;transcript_data.fragment_list.forEach(function(fragment){var ciphertext=Base64.decode(fragment.encrypted_text);var ivlen=16,sha2len=32;var iv=Uint8ArrayFromString(ciphertext.substring(0,ivlen));var encryptedBytes=Uint8ArrayFromString(ciphertext.substring(ivlen+sha2len));var aesCbc=new aesjs.ModeOfOperation.cbc(encryption_key,iv);
var decryptedBytes=aesCbc.decrypt(encryptedBytes);fragment.text=aesjs.utils.utf8.fromBytes(decryptedBytes).substring(0,+fragment.text_length);delete fragment.encrypted_text;delete fragment.text_length;if(fragment.fragment_element)fragment.fragment_element.textarea.innerHTML=fragment.text});if(callback)callback()};var marker=main.transcribe.marker={};marker.current_highlighted_speaker=undefined;marker.current_highlighted_word=undefined;marker.highlight_speaker=function(speaker){if(speaker==marker.current_highlighted_speaker)return;
marker.clear();marker.current_highlighted_speaker=speaker;main.transcript.data.fragment_list.forEach(function(fragment){if(fragment.speaker_id==speaker.id)fragment.fragment_region.element.classList.add(gs.css("colorwave"))});main.dispatchEvent("transcript-highlight_speaker",{speaker:speaker})};marker.highlight_word=function(word){marker.clear();marker.current_highlighted_word=word;var match_whole_words_only=gs.user_data.options.transcript.search_settings.match_whole_words_only?"\\b":"";var match_case=
gs.user_data.options.transcript.search_settings.match_case?"":"i";var adjusted_word=match_whole_words_only+word+match_whole_words_only;var regex_switches="g"+match_case;main.transcript.data.fragment_list.forEach(function(fragment){var found_match=fragment.fragment_element.innerHTML.search(new RegExp(adjusted_word,regex_switches));if(found_match==-1)return;fragment.fragment_region.element.classList.add(gs.css("colorwave"))});main.session.log_standard({name:"highlight_word",word:word});main.dispatchEvent("transcript-highlight_word",
{word:word})};marker.clear=function(){main.transcript.data.fragment_list.forEach(function(fragment){fragment.fragment_region.element.classList.remove(gs.css("colorwave"))});if(marker.current_highlighted_speaker){main.dispatchEvent("transcript-unhighlight_speaker",{speaker:marker.current_highlighted_speaker});marker.current_highlighted_speaker=undefined}if(marker.current_highlighted_word){main.dispatchEvent("transcript-unhighlight_word",{speaker:marker.current_highlighted_word});marker.current_highlighted_word=
undefined}};main.transcribe.get_fragment_from_time=function(time){var fragment_list=main.transcript.data.fragment_list;var result=fragment_list.find(function(fragment){if(parseFloat(time)+.001<=fragment.time_end/1E3)return true});if(typeof result=="undefined")result=fragment_list[fragment_list.length-1];return result};main.transcribe.speaker_list_to_dropdown_array=function(){var speaker_list=main.transcript.data.speaker_list;var result=[];for(var speaker_id in speaker_list){var speaker=speaker_list[speaker_id];
result.push({text:speaker.name,value:speaker.id})}return result};main.transcribe.section_list_to_dropdown_array=function(){var section_list=main.transcript.data.section_list;var result=[];section_list.forEach(function(section){result.push({text:section.name,value:section.id})});return result};main.transcribe.speaker_set_color_event=function(colorbox_input){var color=colorbox_input.get_color();db.speaker_set({speaker_id:colorbox_input.speaker().id,color:color})};main.transcribe.reset_slider_position=
function(fragment){fragment.fragment_element.playbar_slider.set_position_percent(0)};main.transcribe.reset_slider_position_if_at_max=function(fragment){var sliderbar=fragment.fragment_element.playbar_slider;if(!sliderbar)return;var fragment_list=main.transcript.data.fragment_list;var n=fragment_list.indexOf(fragment);var min=n==0?0:fragment_list[n-1].time_end/1E3,max=fragment.time_end/1E3;var fractional_position=typeof sliderbar=="undefined"?0:sliderbar.position/sliderbar.position_logical_max;var time_start=
(max-min)*fractional_position+min;if(time_start>=max)if(gs.user_data.options.transcript.view.show_playbar_slider)main.transcribe.reset_slider_position(fragment)};main.transcribe.create_colorbox=function(init){var click_event_on="click_event_on"in init?init.click_event_on:true;var className=init.className;var classNameFull="editor-colorbox editor-speaker-colorbox "+className;if(!init.disabled){var speaker_colorbox=e.create_color_picker({parent:init.parent,className:classNameFull});speaker_colorbox.addEventListener("input",
function(evt){main.transcribe.speaker_set_color_event(evt.currentTarget)})}else{var speaker_colorbox=dom.create("div",{parent:init.parent,className:classNameFull});speaker_colorbox.fragment=init.fragment;speaker_colorbox.set_color=function(color){this.style.backgroundColor=color};speaker_colorbox.addEventListener("contextmenu",function(evt){evt.preventDefault();speaker_colorbox_click_event(evt)});if(click_event_on)speaker_colorbox.addEventListener(gs.events.POINT,speaker_colorbox_click_event);function speaker_colorbox_click_event(evt){var speaker_colorbox=
evt.currentTarget;var last_fragment=speaker_colorbox.fragment?speaker_colorbox.fragment:main.wavesurfer.active_fragment;var fragment_list=main.transcript.data.fragment_list;var colorbox_speaker_id=+speaker_colorbox.speaker().id;for(var i=0;i<fragment_list.length;i++){var current_fragment=fragment_list[i];if(current_fragment==last_fragment)break}var direction=evt.button==gs.constants.MOUSE_RIGHT?-1:1;for(var m=0;m<fragment_list.length;m++){i=(i+direction+fragment_list.length)%fragment_list.length;
var current_fragment=fragment_list[i];if(current_fragment.speaker_id==colorbox_speaker_id)break}if(m!=fragment_list.length){var target_fragment=fragment_list[i];main.wavesurfer.seek_fragment(target_fragment)}}}speaker_colorbox.speaker=init.speaker;speaker_colorbox.set_color(init.color?init.color:speaker_colorbox.speaker().color);return speaker_colorbox};main.transcribe.focus=function(fragment,do_blur){if(typeof do_blur=="undefined"||!do_blur){var fragment_to_blur=main.wavesurfer.focused_fragment;
if(fragment_to_blur==fragment)return;if(typeof fragment_to_blur!="undefined")this.focus(fragment_to_blur,true);main.wavesurfer.focused_fragment=fragment;main.dispatchEvent("transcript-set_focused_fragment",{fragment:fragment,previous_fragment:fragment_to_blur});if(typeof fragment=="undefined")return}var element=fragment.fragment_element;var edit_controls=element.edit_controls;if(edit_controls.right)edit_controls.right.style.display=do_blur?"none":"inline-block";if(edit_controls.add_section)edit_controls.add_section.style.display=
do_blur?"none":"inline-block";if(edit_controls.add_graphic)edit_controls.add_graphic.style.display=do_blur?"none":"inline-block";if(gs.user_data.options.transcript.view.show_playbar_slider)element.playbar_slider.style.display=do_blur?"none":"inline-block";if(gs.user_data.options.transcript.behavior.expand_slides_on_focus&&element.slide_wrapper)element.slide_wrapper.classList[do_blur?"add":"remove"](gs.css("editor-fragment-textarea-slide-contracted"));if(do_blur)main.transcribe.reset_slider_position(fragment)};
main.transcribe.focus_init=function(target_element){main.transcript.data.fragment_list.forEach(function(fragment){main.transcribe.focus(fragment,!(target_element==fragment.fragment_element))})};var load_pcm_file=main.transcribe.load_pcm_file=function(init){var error=init.error||function(){},success=init.success||function(){};h.get_data({plaintext:true,file:gs.compose_pcm_url(init.transcript_id),data:"",error:error,success:function(data){success(JSON.parse(data))}})};var gui={};gui.set_playpause_icon_status=
function(element,status){element.classList[status=="resting"?"add":"remove"]("glyphicon-play");element.classList[status=="resting"?"remove":"add"]("glyphicon-pause")};gui.get_playpause_icon_status=function(element){return element.classList.contains("glyphicon-play")==true?"resting":"playing"};var h=helperjs,e=gs.extrautilfuncs;var get_data=h.get_data,dom=h.dom;dom.detachAllRecursive(main);if(!history_control.defer)parent.innerHTML="";parent.appendChild(main);if(history_control.defer){main.style.visibility=
"hidden";main.style.height=0}var db=main.db=create_transcript_database_query_functions({dom:dom,get_data:get_data,main:main,event_dispatcher:main,transcript_container:main});var top_bar=main.top_bar=dom.create("div",{parent:main,className:"no-print top_bar"});if(typeof options.transcript_id!="undefined"&&gs.user_data.options.transcript.behavior.do_not_show_top_bar_when_loading&&(history_control.defer||gs.user_data.options.transcript.behavior.do_not_show_until_audio_is_loaded||gs.user_data.options.transcript.behavior.do_not_show_until_wave_is_loaded))top_bar.style.visibility=
"hidden";var global_speaker_list_form={};global_speaker_list_form.close=function(){};global_speaker_list_form.open=function(){if(main.action_lock.state)return;main.action_lock.set();var modal=smoke.alert("",function(result){},{title:{text:"Edit Owner Speaker List",close_reference:smoke.close_reference},ok:"Done"});modal.dialog.title_element.classList.add("smoke-dialog-title_with_tabs");main.action_lock.clear()};var transcript_settings={};transcript_settings.close=function(){};transcript_settings.open=
function(tab_name){var prompt=smoke.alert("",function(){delete transcript_settings.tabs.instance},{title:{close_reference:smoke.close_reference,text:"Transcript Settings"},tabs:{open_condition:function(tab_name,callback){if(!main.action_lock.state)callback(tab_name)},before_open:function(){main.action_lock.set()},list:transcript_settings.tabs.list}});transcript_settings.prompt=prompt;prompt.tabs.open(tab_name);prompt.style.display="none"};transcript_settings.tabs={list:{sharing:{title:"Sharing"},
alternate_titles:{title:"Alternate Titles"},keywords:{title:"Keywords"},event_date:{title:"Event Date"}}};transcript_settings.tabs.list.alternate_titles.open=function(){var modal=transcript_settings.prompt.tabs.refresh();main.action_lock.clear()};transcript_settings.tabs.list.event_date.open=function(){var calcTimezoneOffset=function(){return moment().utcOffset()*6E4};var modal=transcript_settings.prompt.tabs.refresh();var record_date=main.transcript.data.header.record_date;var date_input=dom.create("input",
{className:"transcript_settings-event_date",parent:modal.dialog.text}).dom.insertBefore();if(gs.plugins.flatpickr)style_loaded();else{gs.plugins.flatpickr=true;var head=document.head;var mainStyle=dom.create("link",{parent:head,charset:"utf-8",type:"text/css",rel:"stylesheet",media:"screen",href:"/js/plugins/flatpickr/flatpickr.min.css"});var materialBlue=dom.create("link",{parent:head,charset:"utf-8",type:"text/css",rel:"stylesheet",media:"screen",href:"/js/plugins/flatpickr/material_blue.css"});
var count=3,test_load=function(){count-=1;if(count==0)style_loaded()};mainStyle.addEventListener("load",test_load);materialBlue.addEventListener("load",test_load);e.get_script({file:"js/plugins/flatpickr/flatpickr.min.js",success:function(){gs.plugins.flatpickr=flatpickr;count-=1},error:main.send_errormessage})}function style_loaded(){var picker=flatpickr(date_input,{enableTime:true,dateFormat:"F J, Y, h:i K",onChange:function(selectedDates,dateStr,instance){var new_record_date=+selectedDates[0]+
calcTimezoneOffset();db.transcript_set({record_date:new_record_date/1E3})}});picker.setDate(new Date(record_date*1E3-calcTimezoneOffset()));main.action_lock.clear()}};transcript_settings.tabs.list.sharing.open=function(){get_data({success:function(){transcript_settings.prompt.style.display="";main.action_lock.clear();make_modal()},error:main.send_errormessage,file:"/dbrequest.php",data:"action\x3dtranscript-get"+"\x26transcript_id\x3d"+main.transcript.data.header.id+"\x26only_get_header\x3dtrue"});
function make_modal(){var modal=transcript_settings.prompt.tabs.refresh();var text=modal.dialog.text;var share_link_with_text_container=dom.create("div",{parent:text,className:"transcript_settings-share_link_with_text-container"});var share_link_with_text_text=dom.create("div",{parent:share_link_with_text_container,className:"transcript_settings-share_link_with_text-text",innerHTML:"Share link:\x26nbsp;\x26nbsp;"});var share_link_with_text_link=dom.create("div",{parent:share_link_with_text_container,
className:"transcript_settings-share_link_with_text-link",innerHTML:gs.link_url+"/play/"+main.transcript.data.header.shorturl});var set_pending_settings=function(evt,selected,callback){if(main.action_lock.state){callback(false);return}main.action_lock.set();var view_permissions=selected.value;get_data({success:function(result){main.action_lock.clear();main.transcript.data.header.view_permissions=view_permissions;callback(true)},error:function(err){main.send_errormessage(err);callback(false)},file:"/dbrequest.php",
data:"action\x3dtranscript-set"+"\x26transcript_id\x3d"+main.transcript.data.header.id+"\x26view_permissions\x3d"+view_permissions})};var dropdown=e.gui.dropdown.create({parent:text,clickEventType:gs.events.POINT,className:gs.css("dropdown"),onBeforeChange:set_pending_settings,hideMethod:"visibility",initialValue:main.transcript.data.header.view_permissions,list:[{text:'Only those with \x3cb style\x3d"color: #ce2038"\x3eexplicit\x3c/b\x3e permissions can view',value:"none"},{text:'Only those with the share link \x3cb style\x3d"color: #109414"\x3ecan view\x3c/b\x3e',
value:"shorturl"},{text:'\x3cb style\x3d"color: #109414"\x3eEveryone\x3c/b\x3e can view',value:"all"}]});dropdown.element.classList.add(gs.css("dropdown-fixed_size"))}};menu_system.populate({collapse_callback:function(){main.top_bar_middle.expand();main.top_bar_right.expand()},expand_callback:function(){main.top_bar_middle.collapse();main.top_bar_right.collapse();set_speaker_list_visibility(false)},parent:main.top_bar,expander_className:gs.css("top_bar-expander"),className:gs.css("top_bar-left"),
children:[{"label":"","click":menu_system.collapse,className:"glyphicon glyphicon-chevron-left"},{"label":"Owner Speaker List",condition:function(){return main.transcript&&main.transcript.data.writable},"click":global_speaker_list_form.open,"close":global_speaker_list_form.close},{"label":"Transcript settings",condition:function(){return main.transcript&&main.transcript.data.writable},"click":function(){transcript_settings.open("sharing")},"close":transcript_settings.close},{"label":"Related transcripts",
"click":transcript_list_view_open,"close":transcript_list_view_close},{"label":"New transcript",condition:function(){return gs.user_data.user_type.is_transcriptionist},"click":function(){upload_button.querySelector("input").click()}},{"label":function(){return!main.transcript?"":'Set mode to "'+(main.transcript.mode=="fragment"?"inaudibles":"fragments")+'"'},"condition":function(){return main.transcript&&main.transcript.data.writable},"callback":function(element){menu_system.dom.transcript_mode_toggle_menu_element=
element},"click":function(){if(typeof main.wavesurfer!="undefined")main.wavesurfer.set_mode(main.transcript.mode=="fragment"?"inaudible":"fragment")}},{"label":"Toggle larger slides","condition":function(){return main.transcript},"click":function(){var larger_slides=!gs.user_data.options.transcript.view.larger_slides;window.localStorage.setItem("user_data.options.transcript.view.larger_slides",larger_slides);var class_larger=gs.css("editor-fragment-slide-larger");main.transcript.data.fragment_list.forEach(function(fragment){if(fragment.fragment_element.slide_wrapper)fragment.fragment_element.slide_wrapper.classList.toggle(class_larger)})}}]});
main.addEventListener("transcript-mode_update",function(){if(menu_system.dom.transcript_mode_toggle_menu_element)menu_system.update(menu_system.dom.transcript_mode_toggle_menu_element)});main.addEventListener("transcript-remove",menu_system.update);main.addEventListener("transcript-add",menu_system.update);main.addEventListener("window-hashchange",function(evt){var fragment_list=main.transcript.data.fragment_list;var id=location.hash.substr(1),index=fragment_list.findIndex(function(fragment){if(fragment.id==
id)return true});main.wavesurfer.play_fragment(fragment_list[index])});main.addEventListener("window-zoom",window_zoom_or_resize);main.addEventListener("window-resize",window_zoom_or_resize);function window_zoom_or_resize(){if(!main.transcript)return;if(main.wavesurfer.active_fragment)main.wavesurfer.active_fragment.fragment_element.playbar_slider.update();if(main.wavesurfer)main.wavesurfer.customZoom.do();main.transcribe.sections.fit_text()}main.addEventListener("transcript-pause",function(){var fragment=
main.wavesurfer.active_fragment;if(!fragment)return;gui.set_playpause_icon_status(fragment.fragment_element.playbar_playpause,"resting")});main.addEventListener("transcript-play",function(){var fragment=main.wavesurfer.active_fragment;if(!fragment)return;main.transcribe.focus(fragment);gui.set_playpause_icon_status(fragment.fragment_element.playbar_playpause,"playing")});main.addEventListener("transcript-set_active_fragment",function(evt){var previous_fragment=evt.detail.previous_fragment,fragment=
evt.detail.fragment;main.transcribe.focus(fragment);var fragment_element=fragment.fragment_element;if(main.wavesurfer.isPlaying()){gui.set_playpause_icon_status(fragment_element.playbar_playpause,"playing");if(previous_fragment)gui.set_playpause_icon_status(previous_fragment.fragment_element.playbar_playpause,"resting")}fragment.fragment_element.playbar_slider.update();var background_color=gs.user_data.options.transcript.view.active_fragment_background_color;if(background_color){if(previous_fragment)fragment_element.style.backgroundColor=
"";fragment_element.style.backgroundColor="#ffffff";e.domColor.backgroundFade({element:fragment_element,start:background_color,end:e.domColor.backgroundColorHex(fragment.fragment_element),duration:1E3})}});var top_bar_middle=main.top_bar_middle=create_top_bar_middle({main:main,parent:top_bar,e:e,dom:dom,gs:gs,transcript_set:db.transcript_set,gui:gui});var top_bar_right=main.top_bar_right={},top_bar_right_element=top_bar_right.element=dom.create("div",{className:"top_bar-right",parent:top_bar});top_bar_right.expand=
function(){top_bar_right.element.style.visibility=""};top_bar_right.collapse=function(){top_bar_right.element.style.visibility="hidden"};top_bar_right.label_container=dom.create("div",{parent:top_bar_right.element,className:"editor-top_right_label_container",style:{visibility:"hidden"}}).dom.insertBefore(top_bar_right.element.firstChild);if(gs.user_data.options.transcript.view.time_position=="top-right"){var time_label=top_bar_right.time_label=dom.create("div",{parent:top_bar_right.label_container,
className:"editor-time_label editor-time_label-top_right"}).dom.insertBefore(top_bar_right.label_container.firstChild);var update_position=time_label.update_position=function(){var time=main.wavesurfer.getCurrentTime();time_label.innerHTML=e.timeFormat.secondsToString(+time,false,false)}}else{var time_label=top_bar_right.time_label=dom.create("div",{parent:audio_controls,className:"editor-moving_time_label"});time_label.innerHTML="\x26nbsp;";var update_position=time_label.update_position=function(){var time=
main.wavesurfer.getCurrentTime();time_label.innerHTML=e.timeFormat.secondsToString(+time,false,false);var left=parseFloat(wavesurfer.drawer.cursor.style.left)-wavesurfer.drawer.wrapper.scrollLeft-time_label.clientWidth/2;left=Math.round(left);if(left<0)left=0;else{var parentWidth=parseFloat(window.getComputedStyle(time_label.parentNode).width);if(left>parentWidth-time_label.clientWidth)left=parentWidth-time_label.clientWidth}time_label.style.left=left+"px"}}var help_button=create_help_menu({main:main,
parent:top_bar_right.label_container}).open_button;menu_system.update();main.content_window=dom.create("div",{parent:main,className:"content_window"}).dom.insertBefore(top_bar.nextElementSibling);main.loading_arrows=create_loading_arrows({dom:dom});if(gs.user_data.user_type.is_transcriptionist)var upload_button=create_transcript_upload_button({parent:main,gs:gs,helperjs:h,smoke:smoke,get_data:get_data,main:main,history_control:history_control,generate_and_render_transcript:generate_and_render_transcript});
if(!transcript_search.transcript_id)menu_system.expand();else{menu_system.collapse();load_transcript({transcript_id:transcript_search.transcript_id,fragment_id:transcript_search.fragment_id,show_loading_text:true})}function logout(){if(main.action_lock.state)return;main.action_lock.set();get_data({success:function(){main.action_lock.clear();if(menu_system.ribbon_menu&&menu_system.ribbon_menu.parentNode)menu_system.ribbon_menu.parentNode.removeChild(menu_system.ribbon_menu);if(menu_system.expander&&
menu_system.expander.parentNode)menu_system.expander.parentNode.removeChild(menu_system.expander);main.cleanup();history_control.load_page({page:"login"},{title:"Login"})},error:main.send_errormessage,file:"/dbrequest.php",data:"action\x3dlogout"})}function transcript_list_view_close(){var list_wrapper=main.transcript_list_wrapper;if(list_wrapper){list_wrapper.parentNode.removeChild(list_wrapper);delete main.transcript_list_wrapper;delete main.transcript_list}menu_system.set_title_text();menu_system.expander.set_class_name("default");
main.top_bar.children.forEach(function(e){if(e!=menu_system.expander&&e!=menu_system.ribbonmenu)e.style.display=""})}function transcript_list_view_open(){if(main.action_lock.state)return;main.action_lock.set();get_data({success:function(data){main.action_lock.clear();menu_system.collapse();menu_system.expander.set_class_name("close");main.top_bar.children.forEach(function(e){if(e!=menu_system.expander&&e!=menu_system.ribbonmenu)e.style.display="none"});menu_system.set_title_text("Select a transcript from the list.");
var transcript_list_data=data.transcript_list;var transcript_list_wrapper=main.transcript_list_wrapper=dom.create("div",{parent:main.content_window,className:"transcript_list_wrapper"}).dom.insertBefore(main.content_window.firstChild);var transcript_list=main.transcript_list=dom.create("div",{parent:transcript_list_wrapper,className:"transcript_list menulist menulist-vertical-flex menulist-vertical-flex-row menulist menulist-vertical-attached"});transcript_list_data.forEach(function(transcript_header){var transcript_selection=
dom.create("li",{parent:transcript_list,innerHTML:transcript_header.shortname?transcript_header.shortname:transcript_header.name});transcript_selection.addEventListener(gs.events.POINT,function(){if(main.action_lock.state)return;transcript_list_view_close();load_transcript({transcript_id:transcript_header.id,insert_url:true,show_loading_text:true})})})},error:main.send_errormessage,file:"/dbrequest.php",data:"action\x3dtranscript-list"+(!main.transcript||main.transcript.data.writable?"":"\x26state_page\x3d"+
main.history_control.current_state.page+"\x26source_username\x3d"+main.history_control.current_state.username)})}function load_transcript(init){if(main.action_lock.state)return;main.action_lock.set();var transcript_id=init.transcript_id,fragment_id=init.fragment_id,show_loading_text=init.show_loading_text,insert_url=init.insert_url;if(show_loading_text)main.system_message.set("Loading transcript...");main.dispatchEvent("transcript-add");if(main.wavesurfer)main.wavesurfer.pause();function send_errormessage_single(err){if(err_invoked)return;
err_invoked=true;main.loading_arrows.clear();main.system_message.clear();main.send_errormessage(err)}var load_count=0,err_invoked=false,transcript_data,peaks;main.loading_arrows.set(main.content_window);load_count+=1;load_pcm_file({transcript_id:transcript_id,error:send_errormessage_single,success:function(r){peaks=r;test()}});load_count+=1;db.transcript_get({transcript_id:transcript_id,error:send_errormessage_single,success:function(r){transcript_data=r;test()}});if(gs.user_data.user_type.is_transcriptionist){load_count+=
1;db.color_ideas_get({success:function(result){main.color_ideas=result;test()}})}function test(){load_count-=1;if(load_count!=0)return;main.action_lock.clear();var result={show_loading_text:show_loading_text,transcript_data:transcript_data,peaks:peaks,fragment_id_on_load:fragment_id};if(insert_url){var locationCurrent=window.location.href+"";e.trigger_once_on_condition(function(){return main.transcript&&main.transcript.data.header.id==transcript_data.header.id||window.location.href!=locationCurrent},
function(){generate_and_render_transcript(result)});history_control.insert_page({shorturl:undefined,page:"transcribe",username:transcript_data.header.username,urlname:transcript_data.header.urlname},{prefix:"",title:transcript_data.header.name})}else generate_and_render_transcript(result)}}function generate_and_render_transcript(init){main.system_message.clear();if(main.transcript)main.transcript.parentNode.removeChild(main.transcript);var transcript_data=init.transcript_data,peaks=init.peaks,fragment_id_on_load=
init.fragment_id_on_load,show_loading_text=init.show_loading_text;var transcriptParentFragment=new DocumentFragment;var transcript=main.transcript=dom.create("div",{parent:transcriptParentFragment,className:"editor"});transcript.parentFragment=transcriptParentFragment;transcript.setInterval(function(){main.session.log_standard_queue({name:"transcript_scroll_position",time:Math.ceil(+new Date/1E3),limit:180})},1E3);transcript.remove=function(){if(this.parentNode)this.parentNode.removeChild(this);dom.detachAllRecursive(this);
if(this==main.transcript)delete main.transcript;main.dispatchEvent("transcript-remove",this.mode)};main.set_transcript_title(transcript_data.header.name);void function(){transcript.data=transcript_data;transcript.data.peaks=peaks;transcript.data.autocomplete_tree=e.autocomplete({list:transcript.data.header.hint_words.split(",")});main.classList[transcript.data.writable?"add":"remove"](gs.css_class_prefix+"editing_enabled");main.classList[transcript.data.writable?"remove":"add"](gs.css_class_prefix+
"editing_disabled");main.session.log_standard({name:"transcript_loaded",timezone_offset:(new Date).getTimezoneOffset(),fragment_id:!init.fragment_id_on_load?null:init.fragment_id_on_load});if(transcript.data.writable)transcript.paintbucket={color_list:h.shuffle(main.color_ideas.slice()),color_current:-1,pick_color:function(n){this.color_current=(this.color_current+1)%this.color_list.length;return this.color_list[this.color_current]}};transcript_data.fragment_list=e.decolumnize_array(transcript_data.fragment_list);
for(var id in transcript_data.speaker_list)transcript_data.speaker_list[id].id=id;void function(){var section_list=transcript.data.section_list,fragment_list=transcript.data.fragment_list;section_list.forEach(function(section){var fragment=fragment_list.find(function(search_fragment){return search_fragment.id==section.fragment_id});delete section.fragment_id;section.starting_fragment=fragment;fragment.section_host=section});main.transcribe.sections.sort()}()}();void function(){var header=transcript.data.header;
var keyword_list=header.hint_words.split(",");var cutoff_amount=32;if(keyword_list.length>cutoff_amount)keyword_list.splice(cutoff_amount-1,keyword_list.length-cutoff_amount);keyword_list.push(header.name);if(header.stock_symbol)keyword_list.push(header.stock_symbol);if(header.shortname)keyword_list.push(header.shortname);var speaker_name_list=Object.values(transcript.data.speaker_list).map(function(speaker_data){return speaker_data.is_background?"":speaker_data.name});keyword_list.push(speaker_name_list);
var meta_list={title:header.name,keywords:keyword_list,description:header.description?header.description:header.name};e.add_or_update_meta_tags(meta_list)}();main.top_bar_middle.title_input_shortname.innerHTML=transcript_data.header.shortname!=""?transcript_data.header.shortname:transcript_data.header.name;if(main.transcript.data.writable){var settings_button=main.top_bar.settings_button;if(settings_button&&settings_button.parentNode)settings_button.parentNode.removeChild(settings_button);var settings_button=
main.top_bar.settings_button=dom.create("div",{className:"glyphicon custom_symbols custom_symbols-settings top_bar-button top_bar-button-gear-right",parent:top_bar_right.element});settings_button.addEventListener(gs.events.POINT,logout)}var transcript_description=dom.create("div",{parent:transcript,className:"editor-transcript_description"});var audio_controls=dom.create("div",{parent:transcript,className:"no-print editor-audio_controls"});var waveform=main.waveform=dom.create("div",{parent:audio_controls,
className:"waveform_wrapper"});if(gs.user_data.options.transcript.view.big_play_button){audio_controls.insertBefore(main.top_bar_middle.playpause,audio_controls.childNodes[0]);main.top_bar_middle.playpause.classList.remove(gs.css("top_bar-left-play_button"));main.top_bar_middle.playpause.classList.add(gs.css("editor-audio_controls-play_button"));audio_controls.classList.add(gs.css("editor-audio_controls-with_play_button"))}audio_controls.style.visibility="hidden";transcript_description.innerHTML=
transcript_data.header.description;var waveform_height=gs.user_data.options.transcript.view.waveform_height;var waveform_height_px=waveform_height=="normal"?96:waveform_height=="small"?64:waveform_height=="tiny"?48:96;var last_stored_time=window.localStorage.getItem("transcript-"+transcript_data.header.id+"-time");last_stored_time=last_stored_time==null?null:parseFloat(last_stored_time);setTimeout(function(){audio_controls.style.visibility="";var wavesurfer=main.wavesurfer=function(){return WaveSurfer.create({container:waveform,
height:waveform_height_px,cursorWidth:4,initialSeekPosition:(last_stored_time=="undefined"||last_stored_time==null)&&typeof fragment_id_on_load=="undefined"?0:function(){if(fragment_id_on_load)if(typeof wavesurfer.fragment_on_load!="undefined")return(wavesurfer.fragment_time_start(wavesurfer.fragment_on_load)+.01)/wavesurfer.computedDuration;else{var fragment=wavesurfer.fragment_on_load=transcript_data.fragment_list.find(function(search_fragment){return search_fragment.id==fragment_id_on_load});main.fragment_list_container.jump_to_fragment(fragment);
wavesurfer.play_fragment(fragment);return}return last_stored_time/wavesurfer.computedDuration},progressColor:"rgba(255,255,255,.58)",waveColor:"rgba(255,255,255,.58)",autoVisualRange:[.05,.95],renderer:"Canvas",backend:"MediaElement",minPxPerSec:1,normalize:true,invertTransparency:{cutColor:"black"},styleList:{wrapper:{cursor:"pointer",visibility:"hidden"},progressWave:{borderBottomStyle:"solid",borderBottomWidth:"8px"},wave:{borderBottomStyle:"solid",borderBottomWidth:"8px"}},classList:{cursor:gs.css("wavesurfer-cursor"),
progressWave:gs.css("wavesurfer-progresswave"),wave:gs.css("wavesurfer-wave")}})}();wavesurfer.on("audioprocess",top_bar_right.time_label.update_position);wavesurfer.on("seek",top_bar_right.time_label.update_position);void function(){var pause_original=wavesurfer.pause;wavesurfer.pause=function(){wavesurfer.on_ready=function(){};pause_original.call(wavesurfer)}}();void function(){wavesurfer.on("audioprocess",function(){audioprocess_or_seek("audioprocess")});wavesurfer.on("finish",function(){audioprocess_or_seek("audioprocess")});
wavesurfer.on("seek",function(time,click_from_waveform){audioprocess_or_seek("seek",click_from_waveform)});var saveTimeToLocalStorage=e.throttle(function(time){window.localStorage.setItem("transcript-"+transcript_data.header.id+"-time",time)},200);function audioprocess_or_seek(action,click_from_waveform){var region_being_dragged_while_playing=action=="audioprocess"&&wavesurfer.regionManager.regionAction;if(action=="seek"){if(typeof click_from_waveform=="undefined")click_from_waveform=true;if(click_from_waveform)wavesurfer.running_from_sub_player=
undefined}var time=wavesurfer.getCurrentTime();saveTimeToLocalStorage(time);var previous_fragment=wavesurfer.active_fragment;var fragment=wavesurfer.running_from_sub_player?wavesurfer.running_from_sub_player:main.transcribe.get_fragment_from_time(time);if(previous_fragment!=fragment&&!region_being_dragged_while_playing)wavesurfer.set_active_fragment(fragment);if(action=="seek"){if(!wavesurfer.not_first_jump)var savedScrollTop=main.fragment_list_container_wrapper.scrollTop;if(fragment!=previous_fragment&&
click_from_waveform&&gs.user_data.options.transcript.behavior.jump_to_clicked_fragment_on_wave)main.fragment_list_container.jump_to_fragment(fragment);if(!wavesurfer.not_first_jump)main.fragment_list_container_wrapper.scrollTop=savedScrollTop;wavesurfer.not_first_jump=true}else if(!region_being_dragged_while_playing){if(previous_fragment!=fragment)main.fragment_list_container.jump_to_fragment(fragment);if(gs.user_data.options.transcript.behavior.slowly_scroll_playing_fragment_element)scroll_element_fragment_by_time(get_fragment_and_previous_fragment_from_time(time),
time)}main.transcribe.set_subslider_position_from_audio_position(time);function scroll_element_fragment_by_time(fragment_list,time){var fragment=fragment_list[0],previous_fragment=fragment_list[1];var element=fragment.fragment_element;var container=main.fragment_list_container,container_wrapper=main.fragment_list_container_wrapper;var time_end=fragment.time_end/1E3,time_start=previous_fragment?previous_fragment.time_end/1E3:0;var scroll_ratio=(time-time_start)/(time_end-time_start);var newScrollTop=
element.offsetTop-parseFloat(window.getComputedStyle(container).paddingTop)-parseFloat(window.getComputedStyle(container_wrapper).paddingTop)+scroll_ratio*parseFloat(window.getComputedStyle(element).height)-gs.user_data.options.transcript.view.autoscroll_offset_height;if(newScrollTop<0)newScrollTop=0;container_wrapper.scrollTop=newScrollTop}function get_fragment_and_previous_fragment_from_time(time){var fragment_list=main.transcript.data.fragment_list;var index=fragment_list.findIndex(function(fragment){if(time<=
fragment.time_end/1E3)return true});return[fragment_list[index],fragment_list[index-1]]}}}();wavesurfer.set_active_fragment=function(fragment){if(wavesurfer.active_fragment==fragment)return;var previous_fragment=wavesurfer.active_fragment;wavesurfer.active_fragment=fragment;main.dispatchEvent("transcript-set_active_fragment",{fragment:fragment,previous_fragment:previous_fragment})};wavesurfer.compute_region_color=function(region,options){var previous_region=region.previous_region;var previous_speaker_id=
typeof previous_region=="undefined"?0:previous_region.fragment.speaker_id;var fragment=region.fragment;if(previous_speaker_id==0)var has_alt_color=false;else var has_alt_color=previous_speaker_id!=fragment.speaker_id?true:!previous_region.has_alt_color;region.has_alt_color=has_alt_color;var hexadecimal=main.transcript.data.speaker_list[fragment.speaker_id]["color"];var hex=has_alt_color?hexadecimal+"cc":h.hex_color_blend(hexadecimal,"#000000",.8)+"ff";return hex};wavesurfer.set_color_mode=function(color_mode){var fragment_list=
main.transcript.data.fragment_list;fragment_list.forEach(function(fragment){var region=fragment.fragment_region;var hex=wavesurfer.compute_region_color(region);if(color_mode=="greyscale"){var rgba=e.colorFormat.convert("hex","rgba");var color_array=rgba.substr(rgba.indexOf("(")+1,rgba.indexOf(")")-rgba.indexOf("(")-1).split(",");var average=Math.round((+color_array[0]+ +color_array[1]+ +color_array[2])/3);rgba="rgba("+average+", "+average+", "+average+", "+color_array[3]+")";hex=e.colorFormat.convert("rgba",
"hex")}region.color=hex;region.updateRender()})};wavesurfer.set_mode=function(mode){var overlay_types=["fragment","inaudible"];main.transcript.mode=mode;wavesurfer.set_color_mode(mode=="fragment"?"color":"greyscale");overlay_types.forEach(function(test_mode){var region_list=main.waveform.querySelectorAll("."+gs.css_class_prefix+test_mode+"_region");region_list.forEach(function(region){region.style.pointerEvents=test_mode==mode?"":"none"})});overlay_types.forEach(function(overlay_type){main.transcript.overlay_list[overlay_type]=
{visibility:overlay_type==main.transcript.mode?"visible":"hidden"}});main.dispatchEvent("transcript-mode_update",main.transcript.mode)};wavesurfer.load("https://audio."+gs.link_url.substr(gs.link_url.indexOf("www.")+4)+"/"+"0".repeat(6-(transcript_data.header.id+"").length)+transcript_data.header.id+"."+transcript_data.header.file_extension,transcript_data.peaks,false,{duration:transcript_data.header.audio_length_in_ms/1E3,numberOfChannels:1,createHTMLAudioElement:true});wavesurfer.computedDuration=
wavesurfer.getDuration();void function(){gs.localStorage.saveZoom=function(zoom){window.localStorage.setItem("transcript-"+transcript_data.header.id+"-zoom",zoom)};var zoom=wavesurfer.customZoom={};zoom.rawPxPerSec=Math.round(wavesurfer.getPxPerSec(wavesurfer.drawer.getWidth())*100)/100;zoom.min=1;zoom.max=20;if(!main.transcript.data.writable)zoom.current=zoom.min;else{zoom.current=window.localStorage.getItem("transcript-"+transcript_data.header.id+"-zoom");if(zoom.current=="undefined"){zoom.current=
zoom.min;gs.localStorage.saveZoom(zoom.current)}main.wavesurfer.zoom(zoom.rawPxPerSec*zoom.current)}zoom.do=function(){var waveform=main.waveform,margin=gs.user_data.options.transcript.view.waveform_margin_in_percent;waveform.style.width="";if(margin&&!gs.is_mobile_view){waveform.style.marginLeft=waveform.style.marginRight="calc("+margin+"% - 1px)";waveform.style.width="calc("+(100-margin*2)+"% + 2px)"}zoom.rawPxPerSec=wavesurfer.getPxPerSec(wavesurfer.drawer.getWidth());main.wavesurfer.zoom(zoom.rawPxPerSec*
zoom.current,function(){waveform.style.width=(wavesurfer.drawer.progressWave.clientWidth+wavesurfer.drawer.wave.clientWidth)/zoom.current+"px"})}}();waveform.addEventListener("mousewheel",function(evt){var zoom=wavesurfer.customZoom;evt.preventDefault();var direction=evt.deltaY,zoom_previous=zoom.current;zoom.current=zoom.current*(direction<0?1.075:.93023);if(zoom.current>zoom.max)zoom.current=zoom.max;else if(zoom.current<zoom.min)zoom.current=zoom.min;if(zoom.current==zoom_previous)return;gs.localStorage.saveZoom(zoom.current);
zoom.do();if(main.autospeech_test)main.autospeech_test.style.width=parseFloat(window.getComputedStyle(main.wavesurfer.container).width)*zoom.current+"px";main.top_bar_right.time_label.update_position()});document.body.subscribeToEvent(waveform,"keydown",function(evt){if(typeof evt.key=="undefined")return;var key=evt.key.toLowerCase();var preventDefault=true;var options_transcript=gs.user_data.options.transcript;var edit_settings=options_transcript.edit_settings,keys=options_transcript.keys;switch(key){default:preventDefault=
false;break;case keys.sloth_speed_key:wavesurfer.setPlaybackRate(edit_settings.sloth_speed_percent);break;case keys.slow_speed_key:wavesurfer.setPlaybackRate(edit_settings.slow_speed_percent);break;case keys.normal_speed_key:wavesurfer.setPlaybackRate(edit_settings.normal_speed_percent);break;case keys.time_loop_key:var max=wavesurfer.computedDuration;var current_time=wavesurfer.drawer.getCurrentProgress()*max;var time_start=current_time-edit_settings.time_loop_milliseconds/1E3<0?0:current_time-edit_settings.time_loop_milliseconds/
1E3;wavesurfer.play(time_start);setTimeout(function(){loop_again();function loop_again(){if(!main.transcript.replay)main.transcript.replay={};main.transcript.replay.previous_time=current_time;main.transcript.replay.timer=main.transcript.setTimeoutUpgraded(function(){wavesurfer.play(time_start);main.transcript.setTimeoutUpgraded(loop_again,0)},edit_settings.time_loop_milliseconds)}},0);break;case keys.time_back_key:var max=wavesurfer.computedDuration;var current_time=wavesurfer.drawer.getCurrentProgress()*
max;var time_start=current_time-edit_settings.time_back_milliseconds/1E3<0?0:current_time-edit_settings.time_back_milliseconds/1E3;wavesurfer.play(time_start);if(!main.transcript.replay)main.transcript.replay={};main.transcript.replay.previous_time=current_time;break;case keys.time_replay_start_key:var max=wavesurfer.computedDuration;var current_time=wavesurfer.drawer.getCurrentProgress()*max;var time_start=current_time-edit_settings.time_replay_milliseconds/1E3<0?0:current_time-edit_settings.time_replay_milliseconds/
1E3;wavesurfer.play(time_start);setTimeout(function(){if(!main.transcript.replay)main.transcript.replay={};main.transcript.replay.previous_time=current_time;main.transcript.replay.timer=main.transcript.setTimeoutUpgraded(wavesurfer.pause,edit_settings.time_replay_milliseconds)},0);break;case keys.time_replay_end_key:if(main.transcript.replay)wavesurfer.play(main.transcript.replay.previous_time);else wavesurfer.play();break;case keys.pause_toggle_key:if(wavesurfer.isPlaying()){main.wavesurfer.pause();
break}if(!wavesurfer.running_from_sub_player){wavesurfer.play();break}main.transcribe.reset_slider_position_if_at_max(wavesurfer.active_fragment);wavesurfer.play_fragment(wavesurfer.active_fragment);break;case keys.fragment_split_key:var split_time_in_seconds=wavesurfer.getCurrentTime();if(split_time_in_seconds!=0)fragment_split_event({time:split_time_in_seconds});break}if(preventDefault)evt.preventDefault();function fragment_split_event(init){var split_time=Math.round(init.time*1E3);var fragment_list=
main.transcript.data.fragment_list;var fragment_index=fragment_list.findIndex(function(fragment){return split_time<fragment.time_end});var fragment=fragment_list[fragment_index];if(fragment_list.length>1){if(fragment_index!=0&&fragment_list[fragment_index-1].time_end==split_time)return false;if(fragment_list[fragment_index].time_end==split_time)return false}var params={fragment_id:fragment.id,split_time:split_time,callback:function(){if(new_fragment_text=="")return;if(split_init){split_init.destructive=
true;e.splitElement(split_init)}if(fragment.fragment_element.textarea.textContent=="")fragment.fragment_element.textarea.innerHTML=""}};var selection=window.getSelection();if(selection.anchorNode==selection.focusNode&&selection.isCollapsed==1&&selection.rangeCount==1&&fragment.fragment_element.textarea.contains(selection.baseNode)){var split_init={destructive:false,target:fragment.fragment_element.textarea,splitNode:selection.baseNode,splitOffset:selection.anchorOffset};var split_text=e.splitElement(split_init);
var old_fragment_text=split_text.old.innerHTML.trim();if(split_text.old.textContent.trim()=="")old_fragment_text="";params.old_fragment_text=old_fragment_text;var new_fragment_text=split_text.new.innerHTML.trim();if(split_text.new.textContent.trim()=="")new_fragment_text="";params.new_fragment_text=new_fragment_text}db.fragment_create(params)}});render_speaker_list({main:main,parent:main,speaker_list:transcript_data.speaker_list});render_fragment_list({main:main,parent:transcript,fragment_list:transcript_data.fragment_list});
render_section_list({main:main,parent:main.fragment_list_container,section_list:transcript_data.section_list});render_info_header({main:main,parent:main.fragment_list_container});if(!main.transcript.data.writable)main.contextmenu=create_contextmenu({main:main});if(transcript_data.header.encryption_id)create_survey({main:main,parent:main.fragment_list_container});else if(!transcript_data.header.disable_surveys){var plead_text="This website is financially powered by requesting a survey be done for one every 3 transcripts. Do one early to feed the \x3ci\x3e\x3cb\x3eliterally starving\x3c/b\x3e\x3c/i\x3e developer?";
var modal=smoke.confirm(plead_text,function(result){if(result){var looking_for_surveys_text="Thank you for helping! Now generating the survey...";create_survey({is_bonus_survey:true,looking_for_surveys_text:looking_for_surveys_text,main:main,parent:main.fragment_list_container,skip_request:true})}},{title:{text:"Donate a few seconds of your time today!"},ok:"Feed them.",cancel:"Let them eat cake!"});modal.classList.add("smoke-survey_prerequest")}render_waveform_overlay({main:main,parent:transcript,
transcript_data:transcript_data,wavesurfer:wavesurfer});show_loading_text=false;if(show_loading_text){var loading_text="Loading transcript audio...";if(history_control.defer||gs.user_data.options.transcript.behavior.do_not_show_until_audio_is_loaded||gs.user_data.options.transcript.behavior.do_not_show_until_wave_is_loaded)main.system_message.set(loading_text);else{main.system_message.clear(loading_text);main.wavetext=dom.create("div",{parent:main.waveform,innerHTML:loading_text,className:"waveform_wrapper-wavetext"});
main.wavetext.style.height=main.wavetext.style.lineHeight=window.getComputedStyle(main.waveform).height}}audio_controls.style.visibility="hidden";transcript.style.backgroundColor="transparent";wavesurfer.drawer.wrapper.style.visibility="hidden";if(history_control.defer){parent.innerHTML="";parent.appendChild(main);parent.style.backgroundColor="#efefef";main.style.visibility="";main.style.height="";history_control.complete()}transcript.style.opacity="";transcript.style.backgroundColor="";var ready_event_name=
function(){if(history_control.defer)return"ready";if(gs.user_data.options.transcript.behavior.do_not_show_until_audio_is_loaded&&gs.user_data.options.transcript.behavior.do_not_show_until_wave_is_loaded)return"ready";if(gs.user_data.options.transcript.behavior.do_not_show_until_audio_is_loaded)return"canplay";if(gs.user_data.options.transcript.behavior.do_not_show_until_wave_is_loaded)return"waveform-drawn";return"initialized"}();function ready_event(){top_bar.style.visibility="";menu_system.update();
if(show_loading_text)main.system_message.clear();main.loading_arrows.clear();audio_controls.style.visibility="";wavesurfer.drawer.wrapper.style.visibility="";top_bar_right.label_container.style.visibility="";if(main.wavetext)main.wavetext.style.display="none";transcript.style.opacity="";main.content_window.appendChild(transcript.parentFragment);transcript.parentFragment=undefined;main.dispatchEvent("transcript-attach_to_dom");dom.onRemoved(transcript,function(){transcript.remove()});dom.onRemoved(waveform,
function(){wavesurfer.destroy()});main.dispatchEvent("window-resize");var fragment=!fragment_id_on_load?main.transcribe.get_fragment_from_time(last_stored_time):transcript_data.fragment_list.find(function(search_fragment){return search_fragment.id==fragment_id_on_load});if(transcript_data.header.encryption_id)fragment=transcript_data.fragment_list[0];if(fragment){main.fragment_list_container.jump_to_fragment(fragment);main.wavesurfer.seek_fragment(fragment)}main.dispatchEvent("transcript-ready_event_completed")}
if(ready_event_name=="initialized")ready_event();else wavesurfer.on(ready_event_name,ready_event);main.transcript.permission_level="edit";main.transcript.mode="fragment";main.transcript.overlay_list={};wavesurfer.set_mode(main.transcript.mode);main.dispatchEvent("transcript-mode_update",main.transcript.mode);main.dispatchEvent("transcript-load",main.transcript.mode)},1)}function set_speaker_list_visibility(visible){if(main.speaker_list_container_wrapper)main.speaker_list_container_wrapper.style.display=
visible?"":"none"}};